(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){"use strict";global.EffexApiClient=require("./index")}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./index":2}],2:[function(require,module,exports){"use strict";module.exports=require("./lib/apiclient")},{"./lib/apiclient":3}],3:[function(require,module,exports){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var api=function(ns){"use strict";var axios=require("axios");var config=require("./config.js");var ax=void 0;var admin=void 0;var apiEnv=void 0;var selectedEnv=void 0;var fb=require("./fb");ns.ax=axios.create();ns.setBase=function(base,adminKey){apiEnv.base=base||apiEnv.base;if(apiEnv.base){var bu=apiEnv.base+(apiEnv.basePort?":"+apiEnv.basePort:"");ax=axios.create({baseURL:bu})}admin=adminKey||admin;return ns};ns.getBase=function(){return ax.defaults.baseURL};ns.pingPush=function(){return fb.pingPush().then(function(result){return{ok:true,code:200,value:result}}).catch(function(err){return{ok:false,code:500,error:err}})};ns.pingPushOn=function(func,message){return fb.pingPushOn(func,message).then(function(result){return{ok:true,code:200,value:result}}).catch(function(err){return{ok:false,code:500,error:err}})};ns.setEnv=function(en){if(!config[en]){throw"unknown environment "+en}apiEnv=JSON.parse(JSON.stringify(config[en]));selectedEnv=en;ns.setBase();return ns};ns.setEnv("prod");ns.getUriParam=function(name,source){if((typeof window==="undefined"?"undefined":_typeof(window))===(typeof undefined==="undefined"?"undefined":_typeof(undefined)))return null;source=source||window.location&&window.location.search||"";var match=source&&RegExp("[?&]"+name+"=([^&]*)").exec(source);return source&&match&&decodeURIComponent(match[1].replace(/\+/g," "))};ns.getUriKeys=function(){var ob=["updater","reader","item","boss","writer","alias","id"].reduce(function(p,c){p[c]=ns.getUriParam(c);return p},{});ob.updater=ob.updater||ob.writer;ob.reader=ob.reader||ob.updater||ob.writer;return ob};var keys=ns.getUriKeys()||{};var session=Math.round(Math.random()*2048).toString(32)+(new Date).getTime().toString(32);var pushId=session;ns.getSession=function(){return session};ns.setSession=function(sessionName){session=sessionName;return ns};function makeParams(params){params=params||{};params.session=params.session||session;var pa=Object.keys(params).reduce(function(p,c){p.push(c+"="+encodeURIComponent(params[c]));return p},[]);return pa.length?"?"+pa.join("&"):""}function makeAdmin(params){return makeParams(_extends({},params||{},{admin:admin}))}ns.generateBoss=function(accountId,planId,params){return ax.get("/admin/account/"+accountId+"/boss/"+planId+makeAdmin(params))};ns.makeKeys=function(boss,params){var modes=["reader","writer","updater"];return Promise.all(modes.map(function(mode){return ax.get("/generate/"+boss+"/"+mode+makeParams(params))})).then(function(results){if(!results.every(function(d){return d.data&&d.data.ok})){throw"failed to generate all keys "+JSON.stringify(results.map(function(d){return d.data}))}else{ns.setKeys(modes.reduce(function(p,c,i){p[c]=results[i].data.keys[0];return p},{}))}return ns.getKeys()})};ns.generateKey=function(boss,mode,params){return ax.get("/generate/"+boss+"/"+mode+makeParams(params))};ns.ping=function(){return ax.get("/ping")};ns.info=function(){return ax.get("/info").then(function(r){r.data.clientInfo=config.clientInfo;r.data.endpoint=apiEnv.base;r.data.env=selectedEnv;return r})};ns.setKeys=function(pkeys){keys=pkeys};ns.getKeys=function(){return keys};ns.getQuotas=function(){return ax.get("/quotas")};ns.update=function(data,id,updater,method,params){method=method||"post";method=method.toLowerCase?method.toLowerCase():"";updater=updater||keys.updater;params=params||{};if(method==="get"){params=_extends({},params,{data:data});return ax.get("/updater/"+updater+"/"+encodeURIComponent(id)+makeParams(params))}else if(method==="post"){return ax.post("/updater/"+updater+"/"+encodeURIComponent(id)+makeParams(params),{data:data})}else{return Promise.reject("invalid method:"+method)}};ns.writeAlias=function(data,alias,writer,method,params){method=method||"POST";writer=writer||keys.writer;method=method.toLowerCase?method.toLowerCase():"";params=params||{};if(!alias){return Promise.reject("you need to provide an alias")}var url="/writer/"+writer+"/alias/"+alias+makeParams(params);if(method==="get"){params=_extends({},params,{data:JSON.stringify(data)});return ax.get(url)}else if(method==="post"){return ax.post(url,{data:data})}else{return Promise.reject("invalid method:"+method)}};ns.write=function(data,writer,method,params){method=method||"POST";writer=writer||keys.writer;method=method.toLowerCase?method.toLowerCase():"";params=params||{};if(method==="get"){params=_extends({},params,{data:JSON.stringify(data)});return ax.get("/writer/"+writer+makeParams(params))}else if(method==="post"){return ax.post("/writer/"+writer+makeParams(params),{data:data})}else{return Promise.reject("invalid method:"+method)}};ns.on=function(event,id,key,callback,options,params){var pack=defWatchParams_(callback,options);if(!pack.data.ok){return Promise.reject(pack)}var watch=pack.data.value;watch.event=event;watch.options.uq=Math.round(Math.random()*2048).toString(32)+(new Date).getTime().toString(32);watch.watchable=watch.options.uq;return ns.onRegister(id,key,event,watch.options,params).then(function(result){watch.watchable=result.data.watchable;ns.watching[watch.watchable]=watch;if(!result.data.ok)return Promise.reject(result.data);if(watch.options.type==="push"){return fb.setOn("uqs",watch.options.uq,function(pack){if(!pack.ok){console.log(".. detected change with no data - probably new item",watch.options.uq)}return ns.getWatchable(result.data.watchable,key).then(function(w){if(!w.data.ok){console.error("didnt get watchable ",w.data);return Promise.reject(w.data)}else{var p=w.data;callback(result.data.watchable,p);return p}}).catch(function(err){throw"failed to getwatchable "+result.data.watchable+" "+err})}).then(function(fon){return watch})}else if(watch.options.type==="pull"){doPull_(key,watch,params);return watch}else if(watch.options.type==="url"){return watch}else return Promise.reject({ok:false,code:500,error:watch.options.type+" went bad"})})};function doPull_(key,watch,params){params=params||{};var since=params.since||watch.options.start||0;function p(){if(watch.stopped)return;ns.getWatchable(watch.watchable,key,params).then(function(result){var pack=result.data;if(!pack.ok){watch.stopped=true;watch.callback(watch.watchable,pack)}if(pack.latestObservation&&since<pack.latestObservation&&!watch.stopped){since=pack.latestObservation+1;watch.callback(watch.watchable,pack)}ns.handyTimer(watch.options.frequency*1e3,watch.watchable).then(p)})}return p()}function defWatchParams_(callback,options){var models={push:["type","start","message","reader"],pull:["type","start","message","frequency","reader"],url:["type","start","message","method","reader"]};options=options||{};var type=options.type||"push";var watch={options:{type:type,start:-1,message:""}};var pack={data:{ok:false,error:"unknown model type",code:400,value:options}};if(!models[type])return pack;var fails=Object.keys(options).filter(function(d){return models[type].indexOf(d)===-1});if(fails.length){pack.data.error="invalid watch option properties "+fails.join(",");return pack}Object.keys(options).forEach(function(d){watch.options[d]=options[d]});if(type==="push"){watch.options.frequency=watch.options.frequency||30}else if(type==="url"){watch.options.method=watch.options.method||"POST";watch.options.url=callback;if(typeof callback!=="string"){return{data:{ok:false,error:"url string is needed for "+type+" callback",code:400,value:watch}}}}else{watch.callback=callback;if(typeof callback!=="function"){return{data:{ok:false,error:"function is needed for "+type+" callback",code:400,value:watch}}}}return{data:{ok:true,error:"",code:201,value:watch}}}ns.onRegister=function(id,key,event,data,params){params=params||{};data=data||{};data.pushid=pushId;return ax.post("/onregister/"+key+"/"+id+"/"+event+makeParams(params),{data:data})};ns.offRegister=function(watchable,params){return ax.delete("/offregister/"+watchable+makeParams(params))};ns.getWatchable=function(id,key,params){params=params||{};return ax.get("/watchable/"+id+"/"+key+makeParams(params))};ns.getEventLog=function(id,key,event,params){params=params||{};return ax.get("/eventlog/"+key+"/"+id+"/"+event+makeParams(params))};ns.release=function(id,updater,intent,params){params=params||{};return ax.delete("/release/"+id+"/"+updater+"/"+intent+makeParams(params))};ns.remove=function(id,writer,params){params=params||{};writer=writer||keys.writer;return ax.delete("/writer/"+writer+"/"+encodeURIComponent(id)+makeParams(params))};function read_(id,reader,params){params=params||{};reader=reader||keys.reader;return ax.get("/reader/"+reader+"/"+encodeURIComponent(id)+makeParams(params))}ns.read=function(id,reader,params){params=params||{};return ns.expBackoff(function(){return read_(id,reader,params)},function(lastResult){return params.backoff&&lastResult.data.code===423},{setWaitTime:function setWaitTime(waitTime,passes,result,proposed){return Math.min(proposed,(result&&result.data&&result.data.intentExpires||0)*1e3)}})};ns.validateKey=function(coupon){return ax.get("/validate/"+coupon)};ns.createProfile=function(authId){return ax.put("/admin/profile"+makeAdmin({authid:authId}))};ns.getProfile=function(authId){return ax.get("/admin/profile"+makeAdmin({authid:authId}))};ns.removeProfile=function(authId){return ax.delete("/admin/profile"+makeAdmin({authid:authId}))};ns.getAccount=function(accountId,authId){return ax.get("/admin/account/"+accountId+makeAdmin({authid:authId}))};ns.updateAccount=function(accountId,authId,active){return ax.put("/admin/account/"+accountId+makeAdmin({authid:authId,active:active?1:0}))};ns.addAccount=function(authId){return ax.put("/admin/account"+makeAdmin({authid:authId}))};ns.removeAccount=function(accountId,authId){return ax.delete("/admin/account/"+accountId+makeAdmin({authid:authId}))};ns.pruneBosses=function(accountId){return ax.delete("/admin/prune/"+accountId+makeAdmin())};ns.getBosses=function(accountId,authId){return ax.get("/admin/bosses/"+accountId+makeAdmin({authid:authId}))};ns.getStats=function(accountId,params){return ax.get("/admin/stats/"+accountId+makeAdmin(params))};ns.removeBosses=function(bossKeys){return ax.put("/admin/bosses/"+makeAdmin(),{data:{keys:bossKeys}})};ns.checkKeys=function(preview){if(!Array.isArray(preview))preview=[preview];return preview.every(function(d){return keys[d]})};ns.registerAlias=function(writer,key,id,alias,params){return ax.get("/"+writer+"/"+key+"/alias/"+encodeURIComponent(alias)+"/"+id+makeParams(params))};ns.watching={};ns.off=function(watchId){return new Promise(function(resolve,reject){var watch=ns.watching[watchId];if(watch){watch.stopped=true;delete ns.watching[watch.id]}return ns.offRegister(watchId).then(function(result){if(!result.data.ok&&watch&&watch.options.type==="pull")result.data.ok=true;resolve(result)}).catch(function(err){reject(err)})})};ns.getWatchLog=function(watchable,reader,params){return ax.get("/watchlog/"+watchable+"/"+reader+makeParams(params))};ns.promify=function(thing){var isPromise=!!thing&&((typeof thing==="undefined"?"undefined":_typeof(thing))==="object"||typeof thing==="function")&&typeof thing.then==="function";var isFunction=!isPromise&&!!thing&&typeof thing==="function";return Promise.resolve(isFunction?thing():thing)};ns.handyTimer=function(ms,packet){return new Promise(function(resolve,reject){setTimeout(function(){resolve(packet)},ms)})};ns.expBackoff=function(action,doRetry,options){options=options||{};function defaultWaitTime(waitTime,passes,result){return Math.pow(2,passes)*waitTime+Math.round(Math.random()*73)}var setWaitTime=function setWaitTime(waitTime,passes,result,proposed){return options.setWaitTime?options.setWaitTime(waitTime,passes,result,proposed):0};var waitTime=options.waitTime||500;var passes=options.passes||0;var maxPasses=options.maxPasses||6;var lastResult;return new Promise(function(resolve,reject){worker(waitTime);function worker(expTime){if(passes>=maxPasses){reject(lastResult)}else{if(passes)console.log("backoff pass:",passes);ns.promify(action).then(function(result){lastResult=result;if(doRetry(lastResult,passes++)){return ns.handyTimer(expTime).then(function(){var proposedWaitTime=defaultWaitTime(waitTime,passes,result);worker(setWaitTime(waitTime,passes,lastResult,proposedWaitTime)||proposedWaitTime)})}else{resolve(lastResult)}})}}})};return ns}({});module.exports=api;module.exports.default=api},{"./config.js":4,"./fb":5,axios:156}],4:[function(require,module,exports){"use strict";module.exports={prod:{base:"https://effex-fb.firebaseapp.com/v2",basePort:""},dev:{base:"https://efxapi.com/v2",basePort:""},debug:{base:"https://nodestuff-xlibersion.c9users.io",basePort:"8080"},fb:{base:"https://efxapi.com/v2",basePort:""},clientInfo:{version:"2.3.3",pushSupport:"firebase"},"firebase-config":{apiKey:"AIzaSyAV4YXlMsawxH6YikgSwq77voA1OFmb1Ag",authDomain:"effex-fb.firebaseapp.com",databaseURL:"https://effex-fb.firebaseio.com",projectId:"effex-fb",storageBucket:"effex-fb.appspot.com",messagingSenderId:"602603143811"}}},{}],5:[function(require,module,exports){"use strict";var firebase=require("firebase");module.exports=function(ns){ns.uid="";ns.init=function(){var config=require("./config")["firebase-config"];firebase.initializeApp(config);ns.db=firebase.database()};ns.in=function(){return ns.db?Promise.resolve(ns.uid):Promise.reject("first initialize firebase")};ns.pingPush=function(){return ns.fetch("services","ping/response")};ns.checkIn=function(){if(!ns.db){ns.init()}return ns.in()};ns.fetch=function(collection,doc){return ns.get(collection,doc).then(function(doc){var exists=doc.val()?true:false;var data=exists?doc.val():null;return data})};ns.get=function(collection,doc){return ns.ref(collection,doc).then(function(ref){return ref.once("value")})};ns.set=function(collection,doc,ob){return ns.ref(collection,doc).then(function(ref){return ref.set(ob)}).then(function(r){return ns.ref(collection,doc)})};ns.ref=function(collection,doc){return ns.checkIn().then(function(uid){return ns.db.ref(collection+"/"+doc)})};ns.pingPushOn=function(func,message){var now=(new Date).getTime();var doc="pingPushOn";var ob={message:message||"pingPushOn test",expires:now+3e4,created:new Date(now).toString(),docId:doc};return ns.setOn("uqs",doc,func).then(function(ref){return ref.set(ob)}).then(function(ref){return ob})};ns.setOn=function(collection,docr,func){return ns.ref(collection,docr).then(function(ref){ref.on("value",function(doc){var exists=doc.val()?true:false;var data=exists?doc.val():null;return func({ok:exists?true:false,value:data})});return ref})};return ns}({})},{"./config":4,firebase:184}],6:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var firebaseApp_1=require("./src/firebaseApp");exports.firebase=firebaseApp_1.createFirebaseNamespace();exports.default=exports.firebase},{"./src/firebaseApp":7}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("@firebase/util");var contains=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)};var DEFAULT_ENTRY_NAME="[DEFAULT]";var tokenListeners=[];var FirebaseAppImpl=function(){function FirebaseAppImpl(options,name,firebase_){this.firebase_=firebase_;this.isDeleted_=false;this.services_={};this.name_=name;this.options_=util_2.deepCopy(options);this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(callback){tokenListeners.push(callback);setTimeout(function(){return callback(null)},0)},removeAuthTokenListener:function(callback){tokenListeners=tokenListeners.filter(function(listener){return listener!==callback})}}}Object.defineProperty(FirebaseAppImpl.prototype,"name",{get:function(){this.checkDestroyed_();return this.name_},enumerable:true,configurable:true});Object.defineProperty(FirebaseAppImpl.prototype,"options",{get:function(){this.checkDestroyed_();return this.options_},enumerable:true,configurable:true});FirebaseAppImpl.prototype.delete=function(){var _this=this;return new Promise(function(resolve){_this.checkDestroyed_();resolve()}).then(function(){_this.firebase_.INTERNAL.removeApp(_this.name_);var services=[];Object.keys(_this.services_).forEach(function(serviceKey){Object.keys(_this.services_[serviceKey]).forEach(function(instanceKey){services.push(_this.services_[serviceKey][instanceKey])})});return Promise.all(services.map(function(service){return service.INTERNAL.delete()}))}).then(function(){_this.isDeleted_=true;_this.services_={}})};FirebaseAppImpl.prototype._getService=function(name,instanceIdentifier){if(instanceIdentifier===void 0){instanceIdentifier=DEFAULT_ENTRY_NAME}this.checkDestroyed_();if(!this.services_[name]){this.services_[name]={}}if(!this.services_[name][instanceIdentifier]){var instanceSpecifier=instanceIdentifier!==DEFAULT_ENTRY_NAME?instanceIdentifier:undefined;var service=this.firebase_.INTERNAL.factories[name](this,this.extendApp.bind(this),instanceSpecifier);this.services_[name][instanceIdentifier]=service}return this.services_[name][instanceIdentifier]};FirebaseAppImpl.prototype.extendApp=function(props){var _this=this;util_2.deepExtend(this,props);if(props.INTERNAL&&props.INTERNAL.addAuthTokenListener){tokenListeners.forEach(function(listener){_this.INTERNAL.addAuthTokenListener(listener)});tokenListeners=[]}};FirebaseAppImpl.prototype.checkDestroyed_=function(){if(this.isDeleted_){error("app-deleted",{name:this.name_})}};return FirebaseAppImpl}();FirebaseAppImpl.prototype.name&&FirebaseAppImpl.prototype.options||FirebaseAppImpl.prototype.delete||console.log("dc");function createFirebaseNamespace(){var apps_={};var factories={};var appHooks={};var namespace={__esModule:true,initializeApp:initializeApp,app:app,apps:null,Promise:Promise,SDK_VERSION:"4.6.1",INTERNAL:{registerService:registerService,createFirebaseNamespace:createFirebaseNamespace,extendNamespace:extendNamespace,createSubscribe:util_1.createSubscribe,ErrorFactory:util_2.ErrorFactory,removeApp:removeApp,factories:factories,useAsService:useAsService,Promise:Promise,deepExtend:util_2.deepExtend}};util_2.patchProperty(namespace,"default",namespace);Object.defineProperty(namespace,"apps",{get:getApps});function removeApp(name){var app=apps_[name];callAppHooks(app,"delete");delete apps_[name]}function app(name){name=name||DEFAULT_ENTRY_NAME;if(!contains(apps_,name)){error("no-app",{name:name})}return apps_[name]}util_2.patchProperty(app,"App",FirebaseAppImpl);function initializeApp(options,name){if(name===undefined){name=DEFAULT_ENTRY_NAME}else{if(typeof name!=="string"||name===""){error("bad-app-name",{name:name+""})}}if(contains(apps_,name)){error("duplicate-app",{name:name})}var app=new FirebaseAppImpl(options,name,namespace);apps_[name]=app;callAppHooks(app,"create");return app}function getApps(){return Object.keys(apps_).map(function(name){return apps_[name]})}function registerService(name,createService,serviceProperties,appHook,allowMultipleInstances){if(factories[name]){error("duplicate-service",{name:name})}factories[name]=createService;if(appHook){appHooks[name]=appHook;getApps().forEach(function(app){appHook("create",app)})}var serviceNamespace=function(appArg){if(appArg===void 0){appArg=app()}if(typeof appArg[name]!=="function"){error("invalid-app-argument",{name:name})}return appArg[name]()};if(serviceProperties!==undefined){util_2.deepExtend(serviceNamespace,serviceProperties)}namespace[name]=serviceNamespace;FirebaseAppImpl.prototype[name]=function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var serviceFxn=this._getService.bind(this,name);return serviceFxn.apply(this,allowMultipleInstances?args:[])};return serviceNamespace}function extendNamespace(props){util_2.deepExtend(namespace,props)}function callAppHooks(app,eventName){Object.keys(factories).forEach(function(serviceName){var factoryName=useAsService(app,serviceName);if(factoryName===null){return}if(appHooks[factoryName]){appHooks[factoryName](eventName,app)}})}function useAsService(app,name){if(name==="serverAuth"){return null}var useService=name;var options=app.options;return useService}return namespace}exports.createFirebaseNamespace=createFirebaseNamespace;function error(code,args){throw appErrors.create(code,args)}var errors={"no-app":"No Firebase App '{$name}' has been created - "+"call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$name}","duplicate-app":"Firebase App named '{$name}' already exists","app-deleted":"Firebase App named '{$name}' already deleted","duplicate-service":"Firebase service named '{$name}' already registered","sa-not-supported":"Initializing the Firebase SDK with a service "+"account is only allowed in a Node.js environment. On client "+"devices, you should instead initialize the SDK with an api key and "+"auth domain","invalid-app-argument":"firebase.{$name}() takes either no argument or a "+"Firebase App instance."};var appErrors=new util_2.ErrorFactory("app","Firebase",errors)},{"@firebase/util":139}],8:[function(require,module,exports){(function(global){(function(){var firebase=require("@firebase/app").default;var h,aa=aa||{},k=this;function m(a){return"string"==typeof a}function ba(a){return"boolean"==typeof a}function ca(){}function da(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";else if("function"==b&&"undefined"==typeof a.call)return"object";return b}function ea(a){return null===a}function fa(a){return"array"==da(a)}function ha(a){var b=da(a);return"array"==b||"object"==b&&"number"==typeof a.length}function p(a){return"function"==da(a)}function q(a){var b=typeof a;return"object"==b&&null!=a||"function"==b}var ia="closure_uid_"+(1e9*Math.random()>>>0),ja=0;function ka(a,b,c){return a.call.apply(a.bind,arguments)}function la(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function r(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?r=ka:r=la;return r.apply(null,arguments)}function ma(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}}var na=Date.now||function(){return+new Date};function t(a,b){function c(){}c.prototype=b.prototype;a.ib=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.Nc=function(a,c,f){for(var d=Array(arguments.length-2),e=2;e<arguments.length;e++)d[e-2]=arguments[e];return b.prototype[c].apply(a,d)}}function u(a){if(Error.captureStackTrace)Error.captureStackTrace(this,u);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))}t(u,Error);u.prototype.name="CustomError";function oa(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")}var pa=String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};function qa(a){if(!ra.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(sa,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(ta,"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(ua,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(va,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(wa,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(xa,"&#0;"));return a}var sa=/&/g,ta=/</g,ua=/>/g,va=/"/g,wa=/'/g,xa=/\x00/g,ra=/[\x00&<>"']/;function v(a,b){return-1!=a.indexOf(b)}function ya(a,b){return a<b?-1:a>b?1:0}function za(a,b){b.unshift(a);u.call(this,oa.apply(null,b));b.shift()}t(za,u);za.prototype.name="AssertionError";function Aa(a,b){throw new za("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1))}var Ba=Array.prototype.indexOf?function(a,b,c){return Array.prototype.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(m(a))return m(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1},w=Array.prototype.forEach?function(a,b,c){Array.prototype.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=m(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};function Ca(a,b){var c=a.length,d=m(a)?a.split(""):a;for(--c;0<=c;--c)c in d&&b.call(void 0,d[c],c,a)}var Da=Array.prototype.map?function(a,b,c){return Array.prototype.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=m(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e},Ea=Array.prototype.some?function(a,b,c){return Array.prototype.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=m(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};function Fa(a){a:{var b=Ga;for(var c=a.length,d=m(a)?a.split(""):a,e=0;e<c;e++)if(e in d&&b.call(void 0,d[e],e,a)){b=e;break a}b=-1}return 0>b?null:m(a)?a.charAt(b):a[b]}function Ha(a,b){return 0<=Ba(a,b)}function Ia(a,b){b=Ba(a,b);var c;(c=0<=b)&&Array.prototype.splice.call(a,b,1);return c}function Ja(a,b){var c=0;Ca(a,function(d,e){b.call(void 0,d,e,a)&&1==Array.prototype.splice.call(a,e,1).length&&c++})}function Ka(a){return Array.prototype.concat.apply([],arguments)}function La(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]}var Ma;a:{var Na=k.navigator;if(Na){var Oa=Na.userAgent;if(Oa){Ma=Oa;break a}}Ma=""}function x(a){return v(Ma,a)}function Pa(a,b){for(var c in a)b.call(void 0,a[c],c,a)}function Qa(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b}function Ra(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b}function Sa(a){for(var b in a)return!1;return!0}function Ta(a,b){for(var c in a)if(!(c in b)||a[c]!==b[c])return!1;for(c in b)if(!(c in a))return!1;return!0}function Ua(a){var b={},c;for(c in a)b[c]=a[c];return b}var Va="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Wa(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<Va.length;f++)c=Va[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}}function Xa(a){Xa[" "](a);return a}Xa[" "]=ca;function Ya(a,b){var c=Za;return Object.prototype.hasOwnProperty.call(c,a)?c[a]:c[a]=b(a)}var $a=x("Opera"),y=x("Trident")||x("MSIE"),ab=x("Edge"),bb=ab||y,cb=x("Gecko")&&!(v(Ma.toLowerCase(),"webkit")&&!x("Edge"))&&!(x("Trident")||x("MSIE"))&&!x("Edge"),db=v(Ma.toLowerCase(),"webkit")&&!x("Edge");function eb(){var a=k.document;return a?a.documentMode:void 0}var fb;a:{var gb="",hb=function(){var a=Ma;if(cb)return/rv\:([^\);]+)(\)|;)/.exec(a);if(ab)return/Edge\/([\d\.]+)/.exec(a);if(y)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(a);if(db)return/WebKit\/(\S+)/.exec(a);if($a)return/(?:Version)[ \/]?(\S+)/.exec(a)}();hb&&(gb=hb?hb[1]:"");if(y){var ib=eb();if(null!=ib&&ib>parseFloat(gb)){fb=String(ib);break a}}fb=gb}var Za={};function jb(a){return Ya(a,function(){for(var b=0,c=pa(String(fb)).split("."),d=pa(String(a)).split("."),e=Math.max(c.length,d.length),f=0;0==b&&f<e;f++){var g=c[f]||"",l=d[f]||"";do{g=/(\d*)(\D*)(.*)/.exec(g)||["","","",""];l=/(\d*)(\D*)(.*)/.exec(l)||["","","",""];if(0==g[0].length&&0==l[0].length)break;b=ya(0==g[1].length?0:parseInt(g[1],10),0==l[1].length?0:parseInt(l[1],10))||ya(0==g[2].length,0==l[2].length)||ya(g[2],l[2]);g=g[3];l=l[3]}while(0==b)}return 0<=b})}var kb;var lb=k.document;kb=lb&&y?eb()||("CSS1Compat"==lb.compatMode?parseInt(fb,10):5):void 0;function mb(a){a.prototype.then=a.prototype.then;a.prototype.$goog_Thenable=!0}function nb(a){if(!a)return!1;try{return!!a.$goog_Thenable}catch(b){return!1}}function ob(a,b,c){this.f=c;this.c=a;this.g=b;this.b=0;this.a=null}ob.prototype.get=function(){if(0<this.b){this.b--;var a=this.a;this.a=a.next;a.next=null}else a=this.c();return a};function pb(a,b){a.g(b);a.b<a.f&&(a.b++,b.next=a.a,a.a=b)}var rb=new ob(function(){return new qb},function(a){a.reset()},100);function sb(){var a=tb,b=null;a.a&&(b=a.a,a.a=a.a.next,a.a||(a.b=null),b.next=null);return b}function qb(){this.next=this.b=this.a=null}qb.prototype.set=function(a,b){this.a=a;this.b=b;this.next=null};qb.prototype.reset=function(){this.next=this.b=this.a=null};function vb(a){k.setTimeout(function(){throw a},0)}var wb;function xb(){var a=k.MessageChannel;"undefined"===typeof a&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!x("Presto")&&(a=function(){var a=document.createElement("IFRAME");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow;a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host;a=r(function(a){if(("*"==d||a.origin==d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!x("Trident")&&!x("MSIE")){var b=new a,c={},d=c;b.port1.onmessage=function(){if(void 0!==c.next){c=c.next;var a=c.pb;c.pb=null;a()}};return function(a){d.next={pb:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(a){var b=document.createElement("SCRIPT");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){k.setTimeout(a,0)}}function yb(a,b){zb||Ab();Bb||(zb(),Bb=!0);var c=tb,d=rb.get();d.set(a,b);c.b?c.b.next=d:c.a=d;c.b=d}var zb;function Ab(){if(-1!=String(k.Promise).indexOf("[native code]")){var a=k.Promise.resolve(void 0);zb=function(){a.then(Cb)}}else zb=function(){var a=Cb;!p(k.setImmediate)||k.Window&&k.Window.prototype&&!x("Edge")&&k.Window.prototype.setImmediate==k.setImmediate?(wb||(wb=xb()),wb(a)):k.setImmediate(a)}}var Bb=!1,tb=new function(){this.b=this.a=null};function Cb(){for(var a;a=sb();){try{a.a.call(a.b)}catch(b){vb(b)}pb(rb,a)}Bb=!1}function z(a,b){this.a=Db;this.i=void 0;this.f=this.b=this.c=null;this.g=this.h=!1;if(a!=ca)try{var c=this;a.call(b,function(a){Eb(c,Fb,a)},function(a){if(!(a instanceof Gb))try{if(a instanceof Error)throw a;throw Error("Promise rejected.")}catch(e){}Eb(c,Hb,a)})}catch(d){Eb(this,Hb,d)}}var Db=0,Fb=2,Hb=3;function Ib(){this.next=this.f=this.b=this.g=this.a=null;
this.c=!1}Ib.prototype.reset=function(){this.f=this.b=this.g=this.a=null;this.c=!1};var Jb=new ob(function(){return new Ib},function(a){a.reset()},100);function Kb(a,b,c){var d=Jb.get();d.g=a;d.b=b;d.f=c;return d}function A(a){if(a instanceof z)return a;var b=new z(ca);Eb(b,Fb,a);return b}function B(a){return new z(function(b,c){c(a)})}function Lb(a,b,c){Mb(a,b,c,null)||yb(ma(b,a))}function Nb(a){return new z(function(b,c){var d=a.length,e=[];if(d)for(var f=function(a,c){d--;e[a]=c;0==d&&b(e)},g=function(a){c(a)},l=0,n;l<a.length;l++)n=a[l],Lb(n,ma(f,l),g);else b(e)})}function Ob(a){return new z(function(b){var c=a.length,d=[];if(c)for(var e=function(a,e,f){c--;d[a]=e?{Qb:!0,value:f}:{Qb:!1,reason:f};0==c&&b(d)},f=0,g;f<a.length;f++)g=a[f],Lb(g,ma(e,f,!0),ma(e,f,!1));else b(d)})}z.prototype.then=function(a,b,c){return Pb(this,p(a)?a:null,p(b)?b:null,c)};mb(z);function Qb(a,b){b=Kb(b,b,void 0);b.c=!0;Rb(a,b);return a}h=z.prototype;h.s=function(a,b){return Pb(this,null,a,b)};h.cancel=function(a){this.a==Db&&yb(function(){var b=new Gb(a);Sb(this,b)},this)};function Sb(a,b){if(a.a==Db)if(a.c){var c=a.c;if(c.b){for(var d=0,e=null,f=null,g=c.b;g&&(g.c||(d++,g.a==a&&(e=g),!(e&&1<d)));g=g.next)e||(f=g);e&&(c.a==Db&&1==d?Sb(c,b):(f?(d=f,d.next==c.f&&(c.f=d),d.next=d.next.next):Tb(c),Ub(c,e,Hb,b)))}a.c=null}else Eb(a,Hb,b)}function Rb(a,b){a.b||a.a!=Fb&&a.a!=Hb||Vb(a);a.f?a.f.next=b:a.b=b;a.f=b}function Pb(a,b,c,d){var e=Kb(null,null,null);e.a=new z(function(a,g){e.g=b?function(c){try{var e=b.call(d,c);a(e)}catch(D){g(D)}}:a;e.b=c?function(b){try{var e=c.call(d,b);void 0===e&&b instanceof Gb?g(b):a(e)}catch(D){g(D)}}:g});e.a.c=a;Rb(a,e);return e.a}h.wc=function(a){this.a=Db;Eb(this,Fb,a)};h.xc=function(a){this.a=Db;Eb(this,Hb,a)};function Eb(a,b,c){a.a==Db&&(a===c&&(b=Hb,c=new TypeError("Promise cannot resolve to itself")),a.a=1,Mb(c,a.wc,a.xc,a)||(a.i=c,a.a=b,a.c=null,Vb(a),b!=Hb||c instanceof Gb||Wb(a,c)))}function Mb(a,b,c,d){if(a instanceof z)return Rb(a,Kb(b||ca,c||null,d)),!0;if(nb(a))return a.then(b,c,d),!0;if(q(a))try{var e=a.then;if(p(e))return Xb(a,e,b,c,d),!0}catch(f){return c.call(d,f),!0}return!1}function Xb(a,b,c,d,e){function f(a){l||(l=!0,d.call(e,a))}function g(a){l||(l=!0,c.call(e,a))}var l=!1;try{b.call(a,g,f)}catch(n){f(n)}}function Vb(a){a.h||(a.h=!0,yb(a.Mb,a))}function Tb(a){var b=null;a.b&&(b=a.b,a.b=b.next,b.next=null);a.b||(a.f=null);return b}h.Mb=function(){for(var a;a=Tb(this);)Ub(this,a,this.a,this.i);this.h=!1};function Ub(a,b,c,d){if(c==Hb&&b.b&&!b.c)for(;a&&a.g;a=a.c)a.g=!1;if(b.a)b.a.c=null,Yb(b,c,d);else try{b.c?b.g.call(b.f):Yb(b,c,d)}catch(e){Zb.call(null,e)}pb(Jb,b)}function Yb(a,b,c){b==Fb?a.g.call(a.f,c):a.b&&a.b.call(a.f,c)}function Wb(a,b){a.g=!0;yb(function(){a.g&&Zb.call(null,b)})}var Zb=vb;function Gb(a){u.call(this,a)}t(Gb,u);Gb.prototype.name="cancel";var $b=!y||9<=Number(kb);function ac(){this.a="";this.b=bc}ac.prototype.la=!0;ac.prototype.ja=function(){return this.a};ac.prototype.toString=function(){return"Const{"+this.a+"}"};function cc(a){if(a instanceof ac&&a.constructor===ac&&a.b===bc)return a.a;Aa("expected object of type Const, got '"+a+"'");return"type_error:Const"}var bc={};function dc(a){var b=new ac;b.a=a;return b}dc("");function ec(){this.a="";this.b=fc}ec.prototype.la=!0;ec.prototype.ja=function(){return this.a};ec.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};function gc(a){if(a instanceof ec&&a.constructor===ec&&a.b===fc)return a.a;Aa("expected object of type TrustedResourceUrl, got '"+a+"' of type "+da(a));return"type_error:TrustedResourceUrl"}function hc(a,b){a=ic(a,b);b=new ec;b.a=a;return b}function ic(a,b){var c=cc(a);if(!jc.test(c))throw Error("Invalid TrustedResourceUrl format: "+c);return c.replace(kc,function(a,e){if(!Object.prototype.hasOwnProperty.call(b,e))throw Error('Found marker, "'+e+'", in format string, "'+c+'", but no valid label mapping found in args: '+JSON.stringify(b));a=b[e];return a instanceof ac?cc(a):encodeURIComponent(String(a))})}var kc=/%{(\w+)}/g,jc=/^(?:https:)?\/\/[0-9a-z.:[\]-]+\/|^\/[^\/\\]|^about:blank(#|$)/i,fc={};function lc(){this.a="";this.b=mc}lc.prototype.la=!0;lc.prototype.ja=function(){return this.a};lc.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};function nc(a){if(a instanceof lc&&a.constructor===lc&&a.b===mc)return a.a;Aa("expected object of type SafeUrl, got '"+a+"' of type "+da(a));return"type_error:SafeUrl"}var oc=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function pc(a){if(a instanceof lc)return a;a=a.la?a.ja():String(a);oc.test(a)||(a="about:invalid#zClosurez");return qc(a)}var mc={};function qc(a){var b=new lc;b.a=a;return b}qc("about:blank");function rc(){this.a="";this.b=tc}rc.prototype.la=!0;rc.prototype.ja=function(){return this.a};rc.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};function uc(a){if(a instanceof rc&&a.constructor===rc&&a.b===tc)return a.a;Aa("expected object of type SafeHtml, got '"+a+"' of type "+da(a));return"type_error:SafeHtml"}var tc={};function vc(a){var b=new rc;b.a=a;return b}vc("<!DOCTYPE html>");vc("");vc("<br>");function wc(a){var b=document;return m(a)?b.getElementById(a):a}function xc(a,b){Pa(b,function(b,d){b&&b.la&&(b=b.ja());"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:yc.hasOwnProperty(d)?a.setAttribute(yc[d],b):0==d.lastIndexOf("aria-",0)||0==d.lastIndexOf("data-",0)?a.setAttribute(d,b):a[d]=b})}var yc={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function zc(a,b,c){var d=arguments,e=document,f=String(d[0]),g=d[1];if(!$b&&g&&(g.name||g.type)){f=["<",f];g.name&&f.push(' name="',qa(g.name),'"');if(g.type){f.push(' type="',qa(g.type),'"');var l={};Wa(l,g);delete l.type;g=l}f.push(">");f=f.join("")}f=e.createElement(f);g&&(m(g)?f.className=g:fa(g)?f.className=g.join(" "):xc(f,g));2<d.length&&Ac(e,f,d);return f}function Ac(a,b,c){function d(c){c&&b.appendChild(m(c)?a.createTextNode(c):c)}for(var e=2;e<c.length;e++){var f=c[e];!ha(f)||q(f)&&0<f.nodeType?d(f):w(Bc(f)?La(f):f,d)}}function Bc(a){if(a&&"number"==typeof a.length){if(q(a))return"function"==typeof a.item||"string"==typeof a.item;if(p(a))return"function"==typeof a.item}return!1}function Cc(a){var b=[];Dc(new Ec,a,b);return b.join("")}function Ec(){}function Dc(a,b,c){if(null==b)c.push("null");else{if("object"==typeof b){if(fa(b)){var d=b;b=d.length;c.push("[");for(var e="",f=0;f<b;f++)c.push(e),Dc(a,d[f],c),e=",";c.push("]");return}if(b instanceof String||b instanceof Number||b instanceof Boolean)b=b.valueOf();else{c.push("{");e="";for(d in b)Object.prototype.hasOwnProperty.call(b,d)&&(f=b[d],"function"!=typeof f&&(c.push(e),Fc(d,c),c.push(":"),Dc(a,f,c),e=","));c.push("}");return}}switch(typeof b){case"string":Fc(b,c);break;case"number":c.push(isFinite(b)&&!isNaN(b)?String(b):"null");break;case"boolean":c.push(String(b));break;case"function":c.push("null");break;default:throw Error("Unknown type: "+typeof b)}}}var Gc={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","":"\\u000b"},Hc=/\uffff/.test("ï¿¿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;function Fc(a,b){b.push('"',a.replace(Hc,function(a){var b=Gc[a];b||(b="\\u"+(a.charCodeAt(0)|65536).toString(16).substr(1),Gc[a]=b);return b}),'"')}function Ic(){0!=Jc&&(Kc[this[ia]||(this[ia]=++ja)]=this);this.oa=this.oa;this.Fa=this.Fa}var Jc=0,Kc={};Ic.prototype.oa=!1;function Lc(a){a.oa||(a.oa=!0,a.ta(),0!=Jc&&(a=a[ia]||(a[ia]=++ja),delete Kc[a]))}Ic.prototype.ta=function(){if(this.Fa)for(;this.Fa.length;)this.Fa.shift()()};var Mc=Object.freeze||function(a){return a};var Nc=!y||9<=Number(kb),Oc=y&&!jb("9"),Pc=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var a=!1,b=Object.defineProperty({},"passive",{get:function(){a=!0}});k.addEventListener("test",ca,b);k.removeEventListener("test",ca,b);return a}();function C(a,b){this.type=a;this.b=this.target=b;this.Ab=!0}C.prototype.c=function(){this.Ab=!1};function Qc(a,b){C.call(this,a?a.type:"");this.relatedTarget=this.b=this.target=null;this.button=this.screenY=this.screenX=this.clientY=this.clientX=0;this.key="";this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.pointerId=0;this.pointerType="";this.a=null;if(a){var c=this.type=a.type,d=a.changedTouches?a.changedTouches[0]:null;this.target=a.target||a.srcElement;this.b=b;if(b=a.relatedTarget){if(cb){a:{try{Xa(b.nodeName);var e=!0;break a}catch(f){}e=!1}e||(b=null)}}else"mouseover"==c?b=a.fromElement:"mouseout"==c&&(b=a.toElement);this.relatedTarget=b;null===d?(this.clientX=void 0!==a.clientX?a.clientX:a.pageX,this.clientY=void 0!==a.clientY?a.clientY:a.pageY,this.screenX=a.screenX||0,this.screenY=a.screenY||0):(this.clientX=void 0!==d.clientX?d.clientX:d.pageX,this.clientY=void 0!==d.clientY?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0);this.button=a.button;this.key=a.key||"";this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.pointerId=a.pointerId||0;this.pointerType=m(a.pointerType)?a.pointerType:Rc[a.pointerType]||"";this.a=a;a.defaultPrevented&&this.c()}}t(Qc,C);var Rc=Mc({2:"touch",3:"pen",4:"mouse"});Qc.prototype.c=function(){Qc.ib.c.call(this);var a=this.a;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,Oc)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};Qc.prototype.g=function(){return this.a};var Sc="closure_listenable_"+(1e6*Math.random()|0),Tc=0;function Uc(a,b,c,d,e){this.listener=a;this.a=null;this.src=b;this.type=c;this.capture=!!d;this.La=e;this.key=++Tc;this.ma=this.Ha=!1}function Vc(a){a.ma=!0;a.listener=null;a.a=null;a.src=null;a.La=null}function Wc(a){this.src=a;this.a={};this.b=0}function Xc(a,b,c,d,e,f){var g=b.toString();b=a.a[g];b||(b=a.a[g]=[],a.b++);var l=Yc(b,c,e,f);-1<l?(a=b[l],d||(a.Ha=!1)):(a=new Uc(c,a.src,g,!!e,f),a.Ha=d,b.push(a));return a}function Zc(a,b){var c=b.type;c in a.a&&Ia(a.a[c],b)&&(Vc(b),0==a.a[c].length&&(delete a.a[c],a.b--))}function Yc(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.ma&&f.listener==b&&f.capture==!!c&&f.La==d)return e}return-1}var $c="closure_lm_"+(1e6*Math.random()|0),ad={},bd=0;function cd(a,b,c,d,e){if(d&&d.once)dd(a,b,c,d,e);else if(fa(b))for(var f=0;f<b.length;f++)cd(a,b[f],c,d,e);else c=ed(c),a&&a[Sc]?fd(a,b,c,q(d)?!!d.capture:!!d,e):gd(a,b,c,!1,d,e)}function gd(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=q(e)?!!e.capture:!!e,l=hd(a);l||(a[$c]=l=new Wc(a));c=Xc(l,b,c,d,g,f);if(!c.a){d=id();c.a=d;d.src=a;d.listener=c;if(a.addEventListener)Pc||(e=g),void 0===e&&(e=!1),a.addEventListener(b.toString(),d,e);else if(a.attachEvent)a.attachEvent(jd(b.toString()),d);else throw Error("addEventListener and attachEvent are unavailable.");bd++}}function id(){var a=kd,b=Nc?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b}function dd(a,b,c,d,e){if(fa(b))for(var f=0;f<b.length;f++)dd(a,b[f],c,d,e);else c=ed(c),a&&a[Sc]?ld(a,b,c,q(d)?!!d.capture:!!d,e):gd(a,b,c,!0,d,e)}function E(a,b,c,d,e){if(fa(b))for(var f=0;f<b.length;f++)E(a,b[f],c,d,e);else(d=q(d)?!!d.capture:!!d,c=ed(c),a&&a[Sc])?(a=a.u,b=String(b).toString(),b in a.a&&(f=a.a[b],c=Yc(f,c,d,e),-1<c&&(Vc(f[c]),Array.prototype.splice.call(f,c,1),0==f.length&&(delete a.a[b],a.b--)))):a&&(a=hd(a))&&(b=a.a[b.toString()],a=-1,b&&(a=Yc(b,c,d,e)),(c=-1<a?b[a]:null)&&md(c))}function md(a){if("number"!=typeof a&&a&&!a.ma){var b=a.src;if(b&&b[Sc])Zc(b.u,a);else{var c=a.type,d=a.a;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(jd(c),d);bd--;(c=hd(b))?(Zc(c,a),0==c.b&&(c.src=null,b[$c]=null)):Vc(a)}}}function jd(a){return a in ad?ad[a]:ad[a]="on"+a}function nd(a,b,c,d){var e=!0;if(a=hd(a))if(b=a.a[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&f.capture==c&&!f.ma&&(f=od(f,d),e=e&&!1!==f)}return e}function od(a,b){var c=a.listener,d=a.La||a.src;a.Ha&&md(a);return c.call(d,b)}function kd(a,b){if(a.ma)return!0;if(!Nc){if(!b)a:{b=["window","event"];for(var c=k,d=0;d<b.length;d++)if(c=c[b[d]],null==c){b=null;break a}b=c}d=b;b=new Qc(d,this);c=!0;if(!(0>d.keyCode||void 0!=d.returnValue)){a:{var e=!1;if(0==d.keyCode)try{d.keyCode=-1;break a}catch(g){e=!0}if(e||void 0==d.returnValue)d.returnValue=!0}d=[];for(e=b.b;e;e=e.parentNode)d.push(e);a=a.type;for(e=d.length-1;0<=e;e--){b.b=d[e];var f=nd(d[e],a,!0,b);c=c&&f}for(e=0;e<d.length;e++)b.b=d[e],f=nd(d[e],a,!1,b),c=c&&f}return c}return od(a,new Qc(b,this))}function hd(a){a=a[$c];return a instanceof Wc?a:null}var pd="__closure_events_fn_"+(1e9*Math.random()>>>0);function ed(a){if(p(a))return a;a[pd]||(a[pd]=function(b){return a.handleEvent(b)});return a[pd]}function F(){Ic.call(this);this.u=new Wc(this);this.Eb=this;this.Ra=null}t(F,Ic);F.prototype[Sc]=!0;F.prototype.removeEventListener=function(a,b,c,d){E(this,a,b,c,d)};function G(a,b){var c,d=a.Ra;if(d)for(c=[];d;d=d.Ra)c.push(d);a=a.Eb;d=b.type||b;if(m(b))b=new C(b,a);else if(b instanceof C)b.target=b.target||a;else{var e=b;b=new C(d,a);Wa(b,e)}e=!0;if(c)for(var f=c.length-1;0<=f;f--){var g=b.b=c[f];e=qd(g,d,!0,b)&&e}g=b.b=a;e=qd(g,d,!0,b)&&e;e=qd(g,d,!1,b)&&e;if(c)for(f=0;f<c.length;f++)g=b.b=c[f],e=qd(g,d,!1,b)&&e}F.prototype.ta=function(){F.ib.ta.call(this);if(this.u){var a=this.u,b=0,c;for(c in a.a){for(var d=a.a[c],e=0;e<d.length;e++)++b,Vc(d[e]);delete a.a[c];a.b--}}this.Ra=null};function fd(a,b,c,d,e){Xc(a.u,String(b),c,!1,d,e)}function ld(a,b,c,d,e){Xc(a.u,String(b),c,!0,d,e)}function qd(a,b,c,d){b=a.u.a[String(b)];if(!b)return!0;b=b.concat();for(var e=!0,f=0;f<b.length;++f){var g=b[f];if(g&&!g.ma&&g.capture==c){var l=g.listener,n=g.La||g.src;g.Ha&&Zc(a.u,g);e=!1!==l.call(n,d)&&e}}return e&&0!=d.Ab}function rd(a,b,c){if(p(a))c&&(a=r(a,c));else if(a&&"function"==typeof a.handleEvent)a=r(a.handleEvent,a);else throw Error("Invalid listener argument");return 2147483647<Number(b)?-1:k.setTimeout(a,b||0)}function sd(a){var b=null;return new z(function(c,d){b=rd(function(){c(void 0)},a);-1==b&&d(Error("Failed to schedule timer."))}).s(function(a){k.clearTimeout(b);throw a})}function td(a,b,c,d,e){this.reset(a,b,c,d,e)}td.prototype.a=null;var ud=0;td.prototype.reset=function(a,b,c,d,e){"number"==typeof e||ud++;d||na();this.b=b;delete this.a};function vd(a){this.f=a;this.b=this.c=this.a=null}function wd(a,b){this.name=a;this.value=b}wd.prototype.toString=function(){return this.name};var xd=new wd("SEVERE",1e3),yd=new wd("CONFIG",700),zd=new wd("FINE",500);function Ad(a){if(a.c)return a.c;if(a.a)return Ad(a.a);Aa("Root logger has no level set.");return null}vd.prototype.log=function(a,b,c){if(a.value>=Ad(this).value)for(p(b)&&(b=b()),a=new td(a,String(b),this.f),c&&(a.a=c),c="log:"+a.b,(a=k.console)&&a.timeStamp&&a.timeStamp(c),(a=k.msWriteProfilerMark)&&a(c),c=this;c;)c=c.a};var Bd={},Cd=null;function Dd(a){Cd||(Cd=new vd(""),Bd[""]=Cd,Cd.c=yd);var b;if(!(b=Bd[a])){b=new vd(a);var c=a.lastIndexOf("."),d=a.substr(c+1);c=Dd(a.substr(0,c));c.b||(c.b={});c.b[d]=b;b.a=c;Bd[a]=b}return b}function Ed(a,b){this.b={};this.a=[];this.c=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else if(a){a instanceof Ed?(c=a.S(),d=a.P()):(c=Ra(a),d=Qa(a));for(var e=0;e<c.length;e++)this.set(c[e],d[e])}}h=Ed.prototype;h.P=function(){Fd(this);for(var a=[],b=0;b<this.a.length;b++)a.push(this.b[this.a[b]]);return a};h.S=function(){Fd(this);return this.a.concat()};h.clear=function(){this.b={};this.c=this.a.length=0};function Fd(a){if(a.c!=a.a.length){for(var b=0,c=0;b<a.a.length;){var d=a.a[b];Gd(a.b,d)&&(a.a[c++]=d);b++}a.a.length=c}if(a.c!=a.a.length){var e={};for(c=b=0;b<a.a.length;)d=a.a[b],Gd(e,d)||(a.a[c++]=d,e[d]=1),b++;a.a.length=c}}h.get=function(a,b){return Gd(this.b,a)?this.b[a]:b};h.set=function(a,b){Gd(this.b,a)||(this.c++,this.a.push(a));this.b[a]=b};h.forEach=function(a,b){for(var c=this.S(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};function Gd(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function H(a,b){a&&a.log(zd,b,void 0)}function Hd(a){return Da(a,function(a){a=a.toString(16);return 1<a.length?a:"0"+a}).join("")}var Id=null,Jd=null;function Kd(a){var b="";Ld(a,function(a){b+=String.fromCharCode(a)});return b}function Ld(a,b){function c(b){for(;d<a.length;){var c=a.charAt(d++),e=Jd[c];if(null!=e)return e;if(!/^[\s\xa0]*$/.test(c))throw Error("Unknown base64 encoding at char: "+c)}return b}Md();for(var d=0;;){var e=c(-1),f=c(0),g=c(64),l=c(64);if(64===l&&-1===e)break;b(e<<2|f>>4);64!=g&&(b(f<<4&240|g>>2),64!=l&&b(g<<6&192|l))}}function Md(){if(!Id){Id={};Jd={};for(var a=0;65>a;a++)Id[a]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(a),Jd[Id[a]]=a,62<=a&&(Jd["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(a)]=a)}}function Nd(a,b){this.g=[];this.v=a;this.o=b||null;this.f=this.a=!1;this.c=void 0;this.u=this.w=this.i=!1;this.h=0;this.b=null;this.l=0}Nd.prototype.cancel=function(a){if(this.a)this.c instanceof Nd&&this.c.cancel();else{if(this.b){var b=this.b;delete this.b;a?b.cancel(a):(b.l--,0>=b.l&&b.cancel())}this.v?this.v.call(this.o,this):this.u=!0;this.a||(a=new Od,Pd(this),Qd(this,!1,a))}};Nd.prototype.m=function(a,b){this.i=!1;Qd(this,a,b)};function Qd(a,b,c){a.a=!0;a.c=c;a.f=!b;Rd(a)}function Pd(a){if(a.a){if(!a.u)throw new Sd;a.u=!1}}Nd.prototype.A=function(a){Pd(this);Qd(this,!0,a)};function Td(a,b){Ud(a,null,b,void 0)}function Ud(a,b,c,d){a.g.push([b,c,d]);a.a&&Rd(a)}Nd.prototype.then=function(a,b,c){var d,e,f=new z(function(a,b){d=a;e=b});Ud(this,d,function(a){a instanceof Od?f.cancel():e(a)});return f.then(a,b,c)};mb(Nd);function Vd(a){return Ea(a.g,function(a){return p(a[1])})}function Rd(a){if(a.h&&a.a&&Vd(a)){var b=a.h,c=Wd[b];c&&(k.clearTimeout(c.a),delete Wd[b]);a.h=0}a.b&&(a.b.l--,delete a.b);b=a.c;for(var d=c=!1;a.g.length&&!a.i;){var e=a.g.shift(),f=e[0],g=e[1];e=e[2];if(f=a.f?g:f)try{var l=f.call(e||a.o,b);void 0!==l&&(a.f=a.f&&(l==b||l instanceof Error),a.c=b=l);if(nb(b)||"function"===typeof k.Promise&&b instanceof k.Promise)d=!0,a.i=!0}catch(n){b=n,a.f=!0,Vd(a)||(c=!0)}}a.c=b;d&&(l=r(a.m,a,!0),d=r(a.m,a,!1),b instanceof Nd?(Ud(b,l,d),b.w=!0):b.then(l,d));c&&(b=new Xd(b),Wd[b.a]=b,a.h=b.a)}function Sd(){u.call(this)}t(Sd,u);Sd.prototype.message="Deferred has already fired";Sd.prototype.name="AlreadyCalledError";function Od(){u.call(this)}t(Od,u);Od.prototype.message="Deferred was canceled";Od.prototype.name="CanceledError";function Xd(a){this.a=k.setTimeout(r(this.c,this),0);this.b=a}Xd.prototype.c=function(){delete Wd[this.a];throw this.b};var Wd={};function Yd(){this.b=-1}function Zd(a,b){this.b=-1;this.b=$d;this.f=k.Uint8Array?new Uint8Array(this.b):Array(this.b);this.g=this.c=0;this.a=[];this.i=a;this.h=b;this.l=k.Int32Array?new Int32Array(64):Array(64);ae||(k.Int32Array?ae=new Int32Array(be):ae=be);this.reset()}var ae;t(Zd,Yd);for(var $d=64,ce=$d-1,de=[],ee=0;ee<ce;ee++)de[ee]=0;var fe=Ka(128,de);Zd.prototype.reset=function(){this.g=this.c=0;this.a=k.Int32Array?new Int32Array(this.h):La(this.h)};function ge(a){for(var b=a.f,c=a.l,d=0,e=0;e<b.length;)c[d++]=b[e]<<24|b[e+1]<<16|b[e+2]<<8|b[e+3],e=4*d;for(b=16;64>b;b++){e=c[b-15]|0;d=c[b-2]|0;var f=(c[b-16]|0)+((e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3)|0,g=(c[b-7]|0)+((d>>>17|d<<15)^(d>>>19|d<<13)^d>>>10)|0;c[b]=f+g|0}d=a.a[0]|0;e=a.a[1]|0;var l=a.a[2]|0,n=a.a[3]|0,D=a.a[4]|0,ub=a.a[5]|0,sc=a.a[6]|0;f=a.a[7]|0;for(b=0;64>b;b++){var yj=((d>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10))+(d&e^d&l^e&l)|0;g=D&ub^~D&sc;f=f+((D>>>6|D<<26)^(D>>>11|D<<21)^(D>>>25|D<<7))|0;g=g+(ae[b]|0)|0;g=f+(g+(c[b]|0)|0)|0;f=sc;sc=ub;ub=D;D=n+g|0;n=l;l=e;e=d;d=g+yj|0}a.a[0]=a.a[0]+d|0;a.a[1]=a.a[1]+e|0;a.a[2]=a.a[2]+l|0;a.a[3]=a.a[3]+n|0;a.a[4]=a.a[4]+D|0;a.a[5]=a.a[5]+ub|0;a.a[6]=a.a[6]+sc|0;a.a[7]=a.a[7]+f|0}function he(a,b,c){void 0===c&&(c=b.length);var d=0,e=a.c;if(m(b))for(;d<c;)a.f[e++]=b.charCodeAt(d++),e==a.b&&(ge(a),e=0);else if(ha(b))for(;d<c;){var f=b[d++];if(!("number"==typeof f&&0<=f&&255>=f&&f==(f|0)))throw Error("message must be a byte array");a.f[e++]=f;e==a.b&&(ge(a),e=0)}else throw Error("message must be string or array");a.c=e;a.g+=c}var be=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function ie(){Zd.call(this,8,je)}t(ie,Zd);var je=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function ke(a){if(a.P&&"function"==typeof a.P)return a.P();if(m(a))return a.split("");if(ha(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return Qa(a)}function le(a){if(a.S&&"function"==typeof a.S)return a.S();if(!a.P||"function"!=typeof a.P){if(ha(a)||m(a)){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}return Ra(a)}}function me(a,b){if(a.forEach&&"function"==typeof a.forEach)a.forEach(b,void 0);else if(ha(a)||m(a))w(a,b,void 0);else for(var c=le(a),d=ke(a),e=d.length,f=0;f<e;f++)b.call(void 0,d[f],c&&c[f],a)}var ne=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function oe(a,b){if(a){a=a.split("&");for(var c=0;c<a.length;c++){var d=a[c].indexOf("="),e=null;if(0<=d){var f=a[c].substring(0,d);e=a[c].substring(d+1)}else f=a[c];b(f,e?decodeURIComponent(e.replace(/\+/g," ")):"")}}}function pe(a,b){this.b=this.l=this.c="";this.i=null;this.h=this.g="";this.f=!1;if(a instanceof pe){this.f=void 0!==b?b:a.f;qe(this,a.c);this.l=a.l;this.b=a.b;re(this,a.i);this.g=a.g;b=a.a;var c=new se;c.c=b.c;b.a&&(c.a=new Ed(b.a),c.b=b.b);te(this,c);this.h=a.h}else a&&(c=String(a).match(ne))?(this.f=!!b,qe(this,c[1]||"",!0),this.l=ue(c[2]||""),this.b=ue(c[3]||"",!0),re(this,c[4]),this.g=ue(c[5]||"",!0),te(this,c[6]||"",!0),this.h=ue(c[7]||"")):(this.f=!!b,this.a=new se(null,0,this.f))}pe.prototype.toString=function(){var a=[],b=this.c;b&&a.push(ve(b,we,!0),":");var c=this.b;if(c||"file"==b)a.push("//"),(b=this.l)&&a.push(ve(b,we,!0),"@"),a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c=this.i,null!=c&&a.push(":",String(c));if(c=this.g)this.b&&"/"!=c.charAt(0)&&a.push("/"),a.push(ve(c,"/"==c.charAt(0)?xe:ye,!0));(c=this.a.toString())&&a.push("?",c);(c=this.h)&&a.push("#",ve(c,ze));return a.join("")};function qe(a,b,c){a.c=c?ue(b,!0):b;a.c&&(a.c=a.c.replace(/:$/,""))}function re(a,b){if(b){b=Number(b);if(isNaN(b)||0>b)throw Error("Bad port number "+b);a.i=b}else a.i=null}function te(a,b,c){b instanceof se?(a.a=b,Ae(a.a,a.f)):(c||(b=ve(b,Be)),a.a=new se(b,0,a.f))}function I(a,b,c){a.a.set(b,c)}function Ce(a,b){return a.a.get(b)}function De(a){return a instanceof pe?new pe(a):new pe(a,void 0)}function Ee(a,b){var c=new pe(null,void 0);qe(c,"https");a&&(c.b=a);b&&(c.g=b);return c}function ue(a,b){return a?b?decodeURI(a.replace(/%25/g,"%2525")):decodeURIComponent(a):""}function ve(a,b,c){return m(a)?(a=encodeURI(a).replace(b,Fe),c&&(a=a.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),a):null}function Fe(a){a=a.charCodeAt(0);return"%"+(a>>4&15).toString(16)+(a&15).toString(16)}var we=/[#\/\?@]/g,ye=/[\#\?:]/g,xe=/[\#\?]/g,Be=/[\#\?@]/g,ze=/#/g;function se(a,b,c){this.b=this.a=null;this.c=a||null;this.f=!!c}function Ge(a){a.a||(a.a=new Ed,a.b=0,a.c&&oe(a.c,function(b,c){He(a,decodeURIComponent(b.replace(/\+/g," ")),c)}))}function Ie(a){var b=le(a);if("undefined"==typeof b)throw Error("Keys are undefined");var c=new se(null,0,void 0);a=ke(a);for(var d=0;d<b.length;d++){var e=b[d],f=a[d];fa(f)?Je(c,e,f):He(c,e,f)}return c}function He(a,b,c){Ge(a);a.c=null;b=Ke(a,b);var d=a.a.get(b);d||a.a.set(b,d=[]);d.push(c);a.b+=1}function Le(a,b){Ge(a);b=Ke(a,b);Gd(a.a.b,b)&&(a.c=null,a.b-=a.a.get(b).length,a=a.a,Gd(a.b,b)&&(delete a.b[b],a.c--,a.a.length>2*a.c&&Fd(a)))}h=se.prototype;h.clear=function(){this.a=this.c=null;this.b=0};function Me(a,b){Ge(a);b=Ke(a,b);return Gd(a.a.b,b)}h.forEach=function(a,b){Ge(this);this.a.forEach(function(c,d){w(c,function(c){a.call(b,c,d,this)},this)},this)};h.S=function(){Ge(this);for(var a=this.a.P(),b=this.a.S(),c=[],d=0;d<b.length;d++)for(var e=a[d],f=0;f<e.length;f++)c.push(b[d]);return c};h.P=function(a){Ge(this);var b=[];if(m(a))Me(this,a)&&(b=Ka(b,this.a.get(Ke(this,a))));else{a=this.a.P();for(var c=0;c<a.length;c++)b=Ka(b,a[c])}return b};h.set=function(a,b){Ge(this);this.c=null;a=Ke(this,a);Me(this,a)&&(this.b-=this.a.get(a).length);this.a.set(a,[b]);this.b+=1;return this};h.get=function(a,b){a=a?this.P(a):[];return 0<a.length?String(a[0]):b};function Je(a,b,c){Le(a,b);0<c.length&&(a.c=null,a.a.set(Ke(a,b),La(c)),a.b+=c.length)}h.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var a=[],b=this.a.S(),c=0;c<b.length;c++){var d=b[c],e=encodeURIComponent(String(d));d=this.P(d);for(var f=0;f<d.length;f++){var g=e;""!==d[f]&&(g+="="+encodeURIComponent(String(d[f])));a.push(g)}}return this.c=a.join("&")};function Ke(a,b){b=String(b);a.f&&(b=b.toLowerCase());return b}function Ae(a,b){b&&!a.f&&(Ge(a),a.c=null,a.a.forEach(function(a,b){var c=b.toLowerCase();b!=c&&(Le(this,b),Je(this,c,a))},a));a.f=b}function Ne(){}Ne.prototype.c=null;function Oe(a){return a.c||(a.c=a.b())}var Pe;function Qe(){}t(Qe,Ne);Qe.prototype.a=function(){var a=Re(this);return a?new ActiveXObject(a):new XMLHttpRequest};Qe.prototype.b=function(){var a={};Re(this)&&(a[0]=!0,a[1]=!0);return a};function Re(a){if(!a.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var b=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],c=0;c<b.length;c++){var d=b[c];try{return new ActiveXObject(d),a.f=d}catch(e){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return a.f}Pe=new Qe;function Se(a){F.call(this);this.headers=new Ed;this.w=a||null;this.b=!1;this.v=this.a=null;this.g=this.I=this.i="";this.c=this.G=this.h=this.A=!1;this.f=0;this.m=null;this.l=Te;this.o=this.N=!1}t(Se,F);var Te="",Ue=Se.prototype,Ve=Dd("goog.net.XhrIo");Ue.J=Ve;var We=/^https?$/i,Xe=["POST","PUT"];function Ye(a,b,c,d,e){if(a.a)throw Error("[goog.net.XhrIo] Object is active with another request="+a.i+"; newUri="+b);c=c?c.toUpperCase():"GET";a.i=b;a.g="";a.I=c;a.A=!1;a.b=!0;a.a=a.w?a.w.a():Pe.a();a.v=a.w?Oe(a.w):Oe(Pe);a.a.onreadystatechange=r(a.zb,a);try{H(a.J,Ze(a,"Opening Xhr")),a.G=!0,a.a.open(c,String(b),!0),a.G=!1}catch(g){H(a.J,Ze(a,"Error opening Xhr: "+g.message));$e(a,g);return}b=d||"";var f=new Ed(a.headers);e&&me(e,function(a,b){f.set(b,a)});e=Fa(f.S());d=k.FormData&&b instanceof k.FormData;!Ha(Xe,c)||e||d||f.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");f.forEach(function(a,b){this.a.setRequestHeader(b,a)},a);a.l&&(a.a.responseType=a.l);"withCredentials"in a.a&&a.a.withCredentials!==a.N&&(a.a.withCredentials=a.N);try{af(a),0<a.f&&(a.o=bf(a.a),H(a.J,Ze(a,"Will abort after "+a.f+"ms if incomplete, xhr2 "+a.o)),a.o?(a.a.timeout=a.f,a.a.ontimeout=r(a.Ea,a)):a.m=rd(a.Ea,a.f,a)),H(a.J,Ze(a,"Sending request")),a.h=!0,a.a.send(b),a.h=!1}catch(g){H(a.J,Ze(a,"Send error: "+g.message)),$e(a,g)}}function bf(a){return y&&jb(9)&&"number"==typeof a.timeout&&void 0!==a.ontimeout}function Ga(a){return"content-type"==a.toLowerCase()}h=Se.prototype;h.Ea=function(){"undefined"!=typeof aa&&this.a&&(this.g="Timed out after "+this.f+"ms, aborting",H(this.J,Ze(this,this.g)),G(this,"timeout"),this.abort(8))};function $e(a,b){a.b=!1;a.a&&(a.c=!0,a.a.abort(),a.c=!1);a.g=b;cf(a);df(a)}function cf(a){a.A||(a.A=!0,G(a,"complete"),G(a,"error"))}h.abort=function(){this.a&&this.b&&(H(this.J,Ze(this,"Aborting")),this.b=!1,this.c=!0,this.a.abort(),this.c=!1,G(this,"complete"),G(this,"abort"),df(this))};h.ta=function(){this.a&&(this.b&&(this.b=!1,this.c=!0,this.a.abort(),this.c=!1),df(this,!0));Se.ib.ta.call(this)};h.zb=function(){this.oa||(this.G||this.h||this.c?ef(this):this.fc())};h.fc=function(){ef(this)};function ef(a){if(a.b&&"undefined"!=typeof aa)if(a.v[1]&&4==ff(a)&&2==gf(a))H(a.J,Ze(a,"Local request error detected and ignored"));else if(a.h&&4==ff(a))rd(a.zb,0,a);else if(G(a,"readystatechange"),4==ff(a)){H(a.J,Ze(a,"Request complete"));a.b=!1;try{var b=gf(a);a:switch(b){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break a;default:c=!1}var d;if(!(d=c)){var e;if(e=0===b){var f=String(a.i).match(ne)[1]||null;if(!f&&k.self&&k.self.location){var g=k.self.location.protocol;f=g.substr(0,g.length-1)}e=!We.test(f?f.toLowerCase():"")}d=e}if(d)G(a,"complete"),G(a,"success");else{try{var l=2<ff(a)?a.a.statusText:""}catch(n){H(a.J,"Can not get status: "+n.message),l=""}a.g=l+" ["+gf(a)+"]";cf(a)}}finally{df(a)}}}function df(a,b){if(a.a){af(a);var c=a.a,d=a.v[0]?ca:null;a.a=null;a.v=null;b||G(a,"ready");try{c.onreadystatechange=d}catch(e){(a=a.J)&&a.log(xd,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function af(a){a.a&&a.o&&(a.a.ontimeout=null);"number"==typeof a.m&&(k.clearTimeout(a.m),a.m=null)}function ff(a){return a.a?a.a.readyState:0}function gf(a){try{return 2<ff(a)?a.a.status:-1}catch(b){return-1}}function hf(a){try{return a.a?a.a.responseText:""}catch(b){return H(a.J,"Can not get responseText: "+b.message),""}}h.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.l){case Te:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var a=this.J;a&&a.log(xd,"Response type "+this.l+" is not supported on this browser",void 0);return null}catch(b){return H(this.J,"Can not get response: "+b.message),null}};function Ze(a,b){return b+" ["+a.I+" "+a.i+" "+gf(a)+"]"}var jf=/^[+a-zA-Z0-9_.!#$%&'*\/=?^`{|}~-]+@([a-zA-Z0-9-]+\.)+[a-zA-Z0-9]{2,63}$/;function kf(a){var b={},c=b.document||document,d=gc(a),e=document.createElement("SCRIPT"),f={Bb:e,Ea:void 0},g=new Nd(lf,f),l=null,n=null!=b.timeout?b.timeout:5e3;0<n&&(l=window.setTimeout(function(){mf(e,!0);var a=new nf(of,"Timeout reached for loading script "+d);Pd(g);Qd(g,!1,a)},n),f.Ea=l);e.onload=e.onreadystatechange=function(){e.readyState&&"loaded"!=e.readyState&&"complete"!=e.readyState||(mf(e,b.Oc||!1,l),g.A(null))};e.onerror=function(){mf(e,!0,l);var a=new nf(pf,"Error while loading script "+d);Pd(g);Qd(g,!1,a)};f=b.attributes||{};Wa(f,{type:"text/javascript",charset:"UTF-8"});xc(e,f);e.src=gc(a);qf(c).appendChild(e);return g}function qf(a){var b;return(b=(a||document).getElementsByTagName("HEAD"))&&0!=b.length?b[0]:a.documentElement}function lf(){if(this&&this.Bb){var a=this.Bb;a&&"SCRIPT"==a.tagName&&mf(a,!0,this.Ea)}}function mf(a,b,c){null!=c&&k.clearTimeout(c);a.onload=ca;a.onerror=ca;a.onreadystatechange=ca;b&&window.setTimeout(function(){a&&a.parentNode&&a.parentNode.removeChild(a)},0)}var pf=0,of=1;function nf(a,b){var c="Jsloader error (code #"+a+")";b&&(c+=": "+b);u.call(this,c);this.code=a}t(nf,u);function rf(){}t(rf,Ne);rf.prototype.a=function(){var a=new XMLHttpRequest;if("withCredentials"in a)return a;if("undefined"!=typeof XDomainRequest)return new sf;throw Error("Unsupported browser")};rf.prototype.b=function(){return{}};function sf(){this.a=new XDomainRequest;this.readyState=0;this.onreadystatechange=null;this.responseText="";this.status=-1;this.statusText=this.responseXML=null;
this.a.onload=r(this.Sb,this);this.a.onerror=r(this.wb,this);this.a.onprogress=r(this.Tb,this);this.a.ontimeout=r(this.Ub,this)}h=sf.prototype;h.open=function(a,b,c){if(null!=c&&!c)throw Error("Only async requests are supported.");this.a.open(a,b)};h.send=function(a){if(a)if("string"==typeof a)this.a.send(a);else throw Error("Only string data is supported");else this.a.send()};h.abort=function(){this.a.abort()};h.setRequestHeader=function(){};h.getResponseHeader=function(a){return"content-type"==a.toLowerCase()?this.a.contentType:""};h.Sb=function(){this.status=200;this.responseText=this.a.responseText;tf(this,4)};h.wb=function(){this.status=500;this.responseText="";tf(this,4)};h.Ub=function(){this.wb()};h.Tb=function(){this.status=200;tf(this,1)};function tf(a,b){a.readyState=b;if(a.onreadystatechange)a.onreadystatechange()}h.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType};function uf(){var a=J();return y&&!!kb&&11==kb||/Edge\/\d+/.test(a)}function vf(){return k.window&&k.window.location.href||""}function wf(a,b){b=b||k.window;var c="about:blank";a&&(c=nc(pc(a)));b.location.href=c}function xf(a,b){var c=[],d;for(d in a)d in b?typeof a[d]!=typeof b[d]?c.push(d):fa(a[d])?Ta(a[d],b[d])||c.push(d):"object"==typeof a[d]&&null!=a[d]&&null!=b[d]?0<xf(a[d],b[d]).length&&c.push(d):a[d]!==b[d]&&c.push(d):c.push(d);for(d in b)d in a||c.push(d);return c}function yf(){var a=J();a=zf(a)!=Af?null:(a=a.match(/\sChrome\/(\d+)/i))&&2==a.length?parseInt(a[1],10):null;return a&&30>a?!1:!y||!kb||9<kb}function Bf(a){a=(a||J()).toLowerCase();return a.match(/android/)||a.match(/webos/)||a.match(/iphone|ipad|ipod/)||a.match(/blackberry/)||a.match(/windows phone/)||a.match(/iemobile/)?!0:!1}function Cf(a){a=a||k.window;try{a.close()}catch(b){}}function Df(a,b,c){var d=Math.floor(1e9*Math.random()).toString();b=b||500;c=c||600;var e=(window.screen.availHeight-c)/2,f=(window.screen.availWidth-b)/2;b={width:b,height:c,top:0<e?e:0,left:0<f?f:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1};c=J().toLowerCase();d&&(b.target=d,v(c,"crios/")&&(b.target="_blank"));zf(J())==Ef&&(a=a||"http://localhost",b.scrollbars=!0);c=a||"";(d=b)||(d={});a=window;b=c instanceof lc?c:pc("undefined"!=typeof c.href?c.href:String(c));c=d.target||c.target;e=[];for(g in d)switch(g){case"width":case"height":case"top":case"left":e.push(g+"="+d[g]);break;case"target":case"noreferrer":break;default:e.push(g+"="+(d[g]?1:0))}var g=e.join(",");(x("iPhone")&&!x("iPod")&&!x("iPad")||x("iPad")||x("iPod"))&&a.navigator&&a.navigator.standalone&&c&&"_self"!=c?(g=a.document.createElement("A"),b instanceof lc||b instanceof lc||(b=b.la?b.ja():String(b),oc.test(b)||(b="about:invalid#zClosurez"),b=qc(b)),g.href=nc(b),g.setAttribute("target",c),d.noreferrer&&g.setAttribute("rel","noreferrer"),d=document.createEvent("MouseEvent"),d.initMouseEvent("click",!0,!0,a,1),g.dispatchEvent(d),g={}):d.noreferrer?(g=a.open("",c,g),a=nc(b),g&&(bb&&v(a,";")&&(a="'"+a.replace(/'/g,"%27")+"'"),g.opener=null,dc("b/12014412, meta tag with sanitized URL"),a='<META HTTP-EQUIV="refresh" content="0; url='+qa(a)+'">',a=vc(a),g.document.write(uc(a)),g.document.close())):g=a.open(nc(b),c,g);if(g)try{g.focus()}catch(l){}return g}function Ff(a){return new z(function(b){function c(){sd(2e3).then(function(){if(!a||a.closed)b();else return c()})}return c()})}var Gf=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/;function Hf(){var a=null;return new z(function(b){"complete"==k.document.readyState?b():(a=function(){b()},dd(window,"load",a))}).s(function(b){E(window,"load",a);throw b})}function If(){return Jf(void 0)?Hf().then(function(){return new z(function(a,b){var c=k.document,d=setTimeout(function(){b(Error("Cordova framework is not ready."))},1e3);c.addEventListener("deviceready",function(){clearTimeout(d);a()},!1)})}):B(Error("Cordova must run in an Android or iOS file scheme."))}function Jf(a){a=a||J();return!("file:"!==Kf()||!a.toLowerCase().match(/iphone|ipad|ipod|android/))}function Lf(){var a=k.window;try{return!(!a||a==a.top)}catch(b){return!1}}function K(){return firebase.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":firebase.INTERNAL.hasOwnProperty("node")?"Node":"Browser"}function Mf(){var a=K();return"ReactNative"===a||"Node"===a}var Ef="Firefox",Af="Chrome";function zf(a){var b=a.toLowerCase();if(v(b,"opera/")||v(b,"opr/")||v(b,"opios/"))return"Opera";if(v(b,"iemobile"))return"IEMobile";if(v(b,"msie")||v(b,"trident/"))return"IE";if(v(b,"edge/"))return"Edge";if(v(b,"firefox/"))return Ef;if(v(b,"silk/"))return"Silk";if(v(b,"blackberry"))return"Blackberry";if(v(b,"webos"))return"Webos";if(!v(b,"safari/")||v(b,"chrome/")||v(b,"crios/")||v(b,"android"))if(!v(b,"chrome/")&&!v(b,"crios/")||v(b,"edge/")){if(v(b,"android"))return"Android";if((a=a.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==a.length)return a[1]}else return Af;else return"Safari";return"Other"}var Nf={Cc:"FirebaseCore-web",Ec:"FirebaseUI-web"};function Of(a,b){b=b||[];var c=[],d={},e;for(e in Nf)d[Nf[e]]=!0;for(e=0;e<b.length;e++)"undefined"!==typeof d[b[e]]&&(delete d[b[e]],c.push(b[e]));c.sort();b=c;b.length||(b=["FirebaseCore-web"]);c=K();d="";"Browser"===c?d=zf(J()):d=c;return d+"/JsCore/"+a+"/"+b.join(",")}function J(){return k.navigator&&k.navigator.userAgent||""}function L(a,b){a=a.split(".");b=b||k;for(var c=0;c<a.length&&"object"==typeof b&&null!=b;c++)b=b[a[c]];c!=a.length&&(b=void 0);return b}function Pf(){try{var a=k.localStorage,b=Qf();if(a)return a.setItem(b,"1"),a.removeItem(b),uf()?!!k.indexedDB:!0}catch(c){}return!1}function Rf(){return(Sf()||"chrome-extension:"===Kf()||Jf())&&!Mf()&&Pf()}function Sf(){return"http:"===Kf()||"https:"===Kf()}function Kf(){return k.location&&k.location.protocol||null}function Tf(a){a=a||J();return Bf(a)||zf(a)==Ef?!1:!0}function Uf(a){return"undefined"===typeof a?null:Cc(a)}function Vf(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&null!==a[c]&&void 0!==a[c]&&(b[c]=a[c]);return b}function Wf(a){if(null!==a)return JSON.parse(a)}function Qf(a){return a?a:""+Math.floor(1e9*Math.random()).toString()}function Xf(a){a=a||J();return"Safari"==zf(a)||a.toLowerCase().match(/iphone|ipad|ipod/)?!1:!0}function Yf(){var a=k.___jsl;if(a&&a.H)for(var b in a.H)if(a.H[b].r=a.H[b].r||[],a.H[b].L=a.H[b].L||[],a.H[b].r=a.H[b].L.concat(),a.CP)for(var c=0;c<a.CP.length;c++)a.CP[c]=null}function Zf(){var a=k.navigator;return a&&"boolean"===typeof a.onLine&&(Sf()||"chrome-extension:"===Kf()||"undefined"!==typeof a.connection)?a.onLine:!0}function $f(a,b,c,d){if(a>b)throw Error("Short delay should be less than long delay!");this.c=a;this.b=b;a=c||J();d=d||K();this.a=Bf(a)||"ReactNative"===d}$f.prototype.get=function(){return this.a?this.b:this.c};function ag(){var a=k.document;return a&&"undefined"!==typeof a.visibilityState?"visible"==a.visibilityState:!0}function bg(){var a=k.document,b=null;return ag()||!a?A():new z(function(c){b=function(){ag()&&(a.removeEventListener("visibilitychange",b,!1),c())};a.addEventListener("visibilitychange",b,!1)}).s(function(c){a.removeEventListener("visibilitychange",b,!1);throw c})}function cg(a){try{var b=new Date(parseInt(a,10));if(!isNaN(b.getTime())&&!/[^0-9]/.test(a))return b.toUTCString()}catch(c){}return null}var dg={};var eg;try{var fg={};Object.defineProperty(fg,"abcd",{configurable:!0,enumerable:!0,value:1});Object.defineProperty(fg,"abcd",{configurable:!0,enumerable:!0,value:2});eg=2==fg.abcd}catch(a){eg=!1}function M(a,b,c){eg?Object.defineProperty(a,b,{configurable:!0,enumerable:!0,value:c}):a[b]=c}function gg(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&M(a,c,b[c])}function hg(a){var b={};gg(b,a);return b}function ig(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function jg(a,b){if(!b||!b.length)return!0;if(!a)return!1;for(var c=0;c<b.length;c++){var d=a[b[c]];if(void 0===d||null===d||""===d)return!1}return!0}function kg(a){var b=a;if("object"==typeof a&&null!=a){b="length"in a?[]:{};for(var c in a)M(b,c,kg(a[c]))}return b}function lg(a){var b={},c=a[mg],d=a[ng];a=a[og];if(!c||!a)throw Error("Invalid provider user info!");b[pg]=d||null;b[qg]=c;M(this,rg,a);M(this,sg,kg(b))}var mg="email",ng="newEmail",og="requestType",qg="email",pg="fromEmail",sg="data",rg="operation";function N(a,b){this.code=tg+a;this.message=b||ug[a]||""}t(N,Error);N.prototype.B=function(){return{code:this.code,message:this.message}};N.prototype.toJSON=function(){return this.B()};function vg(a){var b=a&&a.code;return b?new N(b.substring(tg.length),a.message):null}var tg="auth/",ug={"argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"The user's credential is no longer valid. The user must sign in again.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function wg(a){var b=a[xg];if("undefined"===typeof b)throw new N("missing-continue-uri");if("string"!==typeof b||"string"===typeof b&&!b.length)throw new N("invalid-continue-uri");this.h=b;this.c=this.a=null;this.g=!1;var c=a[yg];if(c&&"object"===typeof c){b=c[zg];var d=c[Ag];c=c[Bg];if("string"===typeof b&&b.length){this.a=b;if("undefined"!==typeof d&&"boolean"!==typeof d)throw new N("argument-error",Ag+" property must be a boolean when specified.");this.g=!!d;if("undefined"!==typeof c&&("string"!==typeof c||"string"===typeof c&&!c.length))throw new N("argument-error",Bg+" property must be a non empty string when specified.");this.c=c||null}else{if("undefined"!==typeof b)throw new N("argument-error",zg+" property must be a non empty string when specified.");if("undefined"!==typeof d||"undefined"!==typeof c)throw new N("missing-android-pkg-name")}}else if("undefined"!==typeof c)throw new N("argument-error",yg+" property must be a non null object when specified.");this.b=null;if((b=a[Cg])&&"object"===typeof b)if(b=b[Dg],"string"===typeof b&&b.length)this.b=b;else{if("undefined"!==typeof b)throw new N("argument-error",Dg+" property must be a non empty string when specified.")}else if("undefined"!==typeof b)throw new N("argument-error",Cg+" property must be a non null object when specified.");a=a[Eg];if("undefined"!==typeof a&&"boolean"!==typeof a)throw new N("argument-error",Eg+" property must be a boolean when specified.");if((this.f=!!a)&&!this.b&&!this.a)throw new N("argument-error",Eg+" property can't be true when no mobile application is provided.")}var yg="android",Eg="handleCodeInApp",Cg="iOS",xg="url",Ag="installApp",Bg="minimumVersion",zg="packageName",Dg="bundleId";function Fg(a){var b={};b.continueUrl=a.h;b.canHandleCodeInApp=a.f;if(b.androidPackageName=a.a)b.androidMinimumVersion=a.c,b.androidInstallApp=a.g;b.iOSBundleId=a.b;for(var c in b)null===b[c]&&delete b[c];return b}function Gg(a){this.b=a.sub;na();this.a=a.provider_id||a.firebase&&a.firebase.sign_in_provider||null}function Hg(a){a=a.split(".");if(3!=a.length)return null;a=a[1];for(var b=(4-a.length%4)%4,c=0;c<b;c++)a+=".";try{var d=JSON.parse(Kd(a));if(d.sub&&d.iss&&d.aud&&d.exp)return new Gg(d)}catch(e){}return null}var Ig="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Jg=["client_id","response_type","scope","redirect_uri","state"],Kg={Dc:{Ma:"locale",za:500,ya:600,Na:"facebook.com",$a:Jg},Fc:{Ma:null,za:500,ya:620,Na:"github.com",$a:Jg},Gc:{Ma:"hl",za:515,ya:680,Na:"google.com",$a:Jg},Mc:{Ma:"lang",za:485,ya:705,Na:"twitter.com",$a:Ig}};function Lg(a){for(var b in Kg)if(Kg[b].Na==a)return Kg[b];return null}function Mg(a){var b={};b["facebook.com"]=Ng;b["google.com"]=Og;b["github.com"]=Pg;b["twitter.com"]=Qg;var c=a&&a[Rg];try{if(c)return b[c]?new b[c](a):new Sg(a);if("undefined"!==typeof a[Tg])return new Ug(a)}catch(d){}return null}var Tg="idToken",Rg="providerId";function Ug(a){var b=a[Rg];if(!b&&a[Tg]){var c=Hg(a[Tg]);c&&c.a&&(b=c.a)}if(!b)throw Error("Invalid additional user info!");a=!!a.isNewUser;M(this,"providerId",b);M(this,"isNewUser",a)}function Sg(a){Ug.call(this,a);a=Wf(a.rawUserInfo||"{}");M(this,"profile",kg(a||{}))}t(Sg,Ug);function Ng(a){Sg.call(this,a);if("facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}t(Ng,Sg);function Pg(a){Sg.call(this,a);if("github.com"!=this.providerId)throw Error("Invalid provider ID!");M(this,"username",this.profile&&this.profile.login||null)}t(Pg,Sg);function Og(a){Sg.call(this,a);if("google.com"!=this.providerId)throw Error("Invalid provider ID!")}t(Og,Sg);function Qg(a){Sg.call(this,a);if("twitter.com"!=this.providerId)throw Error("Invalid provider ID!");M(this,"username",a.screenName||null)}t(Qg,Sg);function Vg(a,b){return a.then(function(a){if(a[O]){var c=Hg(a[O]);if(!c||b!=c.b)throw new N("user-mismatch");return a}throw new N("user-mismatch")}).s(function(a){throw a&&a.code&&a.code==tg+"user-not-found"?new N("user-mismatch"):a})}function Wg(a,b){if(b.idToken||b.accessToken)b.idToken&&M(this,"idToken",b.idToken),b.accessToken&&M(this,"accessToken",b.accessToken);else if(b.oauthToken&&b.oauthTokenSecret)M(this,"accessToken",b.oauthToken),M(this,"secret",b.oauthTokenSecret);else throw new N("internal-error","failed to construct a credential");M(this,"providerId",a)}Wg.prototype.wa=function(a){return Xg(a,Yg(this))};Wg.prototype.b=function(a,b){var c=Yg(this);c.idToken=b;return Zg(a,c)};Wg.prototype.c=function(a,b){var c=Yg(this);return Vg($g(a,c),b)};function Yg(a){var b={};a.idToken&&(b.id_token=a.idToken);a.accessToken&&(b.access_token=a.accessToken);a.secret&&(b.oauth_token_secret=a.secret);b.providerId=a.providerId;return{postBody:Ie(b).toString(),requestUri:"http://localhost"}}Wg.prototype.B=function(){var a={providerId:this.providerId};this.idToken&&(a.oauthIdToken=this.idToken);this.accessToken&&(a.oauthAccessToken=this.accessToken);this.secret&&(a.oauthTokenSecret=this.secret);return a};function ah(a,b){this.nc=b||[];gg(this,{providerId:a,isOAuthProvider:!0});this.qb={};this.Wa=(Lg(a)||{}).Ma||null;this.Ua=null}ah.prototype.Ba=function(a){this.qb=Ua(a);return this};function P(a){ah.call(this,a,Jg);this.a=[]}t(P,ah);P.prototype.sa=function(a){Ha(this.a,a)||this.a.push(a);return this};P.prototype.vb=function(){return La(this.a)};P.prototype.credential=function(a,b){if(!a&&!b)throw new N("argument-error","credential failed: must provide the ID token and/or the access token.");return new Wg(this.providerId,{idToken:a||null,accessToken:b||null})};function bh(){P.call(this,"facebook.com")}t(bh,P);M(bh,"PROVIDER_ID","facebook.com");function ch(a){if(!a)throw new N("argument-error","credential failed: expected 1 argument (the OAuth access token).");var b=a;q(a)&&(b=a.accessToken);return(new bh).credential(null,b)}function dh(){P.call(this,"github.com")}t(dh,P);M(dh,"PROVIDER_ID","github.com");function eh(a){if(!a)throw new N("argument-error","credential failed: expected 1 argument (the OAuth access token).");var b=a;q(a)&&(b=a.accessToken);return(new dh).credential(null,b)}function fh(){P.call(this,"google.com");this.sa("profile")}t(fh,P);M(fh,"PROVIDER_ID","google.com");function gh(a,b){var c=a;q(a)&&(c=a.idToken,b=a.accessToken);return(new fh).credential(c,b)}function hh(){ah.call(this,"twitter.com",Ig)}t(hh,ah);M(hh,"PROVIDER_ID","twitter.com");function ih(a,b){var c=a;q(c)||(c={oauthToken:a,oauthTokenSecret:b});if(!c.oauthToken||!c.oauthTokenSecret)throw new N("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Wg("twitter.com",c)}function jh(a,b){this.a=a;this.f=b;M(this,"providerId","password")}jh.prototype.wa=function(a){return Q(a,kh,{email:this.a,password:this.f})};jh.prototype.b=function(a,b){return Q(a,lh,{idToken:b,email:this.a,password:this.f})};jh.prototype.c=function(a,b){return Vg(this.wa(a),b)};jh.prototype.B=function(){return{email:this.a,password:this.f}};function mh(){gg(this,{providerId:"password",isOAuthProvider:!1})}gg(mh,{PROVIDER_ID:"password"});function nh(a){if(!(a.Pa&&a.Oa||a.Da&&a.Y))throw new N("internal-error");this.a=a;M(this,"providerId","phone")}nh.prototype.wa=function(a){return a.Qa(oh(this))};nh.prototype.b=function(a,b){var c=oh(this);c.idToken=b;return Q(a,ph,c)};nh.prototype.c=function(a,b){var c=oh(this);c.operation="REAUTH";a=Q(a,qh,c);return Vg(a,b)};nh.prototype.B=function(){var a={providerId:"phone"};this.a.Pa&&(a.verificationId=this.a.Pa);this.a.Oa&&(a.verificationCode=this.a.Oa);this.a.Da&&(a.temporaryProof=this.a.Da);this.a.Y&&(a.phoneNumber=this.a.Y);return a};function oh(a){return a.a.Da&&a.a.Y?{temporaryProof:a.a.Da,phoneNumber:a.a.Y}:{sessionInfo:a.a.Pa,code:a.a.Oa}}function rh(a){try{this.a=a||firebase.auth()}catch(b){throw new N("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}gg(this,{providerId:"phone",isOAuthProvider:!1})}rh.prototype.Qa=function(a,b){var c=this.a.c;return A(b.verify()).then(function(d){if(!m(d))throw new N("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(b.type){case"recaptcha":return sh(c,{phoneNumber:a,recaptchaToken:d}).then(function(a){"function"===typeof b.reset&&b.reset();return a},function(a){"function"===typeof b.reset&&b.reset();throw a});default:throw new N("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})};function th(a,b){if(!a)throw new N("missing-verification-id");if(!b)throw new N("missing-verification-code");return new nh({Pa:a,Oa:b})}gg(rh,{PROVIDER_ID:"phone"});function uh(a){if(a.temporaryProof&&a.phoneNumber)return new nh({Da:a.temporaryProof,Y:a.phoneNumber});var b=a&&a.providerId;if(!b||"password"===b)return null;var c=a&&a.oauthAccessToken,d=a&&a.oauthTokenSecret;a=a&&a.oauthIdToken;try{switch(b){case"google.com":return gh(a,c);case"facebook.com":return ch(c);case"github.com":return eh(c);case"twitter.com":return ih(c,d);default:return new P(b).credential(a,c)}}catch(e){return null}}function vh(a){if(!a.isOAuthProvider)throw new N("invalid-oauth-provider")}function wh(a,b,c,d,e){this.b=a;this.c=b||null;this.f=c||null;this.g=d||null;this.a=e||null;if(this.f||this.a){if(this.f&&this.a)throw new N("invalid-auth-event");if(this.f&&!this.g)throw new N("invalid-auth-event")}else throw new N("invalid-auth-event")}wh.prototype.B=function(){return{type:this.b,eventId:this.c,urlResponse:this.f,sessionId:this.g,error:this.a&&this.a.B()}};function xh(a){a=a||{};return a.type?new wh(a.type,a.eventId,a.urlResponse,a.sessionId,a.error&&vg(a.error)):null}function yh(a){var b="unauthorized-domain",c=void 0,d=De(a);a=d.b;d=d.c;"chrome-extension"==d?c=oa("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",a):"http"==d||"https"==d?c=oa("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",a):b="operation-not-supported-in-this-environment";N.call(this,b,c)}t(yh,N);function zh(a,b,c){N.call(this,a,c);a=b||{};a.rb&&M(this,"email",a.rb);a.Y&&M(this,"phoneNumber",a.Y);a.credential&&M(this,"credential",a.credential)}t(zh,N);zh.prototype.B=function(){var a={code:this.code,message:this.message};this.email&&(a.email=this.email);this.phoneNumber&&(a.phoneNumber=this.phoneNumber);var b=this.credential&&this.credential.B();b&&Wa(a,b);return a};zh.prototype.toJSON=function(){return this.B()};function Ah(a){if(a.code){var b=a.code||"";0==b.indexOf(tg)&&(b=b.substring(tg.length));var c={credential:uh(a)};if(a.email)c.rb=a.email;else if(a.phoneNumber)c.Y=a.phoneNumber;else return new N(b,a.message||void 0);return new zh(b,c,a.message)}return null}function Bh(a){this.f=a}t(Bh,Ne);Bh.prototype.a=function(){return new this.f};Bh.prototype.b=function(){return{}};function Ch(a,b,c){var d="Node"==K();d=k.XMLHttpRequest||d&&firebase.INTERNAL.node&&firebase.INTERNAL.node.XMLHttpRequest;if(!d)throw new N("internal-error","The XMLHttpRequest compatibility library was not found.");this.b=a;a=b||{};this.i=a.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token";this.l=a.secureTokenTimeout||Dh;this.c=Ua(a.secureTokenHeaders||Eh);this.g=a.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/";this.h=a.firebaseTimeout||Fh;this.a=Ua(a.firebaseHeaders||Gh);c&&(this.a["X-Client-Version"]=c,this.c["X-Client-Version"]=c);this.f=new rf;this.o=new Bh(d)}var Hh,O="idToken",Dh=new $f(3e4,6e4),Eh={"Content-Type":"application/x-www-form-urlencoded"},Fh=new $f(3e4,6e4),Gh={"Content-Type":"application/json"};function Ih(a,b){b?a.a["X-Firebase-Locale"]=b:delete a.a["X-Firebase-Locale"]}function Jh(a,b){b?(a.a["X-Client-Version"]=b,a.c["X-Client-Version"]=b):(delete a.a["X-Client-Version"],delete a.c["X-Client-Version"])}function Kh(a,b,c,d,e,f,g){Zf()?(yf()?a=r(a.m,a):(Hh||(Hh=new z(function(a,b){Lh(a,b)})),a=r(a.u,a)),a(b,c,d,e,f,g)):c&&c(null)}Ch.prototype.m=function(a,b,c,d,e,f){var g="Node"==K(),l=Mf()?g?new Se(this.o):new Se:new Se(this.f);if(f){l.f=Math.max(0,f);var n=setTimeout(function(){G(l,"timeout")},f)}fd(l,"complete",function(){n&&clearTimeout(n);var a=null;try{a=JSON.parse(hf(this))||null}catch(ub){a=null}b&&b(a)});ld(l,"ready",function(){n&&clearTimeout(n);Lc(this)});ld(l,"timeout",function(){n&&clearTimeout(n);Lc(this);b&&b(null)});Ye(l,a,c,d,e)};var Mh=dc("https://apis.google.com/js/client.js?onload=%{onload}"),Nh="__fcb"+Math.floor(1e6*Math.random()).toString();function Lh(a,b){if(((window.gapi||{}).client||{}).request)a();else{k[Nh]=function(){((window.gapi||{}).client||{}).request?a():b(Error("CORS_UNSUPPORTED"))};var c=hc(Mh,{onload:Nh});Td(kf(c),function(){b(Error("CORS_UNSUPPORTED"))})}}Ch.prototype.u=function(a,b,c,d,e){var f=this;Hh.then(function(){window.gapi.client.setApiKey(f.b);var g=window.gapi.auth.getToken();window.gapi.auth.setToken(null);window.gapi.client.request({path:a,method:c,body:d,headers:e,authType:"none",callback:function(a){window.gapi.auth.setToken(g);b&&b(a)}})}).s(function(a){b&&b({error:{message:a&&a.message||"CORS_UNSUPPORTED"}})})};function Oh(a,b){return new z(function(c,d){"refresh_token"==b.grant_type&&b.refresh_token||"authorization_code"==b.grant_type&&b.code?Kh(a,a.i+"?key="+encodeURIComponent(a.b),function(a){a?a.error?d(Ph(a)):a.access_token&&a.refresh_token?c(a):d(new N("internal-error")):d(new N("network-request-failed"))},"POST",Ie(b).toString(),a.c,a.l.get()):d(new N("internal-error"))})}function Qh(a,b,c,d,e,f){var g=De(a.g+b);I(g,"key",a.b);f&&I(g,"cb",na().toString());var l="GET"==c;if(l)for(var n in d)d.hasOwnProperty(n)&&I(g,n,d[n]);return new z(function(b,f){Kh(a,g.toString(),function(a){a?a.error?f(Ph(a,e||{})):b(a):f(new N("network-request-failed"))},c,l?void 0:Cc(Vf(d)),a.a,a.h.get())})}function Rh(a){if(!jf.test(a.email))throw new N("invalid-email")}function Sh(a){"email"in a&&Rh(a)}function Th(a,b){return Q(a,Uh,{identifier:b,continueUri:Sf()?vf():"http://localhost"}).then(function(a){return a.allProviders||[]})}function Vh(a){return Q(a,Wh,{}).then(function(a){return a.authorizedDomains||[]})}function Xh(a){if(!a[O])throw new N("internal-error")}function Yh(a){if(a.phoneNumber||a.temporaryProof){if(!a.phoneNumber||!a.temporaryProof)throw new N("internal-error")}else{if(!a.sessionInfo)throw new N("missing-verification-id");if(!a.code)throw new N("missing-verification-code")}}Ch.prototype.gb=function(){return Q(this,Zh,{})};Ch.prototype.kb=function(a,b){return Q(this,$h,{idToken:a,email:b})};Ch.prototype.lb=function(a,b){return Q(this,lh,{idToken:a,password:b})};var ai={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};h=Ch.prototype;h.mb=function(a,b){var c={idToken:a},d=[];Pa(ai,function(a,f){var e=b[f];null===e?d.push(a):f in b&&(c[f]=e)});d.length&&(c.deleteAttribute=d);return Q(this,$h,c)};h.cb=function(a,b){a={requestType:"PASSWORD_RESET",email:a};Wa(a,b);return Q(this,bi,a)};h.bb=function(a,b){a={requestType:"VERIFY_EMAIL",idToken:a};Wa(a,b);return Q(this,ci,a)};function sh(a,b){return Q(a,di,b)}h.Qa=function(a){return Q(this,ei,a)};function fi(a,b,c){return Q(a,gi,{idToken:b,deleteProvider:c})}function hi(a){if(!a.requestUri||!a.sessionId&&!a.postBody)throw new N("internal-error");
}function ii(a){var b=null;a.needConfirmation?(a.code="account-exists-with-different-credential",b=Ah(a)):"FEDERATED_USER_ID_ALREADY_LINKED"==a.errorMessage?(a.code="credential-already-in-use",b=Ah(a)):"EMAIL_EXISTS"==a.errorMessage&&(a.code="email-already-in-use",b=Ah(a));if(b)throw b;if(!a[O])throw new N("internal-error")}function Xg(a,b){b.returnIdpCredential=!0;return Q(a,ji,b)}function Zg(a,b){b.returnIdpCredential=!0;return Q(a,ki,b)}function $g(a,b){b.returnIdpCredential=!0;b.autoCreate=!1;return Q(a,li,b)}function mi(a){if(!a.oobCode)throw new N("invalid-action-code")}h.Ta=function(a,b){return Q(this,ni,{oobCode:a,newPassword:b})};h.Ia=function(a){return Q(this,oi,{oobCode:a})};h.Sa=function(a){return Q(this,pi,{oobCode:a})};var pi={endpoint:"setAccountInfo",D:mi,ga:"email"},oi={endpoint:"resetPassword",D:mi,O:function(a){if(!a.email||!a.requestType)throw new N("internal-error")}},qi={endpoint:"signupNewUser",D:function(a){Rh(a);if(!a.password)throw new N("weak-password")},O:Xh,T:!0},Uh={endpoint:"createAuthUri"},ri={endpoint:"deleteAccount",ea:["idToken"]},gi={endpoint:"setAccountInfo",ea:["idToken","deleteProvider"],D:function(a){if(!fa(a.deleteProvider))throw new N("internal-error")}},si={endpoint:"getAccountInfo"},ci={endpoint:"getOobConfirmationCode",ea:["idToken","requestType"],D:function(a){if("VERIFY_EMAIL"!=a.requestType)throw new N("internal-error")},ga:"email"},bi={endpoint:"getOobConfirmationCode",ea:["requestType"],D:function(a){if("PASSWORD_RESET"!=a.requestType)throw new N("internal-error");Rh(a)},ga:"email"},Wh={nb:!0,endpoint:"getProjectConfig",yb:"GET"},ti={nb:!0,endpoint:"getRecaptchaParam",yb:"GET",O:function(a){if(!a.recaptchaSiteKey)throw new N("internal-error")}},ni={endpoint:"resetPassword",D:mi,ga:"email"},di={endpoint:"sendVerificationCode",ea:["phoneNumber","recaptchaToken"],ga:"sessionInfo"},$h={endpoint:"setAccountInfo",ea:["idToken"],D:Sh,T:!0},lh={endpoint:"setAccountInfo",ea:["idToken"],D:function(a){Sh(a);if(!a.password)throw new N("weak-password")},O:Xh,T:!0},Zh={endpoint:"signupNewUser",O:Xh,T:!0},ji={endpoint:"verifyAssertion",D:hi,O:ii,T:!0},li={endpoint:"verifyAssertion",D:hi,O:function(a){if(a.errorMessage&&"USER_NOT_FOUND"==a.errorMessage)throw new N("user-not-found");if(!a[O])throw new N("internal-error")},T:!0},ki={endpoint:"verifyAssertion",D:function(a){hi(a);if(!a.idToken)throw new N("internal-error")},O:ii,T:!0},ui={endpoint:"verifyCustomToken",D:function(a){if(!a.token)throw new N("invalid-custom-token")},O:Xh,T:!0},kh={endpoint:"verifyPassword",D:function(a){Rh(a);if(!a.password)throw new N("wrong-password")},O:Xh,T:!0},ei={endpoint:"verifyPhoneNumber",D:Yh,O:Xh},ph={endpoint:"verifyPhoneNumber",D:function(a){if(!a.idToken)throw new N("internal-error");Yh(a)},O:function(a){if(a.temporaryProof)throw a.code="credential-already-in-use",Ah(a);Xh(a)}},qh={Lb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Yh,O:Xh};function Q(a,b,c){if(!jg(c,b.ea))return B(new N("internal-error"));var d=b.yb||"POST",e;return A(c).then(b.D).then(function(){b.T&&(c.returnSecureToken=!0);return Qh(a,b.endpoint,d,c,b.Lb,b.nb||!1)}).then(function(a){return e=a}).then(b.O).then(function(){if(!b.ga)return e;if(!(b.ga in e))throw new N("internal-error");return e[b.ga]})}function Ph(a,b){var c=(a.error&&a.error.errors&&a.error.errors[0]||{}).reason||"";var d={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(c=d[c]?new N(d[c]):null)return c;c=a.error&&a.error.message||"";d={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash"};Wa(d,b||{});b=(b=c.match(/^[^\s]+\s*:\s*(.*)$/))&&1<b.length?b[1]:void 0;for(var e in d)if(0===c.indexOf(e))return new N(d[e],b);!b&&a&&(b=Uf(a));return new N("internal-error",b)}var vi={Ic:{Va:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ab:"https://securetoken.googleapis.com/v1/token",id:"p"},Kc:{Va:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ab:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},Lc:{Va:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ab:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function wi(a){for(var b in vi)if(vi[b].id===a)return a=vi[b],{firebaseEndpoint:a.Va,secureTokenEndpoint:a.ab};return null}var xi;xi=wi("__EID__")?"__EID__":void 0;function yi(a){this.b=a;this.a=null;this.Ya=zi(this)}function zi(a){return Ai().then(function(){return new z(function(b,c){L("gapi.iframes.getContext")().open({where:document.body,url:a.b,messageHandlersFilter:L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(d){function e(){clearTimeout(f);b()}a.a=d;a.a.restyle({setHideOnLeave:!1});var f=setTimeout(function(){c(Error("Network Error"))},Bi.get());d.ping(e).then(e,function(){c(Error("Network Error"))})})})})}function Ci(a,b){return a.Ya.then(function(){return new z(function(c){a.a.send(b.type,b,c,L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}function Di(a,b){a.Ya.then(function(){a.a.register("authEvent",b,L("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}var Ei=dc("https://apis.google.com/js/api.js?onload=%{onload}"),Fi=new $f(3e4,6e4),Bi=new $f(5e3,15e3),Gi=null;function Ai(){return Gi?Gi:Gi=new z(function(a,b){if(Zf()){var c=function(){Yf();L("gapi.load")("gapi.iframes",{callback:a,ontimeout:function(){Yf();b(Error("Network Error"))},timeout:Fi.get()})};if(L("gapi.iframes.Iframe"))a();else if(L("gapi.load"))c();else{var d="__iframefcb"+Math.floor(1e6*Math.random()).toString();k[d]=function(){L("gapi.load")?c():b(Error("Network Error"))};d=hc(Ei,{onload:d});A(kf(d)).s(function(){b(Error("Network Error"))})}}else b(Error("Network Error"))}).s(function(a){Gi=null;throw a})}function Hi(a,b,c){this.i=a;this.g=b;this.h=c;this.f=null;this.a=Ee(this.i,"/__/auth/iframe");I(this.a,"apiKey",this.g);I(this.a,"appName",this.h);this.b=null;this.c=[]}Hi.prototype.toString=function(){this.f?I(this.a,"v",this.f):Le(this.a.a,"v");this.b?I(this.a,"eid",this.b):Le(this.a.a,"eid");this.c.length?I(this.a,"fw",this.c.join(",")):Le(this.a.a,"fw");return this.a.toString()};function Ii(a,b,c,d,e){this.m=a;this.u=b;this.c=c;this.l=d;this.i=this.g=this.h=null;this.a=e;this.f=null}Ii.prototype.toString=function(){var a=Ee(this.m,"/__/auth/handler");I(a,"apiKey",this.u);I(a,"appName",this.c);I(a,"authType",this.l);if(this.a.isOAuthProvider){var b=this.a;try{var c=firebase.app(this.c).auth().$()}catch(l){c=null}b.Ua=c;I(a,"providerId",this.a.providerId);b=this.a;c=Vf(b.qb);for(var d in c)c[d]=c[d].toString();d=b.nc;c=Ua(c);for(var e=0;e<d.length;e++){var f=d[e];f in c&&delete c[f]}b.Wa&&b.Ua&&!c[b.Wa]&&(c[b.Wa]=b.Ua);Sa(c)||I(a,"customParameters",Uf(c))}"function"===typeof this.a.vb&&(b=this.a.vb(),b.length&&I(a,"scopes",b.join(",")));this.h?I(a,"redirectUrl",this.h):Le(a.a,"redirectUrl");this.g?I(a,"eventId",this.g):Le(a.a,"eventId");this.i?I(a,"v",this.i):Le(a.a,"v");if(this.b)for(var g in this.b)this.b.hasOwnProperty(g)&&!Ce(a,g)&&I(a,g,this.b[g]);this.f?I(a,"eid",this.f):Le(a.a,"eid");g=Ji(this.c);g.length&&I(a,"fw",g.join(","));return a.toString()};function Ji(a){try{return firebase.app(a).auth().Ka()}catch(b){return[]}}function Ki(a,b,c,d,e){this.u=a;this.f=b;this.b=c;this.c=d||null;this.h=e||null;this.m=this.o=this.v=null;this.g=[];this.l=this.a=null}function Li(a){var b=vf();return Vh(a).then(function(a){a:{var c=De(b),e=c.c;c=c.b;for(var f=0;f<a.length;f++){var g=a[f];var l=c;var n=e;0==g.indexOf("chrome-extension://")?l=De(g).b==l&&"chrome-extension"==n:"http"!=n&&"https"!=n?l=!1:Gf.test(g)?l=l==g:(g=g.split(".").join("\\."),l=new RegExp("^(.+\\."+g+"|"+g+")$","i").test(l));if(l){a=!0;break a}}a=!1}if(!a)throw new yh(vf())})}function Mi(a){if(a.l)return a.l;a.l=Hf().then(function(){if(!a.o){var b=a.c,c=a.h,d=Ji(a.b),e=new Hi(a.u,a.f,a.b);e.f=b;e.b=c;e.c=La(d||[]);a.o=e.toString()}a.i=new yi(a.o);Ni(a)});return a.l}h=Ki.prototype;h.Ca=function(a,b,c){var d=new N("popup-closed-by-user"),e=new N("web-storage-unsupported"),f=this,g=!1;return this.ba().then(function(){Oi(f).then(function(c){c||(a&&Cf(a),b(e),g=!0)})}).s(function(){}).then(function(){if(!g)return Ff(a)}).then(function(){if(!g)return sd(c).then(function(){b(d)})})};h.Cb=function(){var a=J();return!Tf(a)&&!Xf(a)};h.xb=function(){return!1};h.ub=function(a,b,c,d,e,f,g){if(!a)return B(new N("popup-blocked"));if(g&&!Tf())return this.ba().s(function(b){Cf(a);e(b)}),d(),A();this.a||(this.a=Li(Pi(this)));var l=this;return this.a.then(function(){var b=l.ba().s(function(b){Cf(a);e(b);throw b});d();return b}).then(function(){vh(c);if(!g){var d=Qi(l.u,l.f,l.b,b,c,null,f,l.c,void 0,l.h);wf(d,a)}}).s(function(a){"auth/network-request-failed"==a.code&&(l.a=null);throw a})};function Pi(a){a.m||(a.v=a.c?Of(a.c,Ji(a.b)):null,a.m=new Ch(a.f,wi(a.h),a.v));return a.m}h.Aa=function(a,b,c){this.a||(this.a=Li(Pi(this)));var d=this;return this.a.then(function(){vh(b);var e=Qi(d.u,d.f,d.b,a,b,vf(),c,d.c,void 0,d.h);wf(e)}).s(function(a){"auth/network-request-failed"==a.code&&(d.a=null);throw a})};h.ba=function(){var a=this;return Mi(this).then(function(){return a.i.Ya}).s(function(){a.a=null;throw new N("network-request-failed")})};h.Db=function(){return!0};function Qi(a,b,c,d,e,f,g,l,n,D){a=new Ii(a,b,c,d,e);a.h=f;a.g=g;a.i=l;a.b=Ua(n||null);a.f=D;return a.toString()}function Ni(a){if(!a.i)throw Error("IfcHandler must be initialized!");Di(a.i,function(b){var c={};if(b&&b.authEvent){var d=!1;b=xh(b.authEvent);for(c=0;c<a.g.length;c++)d=a.g[c](b)||d;c={};c.status=d?"ACK":"ERROR";return A(c)}c.status="ERROR";return A(c)})}function Oi(a){var b={type:"webStorageSupport"};return Mi(a).then(function(){return Ci(a.i,b)}).then(function(a){if(a&&a.length&&"undefined"!==typeof a[0].webStorageSupport)return a[0].webStorageSupport;throw Error()})}h.ua=function(a){this.g.push(a)};h.Ja=function(a){Ja(this.g,function(b){return b==a})};function Ri(a){this.a=a||firebase.INTERNAL.reactNative&&firebase.INTERNAL.reactNative.AsyncStorage;if(!this.a)throw new N("internal-error","The React Native compatibility library was not found.")}h=Ri.prototype;h.get=function(a){return A(this.a.getItem(a)).then(function(a){return a&&Wf(a)})};h.set=function(a,b){return A(this.a.setItem(a,Uf(b)))};h.X=function(a){return A(this.a.removeItem(a))};h.ia=function(){};h.da=function(){};function Si(){this.a={}}h=Si.prototype;h.get=function(a){return A(this.a[a])};h.set=function(a,b){this.a[a]=b;return A()};h.X=function(a){delete this.a[a];return A()};h.ia=function(){};h.da=function(){};function Ti(a,b,c,d,e,f){if(!window.indexedDB)throw new N("web-storage-unsupported");this.u=a;this.h=b;this.g=c;this.l=d;this.m=e;this.f={};this.c=[];this.a=0;this.o=f||k.indexedDB}var Ui;function Vi(a){return new z(function(b,c){var d=a.o.open(a.u,a.m);d.onerror=function(a){c(Error(a.target.errorCode))};d.onupgradeneeded=function(b){b=b.target.result;try{b.createObjectStore(a.h,{keyPath:a.g})}catch(f){c(f)}};d.onsuccess=function(a){b(a.target.result)}})}function Wi(a){a.i||(a.i=Vi(a));return a.i}function Xi(a,b){return b.objectStore(a.h)}function Yi(a,b,c){return b.transaction([a.h],c?"readwrite":"readonly")}function Zi(a){return new z(function(b,c){a.onsuccess=function(a){a&&a.target?b(a.target.result):b()};a.onerror=function(a){c(Error(a.target.errorCode))}})}h=Ti.prototype;h.set=function(a,b){var c=!1,d,e=this;return Qb(Wi(this).then(function(b){d=b;b=Xi(e,Yi(e,d,!0));return Zi(b.get(a))}).then(function(f){var g=Xi(e,Yi(e,d,!0));if(f)return f.value=b,Zi(g.put(f));e.a++;c=!0;f={};f[e.g]=a;f[e.l]=b;return Zi(g.add(f))}).then(function(){e.f[a]=b}),function(){c&&e.a--})};h.get=function(a){var b=this;return Wi(this).then(function(c){return Zi(Xi(b,Yi(b,c,!1)).get(a))}).then(function(a){return a&&a.value})};h.X=function(a){var b=!1,c=this;return Qb(Wi(this).then(function(d){b=!0;c.a++;return Zi(Xi(c,Yi(c,d,!0))["delete"](a))}).then(function(){delete c.f[a]}),function(){b&&c.a--})};h.vc=function(){var a=this;return Wi(this).then(function(b){var c=Xi(a,Yi(a,b,!1));return c.getAll?Zi(c.getAll()):new z(function(a,b){var d=[],e=c.openCursor();e.onsuccess=function(b){(b=b.target.result)?(d.push(b.value),b["continue"]()):a(d)};e.onerror=function(a){b(Error(a.target.errorCode))}})}).then(function(b){var c={},d=[];if(0==a.a){for(d=0;d<b.length;d++)c[b[d][a.g]]=b[d][a.l];d=xf(a.f,c);a.f=c}return d})};h.ia=function(a){0==this.c.length&&$i(this);this.c.push(a)};h.da=function(a){Ja(this.c,function(b){return b==a});0==this.c.length&&this.b&&this.b.cancel("STOP_EVENT")};function $i(a){function b(){a.b=sd(800).then(r(a.vc,a)).then(function(b){0<b.length&&w(a.c,function(a){a(b)})}).then(b).s(function(a){"STOP_EVENT"!=a.message&&b()});return a.b}a.b&&a.b.cancel("STOP_EVENT");b()}function aj(){if(!bj()){if("Node"==K())throw new N("internal-error","The LocalStorage compatibility library was not found.");throw new N("web-storage-unsupported")}this.a=k.localStorage||firebase.INTERNAL.node.localStorage}function bj(){var a="Node"==K();a=k.localStorage||a&&firebase.INTERNAL.node&&firebase.INTERNAL.node.localStorage;if(!a)return!1;try{return a.setItem("__sak","1"),a.removeItem("__sak"),!0}catch(b){return!1}}h=aj.prototype;h.get=function(a){var b=this;return A().then(function(){var c=b.a.getItem(a);return Wf(c)})};h.set=function(a,b){var c=this;return A().then(function(){var d=Uf(b);null===d?c.X(a):c.a.setItem(a,d)})};h.X=function(a){var b=this;return A().then(function(){b.a.removeItem(a)})};h.ia=function(a){k.window&&cd(k.window,"storage",a)};h.da=function(a){k.window&&E(k.window,"storage",a)};function cj(){}h=cj.prototype;h.get=function(){return A(null)};h.set=function(){return A()};h.X=function(){return A()};h.ia=function(){};h.da=function(){};function dj(){if(!ej()){if("Node"==K())throw new N("internal-error","The SessionStorage compatibility library was not found.");throw new N("web-storage-unsupported")}this.a=k.sessionStorage||firebase.INTERNAL.node.sessionStorage}function ej(){var a="Node"==K();a=k.sessionStorage||a&&firebase.INTERNAL.node&&firebase.INTERNAL.node.sessionStorage;if(!a)return!1;try{return a.setItem("__sak","1"),a.removeItem("__sak"),!0}catch(b){return!1}}h=dj.prototype;h.get=function(a){var b=this;return A().then(function(){var c=b.a.getItem(a);return Wf(c)})};h.set=function(a,b){var c=this;return A().then(function(){var d=Uf(b);null===d?c.X(a):c.a.setItem(a,d)})};h.X=function(a){var b=this;return A().then(function(){b.a.removeItem(a)})};h.ia=function(){};h.da=function(){};function fj(){var a={};a.Browser=gj;a.Node=hj;a.ReactNative=ij;this.a=a[K()]}var jj,gj={C:aj,jb:dj},hj={C:aj,jb:dj},ij={C:Ri,jb:cj};var kj={Hc:"local",NONE:"none",Jc:"session"};function lj(a){var b=new N("invalid-persistence-type"),c=new N("unsupported-persistence-type");a:{for(d in kj)if(kj[d]==a){var d=!0;break a}d=!1}if(!d||"string"!==typeof a)throw b;switch(K()){case"ReactNative":if("session"===a)throw c;break;case"Node":if("none"!==a)throw c;break;default:if(!Pf()&&"none"!==a)throw c}}function mj(a,b,c,d){this.i=a;this.g=b;this.w=c;this.u=d;this.a={};jj||(jj=new fj);a=jj;try{if(uf()){Ui||(Ui=new Ti("firebaseLocalStorageDb","firebaseLocalStorage","fbase_key","value",1));var e=Ui}else e=new a.a.C;this.l=e}catch(f){this.l=new Si,this.u=!0}try{this.o=new a.a.jb}catch(f){this.o=new Si}this.v=new Si;this.h=r(this.m,this);this.b={}}var nj;function oj(){nj||(nj=new mj("firebase",":",!Xf(J())&&Lf()?!0:!1,Tf()));return nj}function pj(a,b){switch(b){case"session":return a.o;case"none":return a.v;default:return a.l}}function qj(a,b,c){return a.i+a.g+b.name+(c?a.g+c:"")}mj.prototype.get=function(a,b){return pj(this,a.C).get(qj(this,a,b))};function rj(a,b,c){c=qj(a,b,c);"local"==b.C&&(a.b[c]=null);return pj(a,b.C).X(c)}mj.prototype.set=function(a,b,c){var d=qj(this,a,c),e=this,f=pj(this,a.C);return f.set(d,b).then(function(){return f.get(d)}).then(function(b){"local"==a.C&&(e.b[d]=b)})};function sj(a,b,c,d){b=qj(a,b,c);"undefined"!==typeof k.localStorage&&"function"===typeof k.localStorage.getItem&&(a.b[b]=k.localStorage.getItem(b));Sa(a.a)&&(pj(a,"local").ia(a.h),a.u||uf()||tj(a));a.a[b]||(a.a[b]=[]);a.a[b].push(d)}function uj(a,b,c){b=qj(a,vj("local"),b);a.a[b]&&(Ja(a.a[b],function(a){return a==c}),0==a.a[b].length&&delete a.a[b]);Sa(a.a)&&wj(a)}function tj(a){xj(a);a.f=setInterval(function(){for(var b in a.a){var c=k.localStorage.getItem(b),d=a.b[b];c!=d&&(a.b[b]=c,c=new Qc({type:"storage",key:b,target:window,oldValue:d,newValue:c,a:!0}),a.m(c))}},1e3)}function xj(a){a.f&&(clearInterval(a.f),a.f=null)}function wj(a){pj(a,"local").da(a.h);xj(a)}mj.prototype.m=function(a){if(a&&a.g){var b=a.a.key;if(null==b)for(var c in this.a){var d=this.b[c];"undefined"===typeof d&&(d=null);var e=k.localStorage.getItem(c);e!==d&&(this.b[c]=e,this.c(c))}else if(0==b.indexOf(this.i+this.g)&&this.a[b]){"undefined"!==typeof a.a.a?pj(this,"local").da(this.h):xj(this);if(this.w)if(c=k.localStorage.getItem(b),d=a.a.newValue,d!==c)null!==d?k.localStorage.setItem(b,d):k.localStorage.removeItem(b);else if(this.b[b]===d&&"undefined"===typeof a.a.a)return;var f=this;c=function(){if("undefined"!==typeof a.a.a||f.b[b]!==k.localStorage.getItem(b))f.b[b]=k.localStorage.getItem(b),f.c(b)};y&&kb&&10==kb&&k.localStorage.getItem(b)!==a.a.newValue&&a.a.newValue!==a.a.oldValue?setTimeout(c,10):c()}}else w(a,r(this.c,this))};mj.prototype.c=function(a){this.a[a]&&w(this.a[a],function(a){a()})};function zj(a){this.a=a;this.b=oj()}var Aj={name:"authEvent",C:"local"};function Bj(a){return a.b.get(Aj,a.a).then(function(a){return xh(a)})}function Cj(){this.a=oj()}function Dj(a,b,c,d,e,f,g){this.u=a;this.i=b;this.l=c;this.m=d||null;this.o=g||null;this.h=b+":"+c;this.A=new Cj;this.g=new zj(this.h);this.f=null;this.b=[];this.v=e||500;this.w=f||2e3;this.a=this.c=null}function Ej(a){return new N("invalid-cordova-configuration",a)}h=Dj.prototype;h.ba=function(){return this.xa?this.xa:this.xa=If().then(function(){if("function"!==typeof L("universalLinks.subscribe",k))throw Ej("cordova-universal-links-plugin is not installed");if("undefined"===typeof L("BuildInfo.packageName",k))throw Ej("cordova-plugin-buildinfo is not installed");if("function"!==typeof L("cordova.plugins.browsertab.openUrl",k))throw Ej("cordova-plugin-browsertab is not installed");if("function"!==typeof L("cordova.InAppBrowser.open",k))throw Ej("cordova-plugin-inappbrowser is not installed")},function(){throw new N("cordova-not-ready")})};function Fj(){for(var a=20,b=[];0<a;)b.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),a--;return b.join("")}function Gj(a){var b=new ie;he(b,a);a=[];var c=8*b.g;56>b.c?he(b,fe,56-b.c):he(b,fe,b.b-(b.c-56));for(var d=63;56<=d;d--)b.f[d]=c&255,c/=256;ge(b);for(d=c=0;d<b.i;d++)for(var e=24;0<=e;e-=8)a[c++]=b.a[d]>>e&255;return Hd(a)}h.Ca=function(a,b){b(new N("operation-not-supported-in-this-environment"));return A()};h.ub=function(){return B(new N("operation-not-supported-in-this-environment"))};h.Db=function(){return!1};h.Cb=function(){return!0};h.xb=function(){return!0};h.Aa=function(a,b,c){if(this.c)return B(new N("redirect-operation-pending"));var d=this,e=k.document,f=null,g=null,l=null,n=null;return this.c=Qb(A().then(function(){vh(b);return Hj(d)}).then(function(){return Ij(d,a,b,c)}).then(function(){return new z(function(a,b){g=function(){var b=L("cordova.plugins.browsertab.close",k);a();"function"===typeof b&&b();d.a&&"function"===typeof d.a.close&&(d.a.close(),d.a=null);return!1};d.ua(g);l=function(){f||(f=sd(d.w).then(function(){b(new N("redirect-cancelled-by-user"))}))};n=function(){ag()&&l()};e.addEventListener("resume",l,!1);J().toLowerCase().match(/android/)||e.addEventListener("visibilitychange",n,!1)}).s(function(a){return Jj(d).then(function(){throw a})})}),function(){l&&e.removeEventListener("resume",l,!1);n&&e.removeEventListener("visibilitychange",n,!1);f&&f.cancel();g&&d.Ja(g);d.c=null})};function Ij(a,b,c,d){var e=Fj(),f=new wh(b,d,null,e,new N("no-auth-event")),g=L("BuildInfo.packageName",k);if("string"!==typeof g)throw new N("invalid-cordova-configuration");var l=L("BuildInfo.displayName",k),n={};if(J().toLowerCase().match(/iphone|ipad|ipod/))n.ibi=g;else if(J().toLowerCase().match(/android/))n.apn=g;else return B(new N("operation-not-supported-in-this-environment"));l&&(n.appDisplayName=l);e=Gj(e);n.sessionId=e;var D=Qi(a.u,a.i,a.l,b,c,null,d,a.m,n,a.o);return a.ba().then(function(){var b=a.h;return a.A.a.set(Aj,f.B(),b)}).then(function(){var b=L("cordova.plugins.browsertab.isAvailable",k);if("function"!==typeof b)throw new N("invalid-cordova-configuration");var c=null;b(function(b){if(b){c=L("cordova.plugins.browsertab.openUrl",k);if("function"!==typeof c)throw new N("invalid-cordova-configuration");c(D)}else{c=L("cordova.InAppBrowser.open",k);if("function"!==typeof c)throw new N("invalid-cordova-configuration");b=J();b=!(!b.match(/(iPad|iPhone|iPod).*OS 7_\d/i)&&!b.match(/(iPad|iPhone|iPod).*OS 8_\d/i));a.a=c(D,b?"_blank":"_system","location=yes")}})})}function Kj(a,b){for(var c=0;c<a.b.length;c++)try{a.b[c](b)}catch(d){}}function Hj(a){a.f||(a.f=a.ba().then(function(){return new z(function(b){function c(d){b(d);a.Ja(c);return!1}a.ua(c);Lj(a)})}));return a.f}function Jj(a){var b=null;return Bj(a.g).then(function(c){b=c;c=a.g;return rj(c.b,Aj,c.a)}).then(function(){return b})}function Lj(a){function b(b){e=!0;f&&f.cancel();Jj(a).then(function(c){var e=d;if(c&&b&&b.url){e=null;var f=b.url;var g=De(f),l=Ce(g,"link"),n=Ce(De(l),"link");g=Ce(g,"deep_link_id");f=Ce(De(g),"link")||g||n||l||f;-1!=f.indexOf("/__/auth/callback")&&(e=De(f),e=Wf(Ce(e,"firebaseError")||null),e=(e="object"===typeof e?vg(e):null)?new wh(c.b,c.c,null,null,e):new wh(c.b,c.c,f,c.g));e=e||d}Kj(a,e)})}var c=L("universalLinks.subscribe",k);if("function"!==typeof c)throw new N("invalid-cordova-configuration");var d=new wh("unknown",null,null,null,new N("no-auth-event")),e=!1,f=sd(a.v).then(function(){return Jj(a).then(function(){e||Kj(a,d)})}),g=k.handleOpenURL;k.handleOpenURL=function(a){0==a.toLowerCase().indexOf(L("BuildInfo.packageName",k).toLowerCase()+"://")&&b({url:a});if("function"===typeof g)try{g(a)}catch(n){console.error(n)}};c(null,b)}h.ua=function(a){this.b.push(a);Hj(this).s(function(b){"auth/invalid-cordova-configuration"===b.code&&(b=new wh("unknown",null,null,null,new N("no-auth-event")),a(b))})};h.Ja=function(a){Ja(this.b,function(b){return b==a})};function Mj(a){this.a=a;this.b=oj()}var Nj={name:"pendingRedirect",C:"session"};function Oj(a){return a.b.set(Nj,"pending",a.a)}function Pj(a){return rj(a.b,Nj,a.a)}function Qj(a){return a.b.get(Nj,a.a).then(function(a){return"pending"==a})}function Rj(a,b,c){this.v=a;this.l=b;this.u=c;this.h=[];this.f=!1;this.i=r(this.m,this);this.c=new Sj;this.o=new Tj;this.g=new Mj(this.l+":"+this.u);this.b={};this.b.unknown=this.c;this.b.signInViaRedirect=this.c;this.b.linkViaRedirect=this.c;this.b.reauthViaRedirect=this.c;this.b.signInViaPopup=this.o;this.b.linkViaPopup=this.o;this.b.reauthViaPopup=this.o;this.a=Uj(this.v,this.l,this.u,xi)}function Uj(a,b,c,d){var e=firebase.SDK_VERSION||null;return Jf()?new Dj(a,b,c,e,void 0,void 0,d):new Ki(a,b,c,e,d)}Rj.prototype.reset=function(){this.f=!1;this.a.Ja(this.i);this.a=Uj(this.v,this.l,this.u)};function Vj(a){a.f||(a.f=!0,a.a.ua(a.i));var b=a.a;return a.a.ba().s(function(c){a.a==b&&a.reset();throw c})}function Wj(a){a.a.Cb()&&Vj(a).s(function(b){var c=new wh("unknown",null,null,null,new N("operation-not-supported-in-this-environment"));Xj(b)&&a.m(c)});a.a.xb()||Yj(a.c)}Rj.prototype.subscribe=function(a){Ha(this.h,a)||this.h.push(a);if(!this.f){var b=this;Qj(this.g).then(function(a){a?Pj(b.g).then(function(){Vj(b).s(function(a){var c=new wh("unknown",null,null,null,new N("operation-not-supported-in-this-environment"));Xj(a)&&b.m(c)})}):Wj(b)}).s(function(){Wj(b)})}};Rj.prototype.unsubscribe=function(a){Ja(this.h,function(b){return b==a})};Rj.prototype.m=function(a){if(!a)throw new N("invalid-auth-event");for(var b=!1,c=0;c<this.h.length;c++){var d=this.h[c];if(d.ob(a.b,a.c)){(b=this.b[a.b])&&b.h(a,d);b=!0;break}}Yj(this.c);return b};var Zj=new $f(2e3,1e4),ak=new $f(3e4,6e4);Rj.prototype.aa=function(){return this.c.aa()};function bk(a,b,c,d,e,f){return a.a.ub(b,c,d,function(){a.f||(a.f=!0,a.a.ua(a.i))},function(){a.reset()},e,f)}function Xj(a){return a&&"auth/cordova-not-ready"==a.code?!0:!1}Rj.prototype.Aa=function(a,b,c){var d=this,e;return Oj(this.g).then(function(){return d.a.Aa(a,b,c).s(function(a){if(Xj(a))throw new N("operation-not-supported-in-this-environment");e=a;return Pj(d.g).then(function(){throw e})}).then(function(){return d.a.Db()?new z(function(){}):Pj(d.g).then(function(){return d.aa()}).then(function(){}).s(function(){})})})};Rj.prototype.Ca=function(a,b,c,d){return this.a.Ca(c,function(c){a.fa(b,null,c,d)},Zj.get())};var ck={};function dk(a,b,c){var d=b+":"+c;ck[d]||(ck[d]=new Rj(a,b,c));return ck[d]}function Sj(){this.b=null;this.f=[];this.c=[];this.a=null;this.g=!1}Sj.prototype.reset=function(){this.b=null;this.a&&(this.a.cancel(),this.a=null)};Sj.prototype.h=function(a,b){if(!a)return B(new N("invalid-auth-event"));this.reset();this.g=!0;var c=a.b,d=a.c,e=a.a&&"auth/web-storage-unsupported"==a.a.code,f=a.a&&"auth/operation-not-supported-in-this-environment"==a.a.code;"unknown"!=c||e||f?a.a?(ek(this,!0,null,a.a),a=A()):a=b.va(c,d)?fk(this,a,b):B(new N("invalid-auth-event")):(ek(this,!1,null,null),a=A());return a};function Yj(a){a.g||(a.g=!0,ek(a,!1,null,null))}function fk(a,b,c){c=c.va(b.b,b.c);var d=b.f,e=b.g,f=!!b.b.match(/Redirect$/);return c(d,e).then(function(b){ek(a,f,b,null)}).s(function(b){ek(a,f,null,b)})}function gk(a,b){a.b=function(){return B(b)};if(a.c.length)for(var c=0;c<a.c.length;c++)a.c[c](b)}function hk(a,b){a.b=function(){return A(b)};if(a.f.length)for(var c=0;c<a.f.length;c++)a.f[c](b)}function ek(a,b,c,d){b?d?gk(a,d):hk(a,c):hk(a,{user:null});a.f=[];a.c=[]}Sj.prototype.aa=function(){var a=this;return new z(function(b,c){a.b?a.b().then(b,c):(a.f.push(b),a.c.push(c),ik(a))})};function ik(a){var b=new N("timeout");a.a&&a.a.cancel();a.a=sd(ak.get()).then(function(){a.b||ek(a,!0,null,b)})}function Tj(){}Tj.prototype.h=function(a,b){if(!a)return B(new N("invalid-auth-event"));var c=a.b,d=a.c;a.a?(b.fa(a.b,null,a.a,a.c),a=A()):a=b.va(c,d)?jk(a,b):B(new N("invalid-auth-event"));return a};function jk(a,b){var c=a.c,d=a.b;return b.va(d,c)(a.f,a.g).then(function(a){b.fa(d,a,null,c)}).s(function(a){b.fa(d,null,a,c)})}function kk(a,b){this.a=b;M(this,"verificationId",a)}kk.prototype.confirm=function(a){a=th(this.verificationId,a);return this.a(a)};function lk(a,b,c,d){return new rh(a).Qa(b,c).then(function(a){return new kk(a,d)})}function mk(a,b,c,d,e,f){this.h=a;this.i=b;this.g=c;this.c=d;this.f=e;this.l=!!f;this.b=null;this.a=this.c;if(this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}mk.prototype.start=function(){this.a=this.c;nk(this,!0)};function ok(a,b){if(b)return a.a=a.c,a.g();b=a.a;a.a*=2;a.a>a.f&&(a.a=a.f);return b}function nk(a,b){pk(a);a.b=sd(ok(a,b)).then(function(){return a.l?A():bg()}).then(function(){return a.h()}).then(function(){nk(a,!0)}).s(function(b){a.i(b)&&nk(a,!1)})}function pk(a){a.b&&(a.b.cancel(),a.b=null)}function qk(a){this.f=a;this.b=this.a=null;this.c=0}qk.prototype.B=function(){return{apiKey:this.f.b,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}};function rk(a,b){var c=b[O],d=b.refreshToken;b=sk(b.expiresIn);a.b=c;a.c=b;a.a=d}function sk(a){return na()+1e3*parseInt(a,10)}function tk(a,b){return Oh(a.f,b).then(function(b){a.b=b.access_token;a.c=sk(b.expires_in);a.a=b.refresh_token;return{accessToken:a.b,expirationTime:a.c,refreshToken:a.a}}).s(function(b){"auth/user-token-expired"==b.code&&(a.a=null);throw b})}qk.prototype.getToken=function(a){a=!!a;return this.b&&!this.a?B(new N("user-token-expired")):a||!this.b||na()>this.c-3e4?this.a?tk(this,{grant_type:"refresh_token",refresh_token:this.a}):A(null):A({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})};function uk(a,b){this.a=a||null;this.b=b||null;gg(this,{lastSignInTime:cg(b||null),creationTime:cg(a||null)})}function vk(a){return new uk(a.a,a.b)}uk.prototype.B=function(){return{lastLoginAt:this.b,createdAt:this.a}};function wk(a,b,c,d,e,f){gg(this,{uid:a,displayName:d||null,photoURL:e||null,email:c||null,phoneNumber:f||null,providerId:b})}function xk(a,b){C.call(this,a);for(var c in b)this[c]=b[c]}t(xk,C);function yk(a,b,c){this.A=[];this.G=a.apiKey;this.o=a.appName;this.w=a.authDomain||null;a=firebase.SDK_VERSION?Of(firebase.SDK_VERSION):null;this.c=new Ch(this.G,wi(xi),a);this.h=new qk(this.c);zk(this,b[O]);rk(this.h,b);M(this,"refreshToken",this.h.a);Ak(this,c||{});F.call(this);this.I=!1;this.w&&Rf()&&(this.a=dk(this.w,this.G,this.o));this.N=[];this.i=null;this.l=Bk(this);this.U=r(this.Ga,this);var d=this;this.ha=null;this.ra=function(a){d.na(a.h)};this.W=null;this.R=[];this.qa=function(a){Ck(d,a.f)};this.V=null}t(yk,F);yk.prototype.na=function(a){this.ha=a;Ih(this.c,a)};yk.prototype.$=function(){return this.ha};function Dk(a,b){a.W&&E(a.W,"languageCodeChanged",a.ra);(a.W=b)&&cd(b,"languageCodeChanged",a.ra)}function Ck(a,b){a.R=b;Jh(a.c,firebase.SDK_VERSION?Of(firebase.SDK_VERSION,a.R):null)}yk.prototype.Ka=function(){return La(this.R)};function Ek(a,b){a.V&&E(a.V,"frameworkChanged",a.qa);(a.V=b)&&cd(b,"frameworkChanged",a.qa)}yk.prototype.Ga=function(){this.l.b&&(pk(this.l),this.l.start())};function Fk(a){try{return firebase.app(a.o).auth()}catch(b){throw new N("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+a.o+"'!")}}function Bk(a){return new mk(function(){return a.F(!0)},function(a){return a&&"auth/network-request-failed"==a.code?!0:!1},function(){var b=a.h.c-na()-3e5;return 0<b?b:0},3e4,96e4,!1)}function Gk(a){a.m||a.l.b||(a.l.start(),E(a,"tokenChanged",a.U),cd(a,"tokenChanged",a.U))}function Hk(a){E(a,"tokenChanged",a.U);pk(a.l)}function zk(a,b){a.pa=b;M(a,"_lat",b)}function Ik(a,b){Ja(a.N,function(a){
return a==b})}function Jk(a){for(var b=[],c=0;c<a.N.length;c++)b.push(a.N[c](a));return Ob(b).then(function(){return a})}function Kk(a){a.a&&!a.I&&(a.I=!0,a.a.subscribe(a))}function Ak(a,b){gg(a,{uid:b.uid,displayName:b.displayName||null,photoURL:b.photoURL||null,email:b.email||null,emailVerified:b.emailVerified||!1,phoneNumber:b.phoneNumber||null,isAnonymous:b.isAnonymous||!1,metadata:new uk(b.createdAt,b.lastLoginAt),providerData:[]})}M(yk.prototype,"providerId","firebase");function Lk(){}function Mk(a){return A().then(function(){if(a.m)throw new N("app-deleted")})}function Nk(a){return Da(a.providerData,function(a){return a.providerId})}function Ok(a,b){b&&(Pk(a,b.providerId),a.providerData.push(b))}function Pk(a,b){Ja(a.providerData,function(a){return a.providerId==b})}function Qk(a,b,c){("uid"!=b||c)&&a.hasOwnProperty(b)&&M(a,b,c)}function Rk(a,b){a!=b&&(gg(a,{uid:b.uid,displayName:b.displayName,photoURL:b.photoURL,email:b.email,emailVerified:b.emailVerified,phoneNumber:b.phoneNumber,isAnonymous:b.isAnonymous,providerData:[]}),b.metadata?M(a,"metadata",vk(b.metadata)):M(a,"metadata",new uk),w(b.providerData,function(b){Ok(a,b)}),a.h=b.h,M(a,"refreshToken",a.h.a))}h=yk.prototype;h.reload=function(){var a=this;return R(this,Mk(this).then(function(){return Sk(a).then(function(){return Jk(a)}).then(Lk)}))};function Sk(a){return a.F().then(function(b){var c=a.isAnonymous;return Tk(a,b).then(function(){c||Qk(a,"isAnonymous",!1);return b})})}h.F=function(a){var b=this;return R(this,Mk(this).then(function(){return b.h.getToken(a)}).then(function(a){if(!a)throw new N("internal-error");a.accessToken!=b.pa&&(zk(b,a.accessToken),G(b,new xk("tokenChanged")));Qk(b,"refreshToken",a.refreshToken);return a.accessToken}))};h.getToken=function(a){dg["firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead."]||(dg["firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead."]=!0,"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn("firebase.User.prototype.getToken is deprecated. Please use firebase.User.prototype.getIdToken instead."));return this.F(a)};function Uk(a,b){b[O]&&a.pa!=b[O]&&(rk(a.h,b),G(a,new xk("tokenChanged")),zk(a,b[O]),Qk(a,"refreshToken",a.h.a))}function Tk(a,b){return Q(a.c,si,{idToken:b}).then(r(a.gc,a))}h.gc=function(a){a=a.users;if(!a||!a.length)throw new N("internal-error");a=a[0];Ak(this,{uid:a.localId,displayName:a.displayName,photoURL:a.photoUrl,email:a.email,emailVerified:!!a.emailVerified,phoneNumber:a.phoneNumber,lastLoginAt:a.lastLoginAt,createdAt:a.createdAt});for(var b=Vk(a),c=0;c<b.length;c++)Ok(this,b[c]);Qk(this,"isAnonymous",!(this.email&&a.passwordHash)&&!(this.providerData&&this.providerData.length))};function Vk(a){return(a=a.providerUserInfo)&&a.length?Da(a,function(a){return new wk(a.rawId,a.providerId,a.email,a.displayName,a.photoUrl,a.phoneNumber)}):[]}h.Za=function(a){var b=this,c=null;return R(this,a.c(this.c,this.uid).then(function(a){Uk(b,a);c=Wk(b,a,"reauthenticate");b.i=null;return b.reload()}).then(function(){return c}),!0)};h.hc=function(a){return this.Za(a).then(function(){})};function Xk(a,b){return Sk(a).then(function(){if(Ha(Nk(a),b))return Jk(a).then(function(){throw new N("provider-already-linked")})})}h.Xa=function(a){var b=this,c=null;return R(this,Xk(this,a.providerId).then(function(){return b.F()}).then(function(c){return a.b(b.c,c)}).then(function(a){c=Wk(b,a,"link");return Yk(b,a)}).then(function(){return c}))};h.Zb=function(a){return this.Xa(a).then(function(a){return a.user})};h.$b=function(a,b){var c=this;return R(this,Xk(this,"phone").then(function(){return lk(Fk(c),a,b,r(c.Xa,c))}))};h.ic=function(a,b){var c=this;return R(this,A().then(function(){return lk(Fk(c),a,b,r(c.Za,c))}),!0)};function Wk(a,b,c){var d=uh(b);b=Mg(b);return hg({user:a,credential:d,additionalUserInfo:b,operationType:c})}function Yk(a,b){Uk(a,b);return a.reload().then(function(){return a})}h.kb=function(a){var b=this;return R(this,this.F().then(function(c){return b.c.kb(c,a)}).then(function(a){Uk(b,a);return b.reload()}))};h.zc=function(a){var b=this;return R(this,this.F().then(function(c){return a.b(b.c,c)}).then(function(a){Uk(b,a);return b.reload()}))};h.lb=function(a){var b=this;return R(this,this.F().then(function(c){return b.c.lb(c,a)}).then(function(a){Uk(b,a);return b.reload()}))};h.mb=function(a){if(void 0===a.displayName&&void 0===a.photoURL)return Mk(this);var b=this;return R(this,this.F().then(function(c){return b.c.mb(c,{displayName:a.displayName,photoUrl:a.photoURL})}).then(function(a){Uk(b,a);Qk(b,"displayName",a.displayName||null);Qk(b,"photoURL",a.photoUrl||null);w(b.providerData,function(a){"password"===a.providerId&&(M(a,"displayName",b.displayName),M(a,"photoURL",b.photoURL))});return Jk(b)}).then(Lk))};h.yc=function(a){var b=this;return R(this,Sk(this).then(function(c){return Ha(Nk(b),a)?fi(b.c,c,[a]).then(function(a){var c={};w(a.providerUserInfo||[],function(a){c[a.providerId]=!0});w(Nk(b),function(a){c[a]||Pk(b,a)});c[rh.PROVIDER_ID]||M(b,"phoneNumber",null);return Jk(b)}):Jk(b).then(function(){throw new N("no-such-provider")})}))};h.delete=function(){var a=this;return R(this,this.F().then(function(b){return Q(a.c,ri,{idToken:b})}).then(function(){G(a,new xk("userDeleted"))})).then(function(){for(var b=0;b<a.A.length;b++)a.A[b].cancel("app-deleted");Dk(a,null);Ek(a,null);a.A=[];a.m=!0;Hk(a);M(a,"refreshToken",null);a.a&&a.a.unsubscribe(a)})};h.ob=function(a,b){return"linkViaPopup"==a&&(this.g||null)==b&&this.f||"reauthViaPopup"==a&&(this.g||null)==b&&this.f||"linkViaRedirect"==a&&(this.Z||null)==b||"reauthViaRedirect"==a&&(this.Z||null)==b?!0:!1};h.fa=function(a,b,c,d){"linkViaPopup"!=a&&"reauthViaPopup"!=a||d!=(this.g||null)||(c&&this.v?this.v(c):b&&!c&&this.f&&this.f(b),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)};h.va=function(a,b){return"linkViaPopup"==a&&b==(this.g||null)?r(this.sb,this):"reauthViaPopup"==a&&b==(this.g||null)?r(this.tb,this):"linkViaRedirect"==a&&(this.Z||null)==b?r(this.sb,this):"reauthViaRedirect"==a&&(this.Z||null)==b?r(this.tb,this):null};h.ac=function(a){var b=this;return Zk(this,"linkViaPopup",a,function(){return Xk(b,a.providerId).then(function(){return Jk(b)})},!1)};h.jc=function(a){return Zk(this,"reauthViaPopup",a,function(){return A()},!0)};function Zk(a,b,c,d,e){if(!Rf())return B(new N("operation-not-supported-in-this-environment"));if(a.i&&!e)return B(a.i);var f=Lg(c.providerId),g=Qf(a.uid+":::"),l=null;(!Tf()||Lf())&&a.w&&c.isOAuthProvider&&(l=Qi(a.w,a.G,a.o,b,c,null,g,firebase.SDK_VERSION||null));var n=Df(l,f&&f.za,f&&f.ya);d=d().then(function(){$k(a);if(!e)return a.F().then(function(){})}).then(function(){return bk(a.a,n,b,c,g,!!l)}).then(function(){return new z(function(c,d){a.fa(b,null,new N("cancelled-popup-request"),a.g||null);a.f=c;a.v=d;a.g=g;a.b=a.a.Ca(a,b,n,g)})}).then(function(a){n&&Cf(n);return a?hg(a):null}).s(function(a){n&&Cf(n);throw a});return R(a,d,e)}h.bc=function(a){var b=this;return al(this,"linkViaRedirect",a,function(){return Xk(b,a.providerId)},!1)};h.kc=function(a){return al(this,"reauthViaRedirect",a,function(){return A()},!0)};function al(a,b,c,d,e){if(!Rf())return B(new N("operation-not-supported-in-this-environment"));if(a.i&&!e)return B(a.i);var f=null,g=Qf(a.uid+":::");d=d().then(function(){$k(a);if(!e)return a.F().then(function(){})}).then(function(){a.Z=g;return Jk(a)}).then(function(b){a.ca&&(b=a.ca,b=b.b.set(bl,a.B(),b.a));return b}).then(function(){return a.a.Aa(b,c,g)}).s(function(b){f=b;if(a.ca)return cl(a.ca);throw f}).then(function(){if(f)throw f});return R(a,d,e)}function $k(a){if(!a.a||!a.I){if(a.a&&!a.I)throw new N("internal-error");throw new N("auth-domain-config-required")}}h.sb=function(a,b){var c=this;this.b&&(this.b.cancel(),this.b=null);var d=null,e=this.F().then(function(d){return Zg(c.c,{requestUri:a,sessionId:b,idToken:d})}).then(function(a){d=Wk(c,a,"link");return Yk(c,a)}).then(function(){return d});return R(this,e)};h.tb=function(a,b){var c=this;this.b&&(this.b.cancel(),this.b=null);var d=null,e=A().then(function(){return Vg($g(c.c,{requestUri:a,sessionId:b}),c.uid)}).then(function(a){d=Wk(c,a,"reauthenticate");Uk(c,a);c.i=null;return c.reload()}).then(function(){return d});return R(this,e,!0)};h.bb=function(a){var b=this,c=null;return R(this,this.F().then(function(b){c=b;return"undefined"===typeof a||Sa(a)?{}:Fg(new wg(a))}).then(function(a){return b.c.bb(c,a)}).then(function(a){if(b.email!=a)return b.reload()}).then(function(){}))};function R(a,b,c){var d=dl(a,b,c);a.A.push(d);Qb(d,function(){Ia(a.A,d)});return d}function dl(a,b,c){return a.i&&!c?(b.cancel(),B(a.i)):b.s(function(b){!b||"auth/user-disabled"!=b.code&&"auth/user-token-expired"!=b.code||(a.i||G(a,new xk("userInvalidated")),a.i=b);throw b})}h.toJSON=function(){return this.B()};h.B=function(){var a={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,providerData:[],apiKey:this.G,appName:this.o,authDomain:this.w,stsTokenManager:this.h.B(),redirectEventId:this.Z||null};this.metadata&&Wa(a,this.metadata.B());w(this.providerData,function(b){a.providerData.push(ig(b))});return a};function el(a){if(!a.apiKey)return null;var b={apiKey:a.apiKey,authDomain:a.authDomain,appName:a.appName},c={};if(a.stsTokenManager&&a.stsTokenManager.accessToken&&a.stsTokenManager.expirationTime)c[O]=a.stsTokenManager.accessToken,c.refreshToken=a.stsTokenManager.refreshToken||null,c.expiresIn=(a.stsTokenManager.expirationTime-na())/1e3;else return null;var d=new yk(b,c,a);a.providerData&&w(a.providerData,function(a){a&&Ok(d,hg(a))});a.redirectEventId&&(d.Z=a.redirectEventId);return d}function fl(a,b,c,d){var e=new yk(a,b);c&&(e.ca=c);d&&Ck(e,d);return e.reload().then(function(){return e})}function gl(a){this.a=a;this.b=oj()}var bl={name:"redirectUser",C:"session"};function cl(a){return rj(a.b,bl,a.a)}function hl(a,b){return a.b.get(bl,a.a).then(function(a){a&&b&&(a.authDomain=b);return el(a||{})})}function il(a,b){this.a=a;this.b=b||oj();this.c=null;this.f=jl(this);sj(this.b,vj("local"),this.a,r(this.g,this))}il.prototype.g=function(){var a=this,b=vj("local");kl(this,function(){return A().then(function(){return a.c&&"local"!=a.c.C?a.b.get(b,a.a):null}).then(function(c){if(c)return ll(a,"local").then(function(){a.c=b})})})};function ll(a,b){var c=[],d;for(d in kj)kj[d]!==b&&c.push(rj(a.b,vj(kj[d]),a.a));c.push(rj(a.b,ml,a.a));return Nb(c)}function jl(a){var b=vj("local"),c=vj("session"),d=vj("none");return a.b.get(c,a.a).then(function(e){return e?c:a.b.get(d,a.a).then(function(c){return c?d:a.b.get(b,a.a).then(function(c){return c?b:a.b.get(ml,a.a).then(function(a){return a?vj(a):b})})})}).then(function(b){a.c=b;return ll(a,b.C)}).s(function(){a.c||(a.c=b)})}var ml={name:"persistence",C:"session"};function vj(a){return{name:"authUser",C:a}}il.prototype.eb=function(a){var b=null,c=this;lj(a);return kl(this,function(){return a!=c.c.C?c.b.get(c.c,c.a).then(function(d){b=d;return ll(c,a)}).then(function(){c.c=vj(a);if(b)return c.b.set(c.c,b,c.a)}):A()})};function nl(a){return kl(a,function(){return a.b.set(ml,a.c.C,a.a)})}function ol(a,b){return kl(a,function(){return a.b.set(a.c,b.B(),a.a)})}function pl(a){return kl(a,function(){return rj(a.b,a.c,a.a)})}function ql(a,b){return kl(a,function(){return a.b.get(a.c,a.a).then(function(a){a&&b&&(a.authDomain=b);return el(a||{})})})}function kl(a,b){a.f=a.f.then(b,b);return a.f}function rl(a){this.l=!1;M(this,"app",a);if(S(this).options&&S(this).options.apiKey)a=firebase.SDK_VERSION?Of(firebase.SDK_VERSION):null,this.c=new Ch(S(this).options&&S(this).options.apiKey,wi(xi),a);else throw new N("invalid-api-key");this.N=[];this.m=[];this.I=[];this.Gb=firebase.INTERNAL.createSubscribe(r(this.Xb,this));this.R=void 0;this.Hb=firebase.INTERNAL.createSubscribe(r(this.Yb,this));sl(this,null);this.h=new il(S(this).options.apiKey+":"+S(this).name);this.G=new gl(S(this).options.apiKey+":"+S(this).name);this.U=T(this,tl(this));this.i=T(this,ul(this));this.W=!1;this.ha=r(this.uc,this);this.Ga=r(this.ka,this);this.pa=r(this.Pb,this);this.qa=r(this.Vb,this);this.ra=r(this.Wb,this);vl(this);this.INTERNAL={};this.INTERNAL["delete"]=r(this.delete,this);this.INTERNAL.logFramework=r(this.cc,this);this.o=0;F.call(this);wl(this);this.A=[]}t(rl,F);function xl(a){C.call(this,"languageCodeChanged");this.h=a}t(xl,C);function yl(a){C.call(this,"frameworkChanged");this.f=a}t(yl,C);h=rl.prototype;h.eb=function(a){a=this.h.eb(a);return T(this,a)};h.na=function(a){this.V===a||this.l||(this.V=a,Ih(this.c,this.V),G(this,new xl(this.$())))};h.$=function(){return this.V};h.Ac=function(){var a=k.navigator;this.na(a?a.languages&&a.languages[0]||a.language||a.userLanguage||null:null)};h.cc=function(a){this.A.push(a);Jh(this.c,firebase.SDK_VERSION?Of(firebase.SDK_VERSION,this.A):null);G(this,new yl(this.A))};h.Ka=function(){return La(this.A)};function wl(a){Object.defineProperty(a,"lc",{get:function(){return this.$()},set:function(a){this.na(a)},enumerable:!1});a.V=null}h.toJSON=function(){return{apiKey:S(this).options.apiKey,authDomain:S(this).options.authDomain,appName:S(this).name,currentUser:U(this)&&U(this).B()}};function zl(a){return a.Fb||B(new N("auth-domain-config-required"))}function vl(a){var b=S(a).options.authDomain,c=S(a).options.apiKey;b&&Rf()&&(a.Fb=a.U.then(function(){if(!a.l){a.a=dk(b,c,S(a).name);a.a.subscribe(a);U(a)&&Kk(U(a));if(a.w){Kk(a.w);var d=a.w;d.na(a.$());Dk(d,a);d=a.w;Ck(d,a.A);Ek(d,a);a.w=null}return a.a}}))}h.ob=function(a,b){switch(a){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==b&&!!this.f;default:return!1}};h.fa=function(a,b,c,d){"signInViaPopup"==a&&this.g==d&&(c&&this.v?this.v(c):b&&!c&&this.f&&this.f(b),this.b&&(this.b.cancel(),this.b=null),delete this.f,delete this.v)};h.va=function(a,b){return"signInViaRedirect"==a||"signInViaPopup"==a&&this.g==b&&this.f?r(this.Ob,this):null};h.Ob=function(a,b){var c=this;a={requestUri:a,sessionId:b};this.b&&(this.b.cancel(),this.b=null);var d=null,e=null,f=Xg(c.c,a).then(function(a){d=uh(a);e=Mg(a);return a});a=c.U.then(function(){return f}).then(function(a){return Al(c,a)}).then(function(){return hg({user:U(c),credential:d,additionalUserInfo:e,operationType:"signIn"})});return T(this,a)};h.sc=function(a){if(!Rf())return B(new N("operation-not-supported-in-this-environment"));var b=this,c=Lg(a.providerId),d=Qf(),e=null;(!Tf()||Lf())&&S(this).options.authDomain&&a.isOAuthProvider&&(e=Qi(S(this).options.authDomain,S(this).options.apiKey,S(this).name,"signInViaPopup",a,null,d,firebase.SDK_VERSION||null));var f=Df(e,c&&c.za,c&&c.ya);c=zl(this).then(function(b){return bk(b,f,"signInViaPopup",a,d,!!e)}).then(function(){return new z(function(a,c){b.fa("signInViaPopup",null,new N("cancelled-popup-request"),b.g);b.f=a;b.v=c;b.g=d;b.b=b.a.Ca(b,"signInViaPopup",f,d)})}).then(function(a){f&&Cf(f);return a?hg(a):null}).s(function(a){f&&Cf(f);throw a});return T(this,c)};h.tc=function(a){if(!Rf())return B(new N("operation-not-supported-in-this-environment"));var b=this,c=zl(this).then(function(){return nl(b.h)}).then(function(){return b.a.Aa("signInViaRedirect",a)});return T(this,c)};h.aa=function(){if(!Rf())return B(new N("operation-not-supported-in-this-environment"));var a=this,b=zl(this).then(function(){return a.a.aa()}).then(function(a){return a?hg(a):null});return T(this,b)};function Al(a,b){var c={};c.apiKey=S(a).options.apiKey;c.authDomain=S(a).options.authDomain;c.appName=S(a).name;return a.U.then(function(){return fl(c,b,a.G,a.Ka())}).then(function(b){if(U(a)&&b.uid==U(a).uid)return Rk(U(a),b),a.ka(b);sl(a,b);Kk(b);return a.ka(b)}).then(function(){Bl(a)})}function sl(a,b){U(a)&&(Ik(U(a),a.Ga),E(U(a),"tokenChanged",a.pa),E(U(a),"userDeleted",a.qa),E(U(a),"userInvalidated",a.ra),Hk(U(a)));b&&(b.N.push(a.Ga),cd(b,"tokenChanged",a.pa),cd(b,"userDeleted",a.qa),cd(b,"userInvalidated",a.ra),0<a.o&&Gk(b));M(a,"currentUser",b);b&&(b.na(a.$()),Dk(b,a),Ck(b,a.A),Ek(b,a))}h.hb=function(){var a=this,b=this.i.then(function(){if(!U(a))return A();sl(a,null);return pl(a.h).then(function(){Bl(a)})});return T(this,b)};function Cl(a){var b=hl(a.G,S(a).options.authDomain).then(function(b){if(a.w=b)b.ca=a.G;return cl(a.G)});return T(a,b)}function tl(a){var b=S(a).options.authDomain,c=Cl(a).then(function(){return ql(a.h,b)}).then(function(b){return b?(b.ca=a.G,a.w&&(a.w.Z||null)==(b.Z||null)?b:b.reload().then(function(){return ol(a.h,b).then(function(){return b})}).s(function(c){return"auth/network-request-failed"==c.code?b:pl(a.h)})):null}).then(function(b){sl(a,b||null)});return T(a,c)}function ul(a){return a.U.then(function(){return a.aa()}).s(function(){}).then(function(){if(!a.l)return a.ha()}).s(function(){}).then(function(){if(!a.l){a.W=!0;var b=a.h;sj(b.b,vj("local"),b.a,a.ha)}})}h.uc=function(){var a=this;return ql(this.h,S(this).options.authDomain).then(function(b){if(!a.l){var c;if(c=U(a)&&b){c=U(a).uid;var d=b.uid;c=void 0===c||null===c||""===c||void 0===d||null===d||""===d?!1:c==d}if(c)return Rk(U(a),b),U(a).F();if(U(a)||b)sl(a,b),b&&(Kk(b),b.ca=a.G),a.a&&a.a.subscribe(a),Bl(a)}})};h.ka=function(a){return ol(this.h,a)};h.Pb=function(){Bl(this);this.ka(U(this))};h.Vb=function(){this.hb()};h.Wb=function(){this.hb()};function Dl(a,b){var c=null,d=null;return T(a,b.then(function(b){c=uh(b);d=Mg(b);return Al(a,b)}).then(function(){return hg({user:U(a),credential:c,additionalUserInfo:d,operationType:"signIn"})}))}h.Xb=function(a){var b=this;this.addAuthTokenListener(function(){a.next(U(b))})};h.Yb=function(a){var b=this;El(this,function(){a.next(U(b))})};h.ec=function(a,b,c){var d=this;this.W&&firebase.Promise.resolve().then(function(){p(a)?a(U(d)):p(a.next)&&a.next(U(d))});return this.Gb(a,b,c)};h.dc=function(a,b,c){var d=this;this.W&&firebase.Promise.resolve().then(function(){d.R=d.getUid();p(a)?a(U(d)):p(a.next)&&a.next(U(d))});return this.Hb(a,b,c)};h.Rb=function(a){var b=this,c=this.i.then(function(){return U(b)?U(b).F(a).then(function(a){return{accessToken:a}}):null});return T(this,c)};h.pc=function(a){var b=this;return this.i.then(function(){return Dl(b,Q(b.c,ui,{token:a}))}).then(function(a){a=a.user;Qk(a,"isAnonymous",!1);return b.ka(a)}).then(function(){return U(b)})};h.qc=function(a,b){var c=this;return this.i.then(function(){return Dl(c,Q(c.c,kh,{email:a,password:b}))}).then(function(a){return a.user})};h.Kb=function(a,b){var c=this;return this.i.then(function(){return Dl(c,Q(c.c,qi,{email:a,password:b}))}).then(function(a){return a.user})};h.oc=function(a){return this.fb(a).then(function(a){return a.user})};h.fb=function(a){var b=this;return this.i.then(function(){return Dl(b,a.wa(b.c))})};h.gb=function(){var a=this;return this.i.then(function(){var b=U(a);return b&&b.isAnonymous?b:Dl(a,a.c.gb()).then(function(b){b=b.user;Qk(b,"isAnonymous",!0);return a.ka(b)}).then(function(){return U(a)})})};function S(a){return a.app}function U(a){return a.currentUser}h.getUid=function(){return U(this)&&U(this).uid||null};function Fl(a){return U(a)&&U(a)._lat||null}function Bl(a){if(a.W){for(var b=0;b<a.m.length;b++)if(a.m[b])a.m[b](Fl(a));if(a.R!==a.getUid()&&a.I.length)for(a.R=a.getUid(),b=0;b<a.I.length;b++)if(a.I[b])a.I[b](Fl(a))}}h.Ib=function(a){this.addAuthTokenListener(a);this.o++;0<this.o&&U(this)&&Gk(U(this))};h.mc=function(a){var b=this;w(this.m,function(c){c==a&&b.o--});0>this.o&&(this.o=0);0==this.o&&U(this)&&Hk(U(this));this.removeAuthTokenListener(a)};h.addAuthTokenListener=function(a){var b=this;this.m.push(a);T(this,this.i.then(function(){b.l||Ha(b.m,a)&&a(Fl(b))}))};h.removeAuthTokenListener=function(a){Ja(this.m,function(b){return b==a})};function El(a,b){a.I.push(b);T(a,a.i.then(function(){!a.l&&Ha(a.I,b)&&a.R!==a.getUid()&&(a.R=a.getUid(),b(Fl(a)))}))}h.delete=function(){this.l=!0;for(var a=0;a<this.N.length;a++)this.N[a].cancel("app-deleted");this.N=[];this.h&&(a=this.h,uj(a.b,a.a,this.ha));this.a&&this.a.unsubscribe(this);return firebase.Promise.resolve()};function T(a,b){a.N.push(b);Qb(b,function(){Ia(a.N,b)});return b}h.Nb=function(a){return T(this,Th(this.c,a))};h.Bc=function(a){return this.Ia(a).then(function(a){return a.data.email})};h.Ta=function(a,b){return T(this,this.c.Ta(a,b).then(function(){}))};h.Ia=function(a){return T(this,this.c.Ia(a).then(function(a){return new lg(a)}))};h.Sa=function(a){return T(this,this.c.Sa(a).then(function(){}))};h.cb=function(a,b){var c=this;return T(this,A().then(function(){return"undefined"===typeof b||Sa(b)?{}:Fg(new wg(b))}).then(function(b){return c.c.cb(a,b)}).then(function(){}))};h.rc=function(a,b){return T(this,lk(this,a,b,r(this.fb,this)))};function Gl(a,b,c,d){a:{c=Array.prototype.slice.call(c);var e=0;for(var f=!1,g=0;g<b.length;g++)if(b[g].optional)f=!0;else{if(f)throw new N("internal-error","Argument validator encountered a required argument after an optional argument.");e++}f=b.length;if(c.length<e||f<c.length)d="Expected "+(e==f?1==e?"1 argument":e+" arguments":e+"-"+f+" arguments")+" but got "+c.length+".";else{for(e=0;e<c.length;e++)if(f=b[e].optional&&void 0===c[e],!b[e].M(c[e])&&!f){b=b[e];if(0>e||e>=Hl.length)throw new N("internal-error","Argument validator received an unsupported number of arguments.");c=Hl[e];d=(d?"":c+" argument ")+(b.name?'"'+b.name+'" ':"")+"must be "+b.K+".";break a}d=null}}if(d)throw new N("argument-error",a+" failed: "+d)}var Hl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function V(a,b){return{name:a||"",K:"a valid string",optional:!!b,M:m}}function Il(){return{name:"opt_forceRefresh",K:"a boolean",optional:!0,M:ba}}function W(a,b){return{name:a||"",K:"a valid object",optional:!!b,M:q}}function Jl(a,b){return{name:a||"",K:"a function",optional:!!b,M:p}}function Kl(a,b){return{name:a||"",K:"null",optional:!!b,M:ea}}function Ll(){return{name:"",K:"an HTML element",optional:!1,M:function(a){return!!(a&&a instanceof Element)}}}function Ml(){return{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(a){return!!(a&&a instanceof rl)}}}function Nl(){return{name:"app",K:"an instance of Firebase App",optional:!0,M:function(a){return!!(a&&a instanceof firebase.app.App)}}}function Ol(a){return{name:a?a+"Credential":"credential",K:a?"a valid "+a+" credential":"a valid credential",optional:!1,M:function(b){if(!b)return!1;var c=!a||b.providerId===a;return!(!b.wa||!c)}}}function Pl(){return{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(a){return!!(a&&a.providerId&&a.hasOwnProperty&&a.hasOwnProperty("isOAuthProvider"))}}}function Ql(){return{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(a){return!!(a&&m(a.type)&&p(a.verify))}}}function X(a,b,c,d){return{name:c||"",K:a.K+" or "+b.K,optional:!!d,M:function(c){return a.M(c)||b.M(c)}}}function Rl(a,b,c,d,e,f){M(this,"type","recaptcha");this.b=this.c=null;this.m=!1;this.l=b;this.a=c||{theme:"light",type:"image"};this.g=[];if(this.a[Sl])throw new N("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");this.h="invisible"===this.a[Tl];if(!wc(b)||!this.h&&wc(b).hasChildNodes())throw new N("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.u=new Ch(a,f||null,e||null);this.o=d||function(){return null};var g=this;this.i=[];var l=this.a[Ul];this.a[Ul]=function(a){Vl(g,a);if("function"===typeof l)l(a);else if("string"===typeof l){var b=L(l,k);"function"===typeof b&&b(a)}};var n=this.a[Wl];this.a[Wl]=function(){Vl(g,null);if("function"===typeof n)n();else if("string"===typeof n){var a=L(n,k);"function"===typeof a&&a()}}}var Ul="callback",Wl="expired-callback",Sl="sitekey",Tl="size";function Vl(a,b){for(var c=0;c<a.i.length;c++)try{a.i[c](b)}catch(d){}}function Xl(a,b){Ja(a.i,function(a){return a==b})}function Yl(a,b){a.g.push(b);Qb(b,function(){Ia(a.g,b)});return b}h=Rl.prototype;h.xa=function(){var a=this;return this.c?this.c:this.c=Yl(this,A().then(function(){if(Sf())return Hf();throw new N("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return Zl($l(),a.o())}).then(function(){return Q(a.u,ti,{})}).then(function(b){a.a[Sl]=b.recaptchaSiteKey}).s(function(b){a.c=null;throw b}))};h.render=function(){am(this);var a=this;return Yl(this,this.xa().then(function(){if(null===a.b){var b=a.l;if(!a.h){var c=wc(b);b=zc("DIV");c.appendChild(b)}a.b=grecaptcha.render(b,a.a)}return a.b}))};h.verify=function(){am(this);var a=this;return Yl(this,this.render().then(function(b){return new z(function(c){var d=grecaptcha.getResponse(b);if(d)c(d);else{var e=function(b){b&&(Xl(a,e),c(b))};a.i.push(e);a.h&&grecaptcha.execute(a.b)}})}))};h.reset=function(){am(this);null!==this.b&&grecaptcha.reset(this.b)};function am(a){if(a.m)throw new N("internal-error","RecaptchaVerifier instance has been destroyed.")}h.clear=function(){am(this);this.m=!0;$l().b--;for(var a=0;a<this.g.length;a++)this.g[a].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.h){a=wc(this.l);for(var b;b=a.firstChild;)a.removeChild(b)}};var bm=dc("https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}");function cm(){this.b=k.grecaptcha?Infinity:0;this.c=null;this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}function Zl(a,b){return new z(function(c,d){if(Zf())if(!k.grecaptcha||b!==a.c&&!a.b){k[a.a]=function(){if(k.grecaptcha){a.c=b;var e=k.grecaptcha.render;k.grecaptcha.render=function(b,c){b=e(b,c);a.b++;return b};c()}else d(new N("internal-error"));delete k[a.a]};var e=hc(bm,{onload:a.a,hl:b||""});A(kf(e)).s(function(){d(new N("internal-error","Unable to load external reCAPTCHA dependencies!"))})}else c();else d(new N("network-request-failed"))})}var dm=null;function $l(){dm||(dm=new cm);return dm}function em(a,b,c){try{this.f=c||firebase.app()}catch(f){throw new N("argument-error","No firebase.app.App instance is currently initialized.")}if(this.f.options&&this.f.options.apiKey)c=this.f.options.apiKey;else throw new N("invalid-api-key");var d=this,e=null;try{e=this.f.auth().Ka()}catch(f){}e=firebase.SDK_VERSION?Of(firebase.SDK_VERSION,e):null;Rl.call(this,c,a,b,function(){try{var a=d.f.auth().$()}catch(g){a=null}return a},e,wi(xi))}t(em,Rl);function Y(a,b){for(var c in b){var d=b[c].name;a[d]=fm(d,a[c],b[c].j)}}function Z(a,b,c,d){a[b]=fm(b,c,d)}function fm(a,b,c){function d(){var a=Array.prototype.slice.call(arguments);Gl(e,c,a);return b.apply(this,a)}if(!c)return b;var e=gm(a),f;for(f in b)d[f]=b[f];for(f in b.prototype)d.prototype[f]=b.prototype[f];return d}function gm(a){a=a.split(".");return a[a.length-1]}Y(rl.prototype,{Sa:{name:"applyActionCode",j:[V("code")]},Ia:{name:"checkActionCode",j:[V("code")]},Ta:{name:"confirmPasswordReset",j:[V("code"),V("newPassword")]},Kb:{name:"createUserWithEmailAndPassword",j:[V("email"),V("password")]},Nb:{name:"fetchProvidersForEmail",j:[V("email")]},aa:{name:"getRedirectResult",j:[]},dc:{name:"onAuthStateChanged",j:[X(W(),Jl(),"nextOrObserver"),Jl("opt_error",!0),Jl("opt_completed",!0)]},ec:{name:"onIdTokenChanged",j:[X(W(),Jl(),"nextOrObserver"),Jl("opt_error",!0),Jl("opt_completed",!0)]},cb:{name:"sendPasswordResetEmail",j:[V("email"),X(W("opt_actionCodeSettings",!0),Kl(null,!0),"opt_actionCodeSettings",!0)]},eb:{name:"setPersistence",j:[V("persistence")]},fb:{name:"signInAndRetrieveDataWithCredential",j:[Ol()]},gb:{name:"signInAnonymously",j:[]},oc:{name:"signInWithCredential",j:[Ol()]},pc:{name:"signInWithCustomToken",j:[V("token")]},qc:{name:"signInWithEmailAndPassword",j:[V("email"),V("password")]},rc:{name:"signInWithPhoneNumber",j:[V("phoneNumber"),Ql()]},sc:{name:"signInWithPopup",j:[Pl()]},tc:{name:"signInWithRedirect",j:[Pl()]},hb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[V(null,!0)]},Ac:{name:"useDeviceLanguage",j:[]},Bc:{name:"verifyPasswordResetCode",j:[V("code")]}});(function(a,b){for(var c in b){var d=b[c].name;if(d!==c){var e=b[c].Jb;Object.defineProperty(a,d,{get:function(){return this[c]},set:function(a){Gl(d,[e],[a],!0);this[c]=a},enumerable:!0})}}})(rl.prototype,{lc:{name:"languageCode",Jb:X(V(),Kl(),"languageCode")}});rl.Persistence=kj;rl.Persistence.LOCAL="local";rl.Persistence.SESSION="session";rl.Persistence.NONE="none";Y(yk.prototype,{"delete":{name:"delete",j:[]},F:{name:"getIdToken",j:[Il()]},getToken:{name:"getToken",j:[Il()]},Xa:{name:"linkAndRetrieveDataWithCredential",j:[Ol()]},Zb:{name:"linkWithCredential",j:[Ol()]},$b:{name:"linkWithPhoneNumber",j:[V("phoneNumber"),Ql()]},ac:{name:"linkWithPopup",j:[Pl()]},bc:{name:"linkWithRedirect",j:[Pl()]},Za:{name:"reauthenticateAndRetrieveDataWithCredential",j:[Ol()]},hc:{name:"reauthenticateWithCredential",j:[Ol()]},ic:{name:"reauthenticateWithPhoneNumber",j:[V("phoneNumber"),Ql()]},jc:{name:"reauthenticateWithPopup",j:[Pl()]},kc:{name:"reauthenticateWithRedirect",j:[Pl()]},reload:{name:"reload",j:[]},bb:{name:"sendEmailVerification",j:[X(W("opt_actionCodeSettings",!0),Kl(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[V(null,!0)]},yc:{name:"unlink",j:[V("provider")]},kb:{name:"updateEmail",j:[V("email")]},lb:{name:"updatePassword",j:[V("password")]},zc:{name:"updatePhoneNumber",j:[Ol("phone")]},mb:{name:"updateProfile",j:[W("profile")]}});Y(z.prototype,{s:{name:"catch"},then:{name:"then"}});Y(kk.prototype,{confirm:{name:"confirm",j:[V("verificationCode")]}});Z(mh,"credential",function(a,b){return new jh(a,b)},[V("email"),V("password")]);Y(bh.prototype,{sa:{name:"addScope",j:[V("scope")]},Ba:{name:"setCustomParameters",j:[W("customOAuthParameters")]}});Z(bh,"credential",ch,[X(V(),W(),"token")]);Y(dh.prototype,{sa:{name:"addScope",j:[V("scope")]},Ba:{name:"setCustomParameters",j:[W("customOAuthParameters")]}});Z(dh,"credential",eh,[X(V(),W(),"token")]);Y(fh.prototype,{sa:{name:"addScope",j:[V("scope")]},Ba:{name:"setCustomParameters",j:[W("customOAuthParameters")]}});Z(fh,"credential",gh,[X(V(),X(W(),Kl()),"idToken"),X(V(),Kl(),"accessToken",!0)]);Y(hh.prototype,{Ba:{name:"setCustomParameters",j:[W("customOAuthParameters")]}});Z(hh,"credential",ih,[X(V(),W(),"token"),V("secret",!0)]);Y(P.prototype,{sa:{name:"addScope",j:[V("scope")]},credential:{name:"credential",j:[X(V(),Kl(),"idToken",!0),X(V(),Kl(),"accessToken",!0)]},Ba:{name:"setCustomParameters",j:[W("customOAuthParameters")]}});Z(rh,"credential",th,[V("verificationId"),V("verificationCode")]);Y(rh.prototype,{Qa:{name:"verifyPhoneNumber",j:[V("phoneNumber"),Ql()]}});Y(N.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}});Y(zh.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}});Y(yh.prototype,{toJSON:{name:"toJSON",j:[V(null,!0)]}});Y(em.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}});(function(){if("undefined"!==typeof firebase&&firebase.INTERNAL&&firebase.INTERNAL.registerService){var a={Auth:rl,Error:N};Z(a,"EmailAuthProvider",mh,[]);Z(a,"FacebookAuthProvider",bh,[]);Z(a,"GithubAuthProvider",dh,[]);Z(a,"GoogleAuthProvider",fh,[]);Z(a,"TwitterAuthProvider",hh,[]);Z(a,"OAuthProvider",P,[V("providerId")]);Z(a,"PhoneAuthProvider",rh,[Ml()]);Z(a,"RecaptchaVerifier",em,[X(V(),Ll(),"recaptchaContainer"),W("recaptchaParameters",!0),Nl()]);firebase.INTERNAL.registerService("auth",function(a,c){a=new rl(a);c({INTERNAL:{getUid:r(a.getUid,a),getToken:r(a.Rb,a),addAuthTokenListener:r(a.Ib,a),removeAuthTokenListener:r(a.mc,a)}});return a},a,function(a,c){if("create"===a)try{c.auth()}catch(d){}});firebase.INTERNAL.extendNamespace({User:yk})}else throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.")})()}).call(typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"@firebase/app":6
}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var app_1=require("@firebase/app");var Database_1=require("./src/api/Database");exports.Database=Database_1.Database;var Query_1=require("./src/api/Query");exports.Query=Query_1.Query;var Reference_1=require("./src/api/Reference");exports.Reference=Reference_1.Reference;var util_1=require("./src/core/util/util");exports.enableLogging=util_1.enableLogging;var RepoManager_1=require("./src/core/RepoManager");var INTERNAL=require("./src/api/internal");var TEST_ACCESS=require("./src/api/test_access");var util_2=require("@firebase/util");var ServerValue=Database_1.Database.ServerValue;exports.ServerValue=ServerValue;function registerDatabase(instance){var namespace=instance.INTERNAL.registerService("database",function(app,unused,url){return RepoManager_1.RepoManager.getInstance().databaseFromApp(app,url)},{Reference:Reference_1.Reference,Query:Query_1.Query,Database:Database_1.Database,enableLogging:util_1.enableLogging,INTERNAL:INTERNAL,ServerValue:ServerValue,TEST_ACCESS:TEST_ACCESS},null,true);if(util_2.isNodeSdk()){module.exports=namespace}}exports.registerDatabase=registerDatabase;registerDatabase(app_1.default);var DataSnapshot_1=require("./src/api/DataSnapshot");exports.DataSnapshot=DataSnapshot_1.DataSnapshot;var onDisconnect_1=require("./src/api/onDisconnect");exports.OnDisconnect=onDisconnect_1.OnDisconnect},{"./src/api/DataSnapshot":10,"./src/api/Database":11,"./src/api/Query":12,"./src/api/Reference":13,"./src/api/internal":15,"./src/api/onDisconnect":16,"./src/api/test_access":17,"./src/core/RepoManager":24,"./src/core/util/util":68,"@firebase/app":6,"@firebase/util":139}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var validation_1=require("../core/util/validation");var Path_1=require("../core/util/Path");var PriorityIndex_1=require("../core/snap/indexes/PriorityIndex");var DataSnapshot=function(){function DataSnapshot(node_,ref_,index_){this.node_=node_;this.ref_=ref_;this.index_=index_}DataSnapshot.prototype.val=function(){util_1.validateArgCount("DataSnapshot.val",0,0,arguments.length);return this.node_.val()};DataSnapshot.prototype.exportVal=function(){util_1.validateArgCount("DataSnapshot.exportVal",0,0,arguments.length);return this.node_.val(true)};DataSnapshot.prototype.toJSON=function(){util_1.validateArgCount("DataSnapshot.toJSON",0,1,arguments.length);return this.exportVal()};DataSnapshot.prototype.exists=function(){util_1.validateArgCount("DataSnapshot.exists",0,0,arguments.length);return!this.node_.isEmpty()};DataSnapshot.prototype.child=function(childPathString){util_1.validateArgCount("DataSnapshot.child",0,1,arguments.length);childPathString=String(childPathString);validation_1.validatePathString("DataSnapshot.child",1,childPathString,false);var childPath=new Path_1.Path(childPathString);var childRef=this.ref_.child(childPath);return new DataSnapshot(this.node_.getChild(childPath),childRef,PriorityIndex_1.PRIORITY_INDEX)};DataSnapshot.prototype.hasChild=function(childPathString){util_1.validateArgCount("DataSnapshot.hasChild",1,1,arguments.length);validation_1.validatePathString("DataSnapshot.hasChild",1,childPathString,false);var childPath=new Path_1.Path(childPathString);return!this.node_.getChild(childPath).isEmpty()};DataSnapshot.prototype.getPriority=function(){util_1.validateArgCount("DataSnapshot.getPriority",0,0,arguments.length);return this.node_.getPriority().val()};DataSnapshot.prototype.forEach=function(action){var _this=this;util_1.validateArgCount("DataSnapshot.forEach",1,1,arguments.length);util_1.validateCallback("DataSnapshot.forEach",1,action,false);if(this.node_.isLeafNode())return false;var childrenNode=this.node_;return!!childrenNode.forEachChild(this.index_,function(key,node){return action(new DataSnapshot(node,_this.ref_.child(key),PriorityIndex_1.PRIORITY_INDEX))})};DataSnapshot.prototype.hasChildren=function(){util_1.validateArgCount("DataSnapshot.hasChildren",0,0,arguments.length);if(this.node_.isLeafNode())return false;else return!this.node_.isEmpty()};Object.defineProperty(DataSnapshot.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:true,configurable:true});DataSnapshot.prototype.numChildren=function(){util_1.validateArgCount("DataSnapshot.numChildren",0,0,arguments.length);return this.node_.numChildren()};DataSnapshot.prototype.getRef=function(){util_1.validateArgCount("DataSnapshot.ref",0,0,arguments.length);return this.ref_};Object.defineProperty(DataSnapshot.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return DataSnapshot}();exports.DataSnapshot=DataSnapshot},{"../core/snap/indexes/PriorityIndex":46,"../core/util/Path":62,"../core/util/validation":69,"@firebase/util":139}],11:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../core/util/util");var parser_1=require("../core/util/libs/parser");var Path_1=require("../core/util/Path");var Reference_1=require("./Reference");var Repo_1=require("../core/Repo");var RepoManager_1=require("../core/RepoManager");var util_2=require("@firebase/util");var validation_1=require("../core/util/validation");var Database=function(){function Database(repo_){this.repo_=repo_;if(!(repo_ instanceof Repo_1.Repo)){util_1.fatal("Don't call new Database() directly - please use firebase.database().")}this.root_=new Reference_1.Reference(repo_,Path_1.Path.Empty);this.INTERNAL=new DatabaseInternals(this)}Object.defineProperty(Database.prototype,"app",{get:function(){return this.repo_.app},enumerable:true,configurable:true});Database.prototype.ref=function(pathString){this.checkDeleted_("ref");util_2.validateArgCount("database.ref",0,1,arguments.length);return pathString!==undefined?this.root_.child(pathString):this.root_};Database.prototype.refFromURL=function(url){var apiName="database.refFromURL";this.checkDeleted_(apiName);util_2.validateArgCount(apiName,1,1,arguments.length);var parsedURL=parser_1.parseRepoInfo(url);validation_1.validateUrl(apiName,1,parsedURL);var repoInfo=parsedURL.repoInfo;if(repoInfo.host!==this.repo_.repoInfo_.host){util_1.fatal(apiName+": Host name does not match the current database: "+"(found "+repoInfo.host+" but expected "+this.repo_.repoInfo_.host+")")}return this.ref(parsedURL.path.toString())};Database.prototype.checkDeleted_=function(apiName){if(this.repo_===null){util_1.fatal("Cannot call "+apiName+" on a deleted database.")}};Database.prototype.goOffline=function(){util_2.validateArgCount("database.goOffline",0,0,arguments.length);this.checkDeleted_("goOffline");this.repo_.interrupt()};Database.prototype.goOnline=function(){util_2.validateArgCount("database.goOnline",0,0,arguments.length);this.checkDeleted_("goOnline");this.repo_.resume()};Database.ServerValue={TIMESTAMP:{".sv":"timestamp"}};return Database}();exports.Database=Database;var DatabaseInternals=function(){function DatabaseInternals(database){this.database=database}DatabaseInternals.prototype.delete=function(){this.database.checkDeleted_("delete");RepoManager_1.RepoManager.getInstance().deleteRepo(this.database.repo_);this.database.repo_=null;this.database.root_=null;this.database.INTERNAL=null;this.database=null;return Promise.resolve()};return DatabaseInternals}();exports.DatabaseInternals=DatabaseInternals},{"../core/Repo":22,"../core/RepoManager":24,"../core/util/Path":62,"../core/util/libs/parser":67,"../core/util/util":68,"../core/util/validation":69,"./Reference":13,"@firebase/util":139}],12:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var KeyIndex_1=require("../core/snap/indexes/KeyIndex");var PriorityIndex_1=require("../core/snap/indexes/PriorityIndex");var ValueIndex_1=require("../core/snap/indexes/ValueIndex");var PathIndex_1=require("../core/snap/indexes/PathIndex");var util_2=require("../core/util/util");var Path_1=require("../core/util/Path");var validation_1=require("../core/util/validation");var util_3=require("@firebase/util");var EventRegistration_1=require("../core/view/EventRegistration");var util_4=require("@firebase/util");var __referenceConstructor;var Query=function(){function Query(repo,path,queryParams_,orderByCalled_){this.repo=repo;this.path=path;this.queryParams_=queryParams_;this.orderByCalled_=orderByCalled_}Object.defineProperty(Query,"__referenceConstructor",{get:function(){util_1.assert(__referenceConstructor,"Reference.ts has not been loaded");return __referenceConstructor},set:function(val){__referenceConstructor=val},enumerable:true,configurable:true});Query.validateQueryEndpoints_=function(params){var startNode=null;var endNode=null;if(params.hasStart()){startNode=params.getIndexStartValue()}if(params.hasEnd()){endNode=params.getIndexEndValue()}if(params.getIndex()===KeyIndex_1.KEY_INDEX){var tooManyArgsError="Query: When ordering by key, you may only pass one argument to "+"startAt(), endAt(), or equalTo().";var wrongArgTypeError="Query: When ordering by key, the argument passed to startAt(), endAt(),"+"or equalTo() must be a string.";if(params.hasStart()){var startName=params.getIndexStartName();if(startName!=util_2.MIN_NAME){throw new Error(tooManyArgsError)}else if(typeof startNode!=="string"){throw new Error(wrongArgTypeError)}}if(params.hasEnd()){var endName=params.getIndexEndName();if(endName!=util_2.MAX_NAME){throw new Error(tooManyArgsError)}else if(typeof endNode!=="string"){throw new Error(wrongArgTypeError)}}}else if(params.getIndex()===PriorityIndex_1.PRIORITY_INDEX){if(startNode!=null&&!validation_1.isValidPriority(startNode)||endNode!=null&&!validation_1.isValidPriority(endNode)){throw new Error("Query: When ordering by priority, the first argument passed to startAt(), "+"endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}}else{util_1.assert(params.getIndex()instanceof PathIndex_1.PathIndex||params.getIndex()===ValueIndex_1.VALUE_INDEX,"unknown index type.");if(startNode!=null&&typeof startNode==="object"||endNode!=null&&typeof endNode==="object"){throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be "+"an object.")}}};Query.validateLimit_=function(params){if(params.hasStart()&&params.hasEnd()&&params.hasLimit()&&!params.hasAnchoredLimit()){throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")}};Query.prototype.validateNoPreviousOrderByCall_=function(fnName){if(this.orderByCalled_===true){throw new Error(fnName+": You can't combine multiple orderBy calls.")}};Query.prototype.getQueryParams=function(){return this.queryParams_};Query.prototype.getRef=function(){util_3.validateArgCount("Query.ref",0,0,arguments.length);return new Query.__referenceConstructor(this.repo,this.path)};Query.prototype.on=function(eventType,callback,cancelCallbackOrContext,context){util_3.validateArgCount("Query.on",2,4,arguments.length);validation_1.validateEventType("Query.on",1,eventType,false);util_3.validateCallback("Query.on",2,callback,false);var ret=Query.getCancelAndContextArgs_("Query.on",cancelCallbackOrContext,context);if(eventType==="value"){this.onValueEvent(callback,ret.cancel,ret.context)}else{var callbacks={};callbacks[eventType]=callback;this.onChildEvent(callbacks,ret.cancel,ret.context)}return callback};Query.prototype.onValueEvent=function(callback,cancelCallback,context){var container=new EventRegistration_1.ValueEventRegistration(callback,cancelCallback||null,context||null);this.repo.addEventCallbackForQuery(this,container)};Query.prototype.onChildEvent=function(callbacks,cancelCallback,context){var container=new EventRegistration_1.ChildEventRegistration(callbacks,cancelCallback,context);this.repo.addEventCallbackForQuery(this,container)};Query.prototype.off=function(eventType,callback,context){util_3.validateArgCount("Query.off",0,3,arguments.length);validation_1.validateEventType("Query.off",1,eventType,true);util_3.validateCallback("Query.off",2,callback,true);util_3.validateContextObject("Query.off",3,context,true);var container=null;var callbacks=null;if(eventType==="value"){var valueCallback=callback||null;container=new EventRegistration_1.ValueEventRegistration(valueCallback,null,context||null)}else if(eventType){if(callback){callbacks={};callbacks[eventType]=callback}container=new EventRegistration_1.ChildEventRegistration(callbacks,null,context||null)}this.repo.removeEventCallbackForQuery(this,container)};Query.prototype.once=function(eventType,userCallback,cancelOrContext,context){var _this=this;util_3.validateArgCount("Query.once",1,4,arguments.length);validation_1.validateEventType("Query.once",1,eventType,false);util_3.validateCallback("Query.once",2,userCallback,true);var ret=Query.getCancelAndContextArgs_("Query.once",cancelOrContext,context);var firstCall=true;var deferred=new util_4.Deferred;deferred.promise.catch(function(){});var onceCallback=function(snapshot){if(firstCall){firstCall=false;_this.off(eventType,onceCallback);if(userCallback){userCallback.bind(ret.context)(snapshot)}deferred.resolve(snapshot)}};this.on(eventType,onceCallback,function(err){_this.off(eventType,onceCallback);if(ret.cancel)ret.cancel.bind(ret.context)(err);deferred.reject(err)});return deferred.promise};Query.prototype.limitToFirst=function(limit){util_3.validateArgCount("Query.limitToFirst",1,1,arguments.length);if(typeof limit!=="number"||Math.floor(limit)!==limit||limit<=0){throw new Error("Query.limitToFirst: First argument must be a positive integer.")}if(this.queryParams_.hasLimit()){throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, "+"limitToFirst, or limitToLast).")}return new Query(this.repo,this.path,this.queryParams_.limitToFirst(limit),this.orderByCalled_)};Query.prototype.limitToLast=function(limit){util_3.validateArgCount("Query.limitToLast",1,1,arguments.length);if(typeof limit!=="number"||Math.floor(limit)!==limit||limit<=0){throw new Error("Query.limitToLast: First argument must be a positive integer.")}if(this.queryParams_.hasLimit()){throw new Error("Query.limitToLast: Limit was already set (by another call to limit, "+"limitToFirst, or limitToLast).")}return new Query(this.repo,this.path,this.queryParams_.limitToLast(limit),this.orderByCalled_)};Query.prototype.orderByChild=function(path){util_3.validateArgCount("Query.orderByChild",1,1,arguments.length);if(path==="$key"){throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.')}else if(path==="$priority"){throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.')}else if(path==="$value"){throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.')}validation_1.validatePathString("Query.orderByChild",1,path,false);this.validateNoPreviousOrderByCall_("Query.orderByChild");var parsedPath=new Path_1.Path(path);if(parsedPath.isEmpty()){throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.")}var index=new PathIndex_1.PathIndex(parsedPath);var newParams=this.queryParams_.orderBy(index);Query.validateQueryEndpoints_(newParams);return new Query(this.repo,this.path,newParams,true)};Query.prototype.orderByKey=function(){util_3.validateArgCount("Query.orderByKey",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByKey");var newParams=this.queryParams_.orderBy(KeyIndex_1.KEY_INDEX);Query.validateQueryEndpoints_(newParams);return new Query(this.repo,this.path,newParams,true)};Query.prototype.orderByPriority=function(){util_3.validateArgCount("Query.orderByPriority",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByPriority");var newParams=this.queryParams_.orderBy(PriorityIndex_1.PRIORITY_INDEX);Query.validateQueryEndpoints_(newParams);return new Query(this.repo,this.path,newParams,true)};Query.prototype.orderByValue=function(){util_3.validateArgCount("Query.orderByValue",0,0,arguments.length);this.validateNoPreviousOrderByCall_("Query.orderByValue");var newParams=this.queryParams_.orderBy(ValueIndex_1.VALUE_INDEX);Query.validateQueryEndpoints_(newParams);return new Query(this.repo,this.path,newParams,true)};Query.prototype.startAt=function(value,name){if(value===void 0){value=null}util_3.validateArgCount("Query.startAt",0,2,arguments.length);validation_1.validateFirebaseDataArg("Query.startAt",1,value,this.path,true);validation_1.validateKey("Query.startAt",2,name,true);var newParams=this.queryParams_.startAt(value,name);Query.validateLimit_(newParams);Query.validateQueryEndpoints_(newParams);if(this.queryParams_.hasStart()){throw new Error("Query.startAt: Starting point was already set (by another call to startAt "+"or equalTo).")}if(value===undefined){value=null;name=null}return new Query(this.repo,this.path,newParams,this.orderByCalled_)};Query.prototype.endAt=function(value,name){if(value===void 0){value=null}util_3.validateArgCount("Query.endAt",0,2,arguments.length);validation_1.validateFirebaseDataArg("Query.endAt",1,value,this.path,true);validation_1.validateKey("Query.endAt",2,name,true);var newParams=this.queryParams_.endAt(value,name);Query.validateLimit_(newParams);Query.validateQueryEndpoints_(newParams);if(this.queryParams_.hasEnd()){throw new Error("Query.endAt: Ending point was already set (by another call to endAt or "+"equalTo).")}return new Query(this.repo,this.path,newParams,this.orderByCalled_)};Query.prototype.equalTo=function(value,name){util_3.validateArgCount("Query.equalTo",1,2,arguments.length);validation_1.validateFirebaseDataArg("Query.equalTo",1,value,this.path,false);validation_1.validateKey("Query.equalTo",2,name,true);if(this.queryParams_.hasStart()){throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or "+"equalTo).")}if(this.queryParams_.hasEnd()){throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or "+"equalTo).")}return this.startAt(value,name).endAt(value,name)};Query.prototype.toString=function(){util_3.validateArgCount("Query.toString",0,0,arguments.length);return this.repo.toString()+this.path.toUrlEncodedString()};Query.prototype.toJSON=function(){util_3.validateArgCount("Query.toJSON",0,1,arguments.length);return this.toString()};Query.prototype.queryObject=function(){return this.queryParams_.getQueryObject()};Query.prototype.queryIdentifier=function(){var obj=this.queryObject();var id=util_2.ObjectToUniqueKey(obj);return id==="{}"?"default":id};Query.prototype.isEqual=function(other){util_3.validateArgCount("Query.isEqual",1,1,arguments.length);if(!(other instanceof Query)){var error="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(error)}var sameRepo=this.repo===other.repo;var samePath=this.path.equals(other.path);var sameQueryIdentifier=this.queryIdentifier()===other.queryIdentifier();return sameRepo&&samePath&&sameQueryIdentifier};Query.getCancelAndContextArgs_=function(fnName,cancelOrContext,context){var ret={cancel:null,context:null};if(cancelOrContext&&context){ret.cancel=cancelOrContext;util_3.validateCallback(fnName,3,ret.cancel,true);ret.context=context;util_3.validateContextObject(fnName,4,ret.context,true)}else if(cancelOrContext){if(typeof cancelOrContext==="object"&&cancelOrContext!==null){ret.context=cancelOrContext}else if(typeof cancelOrContext==="function"){ret.cancel=cancelOrContext}else{throw new Error(util_3.errorPrefix(fnName,3,true)+" must either be a cancel callback or a context object.")}}return ret};Object.defineProperty(Query.prototype,"ref",{get:function(){return this.getRef()},enumerable:true,configurable:true});return Query}();exports.Query=Query},{"../core/snap/indexes/KeyIndex":44,"../core/snap/indexes/PathIndex":45,"../core/snap/indexes/PriorityIndex":46,"../core/snap/indexes/ValueIndex":47,"../core/util/Path":62,"../core/util/util":68,"../core/util/validation":69,"../core/view/EventRegistration":77,"@firebase/util":139}],13:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var onDisconnect_1=require("./onDisconnect");var TransactionResult_1=require("./TransactionResult");var util_1=require("../core/util/util");var NextPushId_1=require("../core/util/NextPushId");var Query_1=require("./Query");var Repo_1=require("../core/Repo");var Path_1=require("../core/util/Path");var QueryParams_1=require("../core/view/QueryParams");var validation_1=require("../core/util/validation");var util_2=require("@firebase/util");var util_3=require("@firebase/util");var SyncPoint_1=require("../core/SyncPoint");var Reference=function(_super){__extends(Reference,_super);function Reference(repo,path){var _this=this;if(!(repo instanceof Repo_1.Repo)){throw new Error("new Reference() no longer supported - use app.database().")}_this=_super.call(this,repo,path,QueryParams_1.QueryParams.DEFAULT,false)||this;return _this}Reference.prototype.getKey=function(){util_2.validateArgCount("Reference.key",0,0,arguments.length);if(this.path.isEmpty())return null;else return this.path.getBack()};Reference.prototype.child=function(pathString){util_2.validateArgCount("Reference.child",1,1,arguments.length);if(typeof pathString==="number"){pathString=String(pathString)}else if(!(pathString instanceof Path_1.Path)){if(this.path.getFront()===null)validation_1.validateRootPathString("Reference.child",1,pathString,false);else validation_1.validatePathString("Reference.child",1,pathString,false)}return new Reference(this.repo,this.path.child(pathString))};Reference.prototype.getParent=function(){util_2.validateArgCount("Reference.parent",0,0,arguments.length);var parentPath=this.path.parent();return parentPath===null?null:new Reference(this.repo,parentPath)};Reference.prototype.getRoot=function(){util_2.validateArgCount("Reference.root",0,0,arguments.length);var ref=this;while(ref.getParent()!==null){ref=ref.getParent()}return ref};Reference.prototype.databaseProp=function(){return this.repo.database};Reference.prototype.set=function(newVal,onComplete){util_2.validateArgCount("Reference.set",1,2,arguments.length);validation_1.validateWritablePath("Reference.set",this.path);validation_1.validateFirebaseDataArg("Reference.set",1,newVal,this.path,false);util_2.validateCallback("Reference.set",2,onComplete,true);var deferred=new util_3.Deferred;this.repo.setWithPriority(this.path,newVal,null,deferred.wrapCallback(onComplete));return deferred.promise};Reference.prototype.update=function(objectToMerge,onComplete){util_2.validateArgCount("Reference.update",1,2,arguments.length);validation_1.validateWritablePath("Reference.update",this.path);if(Array.isArray(objectToMerge)){var newObjectToMerge={};for(var i=0;i<objectToMerge.length;++i){newObjectToMerge[""+i]=objectToMerge[i]}objectToMerge=newObjectToMerge;util_1.warn("Passing an Array to Firebase.update() is deprecated. "+"Use set() if you want to overwrite the existing data, or "+"an Object with integer keys if you really do want to "+"only update some of the children.")}validation_1.validateFirebaseMergeDataArg("Reference.update",1,objectToMerge,this.path,false);util_2.validateCallback("Reference.update",2,onComplete,true);var deferred=new util_3.Deferred;this.repo.update(this.path,objectToMerge,deferred.wrapCallback(onComplete));return deferred.promise};Reference.prototype.setWithPriority=function(newVal,newPriority,onComplete){util_2.validateArgCount("Reference.setWithPriority",2,3,arguments.length);validation_1.validateWritablePath("Reference.setWithPriority",this.path);validation_1.validateFirebaseDataArg("Reference.setWithPriority",1,newVal,this.path,false);validation_1.validatePriority("Reference.setWithPriority",2,newPriority,false);util_2.validateCallback("Reference.setWithPriority",3,onComplete,true);if(this.getKey()===".length"||this.getKey()===".keys")throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var deferred=new util_3.Deferred;this.repo.setWithPriority(this.path,newVal,newPriority,deferred.wrapCallback(onComplete));return deferred.promise};Reference.prototype.remove=function(onComplete){util_2.validateArgCount("Reference.remove",0,1,arguments.length);validation_1.validateWritablePath("Reference.remove",this.path);util_2.validateCallback("Reference.remove",1,onComplete,true);return this.set(null,onComplete)};Reference.prototype.transaction=function(transactionUpdate,onComplete,applyLocally){util_2.validateArgCount("Reference.transaction",1,3,arguments.length);validation_1.validateWritablePath("Reference.transaction",this.path);util_2.validateCallback("Reference.transaction",1,transactionUpdate,false);util_2.validateCallback("Reference.transaction",2,onComplete,true);validation_1.validateBoolean("Reference.transaction",3,applyLocally,true);if(this.getKey()===".length"||this.getKey()===".keys")throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";if(applyLocally===undefined)applyLocally=true;var deferred=new util_3.Deferred;if(typeof onComplete==="function"){deferred.promise.catch(function(){})}var promiseComplete=function(error,committed,snapshot){if(error){deferred.reject(error)}else{deferred.resolve(new TransactionResult_1.TransactionResult(committed,snapshot))}if(typeof onComplete==="function"){onComplete(error,committed,snapshot)}};this.repo.startTransaction(this.path,transactionUpdate,promiseComplete,applyLocally);return deferred.promise};Reference.prototype.setPriority=function(priority,onComplete){util_2.validateArgCount("Reference.setPriority",1,2,arguments.length);validation_1.validateWritablePath("Reference.setPriority",this.path);validation_1.validatePriority("Reference.setPriority",1,priority,false);util_2.validateCallback("Reference.setPriority",2,onComplete,true);var deferred=new util_3.Deferred;this.repo.setWithPriority(this.path.child(".priority"),priority,null,deferred.wrapCallback(onComplete));return deferred.promise};Reference.prototype.push=function(value,onComplete){util_2.validateArgCount("Reference.push",0,2,arguments.length);validation_1.validateWritablePath("Reference.push",this.path);validation_1.validateFirebaseDataArg("Reference.push",1,value,this.path,true);util_2.validateCallback("Reference.push",2,onComplete,true);var now=this.repo.serverTime();var name=NextPushId_1.nextPushId(now);var thennablePushRef=this.child(name);var pushRef=this.child(name);var promise;if(value!=null){promise=thennablePushRef.set(value,onComplete).then(function(){return pushRef})}else{promise=Promise.resolve(pushRef)}thennablePushRef.then=promise.then.bind(promise);thennablePushRef.catch=promise.then.bind(promise,undefined);if(typeof onComplete==="function"){promise.catch(function(){})}return thennablePushRef};Reference.prototype.onDisconnect=function(){validation_1.validateWritablePath("Reference.onDisconnect",this.path);return new onDisconnect_1.OnDisconnect(this.repo,this.path)};Object.defineProperty(Reference.prototype,"database",{get:function(){return this.databaseProp()},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"key",{get:function(){return this.getKey()},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"parent",{get:function(){return this.getParent()},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"root",{get:function(){return this.getRoot()},enumerable:true,configurable:true});return Reference}(Query_1.Query);exports.Reference=Reference;Query_1.Query.__referenceConstructor=Reference;SyncPoint_1.SyncPoint.__referenceConstructor=Reference},{"../core/Repo":22,"../core/SyncPoint":29,"../core/util/NextPushId":60,"../core/util/Path":62,"../core/util/util":68,"../core/util/validation":69,"../core/view/QueryParams":78,"./Query":12,"./TransactionResult":14,"./onDisconnect":16,"@firebase/util":139}],14:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var TransactionResult=function(){function TransactionResult(committed,snapshot){this.committed=committed;this.snapshot=snapshot}TransactionResult.prototype.toJSON=function(){util_1.validateArgCount("TransactionResult.toJSON",0,1,arguments.length);return{committed:this.committed,snapshot:this.snapshot.toJSON()}};return TransactionResult}();exports.TransactionResult=TransactionResult},{"@firebase/util":139}],15:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var WebSocketConnection_1=require("../realtime/WebSocketConnection");var BrowserPollConnection_1=require("../realtime/BrowserPollConnection");exports.forceLongPolling=function(){WebSocketConnection_1.WebSocketConnection.forceDisallow();BrowserPollConnection_1.BrowserPollConnection.forceAllow()};exports.forceWebSockets=function(){BrowserPollConnection_1.BrowserPollConnection.forceDisallow()};exports.isWebSocketsAvailable=function(){return WebSocketConnection_1.WebSocketConnection["isAvailable"]()};exports.setSecurityDebugCallback=function(ref,callback){ref.repo.persistentConnection_.securityDebugCallback_=callback};exports.stats=function(ref,showDelta){ref.repo.stats(showDelta)};exports.statsIncrementCounter=function(ref,metric){ref.repo.statsIncrementCounter(metric)};exports.dataUpdateCount=function(ref){return ref.repo.dataUpdateCount};exports.interceptServerData=function(ref,callback){return ref.repo.interceptServerData_(callback)}},{"../realtime/BrowserPollConnection":85,"../realtime/WebSocketConnection":89}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var validation_1=require("../core/util/validation");var util_2=require("../core/util/util");var util_3=require("@firebase/util");var OnDisconnect=function(){function OnDisconnect(repo_,path_){this.repo_=repo_;this.path_=path_}OnDisconnect.prototype.cancel=function(onComplete){util_1.validateArgCount("OnDisconnect.cancel",0,1,arguments.length);util_1.validateCallback("OnDisconnect.cancel",1,onComplete,true);var deferred=new util_3.Deferred;this.repo_.onDisconnectCancel(this.path_,deferred.wrapCallback(onComplete));return deferred.promise};OnDisconnect.prototype.remove=function(onComplete){util_1.validateArgCount("OnDisconnect.remove",0,1,arguments.length);validation_1.validateWritablePath("OnDisconnect.remove",this.path_);util_1.validateCallback("OnDisconnect.remove",1,onComplete,true);var deferred=new util_3.Deferred;this.repo_.onDisconnectSet(this.path_,null,deferred.wrapCallback(onComplete));return deferred.promise};OnDisconnect.prototype.set=function(value,onComplete){util_1.validateArgCount("OnDisconnect.set",1,2,arguments.length);validation_1.validateWritablePath("OnDisconnect.set",this.path_);validation_1.validateFirebaseDataArg("OnDisconnect.set",1,value,this.path_,false);util_1.validateCallback("OnDisconnect.set",2,onComplete,true);var deferred=new util_3.Deferred;this.repo_.onDisconnectSet(this.path_,value,deferred.wrapCallback(onComplete));return deferred.promise};OnDisconnect.prototype.setWithPriority=function(value,priority,onComplete){util_1.validateArgCount("OnDisconnect.setWithPriority",2,3,arguments.length);validation_1.validateWritablePath("OnDisconnect.setWithPriority",this.path_);validation_1.validateFirebaseDataArg("OnDisconnect.setWithPriority",1,value,this.path_,false);validation_1.validatePriority("OnDisconnect.setWithPriority",2,priority,false);
util_1.validateCallback("OnDisconnect.setWithPriority",3,onComplete,true);var deferred=new util_3.Deferred;this.repo_.onDisconnectSetWithPriority(this.path_,value,priority,deferred.wrapCallback(onComplete));return deferred.promise};OnDisconnect.prototype.update=function(objectToMerge,onComplete){util_1.validateArgCount("OnDisconnect.update",1,2,arguments.length);validation_1.validateWritablePath("OnDisconnect.update",this.path_);if(Array.isArray(objectToMerge)){var newObjectToMerge={};for(var i=0;i<objectToMerge.length;++i){newObjectToMerge[""+i]=objectToMerge[i]}objectToMerge=newObjectToMerge;util_2.warn("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the "+"existing data, or an Object with integer keys if you really do want to only update some of the children.")}validation_1.validateFirebaseMergeDataArg("OnDisconnect.update",1,objectToMerge,this.path_,false);util_1.validateCallback("OnDisconnect.update",2,onComplete,true);var deferred=new util_3.Deferred;this.repo_.onDisconnectUpdate(this.path_,objectToMerge,deferred.wrapCallback(onComplete));return deferred.promise};return OnDisconnect}();exports.OnDisconnect=OnDisconnect},{"../core/util/util":68,"../core/util/validation":69,"@firebase/util":139}],17:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RepoInfo_1=require("../core/RepoInfo");var PersistentConnection_1=require("../core/PersistentConnection");var RepoManager_1=require("../core/RepoManager");var Connection_1=require("../realtime/Connection");exports.DataConnection=PersistentConnection_1.PersistentConnection;PersistentConnection_1.PersistentConnection.prototype.simpleListen=function(pathString,onComplete){this.sendRequest("q",{p:pathString},onComplete)};PersistentConnection_1.PersistentConnection.prototype.echo=function(data,onEcho){this.sendRequest("echo",{d:data},onEcho)};exports.RealTimeConnection=Connection_1.Connection;exports.hijackHash=function(newHash){var oldPut=PersistentConnection_1.PersistentConnection.prototype.put;PersistentConnection_1.PersistentConnection.prototype.put=function(pathString,data,opt_onComplete,opt_hash){if(opt_hash!==undefined){opt_hash=newHash()}oldPut.call(this,pathString,data,opt_onComplete,opt_hash)};return function(){PersistentConnection_1.PersistentConnection.prototype.put=oldPut}};exports.ConnectionTarget=RepoInfo_1.RepoInfo;exports.queryIdentifier=function(query){return query.queryIdentifier()};exports.listens=function(firebaseRef){return firebaseRef.repo.persistentConnection_.listens_};exports.forceRestClient=function(forceRestClient){RepoManager_1.RepoManager.getInstance().forceRestClient(forceRestClient)}},{"../core/PersistentConnection":20,"../core/RepoInfo":23,"../core/RepoManager":24,"../realtime/Connection":86}],18:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("./util/util");var AuthTokenProvider=function(){function AuthTokenProvider(app_){this.app_=app_}AuthTokenProvider.prototype.getToken=function(forceRefresh){return this.app_["INTERNAL"]["getToken"](forceRefresh).then(null,function(error){if(error&&error.code==="auth/token-not-initialized"){util_1.log("Got auth/token-not-initialized error.  Treating as null token.");return null}else{return Promise.reject(error)}})};AuthTokenProvider.prototype.addTokenChangeListener=function(listener){this.app_["INTERNAL"]["addAuthTokenListener"](listener)};AuthTokenProvider.prototype.removeTokenChangeListener=function(listener){this.app_["INTERNAL"]["removeAuthTokenListener"](listener)};AuthTokenProvider.prototype.notifyForInvalidToken=function(){var errorMessage='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not '+"initialized correctly. ";if("credential"in this.app_.options){errorMessage+='Make sure the "credential" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else if("serviceAccount"in this.app_.options){errorMessage+='Make sure the "serviceAccount" property provided to initializeApp() '+'is authorized to access the specified "databaseURL" and is from the correct '+"project."}else{errorMessage+='Make sure the "apiKey" and "databaseURL" properties provided to '+"initializeApp() match the values provided for your app at "+"https://console.firebase.google.com/."}util_1.warn(errorMessage)};return AuthTokenProvider}();exports.AuthTokenProvider=AuthTokenProvider},{"./util/util":68}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ImmutableTree_1=require("./util/ImmutableTree");var Path_1=require("./util/Path");var util_1=require("@firebase/util");var Node_1=require("./snap/Node");var PriorityIndex_1=require("./snap/indexes/PriorityIndex");var util_2=require("@firebase/util");var CompoundWrite=function(){function CompoundWrite(writeTree_){this.writeTree_=writeTree_}CompoundWrite.prototype.addWrite=function(path,node){if(path.isEmpty()){return new CompoundWrite(new ImmutableTree_1.ImmutableTree(node))}else{var rootmost=this.writeTree_.findRootMostValueAndPath(path);if(rootmost!=null){var rootMostPath=rootmost.path;var value=rootmost.value;var relativePath=Path_1.Path.relativePath(rootMostPath,path);value=value.updateChild(relativePath,node);return new CompoundWrite(this.writeTree_.set(rootMostPath,value))}else{var subtree=new ImmutableTree_1.ImmutableTree(node);var newWriteTree=this.writeTree_.setTree(path,subtree);return new CompoundWrite(newWriteTree)}}};CompoundWrite.prototype.addWrites=function(path,updates){var newWrite=this;util_1.forEach(updates,function(childKey,node){newWrite=newWrite.addWrite(path.child(childKey),node)});return newWrite};CompoundWrite.prototype.removeWrite=function(path){if(path.isEmpty()){return CompoundWrite.Empty}else{var newWriteTree=this.writeTree_.setTree(path,ImmutableTree_1.ImmutableTree.Empty);return new CompoundWrite(newWriteTree)}};CompoundWrite.prototype.hasCompleteWrite=function(path){return this.getCompleteNode(path)!=null};CompoundWrite.prototype.getCompleteNode=function(path){var rootmost=this.writeTree_.findRootMostValueAndPath(path);if(rootmost!=null){return this.writeTree_.get(rootmost.path).getChild(Path_1.Path.relativePath(rootmost.path,path))}else{return null}};CompoundWrite.prototype.getCompleteChildren=function(){var children=[];var node=this.writeTree_.value;if(node!=null){if(!node.isLeafNode()){node.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(childName,childNode){children.push(new Node_1.NamedNode(childName,childNode))})}}else{this.writeTree_.children.inorderTraversal(function(childName,childTree){if(childTree.value!=null){children.push(new Node_1.NamedNode(childName,childTree.value))}})}return children};CompoundWrite.prototype.childCompoundWrite=function(path){if(path.isEmpty()){return this}else{var shadowingNode=this.getCompleteNode(path);if(shadowingNode!=null){return new CompoundWrite(new ImmutableTree_1.ImmutableTree(shadowingNode))}else{return new CompoundWrite(this.writeTree_.subtree(path))}}};CompoundWrite.prototype.isEmpty=function(){return this.writeTree_.isEmpty()};CompoundWrite.prototype.apply=function(node){return CompoundWrite.applySubtreeWrite_(Path_1.Path.Empty,this.writeTree_,node)};CompoundWrite.Empty=new CompoundWrite(new ImmutableTree_1.ImmutableTree(null));CompoundWrite.applySubtreeWrite_=function(relativePath,writeTree,node){if(writeTree.value!=null){return node.updateChild(relativePath,writeTree.value)}else{var priorityWrite_1=null;writeTree.children.inorderTraversal(function(childKey,childTree){if(childKey===".priority"){util_2.assert(childTree.value!==null,"Priority writes must always be leaf nodes");priorityWrite_1=childTree.value}else{node=CompoundWrite.applySubtreeWrite_(relativePath.child(childKey),childTree,node)}});if(!node.getChild(relativePath).isEmpty()&&priorityWrite_1!==null){node=node.updateChild(relativePath.child(".priority"),priorityWrite_1)}return node}};return CompoundWrite}();exports.CompoundWrite=CompoundWrite},{"./snap/Node":40,"./snap/indexes/PriorityIndex":46,"./util/ImmutableTree":59,"./util/Path":62,"@firebase/util":139}],20:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var app_1=require("@firebase/app");var util_1=require("@firebase/util");var util_2=require("@firebase/util");var util_3=require("@firebase/util");var util_4=require("./util/util");var Path_1=require("./util/Path");var VisibilityMonitor_1=require("./util/VisibilityMonitor");var OnlineMonitor_1=require("./util/OnlineMonitor");var util_5=require("@firebase/util");var Connection_1=require("../realtime/Connection");var util_6=require("@firebase/util");var util_7=require("@firebase/util");var ServerActions_1=require("./ServerActions");var RECONNECT_MIN_DELAY=1e3;var RECONNECT_MAX_DELAY_DEFAULT=60*5*1e3;var RECONNECT_MAX_DELAY_FOR_ADMINS=30*1e3;var RECONNECT_DELAY_MULTIPLIER=1.3;var RECONNECT_DELAY_RESET_TIMEOUT=3e4;var SERVER_KILL_INTERRUPT_REASON="server_kill";var INVALID_AUTH_TOKEN_THRESHOLD=3;var PersistentConnection=function(_super){__extends(PersistentConnection,_super);function PersistentConnection(repoInfo_,onDataUpdate_,onConnectStatus_,onServerInfoUpdate_,authTokenProvider_,authOverride_){var _this=_super.call(this)||this;_this.repoInfo_=repoInfo_;_this.onDataUpdate_=onDataUpdate_;_this.onConnectStatus_=onConnectStatus_;_this.onServerInfoUpdate_=onServerInfoUpdate_;_this.authTokenProvider_=authTokenProvider_;_this.authOverride_=authOverride_;_this.id=PersistentConnection.nextPersistentConnectionId_++;_this.log_=util_4.logWrapper("p:"+_this.id+":");_this.interruptReasons_={};_this.listens_={};_this.outstandingPuts_=[];_this.outstandingPutCount_=0;_this.onDisconnectRequestQueue_=[];_this.connected_=false;_this.reconnectDelay_=RECONNECT_MIN_DELAY;_this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT;_this.securityDebugCallback_=null;_this.lastSessionId=null;_this.establishConnectionTimer_=null;_this.visible_=false;_this.requestCBHash_={};_this.requestNumber_=0;_this.realtime_=null;_this.authToken_=null;_this.forceTokenRefresh_=false;_this.invalidAuthTokenCount_=0;_this.firstConnection_=true;_this.lastConnectionAttemptTime_=null;_this.lastConnectionEstablishedTime_=null;if(authOverride_&&!util_7.isNodeSdk()){throw new Error("Auth override specified in options, but not supported on non Node.js platforms")}_this.scheduleConnect_(0);VisibilityMonitor_1.VisibilityMonitor.getInstance().on("visible",_this.onVisible_,_this);if(repoInfo_.host.indexOf("fblocal")===-1){OnlineMonitor_1.OnlineMonitor.getInstance().on("online",_this.onOnline_,_this)}return _this}PersistentConnection.prototype.sendRequest=function(action,body,onResponse){var curReqNum=++this.requestNumber_;var msg={r:curReqNum,a:action,b:body};this.log_(util_2.stringify(msg));util_3.assert(this.connected_,"sendRequest call when we're not connected not allowed.");this.realtime_.sendRequest(msg);if(onResponse){this.requestCBHash_[curReqNum]=onResponse}};PersistentConnection.prototype.listen=function(query,currentHashFn,tag,onComplete){var queryId=query.queryIdentifier();var pathString=query.path.toString();this.log_("Listen called for "+pathString+" "+queryId);this.listens_[pathString]=this.listens_[pathString]||{};util_3.assert(query.getQueryParams().isDefault()||!query.getQueryParams().loadsAllData(),"listen() called for non-default but complete query");util_3.assert(!this.listens_[pathString][queryId],"listen() called twice for same path/queryId.");var listenSpec={onComplete:onComplete,hashFn:currentHashFn,query:query,tag:tag};this.listens_[pathString][queryId]=listenSpec;if(this.connected_){this.sendListen_(listenSpec)}};PersistentConnection.prototype.sendListen_=function(listenSpec){var _this=this;var query=listenSpec.query;var pathString=query.path.toString();var queryId=query.queryIdentifier();this.log_("Listen on "+pathString+" for "+queryId);var req={p:pathString};var action="q";if(listenSpec.tag){req["q"]=query.queryObject();req["t"]=listenSpec.tag}req["h"]=listenSpec.hashFn();this.sendRequest(action,req,function(message){var payload=message["d"];var status=message["s"];PersistentConnection.warnOnListenWarnings_(payload,query);var currentListenSpec=_this.listens_[pathString]&&_this.listens_[pathString][queryId];if(currentListenSpec===listenSpec){_this.log_("listen response",message);if(status!=="ok"){_this.removeListen_(pathString,queryId)}if(listenSpec.onComplete){listenSpec.onComplete(status,payload)}}})};PersistentConnection.warnOnListenWarnings_=function(payload,query){if(payload&&typeof payload==="object"&&util_1.contains(payload,"w")){var warnings=util_1.safeGet(payload,"w");if(Array.isArray(warnings)&&~warnings.indexOf("no_index")){var indexSpec='".indexOn": "'+query.getQueryParams().getIndex().toString()+'"';var indexPath=query.path.toString();util_4.warn("Using an unspecified index. Your data will be downloaded and "+("filtered on the client. Consider adding "+indexSpec+" at ")+(indexPath+" to your security rules for better performance."))}}};PersistentConnection.prototype.refreshAuthToken=function(token){this.authToken_=token;this.log_("Auth token refreshed");if(this.authToken_){this.tryAuth()}else{if(this.connected_){this.sendRequest("unauth",{},function(){})}}this.reduceReconnectDelayIfAdminCredential_(token)};PersistentConnection.prototype.reduceReconnectDelayIfAdminCredential_=function(credential){var isFirebaseSecret=credential&&credential.length===40;if(isFirebaseSecret||util_5.isAdmin(credential)){this.log_("Admin auth credential detected.  Reducing max reconnect time.");this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS}};PersistentConnection.prototype.tryAuth=function(){var _this=this;if(this.connected_&&this.authToken_){var token_1=this.authToken_;var authMethod=util_5.isValidFormat(token_1)?"auth":"gauth";var requestData={cred:token_1};if(this.authOverride_===null){requestData["noauth"]=true}else if(typeof this.authOverride_==="object"){requestData["authvar"]=this.authOverride_}this.sendRequest(authMethod,requestData,function(res){var status=res["s"];var data=res["d"]||"error";if(_this.authToken_===token_1){if(status==="ok"){_this.invalidAuthTokenCount_=0}else{_this.onAuthRevoked_(status,data)}}})}};PersistentConnection.prototype.unlisten=function(query,tag){var pathString=query.path.toString();var queryId=query.queryIdentifier();this.log_("Unlisten called for "+pathString+" "+queryId);util_3.assert(query.getQueryParams().isDefault()||!query.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query");var listen=this.removeListen_(pathString,queryId);if(listen&&this.connected_){this.sendUnlisten_(pathString,queryId,query.queryObject(),tag)}};PersistentConnection.prototype.sendUnlisten_=function(pathString,queryId,queryObj,tag){this.log_("Unlisten on "+pathString+" for "+queryId);var req={p:pathString};var action="n";if(tag){req["q"]=queryObj;req["t"]=tag}this.sendRequest(action,req)};PersistentConnection.prototype.onDisconnectPut=function(pathString,data,onComplete){if(this.connected_){this.sendOnDisconnect_("o",pathString,data,onComplete)}else{this.onDisconnectRequestQueue_.push({pathString:pathString,action:"o",data:data,onComplete:onComplete})}};PersistentConnection.prototype.onDisconnectMerge=function(pathString,data,onComplete){if(this.connected_){this.sendOnDisconnect_("om",pathString,data,onComplete)}else{this.onDisconnectRequestQueue_.push({pathString:pathString,action:"om",data:data,onComplete:onComplete})}};PersistentConnection.prototype.onDisconnectCancel=function(pathString,onComplete){if(this.connected_){this.sendOnDisconnect_("oc",pathString,null,onComplete)}else{this.onDisconnectRequestQueue_.push({pathString:pathString,action:"oc",data:null,onComplete:onComplete})}};PersistentConnection.prototype.sendOnDisconnect_=function(action,pathString,data,onComplete){var request={p:pathString,d:data};this.log_("onDisconnect "+action,request);this.sendRequest(action,request,function(response){if(onComplete){setTimeout(function(){onComplete(response["s"],response["d"])},Math.floor(0))}})};PersistentConnection.prototype.put=function(pathString,data,onComplete,hash){this.putInternal("p",pathString,data,onComplete,hash)};PersistentConnection.prototype.merge=function(pathString,data,onComplete,hash){this.putInternal("m",pathString,data,onComplete,hash)};PersistentConnection.prototype.putInternal=function(action,pathString,data,onComplete,hash){var request={p:pathString,d:data};if(hash!==undefined)request["h"]=hash;this.outstandingPuts_.push({action:action,request:request,onComplete:onComplete});this.outstandingPutCount_++;var index=this.outstandingPuts_.length-1;if(this.connected_){this.sendPut_(index)}else{this.log_("Buffering put: "+pathString)}};PersistentConnection.prototype.sendPut_=function(index){var _this=this;var action=this.outstandingPuts_[index].action;var request=this.outstandingPuts_[index].request;var onComplete=this.outstandingPuts_[index].onComplete;this.outstandingPuts_[index].queued=this.connected_;this.sendRequest(action,request,function(message){_this.log_(action+" response",message);delete _this.outstandingPuts_[index];_this.outstandingPutCount_--;if(_this.outstandingPutCount_===0){_this.outstandingPuts_=[]}if(onComplete)onComplete(message["s"],message["d"])})};PersistentConnection.prototype.reportStats=function(stats){var _this=this;if(this.connected_){var request={c:stats};this.log_("reportStats",request);this.sendRequest("s",request,function(result){var status=result["s"];if(status!=="ok"){var errorReason=result["d"];_this.log_("reportStats","Error sending stats: "+errorReason)}})}};PersistentConnection.prototype.onDataMessage_=function(message){if("r"in message){this.log_("from server: "+util_2.stringify(message));var reqNum=message["r"];var onResponse=this.requestCBHash_[reqNum];if(onResponse){delete this.requestCBHash_[reqNum];onResponse(message["b"])}}else if("error"in message){throw"A server-side error has occurred: "+message["error"]}else if("a"in message){this.onDataPush_(message["a"],message["b"])}};PersistentConnection.prototype.onDataPush_=function(action,body){this.log_("handleServerMessage",action,body);if(action==="d")this.onDataUpdate_(body["p"],body["d"],false,body["t"]);else if(action==="m")this.onDataUpdate_(body["p"],body["d"],true,body["t"]);else if(action==="c")this.onListenRevoked_(body["p"],body["q"]);else if(action==="ac")this.onAuthRevoked_(body["s"],body["d"]);else if(action==="sd")this.onSecurityDebugPacket_(body);else util_4.error("Unrecognized action received from server: "+util_2.stringify(action)+"\nAre you using the latest client?")};PersistentConnection.prototype.onReady_=function(timestamp,sessionId){this.log_("connection ready");this.connected_=true;this.lastConnectionEstablishedTime_=(new Date).getTime();this.handleTimestamp_(timestamp);this.lastSessionId=sessionId;if(this.firstConnection_){this.sendConnectStats_()}this.restoreState_();this.firstConnection_=false;this.onConnectStatus_(true)};PersistentConnection.prototype.scheduleConnect_=function(timeout){var _this=this;util_3.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?");if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_)}this.establishConnectionTimer_=setTimeout(function(){_this.establishConnectionTimer_=null;_this.establishConnection_()},Math.floor(timeout))};PersistentConnection.prototype.onVisible_=function(visible){if(visible&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_){this.log_("Window became visible.  Reducing delay.");this.reconnectDelay_=RECONNECT_MIN_DELAY;if(!this.realtime_){this.scheduleConnect_(0)}}this.visible_=visible};PersistentConnection.prototype.onOnline_=function(online){if(online){this.log_("Browser went online.");this.reconnectDelay_=RECONNECT_MIN_DELAY;if(!this.realtime_){this.scheduleConnect_(0)}}else{this.log_("Browser went offline.  Killing connection.");if(this.realtime_){this.realtime_.close()}}};PersistentConnection.prototype.onRealtimeDisconnect_=function(){this.log_("data client disconnected");this.connected_=false;this.realtime_=null;this.cancelSentTransactions_();this.requestCBHash_={};if(this.shouldReconnect_()){if(!this.visible_){this.log_("Window isn't visible.  Delaying reconnect.");this.reconnectDelay_=this.maxReconnectDelay_;this.lastConnectionAttemptTime_=(new Date).getTime()}else if(this.lastConnectionEstablishedTime_){var timeSinceLastConnectSucceeded=(new Date).getTime()-this.lastConnectionEstablishedTime_;if(timeSinceLastConnectSucceeded>RECONNECT_DELAY_RESET_TIMEOUT)this.reconnectDelay_=RECONNECT_MIN_DELAY;this.lastConnectionEstablishedTime_=null}var timeSinceLastConnectAttempt=(new Date).getTime()-this.lastConnectionAttemptTime_;var reconnectDelay=Math.max(0,this.reconnectDelay_-timeSinceLastConnectAttempt);reconnectDelay=Math.random()*reconnectDelay;this.log_("Trying to reconnect in "+reconnectDelay+"ms");this.scheduleConnect_(reconnectDelay);this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(false)};PersistentConnection.prototype.establishConnection_=function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt");this.lastConnectionAttemptTime_=(new Date).getTime();this.lastConnectionEstablishedTime_=null;var onDataMessage_1=this.onDataMessage_.bind(this);var onReady_1=this.onReady_.bind(this);var onDisconnect_1=this.onRealtimeDisconnect_.bind(this);var connId_1=this.id+":"+PersistentConnection.nextConnectionId_++;var self_1=this;var lastSessionId_1=this.lastSessionId;var canceled_1=false;var connection_1=null;var closeFn_1=function(){if(connection_1){connection_1.close()}else{canceled_1=true;onDisconnect_1()}};var sendRequestFn=function(msg){util_3.assert(connection_1,"sendRequest call when we're not connected not allowed.");connection_1.sendRequest(msg)};this.realtime_={close:closeFn_1,sendRequest:sendRequestFn};var forceRefresh=this.forceTokenRefresh_;this.forceTokenRefresh_=false;this.authTokenProvider_.getToken(forceRefresh).then(function(result){if(!canceled_1){util_4.log("getToken() completed. Creating connection.");self_1.authToken_=result&&result.accessToken;connection_1=new Connection_1.Connection(connId_1,self_1.repoInfo_,onDataMessage_1,onReady_1,onDisconnect_1,function(reason){util_4.warn(reason+" ("+self_1.repoInfo_.toString()+")");self_1.interrupt(SERVER_KILL_INTERRUPT_REASON)},lastSessionId_1)}else{util_4.log("getToken() completed but was canceled")}}).then(null,function(error){self_1.log_("Failed to get token: "+error);if(!canceled_1){if(util_6.CONSTANTS.NODE_ADMIN){util_4.warn(error)}closeFn_1()}})}};PersistentConnection.prototype.interrupt=function(reason){util_4.log("Interrupting connection for reason: "+reason);this.interruptReasons_[reason]=true;if(this.realtime_){this.realtime_.close()}else{if(this.establishConnectionTimer_){clearTimeout(this.establishConnectionTimer_);this.establishConnectionTimer_=null}if(this.connected_){this.onRealtimeDisconnect_()}}};PersistentConnection.prototype.resume=function(reason){util_4.log("Resuming connection for reason: "+reason);delete this.interruptReasons_[reason];if(util_1.isEmpty(this.interruptReasons_)){this.reconnectDelay_=RECONNECT_MIN_DELAY;if(!this.realtime_){this.scheduleConnect_(0)}}};PersistentConnection.prototype.handleTimestamp_=function(timestamp){var delta=timestamp-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:delta})};PersistentConnection.prototype.cancelSentTransactions_=function(){for(var i=0;i<this.outstandingPuts_.length;i++){var put=this.outstandingPuts_[i];if(put&&"h"in put.request&&put.queued){if(put.onComplete)put.onComplete("disconnect");delete this.outstandingPuts_[i];this.outstandingPutCount_--}}if(this.outstandingPutCount_===0)this.outstandingPuts_=[]};PersistentConnection.prototype.onListenRevoked_=function(pathString,query){var queryId;if(!query){queryId="default"}else{queryId=query.map(function(q){return util_4.ObjectToUniqueKey(q)}).join("$")}var listen=this.removeListen_(pathString,queryId);if(listen&&listen.onComplete)listen.onComplete("permission_denied")};PersistentConnection.prototype.removeListen_=function(pathString,queryId){var normalizedPathString=new Path_1.Path(pathString).toString();var listen;if(this.listens_[normalizedPathString]!==undefined){listen=this.listens_[normalizedPathString][queryId];delete this.listens_[normalizedPathString][queryId];if(util_1.getCount(this.listens_[normalizedPathString])===0){delete this.listens_[normalizedPathString]}}else{listen=undefined}return listen};PersistentConnection.prototype.onAuthRevoked_=function(statusCode,explanation){util_4.log("Auth token revoked: "+statusCode+"/"+explanation);this.authToken_=null;this.forceTokenRefresh_=true;this.realtime_.close();if(statusCode==="invalid_token"||statusCode==="permission_denied"){this.invalidAuthTokenCount_++;if(this.invalidAuthTokenCount_>=INVALID_AUTH_TOKEN_THRESHOLD){this.reconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS;this.authTokenProvider_.notifyForInvalidToken()}}};PersistentConnection.prototype.onSecurityDebugPacket_=function(body){if(this.securityDebugCallback_){this.securityDebugCallback_(body)}else{if("msg"in body&&typeof console!=="undefined"){console.log("FIREBASE: "+body["msg"].replace("\n","\nFIREBASE: "))}}};PersistentConnection.prototype.restoreState_=function(){var _this=this;this.tryAuth();util_1.forEach(this.listens_,function(pathString,queries){util_1.forEach(queries,function(key,listenSpec){_this.sendListen_(listenSpec)})});for(var i=0;i<this.outstandingPuts_.length;i++){if(this.outstandingPuts_[i])this.sendPut_(i)}while(this.onDisconnectRequestQueue_.length){var request=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(request.action,request.pathString,request.data,request.onComplete)}};PersistentConnection.prototype.sendConnectStats_=function(){var stats={};var clientName="js";if(util_6.CONSTANTS.NODE_ADMIN){clientName="admin_node"}else if(util_6.CONSTANTS.NODE_CLIENT){clientName="node"}stats["sdk."+clientName+"."+app_1.default.SDK_VERSION.replace(/\./g,"-")]=1;if(util_7.isMobileCordova()){stats["framework.cordova"]=1}else if(util_7.isReactNative()){stats["framework.reactnative"]=1}this.reportStats(stats)};PersistentConnection.prototype.shouldReconnect_=function(){var online=OnlineMonitor_1.OnlineMonitor.getInstance().currentlyOnline();return util_1.isEmpty(this.interruptReasons_)&&online};PersistentConnection.nextPersistentConnectionId_=0;PersistentConnection.nextConnectionId_=0;return PersistentConnection}(ServerActions_1.ServerActions);exports.PersistentConnection=PersistentConnection},{"../realtime/Connection":86,"./ServerActions":26,"./util/OnlineMonitor":61,"./util/Path":62,"./util/VisibilityMonitor":66,"./util/util":68,"@firebase/app":6,"@firebase/util":139}],21:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("./util/util");var util_3=require("@firebase/util");var util_4=require("@firebase/util");var util_5=require("@firebase/util");var ServerActions_1=require("./ServerActions");var ReadonlyRestClient=function(_super){__extends(ReadonlyRestClient,_super);function ReadonlyRestClient(repoInfo_,onDataUpdate_,authTokenProvider_){var _this=_super.call(this)||this;_this.repoInfo_=repoInfo_;_this.onDataUpdate_=onDataUpdate_;_this.authTokenProvider_=authTokenProvider_;_this.log_=util_2.logWrapper("p:rest:");_this.listens_={};return _this}ReadonlyRestClient.prototype.reportStats=function(stats){throw new Error("Method not implemented.")};ReadonlyRestClient.getListenId_=function(query,tag){if(tag!==undefined){return"tag$"+tag}else{util_1.assert(query.getQueryParams().isDefault(),"should have a tag if it's not a default query.");return query.path.toString()}};ReadonlyRestClient.prototype.listen=function(query,currentHashFn,tag,onComplete){var _this=this;var pathString=query.path.toString();this.log_("Listen called for "+pathString+" "+query.queryIdentifier());var listenId=ReadonlyRestClient.getListenId_(query,tag);var thisListen={};this.listens_[listenId]=thisListen;var queryStringParamaters=query.getQueryParams().toRestQueryStringParameters();this.restRequest_(pathString+".json",queryStringParamaters,function(error,result){var data=result;if(error===404){data=null;error=null}if(error===null){_this.onDataUpdate_(pathString,data,false,tag)}if(util_4.safeGet(_this.listens_,listenId)===thisListen){var status_1;if(!error){status_1="ok"}else if(error==401){status_1="permission_denied"}else{status_1="rest_error:"+error}onComplete(status_1,null)}})};ReadonlyRestClient.prototype.unlisten=function(query,tag){var listenId=ReadonlyRestClient.getListenId_(query,tag);delete this.listens_[listenId]};ReadonlyRestClient.prototype.refreshAuthToken=function(token){};ReadonlyRestClient.prototype.restRequest_=function(pathString,queryStringParameters,callback){var _this=this;if(queryStringParameters===void 0){queryStringParameters={}}queryStringParameters["format"]="export";this.authTokenProvider_.getToken(false).then(function(authTokenData){var authToken=authTokenData&&authTokenData.accessToken;if(authToken){queryStringParameters["auth"]=authToken}var url=(_this.repoInfo_.secure?"https://":"http://")+_this.repoInfo_.host+pathString+"?"+util_5.querystring(queryStringParameters);_this.log_("Sending REST request for "+url);var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(callback&&xhr.readyState===4){_this.log_("REST Response for "+url+" received. status:",xhr.status,"response:",xhr.responseText);var res=null;if(xhr.status>=200&&xhr.status<300){try{res=util_3.jsonEval(xhr.responseText)}catch(e){util_2.warn("Failed to parse JSON response for "+url+": "+xhr.responseText)}callback(null,res)}else{if(xhr.status!==401&&xhr.status!==404){util_2.warn("Got unsuccessful REST response for "+url+" Status: "+xhr.status)}callback(xhr.status)}callback=null}};xhr.open("GET",url,true);xhr.send()})};return ReadonlyRestClient}(ServerActions_1.ServerActions);exports.ReadonlyRestClient=ReadonlyRestClient},{"./ServerActions":26,"./util/util":68,"@firebase/util":139}],22:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ServerValues_1=require("./util/ServerValues");var nodeFromJSON_1=require("./snap/nodeFromJSON");var Path_1=require("./util/Path");var SparseSnapshotTree_1=require("./SparseSnapshotTree");var SyncTree_1=require("./SyncTree");var SnapshotHolder_1=require("./SnapshotHolder");var util_1=require("@firebase/util");var util_2=require("./util/util");var util_3=require("@firebase/util");var AuthTokenProvider_1=require("./AuthTokenProvider");var StatsManager_1=require("./stats/StatsManager");var StatsReporter_1=require("./stats/StatsReporter");var StatsListener_1=require("./stats/StatsListener");var EventQueue_1=require("./view/EventQueue");var PersistentConnection_1=require("./PersistentConnection");var ReadonlyRestClient_1=require("./ReadonlyRestClient");var Database_1=require("../api/Database");var INTERRUPT_REASON="repo_interrupt";
var Repo=function(){function Repo(repoInfo_,forceRestClient,app){var _this=this;this.repoInfo_=repoInfo_;this.app=app;this.dataUpdateCount=0;this.statsListener_=null;this.eventQueue_=new EventQueue_1.EventQueue;this.nextWriteId_=1;this.interceptServerDataCallback_=null;this.onDisconnect_=new SparseSnapshotTree_1.SparseSnapshotTree;this.persistentConnection_=null;var authTokenProvider=new AuthTokenProvider_1.AuthTokenProvider(app);this.stats_=StatsManager_1.StatsManager.getCollection(repoInfo_);if(forceRestClient||util_2.beingCrawled()){this.server_=new ReadonlyRestClient_1.ReadonlyRestClient(this.repoInfo_,this.onDataUpdate_.bind(this),authTokenProvider);setTimeout(this.onConnectStatus_.bind(this,true),0)}else{var authOverride=app.options["databaseAuthVariableOverride"];if(typeof authOverride!=="undefined"&&authOverride!==null){if(typeof authOverride!=="object"){throw new Error("Only objects are supported for option databaseAuthVariableOverride")}try{util_1.stringify(authOverride)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}this.persistentConnection_=new PersistentConnection_1.PersistentConnection(this.repoInfo_,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),authTokenProvider,authOverride);this.server_=this.persistentConnection_}authTokenProvider.addTokenChangeListener(function(token){_this.server_.refreshAuthToken(token)});this.statsReporter_=StatsManager_1.StatsManager.getOrCreateReporter(repoInfo_,function(){return new StatsReporter_1.StatsReporter(_this.stats_,_this.server_)});this.transactions_init_();this.infoData_=new SnapshotHolder_1.SnapshotHolder;this.infoSyncTree_=new SyncTree_1.SyncTree({startListening:function(query,tag,currentHashFn,onComplete){var infoEvents=[];var node=_this.infoData_.getNode(query.path);if(!node.isEmpty()){infoEvents=_this.infoSyncTree_.applyServerOverwrite(query.path,node);setTimeout(function(){onComplete("ok")},0)}return infoEvents},stopListening:function(){}});this.updateInfo_("connected",false);this.serverSyncTree_=new SyncTree_1.SyncTree({startListening:function(query,tag,currentHashFn,onComplete){_this.server_.listen(query,currentHashFn,tag,function(status,data){var events=onComplete(status,data);_this.eventQueue_.raiseEventsForChangedPath(query.path,events)});return[]},stopListening:function(query,tag){_this.server_.unlisten(query,tag)}})}Repo.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host};Repo.prototype.name=function(){return this.repoInfo_.namespace};Repo.prototype.serverTime=function(){var offsetNode=this.infoData_.getNode(new Path_1.Path(".info/serverTimeOffset"));var offset=offsetNode.val()||0;return(new Date).getTime()+offset};Repo.prototype.generateServerValues=function(){return ServerValues_1.generateWithValues({timestamp:this.serverTime()})};Repo.prototype.onDataUpdate_=function(pathString,data,isMerge,tag){this.dataUpdateCount++;var path=new Path_1.Path(pathString);data=this.interceptServerDataCallback_?this.interceptServerDataCallback_(pathString,data):data;var events=[];if(tag){if(isMerge){var taggedChildren=util_3.map(data,function(raw){return nodeFromJSON_1.nodeFromJSON(raw)});events=this.serverSyncTree_.applyTaggedQueryMerge(path,taggedChildren,tag)}else{var taggedSnap=nodeFromJSON_1.nodeFromJSON(data);events=this.serverSyncTree_.applyTaggedQueryOverwrite(path,taggedSnap,tag)}}else if(isMerge){var changedChildren=util_3.map(data,function(raw){return nodeFromJSON_1.nodeFromJSON(raw)});events=this.serverSyncTree_.applyServerMerge(path,changedChildren)}else{var snap=nodeFromJSON_1.nodeFromJSON(data);events=this.serverSyncTree_.applyServerOverwrite(path,snap)}var affectedPath=path;if(events.length>0){affectedPath=this.rerunTransactions_(path)}this.eventQueue_.raiseEventsForChangedPath(affectedPath,events)};Repo.prototype.interceptServerData_=function(callback){this.interceptServerDataCallback_=callback};Repo.prototype.onConnectStatus_=function(connectStatus){this.updateInfo_("connected",connectStatus);if(connectStatus===false){this.runOnDisconnectEvents_()}};Repo.prototype.onServerInfoUpdate_=function(updates){var _this=this;util_2.each(updates,function(value,key){_this.updateInfo_(key,value)})};Repo.prototype.updateInfo_=function(pathString,value){var path=new Path_1.Path("/.info/"+pathString);var newNode=nodeFromJSON_1.nodeFromJSON(value);this.infoData_.updateSnapshot(path,newNode);var events=this.infoSyncTree_.applyServerOverwrite(path,newNode);this.eventQueue_.raiseEventsForChangedPath(path,events)};Repo.prototype.getNextWriteId_=function(){return this.nextWriteId_++};Repo.prototype.setWithPriority=function(path,newVal,newPriority,onComplete){var _this=this;this.log_("set",{path:path.toString(),value:newVal,priority:newPriority});var serverValues=this.generateServerValues();var newNodeUnresolved=nodeFromJSON_1.nodeFromJSON(newVal,newPriority);var newNode=ServerValues_1.resolveDeferredValueSnapshot(newNodeUnresolved,serverValues);var writeId=this.getNextWriteId_();var events=this.serverSyncTree_.applyUserOverwrite(path,newNode,writeId,true);this.eventQueue_.queueEvents(events);this.server_.put(path.toString(),newNodeUnresolved.val(true),function(status,errorReason){var success=status==="ok";if(!success){util_2.warn("set at "+path+" failed: "+status)}var clearEvents=_this.serverSyncTree_.ackUserWrite(writeId,!success);_this.eventQueue_.raiseEventsForChangedPath(path,clearEvents);_this.callOnCompleteCallback(onComplete,status,errorReason)});var affectedPath=this.abortTransactions_(path);this.rerunTransactions_(affectedPath);this.eventQueue_.raiseEventsForChangedPath(affectedPath,[])};Repo.prototype.update=function(path,childrenToMerge,onComplete){var _this=this;this.log_("update",{path:path.toString(),value:childrenToMerge});var empty=true;var serverValues=this.generateServerValues();var changedChildren={};util_3.forEach(childrenToMerge,function(changedKey,changedValue){empty=false;var newNodeUnresolved=nodeFromJSON_1.nodeFromJSON(changedValue);changedChildren[changedKey]=ServerValues_1.resolveDeferredValueSnapshot(newNodeUnresolved,serverValues)});if(!empty){var writeId_1=this.getNextWriteId_();var events=this.serverSyncTree_.applyUserMerge(path,changedChildren,writeId_1);this.eventQueue_.queueEvents(events);this.server_.merge(path.toString(),childrenToMerge,function(status,errorReason){var success=status==="ok";if(!success){util_2.warn("update at "+path+" failed: "+status)}var clearEvents=_this.serverSyncTree_.ackUserWrite(writeId_1,!success);var affectedPath=clearEvents.length>0?_this.rerunTransactions_(path):path;_this.eventQueue_.raiseEventsForChangedPath(affectedPath,clearEvents);_this.callOnCompleteCallback(onComplete,status,errorReason)});util_3.forEach(childrenToMerge,function(changedPath){var affectedPath=_this.abortTransactions_(path.child(changedPath));_this.rerunTransactions_(affectedPath)});this.eventQueue_.raiseEventsForChangedPath(path,[])}else{util_2.log("update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(onComplete,"ok")}};Repo.prototype.runOnDisconnectEvents_=function(){var _this=this;this.log_("onDisconnectEvents");var serverValues=this.generateServerValues();var resolvedOnDisconnectTree=ServerValues_1.resolveDeferredValueTree(this.onDisconnect_,serverValues);var events=[];resolvedOnDisconnectTree.forEachTree(Path_1.Path.Empty,function(path,snap){events=events.concat(_this.serverSyncTree_.applyServerOverwrite(path,snap));var affectedPath=_this.abortTransactions_(path);_this.rerunTransactions_(affectedPath)});this.onDisconnect_=new SparseSnapshotTree_1.SparseSnapshotTree;this.eventQueue_.raiseEventsForChangedPath(Path_1.Path.Empty,events)};Repo.prototype.onDisconnectCancel=function(path,onComplete){var _this=this;this.server_.onDisconnectCancel(path.toString(),function(status,errorReason){if(status==="ok"){_this.onDisconnect_.forget(path)}_this.callOnCompleteCallback(onComplete,status,errorReason)})};Repo.prototype.onDisconnectSet=function(path,value,onComplete){var _this=this;var newNode=nodeFromJSON_1.nodeFromJSON(value);this.server_.onDisconnectPut(path.toString(),newNode.val(true),function(status,errorReason){if(status==="ok"){_this.onDisconnect_.remember(path,newNode)}_this.callOnCompleteCallback(onComplete,status,errorReason)})};Repo.prototype.onDisconnectSetWithPriority=function(path,value,priority,onComplete){var _this=this;var newNode=nodeFromJSON_1.nodeFromJSON(value,priority);this.server_.onDisconnectPut(path.toString(),newNode.val(true),function(status,errorReason){if(status==="ok"){_this.onDisconnect_.remember(path,newNode)}_this.callOnCompleteCallback(onComplete,status,errorReason)})};Repo.prototype.onDisconnectUpdate=function(path,childrenToMerge,onComplete){var _this=this;if(util_3.isEmpty(childrenToMerge)){util_2.log("onDisconnect().update() called with empty data.  Don't do anything.");this.callOnCompleteCallback(onComplete,"ok");return}this.server_.onDisconnectMerge(path.toString(),childrenToMerge,function(status,errorReason){if(status==="ok"){util_3.forEach(childrenToMerge,function(childName,childNode){var newChildNode=nodeFromJSON_1.nodeFromJSON(childNode);_this.onDisconnect_.remember(path.child(childName),newChildNode)})}_this.callOnCompleteCallback(onComplete,status,errorReason)})};Repo.prototype.addEventCallbackForQuery=function(query,eventRegistration){var events;if(query.path.getFront()===".info"){events=this.infoSyncTree_.addEventRegistration(query,eventRegistration)}else{events=this.serverSyncTree_.addEventRegistration(query,eventRegistration)}this.eventQueue_.raiseEventsAtPath(query.path,events)};Repo.prototype.removeEventCallbackForQuery=function(query,eventRegistration){var events;if(query.path.getFront()===".info"){events=this.infoSyncTree_.removeEventRegistration(query,eventRegistration)}else{events=this.serverSyncTree_.removeEventRegistration(query,eventRegistration)}this.eventQueue_.raiseEventsAtPath(query.path,events)};Repo.prototype.interrupt=function(){if(this.persistentConnection_){this.persistentConnection_.interrupt(INTERRUPT_REASON)}};Repo.prototype.resume=function(){if(this.persistentConnection_){this.persistentConnection_.resume(INTERRUPT_REASON)}};Repo.prototype.stats=function(showDelta){if(showDelta===void 0){showDelta=false}if(typeof console==="undefined")return;var stats;if(showDelta){if(!this.statsListener_)this.statsListener_=new StatsListener_1.StatsListener(this.stats_);stats=this.statsListener_.get()}else{stats=this.stats_.get()}var longestName=Object.keys(stats).reduce(function(previousValue,currentValue){return Math.max(currentValue.length,previousValue)},0);util_3.forEach(stats,function(stat,value){for(var i=stat.length;i<longestName+2;i++)stat+=" ";console.log(stat+value)})};Repo.prototype.statsIncrementCounter=function(metric){this.stats_.incrementCounter(metric);this.statsReporter_.includeStat(metric)};Repo.prototype.log_=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}var prefix="";if(this.persistentConnection_){prefix=this.persistentConnection_.id+":"}util_2.log.apply(void 0,[prefix].concat(var_args))};Repo.prototype.callOnCompleteCallback=function(callback,status,errorReason){if(callback){util_2.exceptionGuard(function(){if(status=="ok"){callback(null)}else{var code=(status||"error").toUpperCase();var message=code;if(errorReason)message+=": "+errorReason;var error=new Error(message);error.code=code;callback(error)}})}};Object.defineProperty(Repo.prototype,"database",{get:function(){return this.__database||(this.__database=new Database_1.Database(this))},enumerable:true,configurable:true});return Repo}();exports.Repo=Repo},{"../api/Database":11,"./AuthTokenProvider":18,"./PersistentConnection":20,"./ReadonlyRestClient":21,"./SnapshotHolder":27,"./SparseSnapshotTree":28,"./SyncTree":30,"./snap/nodeFromJSON":48,"./stats/StatsListener":51,"./stats/StatsManager":52,"./stats/StatsReporter":53,"./util/Path":62,"./util/ServerValues":63,"./util/util":68,"./view/EventQueue":76,"@firebase/util":139}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("@firebase/util");var storage_1=require("./storage/storage");var Constants_1=require("../realtime/Constants");var RepoInfo=function(){function RepoInfo(host,secure,namespace,webSocketOnly,persistenceKey){if(persistenceKey===void 0){persistenceKey=""}this.secure=secure;this.namespace=namespace;this.webSocketOnly=webSocketOnly;this.persistenceKey=persistenceKey;this.host=host.toLowerCase();this.domain=this.host.substr(this.host.indexOf(".")+1);this.internalHost=storage_1.PersistentStorage.get("host:"+host)||this.host}RepoInfo.prototype.needsQueryParam=function(){return this.host!==this.internalHost};RepoInfo.prototype.isCacheableHost=function(){return this.internalHost.substr(0,2)==="s-"};RepoInfo.prototype.isDemoHost=function(){return this.domain==="firebaseio-demo.com"};RepoInfo.prototype.isCustomHost=function(){return this.domain!=="firebaseio.com"&&this.domain!=="firebaseio-demo.com"};RepoInfo.prototype.updateHost=function(newHost){if(newHost!==this.internalHost){this.internalHost=newHost;if(this.isCacheableHost()){storage_1.PersistentStorage.set("host:"+this.host,this.internalHost)}}};RepoInfo.prototype.connectionURL=function(type,params){util_1.assert(typeof type==="string","typeof type must == string");util_1.assert(typeof params==="object","typeof params must == object");var connURL;if(type===Constants_1.WEBSOCKET){connURL=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?"}else if(type===Constants_1.LONG_POLLING){connURL=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}else{throw new Error("Unknown connection type: "+type)}if(this.needsQueryParam()){params["ns"]=this.namespace}var pairs=[];util_2.forEach(params,function(key,value){pairs.push(key+"="+value)});return connURL+pairs.join("&")};RepoInfo.prototype.toString=function(){var str=this.toURLString();if(this.persistenceKey){str+="<"+this.persistenceKey+">"}return str};RepoInfo.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host};return RepoInfo}();exports.RepoInfo=RepoInfo},{"../realtime/Constants":87,"./storage/storage":56,"@firebase/util":139}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Repo_1=require("./Repo");var util_2=require("./util/util");var parser_1=require("./util/libs/parser");var validation_1=require("./util/validation");require("./Repo_transaction");var DATABASE_URL_OPTION="databaseURL";var _staticInstance;var RepoManager=function(){function RepoManager(){this.repos_={};this.useRestClient_=false}RepoManager.getInstance=function(){if(!_staticInstance){_staticInstance=new RepoManager}return _staticInstance};RepoManager.prototype.interrupt=function(){for(var appName in this.repos_){for(var dbUrl in this.repos_[appName]){this.repos_[appName][dbUrl].interrupt()}}};RepoManager.prototype.resume=function(){for(var appName in this.repos_){for(var dbUrl in this.repos_[appName]){this.repos_[appName][dbUrl].resume()}}};RepoManager.prototype.databaseFromApp=function(app,url){var dbUrl=url||app.options[DATABASE_URL_OPTION];if(dbUrl===undefined){util_2.fatal("Can't determine Firebase Database URL.  Be sure to include "+DATABASE_URL_OPTION+" option when calling firebase.intializeApp().")}var parsedUrl=parser_1.parseRepoInfo(dbUrl);var repoInfo=parsedUrl.repoInfo;validation_1.validateUrl("Invalid Firebase Database URL",1,parsedUrl);if(!parsedUrl.path.isEmpty()){util_2.fatal("Database URL must point to the root of a Firebase Database "+"(not including a child path).")}var repo=this.createRepo(repoInfo,app);return repo.database};RepoManager.prototype.deleteRepo=function(repo){var appRepos=util_1.safeGet(this.repos_,repo.app.name);if(!appRepos||util_1.safeGet(appRepos,repo.repoInfo_.toURLString())!==repo){util_2.fatal("Database "+repo.app.name+"("+repo.repoInfo_+") has already been deleted.")}repo.interrupt();delete appRepos[repo.repoInfo_.toURLString()]};RepoManager.prototype.createRepo=function(repoInfo,app){var appRepos=util_1.safeGet(this.repos_,app.name);if(!appRepos){appRepos={};this.repos_[app.name]=appRepos}var repo=util_1.safeGet(appRepos,repoInfo.toURLString());if(repo){util_2.fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.")}repo=new Repo_1.Repo(repoInfo,this.useRestClient_,app);appRepos[repoInfo.toURLString()]=repo;return repo};RepoManager.prototype.forceRestClient=function(forceRestClient){this.useRestClient_=forceRestClient};return RepoManager}();exports.RepoManager=RepoManager},{"./Repo":22,"./Repo_transaction":25,"./util/libs/parser":67,"./util/util":68,"./util/validation":69,"@firebase/util":139}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Reference_1=require("../api/Reference");var DataSnapshot_1=require("../api/DataSnapshot");var Path_1=require("./util/Path");var Tree_1=require("./util/Tree");var PriorityIndex_1=require("./snap/indexes/PriorityIndex");var util_2=require("./util/util");var ServerValues_1=require("./util/ServerValues");var validation_1=require("./util/validation");var util_3=require("@firebase/util");var nodeFromJSON_1=require("./snap/nodeFromJSON");var ChildrenNode_1=require("./snap/ChildrenNode");var Repo_1=require("./Repo");var TransactionStatus;(function(TransactionStatus){TransactionStatus[TransactionStatus["RUN"]=0]="RUN";TransactionStatus[TransactionStatus["SENT"]=1]="SENT";TransactionStatus[TransactionStatus["COMPLETED"]=2]="COMPLETED";TransactionStatus[TransactionStatus["SENT_NEEDS_ABORT"]=3]="SENT_NEEDS_ABORT";TransactionStatus[TransactionStatus["NEEDS_ABORT"]=4]="NEEDS_ABORT"})(TransactionStatus=exports.TransactionStatus||(exports.TransactionStatus={}));Repo_1.Repo.MAX_TRANSACTION_RETRIES_=25;Repo_1.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new Tree_1.Tree};Repo_1.Repo.prototype.startTransaction=function(path,transactionUpdate,onComplete,applyLocally){this.log_("transaction on "+path);var valueCallback=function(){};var watchRef=new Reference_1.Reference(this,path);watchRef.on("value",valueCallback);var unwatcher=function(){watchRef.off("value",valueCallback)};var transaction={path:path,update:transactionUpdate,onComplete:onComplete,status:null,order:util_2.LUIDGenerator(),applyLocally:applyLocally,retryCount:0,unwatcher:unwatcher,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null};var currentState=this.getLatestState_(path);transaction.currentInputSnapshot=currentState;var newVal=transaction.update(currentState.val());if(newVal===undefined){transaction.unwatcher();transaction.currentOutputSnapshotRaw=null;transaction.currentOutputSnapshotResolved=null;if(transaction.onComplete){var snapshot=new DataSnapshot_1.DataSnapshot(transaction.currentInputSnapshot,new Reference_1.Reference(this,transaction.path),PriorityIndex_1.PRIORITY_INDEX);transaction.onComplete(null,false,snapshot)}}else{validation_1.validateFirebaseData("transaction failed: Data returned ",newVal,transaction.path);transaction.status=TransactionStatus.RUN;var queueNode=this.transactionQueueTree_.subTree(path);var nodeQueue=queueNode.getValue()||[];nodeQueue.push(transaction);queueNode.setValue(nodeQueue);var priorityForNode=void 0;if(typeof newVal==="object"&&newVal!==null&&util_3.contains(newVal,".priority")){priorityForNode=util_3.safeGet(newVal,".priority");util_1.assert(validation_1.isValidPriority(priorityForNode),"Invalid priority returned by transaction. "+"Priority must be a valid string, finite number, server value, or null.")}else{var currentNode=this.serverSyncTree_.calcCompleteEventCache(path)||ChildrenNode_1.ChildrenNode.EMPTY_NODE;priorityForNode=currentNode.getPriority().val()}priorityForNode=priorityForNode;var serverValues=this.generateServerValues();var newNodeUnresolved=nodeFromJSON_1.nodeFromJSON(newVal,priorityForNode);var newNode=ServerValues_1.resolveDeferredValueSnapshot(newNodeUnresolved,serverValues);transaction.currentOutputSnapshotRaw=newNodeUnresolved;transaction.currentOutputSnapshotResolved=newNode;transaction.currentWriteId=this.getNextWriteId_();var events=this.serverSyncTree_.applyUserOverwrite(path,newNode,transaction.currentWriteId,transaction.applyLocally);this.eventQueue_.raiseEventsForChangedPath(path,events);this.sendReadyTransactions_()}};Repo_1.Repo.prototype.getLatestState_=function(path,excludeSets){return this.serverSyncTree_.calcCompleteEventCache(path,excludeSets)||ChildrenNode_1.ChildrenNode.EMPTY_NODE};Repo_1.Repo.prototype.sendReadyTransactions_=function(node){var _this=this;if(node===void 0){node=this.transactionQueueTree_}if(!node){this.pruneCompletedTransactionsBelowNode_(node)}if(node.getValue()!==null){var queue=this.buildTransactionQueue_(node);util_1.assert(queue.length>0,"Sending zero length transaction queue");var allRun=queue.every(function(transaction){return transaction.status===TransactionStatus.RUN});if(allRun){this.sendTransactionQueue_(node.path(),queue)}}else if(node.hasChildren()){node.forEachChild(function(childNode){_this.sendReadyTransactions_(childNode)})}};Repo_1.Repo.prototype.sendTransactionQueue_=function(path,queue){var _this=this;var setsToIgnore=queue.map(function(txn){return txn.currentWriteId});var latestState=this.getLatestState_(path,setsToIgnore);var snapToSend=latestState;var latestHash=latestState.hash();for(var i=0;i<queue.length;i++){var txn=queue[i];util_1.assert(txn.status===TransactionStatus.RUN,"tryToSendTransactionQueue_: items in queue should all be run.");txn.status=TransactionStatus.SENT;txn.retryCount++;var relativePath=Path_1.Path.relativePath(path,txn.path);snapToSend=snapToSend.updateChild(relativePath,txn.currentOutputSnapshotRaw)}var dataToSend=snapToSend.val(true);var pathToSend=path;this.server_.put(pathToSend.toString(),dataToSend,function(status){_this.log_("transaction put response",{path:pathToSend.toString(),status:status});var events=[];if(status==="ok"){var callbacks=[];for(var i=0;i<queue.length;i++){queue[i].status=TransactionStatus.COMPLETED;events=events.concat(_this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId));if(queue[i].onComplete){var node=queue[i].currentOutputSnapshotResolved;var ref=new Reference_1.Reference(_this,queue[i].path);var snapshot=new DataSnapshot_1.DataSnapshot(node,ref,PriorityIndex_1.PRIORITY_INDEX);callbacks.push(queue[i].onComplete.bind(null,null,true,snapshot))}queue[i].unwatcher()}_this.pruneCompletedTransactionsBelowNode_(_this.transactionQueueTree_.subTree(path));_this.sendReadyTransactions_();_this.eventQueue_.raiseEventsForChangedPath(path,events);for(var i=0;i<callbacks.length;i++){util_2.exceptionGuard(callbacks[i])}}else{if(status==="datastale"){for(var i=0;i<queue.length;i++){if(queue[i].status===TransactionStatus.SENT_NEEDS_ABORT)queue[i].status=TransactionStatus.NEEDS_ABORT;else queue[i].status=TransactionStatus.RUN}}else{util_2.warn("transaction at "+pathToSend.toString()+" failed: "+status);for(var i=0;i<queue.length;i++){queue[i].status=TransactionStatus.NEEDS_ABORT;queue[i].abortReason=status}}_this.rerunTransactions_(path)}},latestHash)};Repo_1.Repo.prototype.rerunTransactions_=function(changedPath){var rootMostTransactionNode=this.getAncestorTransactionNode_(changedPath);var path=rootMostTransactionNode.path();var queue=this.buildTransactionQueue_(rootMostTransactionNode);this.rerunTransactionQueue_(queue,path);return path};Repo_1.Repo.prototype.rerunTransactionQueue_=function(queue,path){if(queue.length===0){return}var callbacks=[];var events=[];var txnsToRerun=queue.filter(function(q){return q.status===TransactionStatus.RUN});var setsToIgnore=txnsToRerun.map(function(q){return q.currentWriteId});for(var i=0;i<queue.length;i++){var transaction=queue[i];var relativePath=Path_1.Path.relativePath(path,transaction.path);var abortTransaction=false,abortReason=void 0;util_1.assert(relativePath!==null,"rerunTransactionsUnderNode_: relativePath should not be null.");if(transaction.status===TransactionStatus.NEEDS_ABORT){abortTransaction=true;abortReason=transaction.abortReason;events=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true))}else if(transaction.status===TransactionStatus.RUN){if(transaction.retryCount>=Repo_1.Repo.MAX_TRANSACTION_RETRIES_){abortTransaction=true;abortReason="maxretry";events=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true))}else{var currentNode=this.getLatestState_(transaction.path,setsToIgnore);transaction.currentInputSnapshot=currentNode;var newData=queue[i].update(currentNode.val());if(newData!==undefined){validation_1.validateFirebaseData("transaction failed: Data returned ",newData,transaction.path);var newDataNode=nodeFromJSON_1.nodeFromJSON(newData);var hasExplicitPriority=typeof newData==="object"&&newData!=null&&util_3.contains(newData,".priority");if(!hasExplicitPriority){newDataNode=newDataNode.updatePriority(currentNode.getPriority())}var oldWriteId=transaction.currentWriteId;var serverValues=this.generateServerValues();var newNodeResolved=ServerValues_1.resolveDeferredValueSnapshot(newDataNode,serverValues);transaction.currentOutputSnapshotRaw=newDataNode;transaction.currentOutputSnapshotResolved=newNodeResolved;transaction.currentWriteId=this.getNextWriteId_();setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId),1);events=events.concat(this.serverSyncTree_.applyUserOverwrite(transaction.path,newNodeResolved,transaction.currentWriteId,transaction.applyLocally));events=events.concat(this.serverSyncTree_.ackUserWrite(oldWriteId,true))}else{abortTransaction=true;abortReason="nodata";events=events.concat(this.serverSyncTree_.ackUserWrite(transaction.currentWriteId,true))}}}this.eventQueue_.raiseEventsForChangedPath(path,events);events=[];if(abortTransaction){queue[i].status=TransactionStatus.COMPLETED;(function(unwatcher){setTimeout(unwatcher,Math.floor(0))})(queue[i].unwatcher);if(queue[i].onComplete){if(abortReason==="nodata"){var ref=new Reference_1.Reference(this,queue[i].path);var lastInput=queue[i].currentInputSnapshot;var snapshot=new DataSnapshot_1.DataSnapshot(lastInput,ref,PriorityIndex_1.PRIORITY_INDEX);callbacks.push(queue[i].onComplete.bind(null,null,false,snapshot))}else{callbacks.push(queue[i].onComplete.bind(null,new Error(abortReason),false,null))}}}}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(var i=0;i<callbacks.length;i++){util_2.exceptionGuard(callbacks[i])}this.sendReadyTransactions_()};Repo_1.Repo.prototype.getAncestorTransactionNode_=function(path){var front;var transactionNode=this.transactionQueueTree_;while((front=path.getFront())!==null&&transactionNode.getValue()===null){transactionNode=transactionNode.subTree(front);path=path.popFront()}return transactionNode};Repo_1.Repo.prototype.buildTransactionQueue_=function(transactionNode){var transactionQueue=[];this.aggregateTransactionQueuesForNode_(transactionNode,transactionQueue);transactionQueue.sort(function(a,b){return a.order-b.order});return transactionQueue};Repo_1.Repo.prototype.aggregateTransactionQueuesForNode_=function(node,queue){var _this=this;var nodeQueue=node.getValue();if(nodeQueue!==null){for(var i=0;i<nodeQueue.length;i++){queue.push(nodeQueue[i])}}node.forEachChild(function(child){_this.aggregateTransactionQueuesForNode_(child,queue)})};Repo_1.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(node){var _this=this;var queue=node.getValue();if(queue){var to=0;for(var from=0;from<queue.length;from++){if(queue[from].status!==TransactionStatus.COMPLETED){queue[to]=queue[from];to++}}queue.length=to;node.setValue(queue.length>0?queue:null)}node.forEachChild(function(childNode){_this.pruneCompletedTransactionsBelowNode_(childNode)})};Repo_1.Repo.prototype.abortTransactions_=function(path){var _this=this;var affectedPath=this.getAncestorTransactionNode_(path).path();var transactionNode=this.transactionQueueTree_.subTree(path);transactionNode.forEachAncestor(function(node){_this.abortTransactionsOnNode_(node)});this.abortTransactionsOnNode_(transactionNode);transactionNode.forEachDescendant(function(node){_this.abortTransactionsOnNode_(node)});return affectedPath};Repo_1.Repo.prototype.abortTransactionsOnNode_=function(node){var queue=node.getValue();if(queue!==null){var callbacks=[];var events=[];var lastSent=-1;for(var i=0;i<queue.length;i++){if(queue[i].status===TransactionStatus.SENT_NEEDS_ABORT){}else if(queue[i].status===TransactionStatus.SENT){util_1.assert(lastSent===i-1,"All SENT items should be at beginning of queue.");lastSent=i;queue[i].status=TransactionStatus.SENT_NEEDS_ABORT;queue[i].abortReason="set"}else{util_1.assert(queue[i].status===TransactionStatus.RUN,"Unexpected transaction status in abort");queue[i].unwatcher();events=events.concat(this.serverSyncTree_.ackUserWrite(queue[i].currentWriteId,true));if(queue[i].onComplete){var snapshot=null;callbacks.push(queue[i].onComplete.bind(null,new Error("set"),false,snapshot))}}}if(lastSent===-1){node.setValue(null)}else{queue.length=lastSent+1}this.eventQueue_.raiseEventsForChangedPath(node.path(),events);for(var i=0;i<callbacks.length;i++){util_2.exceptionGuard(callbacks[i])}}}},{"../api/DataSnapshot":10,"../api/Reference":13,"./Repo":22,"./snap/ChildrenNode":37,"./snap/indexes/PriorityIndex":46,"./snap/nodeFromJSON":48,"./util/Path":62,"./util/ServerValues":63,"./util/Tree":65,"./util/util":68,"./util/validation":69,"@firebase/util":139}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ServerActions=function(){function ServerActions(){}ServerActions.prototype.put=function(pathString,data,onComplete,hash){};ServerActions.prototype.merge=function(pathString,data,onComplete,hash){};ServerActions.prototype.refreshAuthToken=function(token){};ServerActions.prototype.onDisconnectPut=function(pathString,data,onComplete){};ServerActions.prototype.onDisconnectMerge=function(pathString,data,onComplete){};ServerActions.prototype.onDisconnectCancel=function(pathString,onComplete){};ServerActions.prototype.reportStats=function(stats){};return ServerActions}();exports.ServerActions=ServerActions},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ChildrenNode_1=require("./snap/ChildrenNode");var SnapshotHolder=function(){function SnapshotHolder(){this.rootNode_=ChildrenNode_1.ChildrenNode.EMPTY_NODE}SnapshotHolder.prototype.getNode=function(path){return this.rootNode_.getChild(path)};SnapshotHolder.prototype.updateSnapshot=function(path,newSnapshotNode){this.rootNode_=this.rootNode_.updateChild(path,newSnapshotNode)};return SnapshotHolder}();exports.SnapshotHolder=SnapshotHolder},{"./snap/ChildrenNode":37}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Path_1=require("./util/Path");var PriorityIndex_1=require("./snap/indexes/PriorityIndex");var CountedSet_1=require("./util/CountedSet");var SparseSnapshotTree=function(){function SparseSnapshotTree(){this.value_=null;this.children_=null}SparseSnapshotTree.prototype.find=function(path){if(this.value_!=null){return this.value_.getChild(path)}else if(!path.isEmpty()&&this.children_!=null){var childKey=path.getFront();path=path.popFront();if(this.children_.contains(childKey)){var childTree=this.children_.get(childKey);return childTree.find(path)}else{return null}}else{return null}};SparseSnapshotTree.prototype.remember=function(path,data){if(path.isEmpty()){this.value_=data;this.children_=null}else if(this.value_!==null){this.value_=this.value_.updateChild(path,data)}else{if(this.children_==null){this.children_=new CountedSet_1.CountedSet}var childKey=path.getFront();
if(!this.children_.contains(childKey)){this.children_.add(childKey,new SparseSnapshotTree)}var child=this.children_.get(childKey);path=path.popFront();child.remember(path,data)}};SparseSnapshotTree.prototype.forget=function(path){if(path.isEmpty()){this.value_=null;this.children_=null;return true}else{if(this.value_!==null){if(this.value_.isLeafNode()){return false}else{var value=this.value_;this.value_=null;var self_1=this;value.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,tree){self_1.remember(new Path_1.Path(key),tree)});return this.forget(path)}}else if(this.children_!==null){var childKey=path.getFront();path=path.popFront();if(this.children_.contains(childKey)){var safeToRemove=this.children_.get(childKey).forget(path);if(safeToRemove){this.children_.remove(childKey)}}if(this.children_.isEmpty()){this.children_=null;return true}else{return false}}else{return true}}};SparseSnapshotTree.prototype.forEachTree=function(prefixPath,func){if(this.value_!==null){func(prefixPath,this.value_)}else{this.forEachChild(function(key,tree){var path=new Path_1.Path(prefixPath.toString()+"/"+key);tree.forEachTree(path,func)})}};SparseSnapshotTree.prototype.forEachChild=function(func){if(this.children_!==null){this.children_.each(function(key,tree){func(key,tree)})}};return SparseSnapshotTree}();exports.SparseSnapshotTree=SparseSnapshotTree},{"./snap/indexes/PriorityIndex":46,"./util/CountedSet":57,"./util/Path":62}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CacheNode_1=require("./view/CacheNode");var ChildrenNode_1=require("./snap/ChildrenNode");var util_1=require("@firebase/util");var util_2=require("@firebase/util");var ViewCache_1=require("./view/ViewCache");var View_1=require("./view/View");var __referenceConstructor;var SyncPoint=function(){function SyncPoint(){this.views_={}}Object.defineProperty(SyncPoint,"__referenceConstructor",{get:function(){util_1.assert(__referenceConstructor,"Reference.ts has not been loaded");return __referenceConstructor},set:function(val){util_1.assert(!__referenceConstructor,"__referenceConstructor has already been defined");__referenceConstructor=val},enumerable:true,configurable:true});SyncPoint.prototype.isEmpty=function(){return util_2.isEmpty(this.views_)};SyncPoint.prototype.applyOperation=function(operation,writesCache,optCompleteServerCache){var queryId=operation.source.queryId;if(queryId!==null){var view=util_2.safeGet(this.views_,queryId);util_1.assert(view!=null,"SyncTree gave us an op for an invalid query.");return view.applyOperation(operation,writesCache,optCompleteServerCache)}else{var events_1=[];util_2.forEach(this.views_,function(key,view){events_1=events_1.concat(view.applyOperation(operation,writesCache,optCompleteServerCache))});return events_1}};SyncPoint.prototype.addEventRegistration=function(query,eventRegistration,writesCache,serverCache,serverCacheComplete){var queryId=query.queryIdentifier();var view=util_2.safeGet(this.views_,queryId);if(!view){var eventCache=writesCache.calcCompleteEventCache(serverCacheComplete?serverCache:null);var eventCacheComplete=false;if(eventCache){eventCacheComplete=true}else if(serverCache instanceof ChildrenNode_1.ChildrenNode){eventCache=writesCache.calcCompleteEventChildren(serverCache);eventCacheComplete=false}else{eventCache=ChildrenNode_1.ChildrenNode.EMPTY_NODE;eventCacheComplete=false}var viewCache=new ViewCache_1.ViewCache(new CacheNode_1.CacheNode(eventCache,eventCacheComplete,false),new CacheNode_1.CacheNode(serverCache,serverCacheComplete,false));view=new View_1.View(query,viewCache);this.views_[queryId]=view}view.addEventRegistration(eventRegistration);return view.getInitialEvents(eventRegistration)};SyncPoint.prototype.removeEventRegistration=function(query,eventRegistration,cancelError){var queryId=query.queryIdentifier();var removed=[];var cancelEvents=[];var hadCompleteView=this.hasCompleteView();if(queryId==="default"){var self_1=this;util_2.forEach(this.views_,function(viewQueryId,view){cancelEvents=cancelEvents.concat(view.removeEventRegistration(eventRegistration,cancelError));if(view.isEmpty()){delete self_1.views_[viewQueryId];if(!view.getQuery().getQueryParams().loadsAllData()){removed.push(view.getQuery())}}})}else{var view=util_2.safeGet(this.views_,queryId);if(view){cancelEvents=cancelEvents.concat(view.removeEventRegistration(eventRegistration,cancelError));if(view.isEmpty()){delete this.views_[queryId];if(!view.getQuery().getQueryParams().loadsAllData()){removed.push(view.getQuery())}}}}if(hadCompleteView&&!this.hasCompleteView()){removed.push(new SyncPoint.__referenceConstructor(query.repo,query.path))}return{removed:removed,events:cancelEvents}};SyncPoint.prototype.getQueryViews=function(){var _this=this;var values=Object.keys(this.views_).map(function(key){return _this.views_[key]});return values.filter(function(view){return!view.getQuery().getQueryParams().loadsAllData()})};SyncPoint.prototype.getCompleteServerCache=function(path){var serverCache=null;util_2.forEach(this.views_,function(key,view){serverCache=serverCache||view.getCompleteServerCache(path)});return serverCache};SyncPoint.prototype.viewForQuery=function(query){var params=query.getQueryParams();if(params.loadsAllData()){return this.getCompleteView()}else{var queryId=query.queryIdentifier();return util_2.safeGet(this.views_,queryId)}};SyncPoint.prototype.viewExistsForQuery=function(query){return this.viewForQuery(query)!=null};SyncPoint.prototype.hasCompleteView=function(){return this.getCompleteView()!=null};SyncPoint.prototype.getCompleteView=function(){var completeView=util_2.findValue(this.views_,function(view){return view.getQuery().getQueryParams().loadsAllData()});return completeView||null};return SyncPoint}();exports.SyncPoint=SyncPoint},{"./snap/ChildrenNode":37,"./view/CacheNode":70,"./view/View":79,"./view/ViewCache":80,"@firebase/util":139}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("./util/util");var AckUserWrite_1=require("./operation/AckUserWrite");var ChildrenNode_1=require("./snap/ChildrenNode");var util_3=require("@firebase/util");var ImmutableTree_1=require("./util/ImmutableTree");var ListenComplete_1=require("./operation/ListenComplete");var Merge_1=require("./operation/Merge");var Operation_1=require("./operation/Operation");var Overwrite_1=require("./operation/Overwrite");var Path_1=require("./util/Path");var SyncPoint_1=require("./SyncPoint");var WriteTree_1=require("./WriteTree");var SyncTree=function(){function SyncTree(listenProvider_){this.listenProvider_=listenProvider_;this.syncPointTree_=ImmutableTree_1.ImmutableTree.Empty;this.pendingWriteTree_=new WriteTree_1.WriteTree;this.tagToQueryMap_={};this.queryToTagMap_={}}SyncTree.prototype.applyUserOverwrite=function(path,newData,writeId,visible){this.pendingWriteTree_.addOverwrite(path,newData,writeId,visible);if(!visible){return[]}else{return this.applyOperationToSyncPoints_(new Overwrite_1.Overwrite(Operation_1.OperationSource.User,path,newData))}};SyncTree.prototype.applyUserMerge=function(path,changedChildren,writeId){this.pendingWriteTree_.addMerge(path,changedChildren,writeId);var changeTree=ImmutableTree_1.ImmutableTree.fromObject(changedChildren);return this.applyOperationToSyncPoints_(new Merge_1.Merge(Operation_1.OperationSource.User,path,changeTree))};SyncTree.prototype.ackUserWrite=function(writeId,revert){if(revert===void 0){revert=false}var write=this.pendingWriteTree_.getWrite(writeId);var needToReevaluate=this.pendingWriteTree_.removeWrite(writeId);if(!needToReevaluate){return[]}else{var affectedTree_1=ImmutableTree_1.ImmutableTree.Empty;if(write.snap!=null){affectedTree_1=affectedTree_1.set(Path_1.Path.Empty,true)}else{util_3.forEach(write.children,function(pathString,node){affectedTree_1=affectedTree_1.set(new Path_1.Path(pathString),node)})}return this.applyOperationToSyncPoints_(new AckUserWrite_1.AckUserWrite(write.path,affectedTree_1,revert))}};SyncTree.prototype.applyServerOverwrite=function(path,newData){return this.applyOperationToSyncPoints_(new Overwrite_1.Overwrite(Operation_1.OperationSource.Server,path,newData))};SyncTree.prototype.applyServerMerge=function(path,changedChildren){var changeTree=ImmutableTree_1.ImmutableTree.fromObject(changedChildren);return this.applyOperationToSyncPoints_(new Merge_1.Merge(Operation_1.OperationSource.Server,path,changeTree))};SyncTree.prototype.applyListenComplete=function(path){return this.applyOperationToSyncPoints_(new ListenComplete_1.ListenComplete(Operation_1.OperationSource.Server,path))};SyncTree.prototype.applyTaggedQueryOverwrite=function(path,snap,tag){var queryKey=this.queryKeyForTag_(tag);if(queryKey!=null){var r=SyncTree.parseQueryKey_(queryKey);var queryPath=r.path,queryId=r.queryId;var relativePath=Path_1.Path.relativePath(queryPath,path);var op=new Overwrite_1.Overwrite(Operation_1.OperationSource.forServerTaggedQuery(queryId),relativePath,snap);return this.applyTaggedOperation_(queryPath,op)}else{return[]}};SyncTree.prototype.applyTaggedQueryMerge=function(path,changedChildren,tag){var queryKey=this.queryKeyForTag_(tag);if(queryKey){var r=SyncTree.parseQueryKey_(queryKey);var queryPath=r.path,queryId=r.queryId;var relativePath=Path_1.Path.relativePath(queryPath,path);var changeTree=ImmutableTree_1.ImmutableTree.fromObject(changedChildren);var op=new Merge_1.Merge(Operation_1.OperationSource.forServerTaggedQuery(queryId),relativePath,changeTree);return this.applyTaggedOperation_(queryPath,op)}else{return[]}};SyncTree.prototype.applyTaggedListenComplete=function(path,tag){var queryKey=this.queryKeyForTag_(tag);if(queryKey){var r=SyncTree.parseQueryKey_(queryKey);var queryPath=r.path,queryId=r.queryId;var relativePath=Path_1.Path.relativePath(queryPath,path);var op=new ListenComplete_1.ListenComplete(Operation_1.OperationSource.forServerTaggedQuery(queryId),relativePath);return this.applyTaggedOperation_(queryPath,op)}else{return[]}};SyncTree.prototype.addEventRegistration=function(query,eventRegistration){var path=query.path;var serverCache=null;var foundAncestorDefaultView=false;this.syncPointTree_.foreachOnPath(path,function(pathToSyncPoint,sp){var relativePath=Path_1.Path.relativePath(pathToSyncPoint,path);serverCache=serverCache||sp.getCompleteServerCache(relativePath);foundAncestorDefaultView=foundAncestorDefaultView||sp.hasCompleteView()});var syncPoint=this.syncPointTree_.get(path);if(!syncPoint){syncPoint=new SyncPoint_1.SyncPoint;this.syncPointTree_=this.syncPointTree_.set(path,syncPoint)}else{foundAncestorDefaultView=foundAncestorDefaultView||syncPoint.hasCompleteView();serverCache=serverCache||syncPoint.getCompleteServerCache(Path_1.Path.Empty)}var serverCacheComplete;if(serverCache!=null){serverCacheComplete=true}else{serverCacheComplete=false;serverCache=ChildrenNode_1.ChildrenNode.EMPTY_NODE;var subtree=this.syncPointTree_.subtree(path);subtree.foreachChild(function(childName,childSyncPoint){var completeCache=childSyncPoint.getCompleteServerCache(Path_1.Path.Empty);if(completeCache){serverCache=serverCache.updateImmediateChild(childName,completeCache)}})}var viewAlreadyExists=syncPoint.viewExistsForQuery(query);if(!viewAlreadyExists&&!query.getQueryParams().loadsAllData()){var queryKey=SyncTree.makeQueryKey_(query);util_1.assert(!(queryKey in this.queryToTagMap_),"View does not exist, but we have a tag");var tag=SyncTree.getNextQueryTag_();this.queryToTagMap_[queryKey]=tag;this.tagToQueryMap_["_"+tag]=queryKey}var writesCache=this.pendingWriteTree_.childWrites(path);var events=syncPoint.addEventRegistration(query,eventRegistration,writesCache,serverCache,serverCacheComplete);if(!viewAlreadyExists&&!foundAncestorDefaultView){var view=syncPoint.viewForQuery(query);events=events.concat(this.setupListener_(query,view))}return events};SyncTree.prototype.removeEventRegistration=function(query,eventRegistration,cancelError){var _this=this;var path=query.path;var maybeSyncPoint=this.syncPointTree_.get(path);var cancelEvents=[];if(maybeSyncPoint&&(query.queryIdentifier()==="default"||maybeSyncPoint.viewExistsForQuery(query))){var removedAndEvents=maybeSyncPoint.removeEventRegistration(query,eventRegistration,cancelError);if(maybeSyncPoint.isEmpty()){this.syncPointTree_=this.syncPointTree_.remove(path)}var removed=removedAndEvents.removed;cancelEvents=removedAndEvents.events;var removingDefault=-1!==removed.findIndex(function(query){return query.getQueryParams().loadsAllData()});var covered=this.syncPointTree_.findOnPath(path,function(relativePath,parentSyncPoint){return parentSyncPoint.hasCompleteView()});if(removingDefault&&!covered){var subtree=this.syncPointTree_.subtree(path);if(!subtree.isEmpty()){var newViews=this.collectDistinctViewsForSubTree_(subtree);for(var i=0;i<newViews.length;++i){var view=newViews[i],newQuery=view.getQuery();var listener=this.createListenerForView_(view);this.listenProvider_.startListening(SyncTree.queryForListening_(newQuery),this.tagForQuery_(newQuery),listener.hashFn,listener.onComplete)}}else{}}if(!covered&&removed.length>0&&!cancelError){if(removingDefault){var defaultTag=null;this.listenProvider_.stopListening(SyncTree.queryForListening_(query),defaultTag)}else{removed.forEach(function(queryToRemove){var tagToRemove=_this.queryToTagMap_[SyncTree.makeQueryKey_(queryToRemove)];_this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToRemove),tagToRemove)})}}this.removeTags_(removed)}else{}return cancelEvents};SyncTree.prototype.calcCompleteEventCache=function(path,writeIdsToExclude){var includeHiddenSets=true;var writeTree=this.pendingWriteTree_;var serverCache=this.syncPointTree_.findOnPath(path,function(pathSoFar,syncPoint){var relativePath=Path_1.Path.relativePath(pathSoFar,path);var serverCache=syncPoint.getCompleteServerCache(relativePath);if(serverCache){return serverCache}});return writeTree.calcCompleteEventCache(path,serverCache,writeIdsToExclude,includeHiddenSets)};SyncTree.prototype.collectDistinctViewsForSubTree_=function(subtree){return subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){if(maybeChildSyncPoint&&maybeChildSyncPoint.hasCompleteView()){var completeView=maybeChildSyncPoint.getCompleteView();return[completeView]}else{var views_1=[];if(maybeChildSyncPoint){views_1=maybeChildSyncPoint.getQueryViews()}util_3.forEach(childMap,function(key,childViews){views_1=views_1.concat(childViews)});return views_1}})};SyncTree.prototype.removeTags_=function(queries){for(var j=0;j<queries.length;++j){var removedQuery=queries[j];if(!removedQuery.getQueryParams().loadsAllData()){var removedQueryKey=SyncTree.makeQueryKey_(removedQuery);var removedQueryTag=this.queryToTagMap_[removedQueryKey];delete this.queryToTagMap_[removedQueryKey];delete this.tagToQueryMap_["_"+removedQueryTag]}}};SyncTree.queryForListening_=function(query){if(query.getQueryParams().loadsAllData()&&!query.getQueryParams().isDefault()){return query.getRef()}else{return query}};SyncTree.prototype.setupListener_=function(query,view){var path=query.path;var tag=this.tagForQuery_(query);var listener=this.createListenerForView_(view);var events=this.listenProvider_.startListening(SyncTree.queryForListening_(query),tag,listener.hashFn,listener.onComplete);var subtree=this.syncPointTree_.subtree(path);if(tag){util_1.assert(!subtree.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed")}else{var queriesToStop=subtree.fold(function(relativePath,maybeChildSyncPoint,childMap){if(!relativePath.isEmpty()&&maybeChildSyncPoint&&maybeChildSyncPoint.hasCompleteView()){return[maybeChildSyncPoint.getCompleteView().getQuery()]}else{var queries_1=[];if(maybeChildSyncPoint){queries_1=queries_1.concat(maybeChildSyncPoint.getQueryViews().map(function(view){return view.getQuery()}))}util_3.forEach(childMap,function(key,childQueries){queries_1=queries_1.concat(childQueries)});return queries_1}});for(var i=0;i<queriesToStop.length;++i){var queryToStop=queriesToStop[i];this.listenProvider_.stopListening(SyncTree.queryForListening_(queryToStop),this.tagForQuery_(queryToStop))}}return events};SyncTree.prototype.createListenerForView_=function(view){var _this=this;var query=view.getQuery();var tag=this.tagForQuery_(query);return{hashFn:function(){var cache=view.getServerCache()||ChildrenNode_1.ChildrenNode.EMPTY_NODE;return cache.hash()},onComplete:function(status){if(status==="ok"){if(tag){return _this.applyTaggedListenComplete(query.path,tag)}else{return _this.applyListenComplete(query.path)}}else{var error=util_2.errorForServerCode(status,query);return _this.removeEventRegistration(query,null,error)}}}};SyncTree.makeQueryKey_=function(query){return query.path.toString()+"$"+query.queryIdentifier()};SyncTree.parseQueryKey_=function(queryKey){var splitIndex=queryKey.indexOf("$");util_1.assert(splitIndex!==-1&&splitIndex<queryKey.length-1,"Bad queryKey.");return{queryId:queryKey.substr(splitIndex+1),path:new Path_1.Path(queryKey.substr(0,splitIndex))}};SyncTree.prototype.queryKeyForTag_=function(tag){return this.tagToQueryMap_["_"+tag]};SyncTree.prototype.tagForQuery_=function(query){var queryKey=SyncTree.makeQueryKey_(query);return util_3.safeGet(this.queryToTagMap_,queryKey)};SyncTree.getNextQueryTag_=function(){return SyncTree.nextQueryTag_++};SyncTree.prototype.applyTaggedOperation_=function(queryPath,operation){var syncPoint=this.syncPointTree_.get(queryPath);util_1.assert(syncPoint,"Missing sync point for query tag that we're tracking");var writesCache=this.pendingWriteTree_.childWrites(queryPath);return syncPoint.applyOperation(operation,writesCache,null)};SyncTree.prototype.applyOperationToSyncPoints_=function(operation){return this.applyOperationHelper_(operation,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(Path_1.Path.Empty))};SyncTree.prototype.applyOperationHelper_=function(operation,syncPointTree,serverCache,writesCache){if(operation.path.isEmpty()){return this.applyOperationDescendantsHelper_(operation,syncPointTree,serverCache,writesCache)}else{var syncPoint=syncPointTree.get(Path_1.Path.Empty);if(serverCache==null&&syncPoint!=null){serverCache=syncPoint.getCompleteServerCache(Path_1.Path.Empty)}var events=[];var childName=operation.path.getFront();var childOperation=operation.operationForChild(childName);var childTree=syncPointTree.children.get(childName);if(childTree&&childOperation){var childServerCache=serverCache?serverCache.getImmediateChild(childName):null;var childWritesCache=writesCache.child(childName);events=events.concat(this.applyOperationHelper_(childOperation,childTree,childServerCache,childWritesCache))}if(syncPoint){events=events.concat(syncPoint.applyOperation(operation,writesCache,serverCache))}return events}};SyncTree.prototype.applyOperationDescendantsHelper_=function(operation,syncPointTree,serverCache,writesCache){var _this=this;var syncPoint=syncPointTree.get(Path_1.Path.Empty);if(serverCache==null&&syncPoint!=null){serverCache=syncPoint.getCompleteServerCache(Path_1.Path.Empty)}var events=[];syncPointTree.children.inorderTraversal(function(childName,childTree){var childServerCache=serverCache?serverCache.getImmediateChild(childName):null;var childWritesCache=writesCache.child(childName);var childOperation=operation.operationForChild(childName);if(childOperation){events=events.concat(_this.applyOperationDescendantsHelper_(childOperation,childTree,childServerCache,childWritesCache))}});if(syncPoint){events=events.concat(syncPoint.applyOperation(operation,writesCache,serverCache))}return events};SyncTree.nextQueryTag_=1;return SyncTree}();exports.SyncTree=SyncTree},{"./SyncPoint":29,"./WriteTree":31,"./operation/AckUserWrite":32,"./operation/ListenComplete":33,"./operation/Merge":34,"./operation/Operation":35,"./operation/Overwrite":36,"./snap/ChildrenNode":37,"./util/ImmutableTree":59,"./util/Path":62,"./util/util":68,"@firebase/util":139}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("@firebase/util");var Path_1=require("./util/Path");var CompoundWrite_1=require("./CompoundWrite");var PriorityIndex_1=require("./snap/indexes/PriorityIndex");var ChildrenNode_1=require("./snap/ChildrenNode");var WriteTree=function(){function WriteTree(){this.visibleWrites_=CompoundWrite_1.CompoundWrite.Empty;this.allWrites_=[];this.lastWriteId_=-1}WriteTree.prototype.childWrites=function(path){return new WriteTreeRef(path,this)};WriteTree.prototype.addOverwrite=function(path,snap,writeId,visible){util_2.assert(writeId>this.lastWriteId_,"Stacking an older write on top of newer ones");if(visible===undefined){visible=true}this.allWrites_.push({path:path,snap:snap,writeId:writeId,visible:visible});if(visible){this.visibleWrites_=this.visibleWrites_.addWrite(path,snap)}this.lastWriteId_=writeId};WriteTree.prototype.addMerge=function(path,changedChildren,writeId){util_2.assert(writeId>this.lastWriteId_,"Stacking an older merge on top of newer ones");this.allWrites_.push({path:path,children:changedChildren,writeId:writeId,visible:true});this.visibleWrites_=this.visibleWrites_.addWrites(path,changedChildren);this.lastWriteId_=writeId};WriteTree.prototype.getWrite=function(writeId){for(var i=0;i<this.allWrites_.length;i++){var record=this.allWrites_[i];if(record.writeId===writeId){return record}}return null};WriteTree.prototype.removeWrite=function(writeId){var _this=this;var idx=this.allWrites_.findIndex(function(s){return s.writeId===writeId});util_2.assert(idx>=0,"removeWrite called with nonexistent writeId.");var writeToRemove=this.allWrites_[idx];this.allWrites_.splice(idx,1);var removedWriteWasVisible=writeToRemove.visible;var removedWriteOverlapsWithOtherWrites=false;var i=this.allWrites_.length-1;while(removedWriteWasVisible&&i>=0){var currentWrite=this.allWrites_[i];if(currentWrite.visible){if(i>=idx&&this.recordContainsPath_(currentWrite,writeToRemove.path)){removedWriteWasVisible=false}else if(writeToRemove.path.contains(currentWrite.path)){removedWriteOverlapsWithOtherWrites=true}}i--}if(!removedWriteWasVisible){return false}else if(removedWriteOverlapsWithOtherWrites){this.resetTree_();return true}else{if(writeToRemove.snap){this.visibleWrites_=this.visibleWrites_.removeWrite(writeToRemove.path)}else{var children=writeToRemove.children;util_1.forEach(children,function(childName){_this.visibleWrites_=_this.visibleWrites_.removeWrite(writeToRemove.path.child(childName))})}return true}};WriteTree.prototype.getCompleteWriteData=function(path){return this.visibleWrites_.getCompleteNode(path)};WriteTree.prototype.calcCompleteEventCache=function(treePath,completeServerCache,writeIdsToExclude,includeHiddenWrites){if(!writeIdsToExclude&&!includeHiddenWrites){var shadowingNode=this.visibleWrites_.getCompleteNode(treePath);if(shadowingNode!=null){return shadowingNode}else{var subMerge=this.visibleWrites_.childCompoundWrite(treePath);if(subMerge.isEmpty()){return completeServerCache}else if(completeServerCache==null&&!subMerge.hasCompleteWrite(Path_1.Path.Empty)){return null}else{var layeredCache=completeServerCache||ChildrenNode_1.ChildrenNode.EMPTY_NODE;return subMerge.apply(layeredCache)}}}else{var merge=this.visibleWrites_.childCompoundWrite(treePath);if(!includeHiddenWrites&&merge.isEmpty()){return completeServerCache}else{if(!includeHiddenWrites&&completeServerCache==null&&!merge.hasCompleteWrite(Path_1.Path.Empty)){return null}else{var filter=function(write){return(write.visible||includeHiddenWrites)&&(!writeIdsToExclude||!~writeIdsToExclude.indexOf(write.writeId))&&(write.path.contains(treePath)||treePath.contains(write.path))};var mergeAtPath=WriteTree.layerTree_(this.allWrites_,filter,treePath);var layeredCache=completeServerCache||ChildrenNode_1.ChildrenNode.EMPTY_NODE;return mergeAtPath.apply(layeredCache)}}}};WriteTree.prototype.calcCompleteEventChildren=function(treePath,completeServerChildren){var completeChildren=ChildrenNode_1.ChildrenNode.EMPTY_NODE;var topLevelSet=this.visibleWrites_.getCompleteNode(treePath);if(topLevelSet){if(!topLevelSet.isLeafNode()){topLevelSet.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(childName,childSnap){completeChildren=completeChildren.updateImmediateChild(childName,childSnap)})}return completeChildren}else if(completeServerChildren){var merge_1=this.visibleWrites_.childCompoundWrite(treePath);completeServerChildren.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(childName,childNode){var node=merge_1.childCompoundWrite(new Path_1.Path(childName)).apply(childNode);completeChildren=completeChildren.updateImmediateChild(childName,node)});merge_1.getCompleteChildren().forEach(function(namedNode){completeChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node)});return completeChildren}else{var merge=this.visibleWrites_.childCompoundWrite(treePath);merge.getCompleteChildren().forEach(function(namedNode){completeChildren=completeChildren.updateImmediateChild(namedNode.name,namedNode.node)});return completeChildren}};WriteTree.prototype.calcEventCacheAfterServerOverwrite=function(treePath,childPath,existingEventSnap,existingServerSnap){util_2.assert(existingEventSnap||existingServerSnap,"Either existingEventSnap or existingServerSnap must exist");var path=treePath.child(childPath);if(this.visibleWrites_.hasCompleteWrite(path)){return null}else{var childMerge=this.visibleWrites_.childCompoundWrite(path);if(childMerge.isEmpty()){return existingServerSnap.getChild(childPath)}else{return childMerge.apply(existingServerSnap.getChild(childPath))}}};WriteTree.prototype.calcCompleteChild=function(treePath,childKey,existingServerSnap){var path=treePath.child(childKey);var shadowingNode=this.visibleWrites_.getCompleteNode(path);if(shadowingNode!=null){return shadowingNode}else{if(existingServerSnap.isCompleteForChild(childKey)){var childMerge=this.visibleWrites_.childCompoundWrite(path);return childMerge.apply(existingServerSnap.getNode().getImmediateChild(childKey))}else{return null}}};WriteTree.prototype.shadowingWrite=function(path){return this.visibleWrites_.getCompleteNode(path)};WriteTree.prototype.calcIndexedSlice=function(treePath,completeServerData,startPost,count,reverse,index){var toIterate;var merge=this.visibleWrites_.childCompoundWrite(treePath);var shadowingNode=merge.getCompleteNode(Path_1.Path.Empty);if(shadowingNode!=null){toIterate=shadowingNode}else if(completeServerData!=null){toIterate=merge.apply(completeServerData)}else{return[]}toIterate=toIterate.withIndex(index);if(!toIterate.isEmpty()&&!toIterate.isLeafNode()){var nodes=[];var cmp=index.getCompare();var iter=reverse?toIterate.getReverseIteratorFrom(startPost,index):toIterate.getIteratorFrom(startPost,index);var next=iter.getNext();while(next&&nodes.length<count){if(cmp(next,startPost)!==0){nodes.push(next)}next=iter.getNext()}return nodes}else{return[]}};WriteTree.prototype.recordContainsPath_=function(writeRecord,path){if(writeRecord.snap){return writeRecord.path.contains(path)}else{return!!util_1.findKey(writeRecord.children,function(childSnap,childName){return writeRecord.path.child(childName).contains(path)})}};WriteTree.prototype.resetTree_=function(){this.visibleWrites_=WriteTree.layerTree_(this.allWrites_,WriteTree.DefaultFilter_,Path_1.Path.Empty);if(this.allWrites_.length>0){this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId}else{this.lastWriteId_=-1}};WriteTree.DefaultFilter_=function(write){return write.visible};WriteTree.layerTree_=function(writes,filter,treeRoot){var compoundWrite=CompoundWrite_1.CompoundWrite.Empty;for(var i=0;i<writes.length;++i){var write=writes[i];if(filter(write)){var writePath=write.path;var relativePath=void 0;if(write.snap){if(treeRoot.contains(writePath)){relativePath=Path_1.Path.relativePath(treeRoot,writePath);compoundWrite=compoundWrite.addWrite(relativePath,write.snap)}else if(writePath.contains(treeRoot)){relativePath=Path_1.Path.relativePath(writePath,treeRoot);compoundWrite=compoundWrite.addWrite(Path_1.Path.Empty,write.snap.getChild(relativePath))}else{}}else if(write.children){if(treeRoot.contains(writePath)){relativePath=Path_1.Path.relativePath(treeRoot,writePath);compoundWrite=compoundWrite.addWrites(relativePath,write.children)}else if(writePath.contains(treeRoot)){relativePath=Path_1.Path.relativePath(writePath,treeRoot);if(relativePath.isEmpty()){compoundWrite=compoundWrite.addWrites(Path_1.Path.Empty,write.children)}else{var child=util_1.safeGet(write.children,relativePath.getFront());if(child){var deepNode=child.getChild(relativePath.popFront());compoundWrite=compoundWrite.addWrite(Path_1.Path.Empty,deepNode)}}}else{}}else{throw util_2.assertionError("WriteRecord should have .snap or .children")}}}return compoundWrite};return WriteTree}();exports.WriteTree=WriteTree;var WriteTreeRef=function(){function WriteTreeRef(path,writeTree){this.treePath_=path;this.writeTree_=writeTree}WriteTreeRef.prototype.calcCompleteEventCache=function(completeServerCache,writeIdsToExclude,includeHiddenWrites){return this.writeTree_.calcCompleteEventCache(this.treePath_,completeServerCache,writeIdsToExclude,includeHiddenWrites)};WriteTreeRef.prototype.calcCompleteEventChildren=function(completeServerChildren){return this.writeTree_.calcCompleteEventChildren(this.treePath_,completeServerChildren)};WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(path,existingEventSnap,existingServerSnap){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,path,existingEventSnap,existingServerSnap)};WriteTreeRef.prototype.shadowingWrite=function(path){return this.writeTree_.shadowingWrite(this.treePath_.child(path))};WriteTreeRef.prototype.calcIndexedSlice=function(completeServerData,startPost,count,reverse,index){return this.writeTree_.calcIndexedSlice(this.treePath_,completeServerData,startPost,count,reverse,index)};WriteTreeRef.prototype.calcCompleteChild=function(childKey,existingServerCache){return this.writeTree_.calcCompleteChild(this.treePath_,childKey,existingServerCache)};WriteTreeRef.prototype.child=function(childName){return new WriteTreeRef(this.treePath_.child(childName),this.writeTree_)};return WriteTreeRef}();exports.WriteTreeRef=WriteTreeRef},{"./CompoundWrite":19,"./snap/ChildrenNode":37,"./snap/indexes/PriorityIndex":46,"./util/Path":62,"@firebase/util":139}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Path_1=require("../util/Path");var Operation_1=require("./Operation");var AckUserWrite=function(){function AckUserWrite(path,affectedTree,revert){this.path=path;this.affectedTree=affectedTree;this.revert=revert;this.type=Operation_1.OperationType.ACK_USER_WRITE;this.source=Operation_1.OperationSource.User}AckUserWrite.prototype.operationForChild=function(childName){if(!this.path.isEmpty()){util_1.assert(this.path.getFront()===childName,"operationForChild called for unrelated child.");return new AckUserWrite(this.path.popFront(),this.affectedTree,this.revert)}else if(this.affectedTree.value!=null){util_1.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths.");return this}else{var childTree=this.affectedTree.subtree(new Path_1.Path(childName));return new AckUserWrite(Path_1.Path.Empty,childTree,this.revert)}};return AckUserWrite}();exports.AckUserWrite=AckUserWrite},{"../util/Path":62,"./Operation":35,"@firebase/util":139}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Path_1=require("../util/Path");var Operation_1=require("./Operation");var ListenComplete=function(){function ListenComplete(source,path){this.source=source;this.path=path;this.type=Operation_1.OperationType.LISTEN_COMPLETE}ListenComplete.prototype.operationForChild=function(childName){if(this.path.isEmpty()){return new ListenComplete(this.source,Path_1.Path.Empty)}else{return new ListenComplete(this.source,this.path.popFront());
}};return ListenComplete}();exports.ListenComplete=ListenComplete},{"../util/Path":62,"./Operation":35}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Operation_1=require("./Operation");var Overwrite_1=require("./Overwrite");var Path_1=require("../util/Path");var util_1=require("@firebase/util");var Merge=function(){function Merge(source,path,children){this.source=source;this.path=path;this.children=children;this.type=Operation_1.OperationType.MERGE}Merge.prototype.operationForChild=function(childName){if(this.path.isEmpty()){var childTree=this.children.subtree(new Path_1.Path(childName));if(childTree.isEmpty()){return null}else if(childTree.value){return new Overwrite_1.Overwrite(this.source,Path_1.Path.Empty,childTree.value)}else{return new Merge(this.source,Path_1.Path.Empty,childTree)}}else{util_1.assert(this.path.getFront()===childName,"Can't get a merge for a child not on the path of the operation");return new Merge(this.source,this.path.popFront(),this.children)}};Merge.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"};return Merge}();exports.Merge=Merge},{"../util/Path":62,"./Operation":35,"./Overwrite":36,"@firebase/util":139}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var OperationType;(function(OperationType){OperationType[OperationType["OVERWRITE"]=0]="OVERWRITE";OperationType[OperationType["MERGE"]=1]="MERGE";OperationType[OperationType["ACK_USER_WRITE"]=2]="ACK_USER_WRITE";OperationType[OperationType["LISTEN_COMPLETE"]=3]="LISTEN_COMPLETE"})(OperationType=exports.OperationType||(exports.OperationType={}));var OperationSource=function(){function OperationSource(fromUser,fromServer,queryId,tagged){this.fromUser=fromUser;this.fromServer=fromServer;this.queryId=queryId;this.tagged=tagged;util_1.assert(!tagged||fromServer,"Tagged queries must be from server.")}OperationSource.User=new OperationSource(true,false,null,false);OperationSource.Server=new OperationSource(false,true,null,false);OperationSource.forServerTaggedQuery=function(queryId){return new OperationSource(false,true,queryId,true)};return OperationSource}();exports.OperationSource=OperationSource},{"@firebase/util":139}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Operation_1=require("./Operation");var Path_1=require("../util/Path");var Overwrite=function(){function Overwrite(source,path,snap){this.source=source;this.path=path;this.snap=snap;this.type=Operation_1.OperationType.OVERWRITE}Overwrite.prototype.operationForChild=function(childName){if(this.path.isEmpty()){return new Overwrite(this.source,Path_1.Path.Empty,this.snap.getImmediateChild(childName))}else{return new Overwrite(this.source,this.path.popFront(),this.snap)}};return Overwrite}();exports.Overwrite=Overwrite},{"../util/Path":62,"./Operation":35}],37:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../util/util");var SortedMap_1=require("../util/SortedMap");var Node_1=require("./Node");var snap_1=require("./snap");var PriorityIndex_1=require("./indexes/PriorityIndex");var KeyIndex_1=require("./indexes/KeyIndex");var IndexMap_1=require("./IndexMap");var LeafNode_1=require("./LeafNode");var comparators_1=require("./comparators");var EMPTY_NODE;var ChildrenNode=function(){function ChildrenNode(children_,priorityNode_,indexMap_){this.children_=children_;this.priorityNode_=priorityNode_;this.indexMap_=indexMap_;this.lazyHash_=null;if(this.priorityNode_){snap_1.validatePriorityNode(this.priorityNode_)}if(this.children_.isEmpty()){util_1.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}}Object.defineProperty(ChildrenNode,"EMPTY_NODE",{get:function(){return EMPTY_NODE||(EMPTY_NODE=new ChildrenNode(new SortedMap_1.SortedMap(comparators_1.NAME_COMPARATOR),null,IndexMap_1.IndexMap.Default))},enumerable:true,configurable:true});ChildrenNode.prototype.isLeafNode=function(){return false};ChildrenNode.prototype.getPriority=function(){return this.priorityNode_||EMPTY_NODE};ChildrenNode.prototype.updatePriority=function(newPriorityNode){if(this.children_.isEmpty()){return this}else{return new ChildrenNode(this.children_,newPriorityNode,this.indexMap_)}};ChildrenNode.prototype.getImmediateChild=function(childName){if(childName===".priority"){return this.getPriority()}else{var child=this.children_.get(childName);return child===null?EMPTY_NODE:child}};ChildrenNode.prototype.getChild=function(path){var front=path.getFront();if(front===null)return this;return this.getImmediateChild(front).getChild(path.popFront())};ChildrenNode.prototype.hasChild=function(childName){return this.children_.get(childName)!==null};ChildrenNode.prototype.updateImmediateChild=function(childName,newChildNode){util_1.assert(newChildNode,"We should always be passing snapshot nodes");if(childName===".priority"){return this.updatePriority(newChildNode)}else{var namedNode=new Node_1.NamedNode(childName,newChildNode);var newChildren=void 0,newIndexMap=void 0,newPriority=void 0;if(newChildNode.isEmpty()){newChildren=this.children_.remove(childName);newIndexMap=this.indexMap_.removeFromIndexes(namedNode,this.children_)}else{newChildren=this.children_.insert(childName,newChildNode);newIndexMap=this.indexMap_.addToIndexes(namedNode,this.children_)}newPriority=newChildren.isEmpty()?EMPTY_NODE:this.priorityNode_;return new ChildrenNode(newChildren,newPriority,newIndexMap)}};ChildrenNode.prototype.updateChild=function(path,newChildNode){var front=path.getFront();if(front===null){return newChildNode}else{util_1.assert(path.getFront()!==".priority"||path.getLength()===1,".priority must be the last token in a path");var newImmediateChild=this.getImmediateChild(front).updateChild(path.popFront(),newChildNode);return this.updateImmediateChild(front,newImmediateChild)}};ChildrenNode.prototype.isEmpty=function(){return this.children_.isEmpty()};ChildrenNode.prototype.numChildren=function(){return this.children_.count()};ChildrenNode.prototype.val=function(exportFormat){if(this.isEmpty())return null;var obj={};var numKeys=0,maxKey=0,allIntegerKeys=true;this.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){obj[key]=childNode.val(exportFormat);numKeys++;if(allIntegerKeys&&ChildrenNode.INTEGER_REGEXP_.test(key)){maxKey=Math.max(maxKey,Number(key))}else{allIntegerKeys=false}});if(!exportFormat&&allIntegerKeys&&maxKey<2*numKeys){var array=[];for(var key in obj)array[key]=obj[key];return array}else{if(exportFormat&&!this.getPriority().isEmpty()){obj[".priority"]=this.getPriority().val()}return obj}};ChildrenNode.prototype.hash=function(){if(this.lazyHash_===null){var toHash_1="";if(!this.getPriority().isEmpty())toHash_1+="priority:"+snap_1.priorityHashText(this.getPriority().val())+":";this.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){var childHash=childNode.hash();if(childHash!=="")toHash_1+=":"+key+":"+childHash});this.lazyHash_=toHash_1===""?"":util_2.sha1(toHash_1)}return this.lazyHash_};ChildrenNode.prototype.getPredecessorChildName=function(childName,childNode,index){var idx=this.resolveIndex_(index);if(idx){var predecessor=idx.getPredecessorKey(new Node_1.NamedNode(childName,childNode));return predecessor?predecessor.name:null}else{return this.children_.getPredecessorKey(childName)}};ChildrenNode.prototype.getFirstChildName=function(indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){var minKey=idx.minKey();return minKey&&minKey.name}else{return this.children_.minKey()}};ChildrenNode.prototype.getFirstChild=function(indexDefinition){var minKey=this.getFirstChildName(indexDefinition);if(minKey){return new Node_1.NamedNode(minKey,this.children_.get(minKey))}else{return null}};ChildrenNode.prototype.getLastChildName=function(indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){var maxKey=idx.maxKey();return maxKey&&maxKey.name}else{return this.children_.maxKey()}};ChildrenNode.prototype.getLastChild=function(indexDefinition){var maxKey=this.getLastChildName(indexDefinition);if(maxKey){return new Node_1.NamedNode(maxKey,this.children_.get(maxKey))}else{return null}};ChildrenNode.prototype.forEachChild=function(index,action){var idx=this.resolveIndex_(index);if(idx){return idx.inorderTraversal(function(wrappedNode){return action(wrappedNode.name,wrappedNode.node)})}else{return this.children_.inorderTraversal(action)}};ChildrenNode.prototype.getIterator=function(indexDefinition){return this.getIteratorFrom(indexDefinition.minPost(),indexDefinition)};ChildrenNode.prototype.getIteratorFrom=function(startPost,indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){return idx.getIteratorFrom(startPost,function(key){return key})}else{var iterator=this.children_.getIteratorFrom(startPost.name,Node_1.NamedNode.Wrap);var next=iterator.peek();while(next!=null&&indexDefinition.compare(next,startPost)<0){iterator.getNext();next=iterator.peek()}return iterator}};ChildrenNode.prototype.getReverseIterator=function(indexDefinition){return this.getReverseIteratorFrom(indexDefinition.maxPost(),indexDefinition)};ChildrenNode.prototype.getReverseIteratorFrom=function(endPost,indexDefinition){var idx=this.resolveIndex_(indexDefinition);if(idx){return idx.getReverseIteratorFrom(endPost,function(key){return key})}else{var iterator=this.children_.getReverseIteratorFrom(endPost.name,Node_1.NamedNode.Wrap);var next=iterator.peek();while(next!=null&&indexDefinition.compare(next,endPost)>0){iterator.getNext();next=iterator.peek()}return iterator}};ChildrenNode.prototype.compareTo=function(other){if(this.isEmpty()){if(other.isEmpty()){return 0}else{return-1}}else if(other.isLeafNode()||other.isEmpty()){return 1}else if(other===exports.MAX_NODE){return-1}else{return 0}};ChildrenNode.prototype.withIndex=function(indexDefinition){if(indexDefinition===KeyIndex_1.KEY_INDEX||this.indexMap_.hasIndex(indexDefinition)){return this}else{var newIndexMap=this.indexMap_.addIndex(indexDefinition,this.children_);return new ChildrenNode(this.children_,this.priorityNode_,newIndexMap)}};ChildrenNode.prototype.isIndexed=function(index){return index===KeyIndex_1.KEY_INDEX||this.indexMap_.hasIndex(index)};ChildrenNode.prototype.equals=function(other){if(other===this){return true}else if(other.isLeafNode()){return false}else{var otherChildrenNode=other;if(!this.getPriority().equals(otherChildrenNode.getPriority())){return false}else if(this.children_.count()===otherChildrenNode.children_.count()){var thisIter=this.getIterator(PriorityIndex_1.PRIORITY_INDEX);var otherIter=otherChildrenNode.getIterator(PriorityIndex_1.PRIORITY_INDEX);var thisCurrent=thisIter.getNext();var otherCurrent=otherIter.getNext();while(thisCurrent&&otherCurrent){if(thisCurrent.name!==otherCurrent.name||!thisCurrent.node.equals(otherCurrent.node)){return false}thisCurrent=thisIter.getNext();otherCurrent=otherIter.getNext()}return thisCurrent===null&&otherCurrent===null}else{return false}}};ChildrenNode.prototype.resolveIndex_=function(indexDefinition){if(indexDefinition===KeyIndex_1.KEY_INDEX){return null}else{return this.indexMap_.get(indexDefinition.toString())}};ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;return ChildrenNode}();exports.ChildrenNode=ChildrenNode;var MaxNode=function(_super){__extends(MaxNode,_super);function MaxNode(){return _super.call(this,new SortedMap_1.SortedMap(comparators_1.NAME_COMPARATOR),ChildrenNode.EMPTY_NODE,IndexMap_1.IndexMap.Default)||this}MaxNode.prototype.compareTo=function(other){if(other===this){return 0}else{return 1}};MaxNode.prototype.equals=function(other){return other===this};MaxNode.prototype.getPriority=function(){return this};MaxNode.prototype.getImmediateChild=function(childName){return ChildrenNode.EMPTY_NODE};MaxNode.prototype.isEmpty=function(){return false};return MaxNode}(ChildrenNode);exports.MaxNode=MaxNode;exports.MAX_NODE=new MaxNode;Object.defineProperties(Node_1.NamedNode,{MIN:{value:new Node_1.NamedNode(util_2.MIN_NAME,ChildrenNode.EMPTY_NODE)},MAX:{value:new Node_1.NamedNode(util_2.MAX_NAME,exports.MAX_NODE)}});KeyIndex_1.KeyIndex.__EMPTY_NODE=ChildrenNode.EMPTY_NODE;LeafNode_1.LeafNode.__childrenNodeConstructor=ChildrenNode;snap_1.setMaxNode(exports.MAX_NODE);PriorityIndex_1.setMaxNode(exports.MAX_NODE)},{"../util/SortedMap":64,"../util/util":68,"./IndexMap":38,"./LeafNode":39,"./Node":40,"./comparators":42,"./indexes/KeyIndex":44,"./indexes/PriorityIndex":46,"./snap":49,"@firebase/util":139}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var childSet_1=require("./childSet");var util_2=require("@firebase/util");var Node_1=require("./Node");var PriorityIndex_1=require("./indexes/PriorityIndex");var KeyIndex_1=require("./indexes/KeyIndex");var _defaultIndexMap;var fallbackObject={};var IndexMap=function(){function IndexMap(indexes_,indexSet_){this.indexes_=indexes_;this.indexSet_=indexSet_}Object.defineProperty(IndexMap,"Default",{get:function(){util_1.assert(fallbackObject&&PriorityIndex_1.PRIORITY_INDEX,"ChildrenNode.ts has not been loaded");_defaultIndexMap=_defaultIndexMap||new IndexMap({".priority":fallbackObject},{".priority":PriorityIndex_1.PRIORITY_INDEX});return _defaultIndexMap},enumerable:true,configurable:true});IndexMap.prototype.get=function(indexKey){var sortedMap=util_2.safeGet(this.indexes_,indexKey);if(!sortedMap)throw new Error("No index defined for "+indexKey);if(sortedMap===fallbackObject){return null}else{return sortedMap}};IndexMap.prototype.hasIndex=function(indexDefinition){return util_2.contains(this.indexSet_,indexDefinition.toString())};IndexMap.prototype.addIndex=function(indexDefinition,existingChildren){util_1.assert(indexDefinition!==KeyIndex_1.KEY_INDEX,"KeyIndex always exists and isn't meant to be added to the IndexMap.");var childList=[];var sawIndexedValue=false;var iter=existingChildren.getIterator(Node_1.NamedNode.Wrap);var next=iter.getNext();while(next){sawIndexedValue=sawIndexedValue||indexDefinition.isDefinedOn(next.node);childList.push(next);next=iter.getNext()}var newIndex;if(sawIndexedValue){newIndex=childSet_1.buildChildSet(childList,indexDefinition.getCompare())}else{newIndex=fallbackObject}var indexName=indexDefinition.toString();var newIndexSet=util_2.clone(this.indexSet_);newIndexSet[indexName]=indexDefinition;var newIndexes=util_2.clone(this.indexes_);newIndexes[indexName]=newIndex;return new IndexMap(newIndexes,newIndexSet)};IndexMap.prototype.addToIndexes=function(namedNode,existingChildren){var _this=this;var newIndexes=util_2.map(this.indexes_,function(indexedChildren,indexName){var index=util_2.safeGet(_this.indexSet_,indexName);util_1.assert(index,"Missing index implementation for "+indexName);if(indexedChildren===fallbackObject){if(index.isDefinedOn(namedNode.node)){var childList=[];var iter=existingChildren.getIterator(Node_1.NamedNode.Wrap);var next=iter.getNext();while(next){if(next.name!=namedNode.name){childList.push(next)}next=iter.getNext()}childList.push(namedNode);return childSet_1.buildChildSet(childList,index.getCompare())}else{return fallbackObject}}else{var existingSnap=existingChildren.get(namedNode.name);var newChildren=indexedChildren;if(existingSnap){newChildren=newChildren.remove(new Node_1.NamedNode(namedNode.name,existingSnap))}return newChildren.insert(namedNode,namedNode.node)}});return new IndexMap(newIndexes,this.indexSet_)};IndexMap.prototype.removeFromIndexes=function(namedNode,existingChildren){var newIndexes=util_2.map(this.indexes_,function(indexedChildren){if(indexedChildren===fallbackObject){return indexedChildren}else{var existingSnap=existingChildren.get(namedNode.name);if(existingSnap){return indexedChildren.remove(new Node_1.NamedNode(namedNode.name,existingSnap))}else{return indexedChildren}}});return new IndexMap(newIndexes,this.indexSet_)};return IndexMap}();exports.IndexMap=IndexMap},{"./Node":40,"./childSet":41,"./indexes/KeyIndex":44,"./indexes/PriorityIndex":46,"@firebase/util":139}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../util/util");var snap_1=require("./snap");var __childrenNodeConstructor;var LeafNode=function(){function LeafNode(value_,priorityNode_){if(priorityNode_===void 0){priorityNode_=LeafNode.__childrenNodeConstructor.EMPTY_NODE}this.value_=value_;this.priorityNode_=priorityNode_;this.lazyHash_=null;util_1.assert(this.value_!==undefined&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value.");snap_1.validatePriorityNode(this.priorityNode_)}Object.defineProperty(LeafNode,"__childrenNodeConstructor",{get:function(){return __childrenNodeConstructor},set:function(val){__childrenNodeConstructor=val},enumerable:true,configurable:true});LeafNode.prototype.isLeafNode=function(){return true};LeafNode.prototype.getPriority=function(){return this.priorityNode_};LeafNode.prototype.updatePriority=function(newPriorityNode){return new LeafNode(this.value_,newPriorityNode)};LeafNode.prototype.getImmediateChild=function(childName){if(childName===".priority"){return this.priorityNode_}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE}};LeafNode.prototype.getChild=function(path){if(path.isEmpty()){return this}else if(path.getFront()===".priority"){return this.priorityNode_}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE}};LeafNode.prototype.hasChild=function(){return false};LeafNode.prototype.getPredecessorChildName=function(childName,childNode){return null};LeafNode.prototype.updateImmediateChild=function(childName,newChildNode){if(childName===".priority"){return this.updatePriority(newChildNode)}else if(newChildNode.isEmpty()&&childName!==".priority"){return this}else{return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName,newChildNode).updatePriority(this.priorityNode_)}};LeafNode.prototype.updateChild=function(path,newChildNode){var front=path.getFront();if(front===null){return newChildNode}else if(newChildNode.isEmpty()&&front!==".priority"){return this}else{util_1.assert(front!==".priority"||path.getLength()===1,".priority must be the last token in a path");return this.updateImmediateChild(front,LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(path.popFront(),newChildNode))}};LeafNode.prototype.isEmpty=function(){return false};LeafNode.prototype.numChildren=function(){return 0};LeafNode.prototype.forEachChild=function(index,action){return false};LeafNode.prototype.val=function(exportFormat){if(exportFormat&&!this.getPriority().isEmpty())return{".value":this.getValue(),".priority":this.getPriority().val()};else return this.getValue()};LeafNode.prototype.hash=function(){if(this.lazyHash_===null){var toHash="";if(!this.priorityNode_.isEmpty())toHash+="priority:"+snap_1.priorityHashText(this.priorityNode_.val())+":";var type=typeof this.value_;toHash+=type+":";if(type==="number"){toHash+=util_2.doubleToIEEE754String(this.value_)}else{toHash+=this.value_}this.lazyHash_=util_2.sha1(toHash)}return this.lazyHash_};LeafNode.prototype.getValue=function(){return this.value_};LeafNode.prototype.compareTo=function(other){if(other===LeafNode.__childrenNodeConstructor.EMPTY_NODE){return 1}else if(other instanceof LeafNode.__childrenNodeConstructor){return-1}else{util_1.assert(other.isLeafNode(),"Unknown node type");return this.compareToLeafNode_(other)}};LeafNode.prototype.compareToLeafNode_=function(otherLeaf){var otherLeafType=typeof otherLeaf.value_;var thisLeafType=typeof this.value_;var otherIndex=LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);var thisIndex=LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);util_1.assert(otherIndex>=0,"Unknown leaf type: "+otherLeafType);util_1.assert(thisIndex>=0,"Unknown leaf type: "+thisLeafType);if(otherIndex===thisIndex){if(thisLeafType==="object"){return 0}else{if(this.value_<otherLeaf.value_){return-1}else if(this.value_===otherLeaf.value_){return 0}else{return 1}}}else{return thisIndex-otherIndex}};LeafNode.prototype.withIndex=function(){return this};LeafNode.prototype.isIndexed=function(){return true};LeafNode.prototype.equals=function(other){if(other===this){return true}else if(other.isLeafNode()){var otherLeaf=other;return this.value_===otherLeaf.value_&&this.priorityNode_.equals(otherLeaf.priorityNode_)}else{return false}};LeafNode.VALUE_TYPE_ORDER=["object","boolean","number","string"];return LeafNode}();exports.LeafNode=LeafNode},{"../util/util":68,"./snap":49,"@firebase/util":139}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var NamedNode=function(){function NamedNode(name,node){this.name=name;this.node=node}NamedNode.Wrap=function(name,node){return new NamedNode(name,node)};return NamedNode}();exports.NamedNode=NamedNode},{}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SortedMap_1=require("../util/SortedMap");var SortedMap_2=require("../util/SortedMap");var LOG_2=Math.log(2);var Base12Num=function(){function Base12Num(length){var logBase2=function(num){return parseInt(Math.log(num)/LOG_2,10)};var bitMask=function(bits){return parseInt(Array(bits+1).join("1"),2)};this.count=logBase2(length+1);this.current_=this.count-1;var mask=bitMask(this.count);this.bits_=length+1&mask}Base12Num.prototype.nextBitIsOne=function(){var result=!(this.bits_&1<<this.current_);this.current_--;return result};return Base12Num}();exports.buildChildSet=function(childList,cmp,keyFn,mapSortFn){childList.sort(cmp);var buildBalancedTree=function(low,high){var length=high-low;var namedNode;var key;if(length==0){return null}else if(length==1){namedNode=childList[low];key=keyFn?keyFn(namedNode):namedNode;return new SortedMap_1.LLRBNode(key,namedNode.node,SortedMap_1.LLRBNode.BLACK,null,null)}else{var middle=parseInt(length/2,10)+low;var left=buildBalancedTree(low,middle);var right=buildBalancedTree(middle+1,high);namedNode=childList[middle];key=keyFn?keyFn(namedNode):namedNode;return new SortedMap_1.LLRBNode(key,namedNode.node,SortedMap_1.LLRBNode.BLACK,left,right)}};var buildFrom12Array=function(base12){var node=null;var root=null;var index=childList.length;var buildPennant=function(chunkSize,color){var low=index-chunkSize;var high=index;index-=chunkSize;var childTree=buildBalancedTree(low+1,high);var namedNode=childList[low];var key=keyFn?keyFn(namedNode):namedNode;attachPennant(new SortedMap_1.LLRBNode(key,namedNode.node,color,null,childTree))};var attachPennant=function(pennant){if(node){node.left=pennant;node=pennant}else{root=pennant;node=pennant}};for(var i=0;i<base12.count;++i){var isOne=base12.nextBitIsOne();var chunkSize=Math.pow(2,base12.count-(i+1));if(isOne){buildPennant(chunkSize,SortedMap_1.LLRBNode.BLACK)}else{buildPennant(chunkSize,SortedMap_1.LLRBNode.BLACK);buildPennant(chunkSize,SortedMap_1.LLRBNode.RED)}}return root};var base12=new Base12Num(childList.length);var root=buildFrom12Array(base12);return new SortedMap_2.SortedMap(mapSortFn||cmp,root)}},{"../util/SortedMap":64}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../util/util");function NAME_ONLY_COMPARATOR(left,right){return util_1.nameCompare(left.name,right.name)}exports.NAME_ONLY_COMPARATOR=NAME_ONLY_COMPARATOR;function NAME_COMPARATOR(left,right){return util_1.nameCompare(left,right)}exports.NAME_COMPARATOR=NAME_COMPARATOR},{"../util/util":68}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Node_1=require("../Node");var util_1=require("../../util/util");var Index=function(){function Index(){}Index.prototype.getCompare=function(){return this.compare.bind(this)};Index.prototype.indexedValueChanged=function(oldNode,newNode){var oldWrapped=new Node_1.NamedNode(util_1.MIN_NAME,oldNode);var newWrapped=new Node_1.NamedNode(util_1.MIN_NAME,newNode);return this.compare(oldWrapped,newWrapped)!==0};Index.prototype.minPost=function(){return Node_1.NamedNode.MIN};return Index}();exports.Index=Index},{"../../util/util":68,"../Node":40}],44:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Index_1=require("./Index");var Node_1=require("../Node");var util_1=require("../../util/util");var util_2=require("@firebase/util");var __EMPTY_NODE;var KeyIndex=function(_super){__extends(KeyIndex,_super);function KeyIndex(){return _super!==null&&_super.apply(this,arguments)||this}Object.defineProperty(KeyIndex,"__EMPTY_NODE",{get:function(){return __EMPTY_NODE},set:function(val){__EMPTY_NODE=val},enumerable:true,configurable:true});KeyIndex.prototype.compare=function(a,b){return util_1.nameCompare(a.name,b.name)};KeyIndex.prototype.isDefinedOn=function(node){throw util_2.assertionError("KeyIndex.isDefinedOn not expected to be called.")};KeyIndex.prototype.indexedValueChanged=function(oldNode,newNode){return false};KeyIndex.prototype.minPost=function(){return Node_1.NamedNode.MIN};KeyIndex.prototype.maxPost=function(){return new Node_1.NamedNode(util_1.MAX_NAME,__EMPTY_NODE)};KeyIndex.prototype.makePost=function(indexValue,name){util_2.assert(typeof indexValue==="string","KeyIndex indexValue must always be a string.");return new Node_1.NamedNode(indexValue,__EMPTY_NODE)};KeyIndex.prototype.toString=function(){return".key"};return KeyIndex}(Index_1.Index);exports.KeyIndex=KeyIndex;exports.KEY_INDEX=new KeyIndex},{"../../util/util":68,"../Node":40,"./Index":43,"@firebase/util":139}],45:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../../util/util");var Index_1=require("./Index");var ChildrenNode_1=require("../ChildrenNode");var Node_1=require("../Node");var nodeFromJSON_1=require("../nodeFromJSON");var PathIndex=function(_super){__extends(PathIndex,_super);function PathIndex(indexPath_){var _this=_super.call(this)||this;_this.indexPath_=indexPath_;util_1.assert(!indexPath_.isEmpty()&&indexPath_.getFront()!==".priority","Can't create PathIndex with empty path or .priority key");return _this}PathIndex.prototype.extractChild=function(snap){return snap.getChild(this.indexPath_)};PathIndex.prototype.isDefinedOn=function(node){return!node.getChild(this.indexPath_).isEmpty()};PathIndex.prototype.compare=function(a,b){var aChild=this.extractChild(a.node);var bChild=this.extractChild(b.node);var indexCmp=aChild.compareTo(bChild);if(indexCmp===0){return util_2.nameCompare(a.name,b.name)}else{return indexCmp}};PathIndex.prototype.makePost=function(indexValue,name){var valueNode=nodeFromJSON_1.nodeFromJSON(indexValue);var node=ChildrenNode_1.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,valueNode);return new Node_1.NamedNode(name,node)};PathIndex.prototype.maxPost=function(){var node=ChildrenNode_1.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_,ChildrenNode_1.MAX_NODE);return new Node_1.NamedNode(util_2.MAX_NAME,node)};PathIndex.prototype.toString=function(){return this.indexPath_.slice().join("/")};return PathIndex}(Index_1.Index);exports.PathIndex=PathIndex},{"../../util/util":68,"../ChildrenNode":37,"../Node":40,"../nodeFromJSON":48,"./Index":43,"@firebase/util":139}],46:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Index_1=require("./Index");var util_1=require("../../util/util");var Node_1=require("../Node");var LeafNode_1=require("../LeafNode");var nodeFromJSON;var MAX_NODE;function setNodeFromJSON(val){nodeFromJSON=val}exports.setNodeFromJSON=setNodeFromJSON;function setMaxNode(val){MAX_NODE=val}exports.setMaxNode=setMaxNode;var PriorityIndex=function(_super){__extends(PriorityIndex,_super);function PriorityIndex(){return _super!==null&&_super.apply(this,arguments)||this}PriorityIndex.prototype.compare=function(a,b){var aPriority=a.node.getPriority();var bPriority=b.node.getPriority();var indexCmp=aPriority.compareTo(bPriority);if(indexCmp===0){return util_1.nameCompare(a.name,b.name)}else{return indexCmp}};PriorityIndex.prototype.isDefinedOn=function(node){return!node.getPriority().isEmpty()};PriorityIndex.prototype.indexedValueChanged=function(oldNode,newNode){return!oldNode.getPriority().equals(newNode.getPriority())};PriorityIndex.prototype.minPost=function(){return Node_1.NamedNode.MIN};PriorityIndex.prototype.maxPost=function(){return new Node_1.NamedNode(util_1.MAX_NAME,new LeafNode_1.LeafNode("[PRIORITY-POST]",MAX_NODE))};PriorityIndex.prototype.makePost=function(indexValue,name){var priorityNode=nodeFromJSON(indexValue);return new Node_1.NamedNode(name,new LeafNode_1.LeafNode("[PRIORITY-POST]",priorityNode))};PriorityIndex.prototype.toString=function(){return".priority"};return PriorityIndex}(Index_1.Index);exports.PriorityIndex=PriorityIndex;exports.PRIORITY_INDEX=new PriorityIndex},{"../../util/util":68,"../LeafNode":39,"../Node":40,"./Index":43}],47:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var Index_1=require("./Index");var Node_1=require("../Node");var util_1=require("../../util/util");var nodeFromJSON_1=require("../nodeFromJSON");var ValueIndex=function(_super){__extends(ValueIndex,_super);function ValueIndex(){return _super!==null&&_super.apply(this,arguments)||this}ValueIndex.prototype.compare=function(a,b){var indexCmp=a.node.compareTo(b.node);if(indexCmp===0){return util_1.nameCompare(a.name,b.name)}else{return indexCmp}};ValueIndex.prototype.isDefinedOn=function(node){return true};ValueIndex.prototype.indexedValueChanged=function(oldNode,newNode){return!oldNode.equals(newNode)};ValueIndex.prototype.minPost=function(){return Node_1.NamedNode.MIN};ValueIndex.prototype.maxPost=function(){return Node_1.NamedNode.MAX};ValueIndex.prototype.makePost=function(indexValue,name){var valueNode=nodeFromJSON_1.nodeFromJSON(indexValue);
return new Node_1.NamedNode(name,valueNode)};ValueIndex.prototype.toString=function(){return".value"};return ValueIndex}(Index_1.Index);exports.ValueIndex=ValueIndex;exports.VALUE_INDEX=new ValueIndex},{"../../util/util":68,"../Node":40,"../nodeFromJSON":48,"./Index":43}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ChildrenNode_1=require("./ChildrenNode");var LeafNode_1=require("./LeafNode");var Node_1=require("./Node");var util_1=require("@firebase/util");var util_2=require("@firebase/util");var childSet_1=require("./childSet");var comparators_1=require("./comparators");var IndexMap_1=require("./IndexMap");var PriorityIndex_1=require("./indexes/PriorityIndex");var USE_HINZE=true;function nodeFromJSON(json,priority){if(priority===void 0){priority=null}if(json===null){return ChildrenNode_1.ChildrenNode.EMPTY_NODE}if(typeof json==="object"&&".priority"in json){priority=json[".priority"]}util_2.assert(priority===null||typeof priority==="string"||typeof priority==="number"||typeof priority==="object"&&".sv"in priority,"Invalid priority type found: "+typeof priority);if(typeof json==="object"&&".value"in json&&json[".value"]!==null){json=json[".value"]}if(typeof json!=="object"||".sv"in json){var jsonLeaf=json;return new LeafNode_1.LeafNode(jsonLeaf,nodeFromJSON(priority))}if(!(json instanceof Array)&&USE_HINZE){var children_1=[];var childrenHavePriority_1=false;var hinzeJsonObj_1=json;util_1.forEach(hinzeJsonObj_1,function(key,child){if(typeof key!=="string"||key.substring(0,1)!=="."){var childNode=nodeFromJSON(hinzeJsonObj_1[key]);if(!childNode.isEmpty()){childrenHavePriority_1=childrenHavePriority_1||!childNode.getPriority().isEmpty();children_1.push(new Node_1.NamedNode(key,childNode))}}});if(children_1.length==0){return ChildrenNode_1.ChildrenNode.EMPTY_NODE}var childSet=childSet_1.buildChildSet(children_1,comparators_1.NAME_ONLY_COMPARATOR,function(namedNode){return namedNode.name},comparators_1.NAME_COMPARATOR);if(childrenHavePriority_1){var sortedChildSet=childSet_1.buildChildSet(children_1,PriorityIndex_1.PRIORITY_INDEX.getCompare());return new ChildrenNode_1.ChildrenNode(childSet,nodeFromJSON(priority),new IndexMap_1.IndexMap({".priority":sortedChildSet},{".priority":PriorityIndex_1.PRIORITY_INDEX}))}else{return new ChildrenNode_1.ChildrenNode(childSet,nodeFromJSON(priority),IndexMap_1.IndexMap.Default)}}else{var node_1=ChildrenNode_1.ChildrenNode.EMPTY_NODE;var jsonObj_1=json;util_1.forEach(jsonObj_1,function(key,childData){if(util_1.contains(jsonObj_1,key)){if(key.substring(0,1)!=="."){var childNode=nodeFromJSON(childData);if(childNode.isLeafNode()||!childNode.isEmpty())node_1=node_1.updateImmediateChild(key,childNode)}}});return node_1.updatePriority(nodeFromJSON(priority))}}exports.nodeFromJSON=nodeFromJSON;PriorityIndex_1.setNodeFromJSON(nodeFromJSON)},{"./ChildrenNode":37,"./IndexMap":38,"./LeafNode":39,"./Node":40,"./childSet":41,"./comparators":42,"./indexes/PriorityIndex":46,"@firebase/util":139}],49:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../util/util");var util_3=require("@firebase/util");var MAX_NODE;function setMaxNode(val){MAX_NODE=val}exports.setMaxNode=setMaxNode;exports.priorityHashText=function(priority){if(typeof priority==="number")return"number:"+util_2.doubleToIEEE754String(priority);else return"string:"+priority};exports.validatePriorityNode=function(priorityNode){if(priorityNode.isLeafNode()){var val=priorityNode.val();util_1.assert(typeof val==="string"||typeof val==="number"||typeof val==="object"&&util_3.contains(val,".sv"),"Priority must be a string or number.")}else{util_1.assert(priorityNode===MAX_NODE||priorityNode.isEmpty(),"priority of unexpected type.")}util_1.assert(priorityNode===MAX_NODE||priorityNode.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")}},{"../util/util":68,"@firebase/util":139}],50:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("@firebase/util");var StatsCollection=function(){function StatsCollection(){this.counters_={}}StatsCollection.prototype.incrementCounter=function(name,amount){if(amount===void 0){amount=1}if(!util_2.contains(this.counters_,name))this.counters_[name]=0;this.counters_[name]+=amount};StatsCollection.prototype.get=function(){return util_1.deepCopy(this.counters_)};return StatsCollection}();exports.StatsCollection=StatsCollection},{"@firebase/util":139}],51:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var StatsListener=function(){function StatsListener(collection_){this.collection_=collection_;this.last_=null}StatsListener.prototype.get=function(){var newStats=this.collection_.get();var delta=util_1.clone(newStats);if(this.last_){util_1.forEach(this.last_,function(stat,value){delta[stat]=delta[stat]-value})}this.last_=newStats;return delta};return StatsListener}();exports.StatsListener=StatsListener},{"@firebase/util":139}],52:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var StatsCollection_1=require("./StatsCollection");var StatsManager=function(){function StatsManager(){}StatsManager.getCollection=function(repoInfo){var hashString=repoInfo.toString();if(!this.collections_[hashString]){this.collections_[hashString]=new StatsCollection_1.StatsCollection}return this.collections_[hashString]};StatsManager.getOrCreateReporter=function(repoInfo,creatorFunction){var hashString=repoInfo.toString();if(!this.reporters_[hashString]){this.reporters_[hashString]=creatorFunction()}return this.reporters_[hashString]};StatsManager.collections_={};StatsManager.reporters_={};return StatsManager}();exports.StatsManager=StatsManager},{"./StatsCollection":50}],53:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../util/util");var StatsListener_1=require("./StatsListener");var FIRST_STATS_MIN_TIME=10*1e3;var FIRST_STATS_MAX_TIME=30*1e3;var REPORT_STATS_INTERVAL=5*60*1e3;var StatsReporter=function(){function StatsReporter(collection,server_){this.server_=server_;this.statsToReport_={};this.statsListener_=new StatsListener_1.StatsListener(collection);var timeout=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();util_2.setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(timeout))}StatsReporter.prototype.includeStat=function(stat){this.statsToReport_[stat]=true};StatsReporter.prototype.reportStats_=function(){var _this=this;var stats=this.statsListener_.get();var reportedStats={};var haveStatsToReport=false;util_1.forEach(stats,function(stat,value){if(value>0&&util_1.contains(_this.statsToReport_,stat)){reportedStats[stat]=value;haveStatsToReport=true}});if(haveStatsToReport){this.server_.reportStats(reportedStats)}util_2.setTimeoutNonBlocking(this.reportStats_.bind(this),Math.floor(Math.random()*2*REPORT_STATS_INTERVAL))};return StatsReporter}();exports.StatsReporter=StatsReporter},{"../util/util":68,"./StatsListener":51,"@firebase/util":139}],54:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var DOMStorageWrapper=function(){function DOMStorageWrapper(domStorage_){this.domStorage_=domStorage_;this.prefix_="firebase:"}DOMStorageWrapper.prototype.set=function(key,value){if(value==null){this.domStorage_.removeItem(this.prefixedName_(key))}else{this.domStorage_.setItem(this.prefixedName_(key),util_1.stringify(value))}};DOMStorageWrapper.prototype.get=function(key){var storedVal=this.domStorage_.getItem(this.prefixedName_(key));if(storedVal==null){return null}else{return util_1.jsonEval(storedVal)}};DOMStorageWrapper.prototype.remove=function(key){this.domStorage_.removeItem(this.prefixedName_(key))};DOMStorageWrapper.prototype.prefixedName_=function(name){return this.prefix_+name};DOMStorageWrapper.prototype.toString=function(){return this.domStorage_.toString()};return DOMStorageWrapper}();exports.DOMStorageWrapper=DOMStorageWrapper},{"@firebase/util":139}],55:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var MemoryStorage=function(){function MemoryStorage(){this.cache_={};this.isInMemoryStorage=true}MemoryStorage.prototype.set=function(key,value){if(value==null){delete this.cache_[key]}else{this.cache_[key]=value}};MemoryStorage.prototype.get=function(key){if(util_1.contains(this.cache_,key)){return this.cache_[key]}return null};MemoryStorage.prototype.remove=function(key){delete this.cache_[key]};return MemoryStorage}();exports.MemoryStorage=MemoryStorage},{"@firebase/util":139}],56:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DOMStorageWrapper_1=require("./DOMStorageWrapper");var MemoryStorage_1=require("./MemoryStorage");var createStoragefor=function(domStorageName){try{if(typeof window!=="undefined"&&typeof window[domStorageName]!=="undefined"){var domStorage=window[domStorageName];domStorage.setItem("firebase:sentinel","cache");domStorage.removeItem("firebase:sentinel");return new DOMStorageWrapper_1.DOMStorageWrapper(domStorage)}}catch(e){}return new MemoryStorage_1.MemoryStorage};exports.PersistentStorage=createStoragefor("localStorage");exports.SessionStorage=createStoragefor("sessionStorage")},{"./DOMStorageWrapper":54,"./MemoryStorage":55}],57:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var CountedSet=function(){function CountedSet(){this.set={}}CountedSet.prototype.add=function(item,val){this.set[item]=val!==null?val:true};CountedSet.prototype.contains=function(key){return util_1.contains(this.set,key)};CountedSet.prototype.get=function(item){return this.contains(item)?this.set[item]:undefined};CountedSet.prototype.remove=function(item){delete this.set[item]};CountedSet.prototype.clear=function(){this.set={}};CountedSet.prototype.isEmpty=function(){return util_1.isEmpty(this.set)};CountedSet.prototype.count=function(){return util_1.getCount(this.set)};CountedSet.prototype.each=function(fn){util_1.forEach(this.set,function(k,v){return fn(k,v)})};CountedSet.prototype.keys=function(){var keys=[];util_1.forEach(this.set,function(k){keys.push(k)});return keys};return CountedSet}();exports.CountedSet=CountedSet},{"@firebase/util":139}],58:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var EventEmitter=function(){function EventEmitter(allowedEvents_){this.allowedEvents_=allowedEvents_;this.listeners_={};util_1.assert(Array.isArray(allowedEvents_)&&allowedEvents_.length>0,"Requires a non-empty array")}EventEmitter.prototype.trigger=function(eventType){var var_args=[];for(var _i=1;_i<arguments.length;_i++){var_args[_i-1]=arguments[_i]}if(Array.isArray(this.listeners_[eventType])){var listeners=this.listeners_[eventType].slice();for(var i=0;i<listeners.length;i++){listeners[i].callback.apply(listeners[i].context,var_args)}}};EventEmitter.prototype.on=function(eventType,callback,context){this.validateEventType_(eventType);this.listeners_[eventType]=this.listeners_[eventType]||[];this.listeners_[eventType].push({callback:callback,context:context});var eventData=this.getInitialEvent(eventType);if(eventData){callback.apply(context,eventData)}};EventEmitter.prototype.off=function(eventType,callback,context){this.validateEventType_(eventType);var listeners=this.listeners_[eventType]||[];for(var i=0;i<listeners.length;i++){if(listeners[i].callback===callback&&(!context||context===listeners[i].context)){listeners.splice(i,1);return}}};EventEmitter.prototype.validateEventType_=function(eventType){util_1.assert(this.allowedEvents_.find(function(et){return et===eventType}),"Unknown event: "+eventType)};return EventEmitter}();exports.EventEmitter=EventEmitter},{"@firebase/util":139}],59:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SortedMap_1=require("./SortedMap");var Path_1=require("./Path");var util_1=require("./util");var util_2=require("@firebase/util");var emptyChildrenSingleton;var EmptyChildren=function(){if(!emptyChildrenSingleton){emptyChildrenSingleton=new SortedMap_1.SortedMap(util_1.stringCompare)}return emptyChildrenSingleton};var ImmutableTree=function(){function ImmutableTree(value,children){if(children===void 0){children=EmptyChildren()}this.value=value;this.children=children}ImmutableTree.fromObject=function(obj){var tree=ImmutableTree.Empty;util_2.forEach(obj,function(childPath,childSnap){tree=tree.set(new Path_1.Path(childPath),childSnap)});return tree};ImmutableTree.prototype.isEmpty=function(){return this.value===null&&this.children.isEmpty()};ImmutableTree.prototype.findRootMostMatchingPathAndValue=function(relativePath,predicate){if(this.value!=null&&predicate(this.value)){return{path:Path_1.Path.Empty,value:this.value}}else{if(relativePath.isEmpty()){return null}else{var front=relativePath.getFront();var child=this.children.get(front);if(child!==null){var childExistingPathAndValue=child.findRootMostMatchingPathAndValue(relativePath.popFront(),predicate);if(childExistingPathAndValue!=null){var fullPath=new Path_1.Path(front).child(childExistingPathAndValue.path);return{path:fullPath,value:childExistingPathAndValue.value}}else{return null}}else{return null}}}};ImmutableTree.prototype.findRootMostValueAndPath=function(relativePath){return this.findRootMostMatchingPathAndValue(relativePath,function(){return true})};ImmutableTree.prototype.subtree=function(relativePath){if(relativePath.isEmpty()){return this}else{var front=relativePath.getFront();var childTree=this.children.get(front);if(childTree!==null){return childTree.subtree(relativePath.popFront())}else{return ImmutableTree.Empty}}};ImmutableTree.prototype.set=function(relativePath,toSet){if(relativePath.isEmpty()){return new ImmutableTree(toSet,this.children)}else{var front=relativePath.getFront();var child=this.children.get(front)||ImmutableTree.Empty;var newChild=child.set(relativePath.popFront(),toSet);var newChildren=this.children.insert(front,newChild);return new ImmutableTree(this.value,newChildren)}};ImmutableTree.prototype.remove=function(relativePath){if(relativePath.isEmpty()){if(this.children.isEmpty()){return ImmutableTree.Empty}else{return new ImmutableTree(null,this.children)}}else{var front=relativePath.getFront();var child=this.children.get(front);if(child){var newChild=child.remove(relativePath.popFront());var newChildren=void 0;if(newChild.isEmpty()){newChildren=this.children.remove(front)}else{newChildren=this.children.insert(front,newChild)}if(this.value===null&&newChildren.isEmpty()){return ImmutableTree.Empty}else{return new ImmutableTree(this.value,newChildren)}}else{return this}}};ImmutableTree.prototype.get=function(relativePath){if(relativePath.isEmpty()){return this.value}else{var front=relativePath.getFront();var child=this.children.get(front);if(child){return child.get(relativePath.popFront())}else{return null}}};ImmutableTree.prototype.setTree=function(relativePath,newTree){if(relativePath.isEmpty()){return newTree}else{var front=relativePath.getFront();var child=this.children.get(front)||ImmutableTree.Empty;var newChild=child.setTree(relativePath.popFront(),newTree);var newChildren=void 0;if(newChild.isEmpty()){newChildren=this.children.remove(front)}else{newChildren=this.children.insert(front,newChild)}return new ImmutableTree(this.value,newChildren)}};ImmutableTree.prototype.fold=function(fn){return this.fold_(Path_1.Path.Empty,fn)};ImmutableTree.prototype.fold_=function(pathSoFar,fn){var accum={};this.children.inorderTraversal(function(childKey,childTree){accum[childKey]=childTree.fold_(pathSoFar.child(childKey),fn)});return fn(pathSoFar,this.value,accum)};ImmutableTree.prototype.findOnPath=function(path,f){return this.findOnPath_(path,Path_1.Path.Empty,f)};ImmutableTree.prototype.findOnPath_=function(pathToFollow,pathSoFar,f){var result=this.value?f(pathSoFar,this.value):false;if(result){return result}else{if(pathToFollow.isEmpty()){return null}else{var front=pathToFollow.getFront();var nextChild=this.children.get(front);if(nextChild){return nextChild.findOnPath_(pathToFollow.popFront(),pathSoFar.child(front),f)}else{return null}}}};ImmutableTree.prototype.foreachOnPath=function(path,f){return this.foreachOnPath_(path,Path_1.Path.Empty,f)};ImmutableTree.prototype.foreachOnPath_=function(pathToFollow,currentRelativePath,f){if(pathToFollow.isEmpty()){return this}else{if(this.value){f(currentRelativePath,this.value)}var front=pathToFollow.getFront();var nextChild=this.children.get(front);if(nextChild){return nextChild.foreachOnPath_(pathToFollow.popFront(),currentRelativePath.child(front),f)}else{return ImmutableTree.Empty}}};ImmutableTree.prototype.foreach=function(f){this.foreach_(Path_1.Path.Empty,f)};ImmutableTree.prototype.foreach_=function(currentRelativePath,f){this.children.inorderTraversal(function(childName,childTree){childTree.foreach_(currentRelativePath.child(childName),f)});if(this.value){f(currentRelativePath,this.value)}};ImmutableTree.prototype.foreachChild=function(f){this.children.inorderTraversal(function(childName,childTree){if(childTree.value){f(childName,childTree.value)}})};ImmutableTree.Empty=new ImmutableTree(null);return ImmutableTree}();exports.ImmutableTree=ImmutableTree},{"./Path":62,"./SortedMap":64,"./util":68,"@firebase/util":139}],60:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");exports.nextPushId=function(){var PUSH_CHARS="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz";var lastPushTime=0;var lastRandChars=[];return function(now){var duplicateTime=now===lastPushTime;lastPushTime=now;var i;var timeStampChars=new Array(8);for(i=7;i>=0;i--){timeStampChars[i]=PUSH_CHARS.charAt(now%64);now=Math.floor(now/64)}util_1.assert(now===0,"Cannot push at time == 0");var id=timeStampChars.join("");if(!duplicateTime){for(i=0;i<12;i++){lastRandChars[i]=Math.floor(Math.random()*64)}}else{for(i=11;i>=0&&lastRandChars[i]===63;i--){lastRandChars[i]=0}lastRandChars[i]++}for(i=0;i<12;i++){id+=PUSH_CHARS.charAt(lastRandChars[i])}util_1.assert(id.length===20,"nextPushId: Length should be 20.");return id}}()},{"@firebase/util":139}],61:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var EventEmitter_1=require("./EventEmitter");var util_2=require("@firebase/util");var OnlineMonitor=function(_super){__extends(OnlineMonitor,_super);function OnlineMonitor(){var _this=_super.call(this,["online"])||this;_this.online_=true;if(typeof window!=="undefined"&&typeof window.addEventListener!=="undefined"&&!util_2.isMobileCordova()){window.addEventListener("online",function(){if(!_this.online_){_this.online_=true;_this.trigger("online",true)}},false);window.addEventListener("offline",function(){if(_this.online_){_this.online_=false;_this.trigger("online",false)}},false)}return _this}OnlineMonitor.getInstance=function(){return new OnlineMonitor};OnlineMonitor.prototype.getInitialEvent=function(eventType){util_1.assert(eventType==="online","Unknown event type: "+eventType);return[this.online_]};OnlineMonitor.prototype.currentlyOnline=function(){return this.online_};return OnlineMonitor}(EventEmitter_1.EventEmitter);exports.OnlineMonitor=OnlineMonitor},{"./EventEmitter":58,"@firebase/util":139}],62:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("./util");var util_2=require("@firebase/util");var Path=function(){function Path(pathOrString,pieceNum){if(pieceNum===void 0){this.pieces_=pathOrString.split("/");var copyTo=0;for(var i=0;i<this.pieces_.length;i++){if(this.pieces_[i].length>0){this.pieces_[copyTo]=this.pieces_[i];copyTo++}}this.pieces_.length=copyTo;this.pieceNum_=0}else{this.pieces_=pathOrString;this.pieceNum_=pieceNum}}Object.defineProperty(Path,"Empty",{get:function(){return new Path("")},enumerable:true,configurable:true});Path.prototype.getFront=function(){if(this.pieceNum_>=this.pieces_.length)return null;return this.pieces_[this.pieceNum_]};Path.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_};Path.prototype.popFront=function(){var pieceNum=this.pieceNum_;if(pieceNum<this.pieces_.length){pieceNum++}return new Path(this.pieces_,pieceNum)};Path.prototype.getBack=function(){if(this.pieceNum_<this.pieces_.length)return this.pieces_[this.pieces_.length-1];return null};Path.prototype.toString=function(){var pathString="";for(var i=this.pieceNum_;i<this.pieces_.length;i++){if(this.pieces_[i]!=="")pathString+="/"+this.pieces_[i]}return pathString||"/"};Path.prototype.toUrlEncodedString=function(){var pathString="";for(var i=this.pieceNum_;i<this.pieces_.length;i++){if(this.pieces_[i]!=="")pathString+="/"+encodeURIComponent(String(this.pieces_[i]))}return pathString||"/"};Path.prototype.slice=function(begin){if(begin===void 0){begin=0}return this.pieces_.slice(this.pieceNum_+begin)};Path.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;var pieces=[];for(var i=this.pieceNum_;i<this.pieces_.length-1;i++)pieces.push(this.pieces_[i]);return new Path(pieces,0)};Path.prototype.child=function(childPathObj){var pieces=[];for(var i=this.pieceNum_;i<this.pieces_.length;i++)pieces.push(this.pieces_[i]);if(childPathObj instanceof Path){for(var i=childPathObj.pieceNum_;i<childPathObj.pieces_.length;i++){pieces.push(childPathObj.pieces_[i])}}else{var childPieces=childPathObj.split("/");for(var i=0;i<childPieces.length;i++){if(childPieces[i].length>0)pieces.push(childPieces[i])}}return new Path(pieces,0)};Path.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length};Path.relativePath=function(outerPath,innerPath){var outer=outerPath.getFront(),inner=innerPath.getFront();if(outer===null){return innerPath}else if(outer===inner){return Path.relativePath(outerPath.popFront(),innerPath.popFront())}else{throw new Error("INTERNAL ERROR: innerPath ("+innerPath+") is not within "+"outerPath ("+outerPath+")")}};Path.comparePaths=function(left,right){var leftKeys=left.slice();var rightKeys=right.slice();for(var i=0;i<leftKeys.length&&i<rightKeys.length;i++){var cmp=util_1.nameCompare(leftKeys[i],rightKeys[i]);if(cmp!==0)return cmp}if(leftKeys.length===rightKeys.length)return 0;return leftKeys.length<rightKeys.length?-1:1};Path.prototype.equals=function(other){if(this.getLength()!==other.getLength()){return false}for(var i=this.pieceNum_,j=other.pieceNum_;i<=this.pieces_.length;i++,j++){if(this.pieces_[i]!==other.pieces_[j]){return false}}return true};Path.prototype.contains=function(other){var i=this.pieceNum_;var j=other.pieceNum_;if(this.getLength()>other.getLength()){return false}while(i<this.pieces_.length){if(this.pieces_[i]!==other.pieces_[j]){return false}++i;++j}return true};return Path}();exports.Path=Path;var ValidationPath=function(){function ValidationPath(path,errorPrefix_){this.errorPrefix_=errorPrefix_;this.parts_=path.slice();this.byteLength_=Math.max(1,this.parts_.length);for(var i=0;i<this.parts_.length;i++){this.byteLength_+=util_2.stringLength(this.parts_[i])}this.checkValid_()}Object.defineProperty(ValidationPath,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:true,configurable:true});Object.defineProperty(ValidationPath,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:true,configurable:true});ValidationPath.prototype.push=function(child){if(this.parts_.length>0){this.byteLength_+=1}this.parts_.push(child);this.byteLength_+=util_2.stringLength(child);this.checkValid_()};ValidationPath.prototype.pop=function(){var last=this.parts_.pop();this.byteLength_-=util_2.stringLength(last);if(this.parts_.length>0){this.byteLength_-=1}};ValidationPath.prototype.checkValid_=function(){if(this.byteLength_>ValidationPath.MAX_PATH_LENGTH_BYTES){throw new Error(this.errorPrefix_+"has a key path longer than "+ValidationPath.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").")}if(this.parts_.length>ValidationPath.MAX_PATH_DEPTH){throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+ValidationPath.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())}};ValidationPath.prototype.toErrorString=function(){if(this.parts_.length==0){return""}return"in property '"+this.parts_.join(".")+"'"};return ValidationPath}();exports.ValidationPath=ValidationPath},{"./util":68,"@firebase/util":139}],63:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Path_1=require("./Path");var SparseSnapshotTree_1=require("../SparseSnapshotTree");var LeafNode_1=require("../snap/LeafNode");var nodeFromJSON_1=require("../snap/nodeFromJSON");var PriorityIndex_1=require("../snap/indexes/PriorityIndex");exports.generateWithValues=function(values){values=values||{};values["timestamp"]=values["timestamp"]||(new Date).getTime();return values};exports.resolveDeferredValue=function(value,serverValues){if(!value||typeof value!=="object"){return value}else{util_1.assert(".sv"in value,"Unexpected leaf node or priority contents");return serverValues[value[".sv"]]}};exports.resolveDeferredValueTree=function(tree,serverValues){var resolvedTree=new SparseSnapshotTree_1.SparseSnapshotTree;tree.forEachTree(new Path_1.Path(""),function(path,node){resolvedTree.remember(path,exports.resolveDeferredValueSnapshot(node,serverValues))});return resolvedTree};exports.resolveDeferredValueSnapshot=function(node,serverValues){var rawPri=node.getPriority().val();var priority=exports.resolveDeferredValue(rawPri,serverValues);var newNode;if(node.isLeafNode()){var leafNode=node;var value=exports.resolveDeferredValue(leafNode.getValue(),serverValues);if(value!==leafNode.getValue()||priority!==leafNode.getPriority().val()){return new LeafNode_1.LeafNode(value,nodeFromJSON_1.nodeFromJSON(priority))}else{return node}}else{var childrenNode=node;newNode=childrenNode;if(priority!==childrenNode.getPriority().val()){newNode=newNode.updatePriority(new LeafNode_1.LeafNode(priority))}childrenNode.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(childName,childNode){var newChildNode=exports.resolveDeferredValueSnapshot(childNode,serverValues);if(newChildNode!==childNode){newNode=newNode.updateImmediateChild(childName,newChildNode)}});return newNode}}},{"../SparseSnapshotTree":28,"../snap/LeafNode":39,"../snap/indexes/PriorityIndex":46,"../snap/nodeFromJSON":48,"./Path":62,"@firebase/util":139}],64:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SortedMapIterator=function(){function SortedMapIterator(node,startKey,comparator,isReverse_,resultGenerator_){if(resultGenerator_===void 0){resultGenerator_=null}this.isReverse_=isReverse_;this.resultGenerator_=resultGenerator_;this.nodeStack_=[];var cmp=1;while(!node.isEmpty()){node=node;cmp=startKey?comparator(node.key,startKey):1;if(isReverse_)cmp*=-1;if(cmp<0){if(this.isReverse_){node=node.left}else{node=node.right}}else if(cmp===0){this.nodeStack_.push(node);break}else{this.nodeStack_.push(node);if(this.isReverse_){node=node.right}else{node=node.left}}}}SortedMapIterator.prototype.getNext=function(){if(this.nodeStack_.length===0)return null;var node=this.nodeStack_.pop();var result;if(this.resultGenerator_)result=this.resultGenerator_(node.key,node.value);else result={key:node.key,value:node.value};if(this.isReverse_){node=node.left;while(!node.isEmpty()){this.nodeStack_.push(node);node=node.right}}else{node=node.right;while(!node.isEmpty()){this.nodeStack_.push(node);node=node.left}}return result};SortedMapIterator.prototype.hasNext=function(){return this.nodeStack_.length>0};SortedMapIterator.prototype.peek=function(){if(this.nodeStack_.length===0)return null;var node=this.nodeStack_[this.nodeStack_.length-1];if(this.resultGenerator_){return this.resultGenerator_(node.key,node.value)}else{return{key:node.key,value:node.value}}};return SortedMapIterator}();exports.SortedMapIterator=SortedMapIterator;var LLRBNode=function(){function LLRBNode(key,value,color,left,right){this.key=key;this.value=value;this.color=color!=null?color:LLRBNode.RED;this.left=left!=null?left:SortedMap.EMPTY_NODE;this.right=right!=null?right:SortedMap.EMPTY_NODE}LLRBNode.prototype.copy=function(key,value,color,left,right){return new LLRBNode(key!=null?key:this.key,value!=null?value:this.value,color!=null?color:this.color,left!=null?left:this.left,right!=null?right:this.right)};LLRBNode.prototype.count=function(){return this.left.count()+1+this.right.count()};LLRBNode.prototype.isEmpty=function(){return false};LLRBNode.prototype.inorderTraversal=function(action){return this.left.inorderTraversal(action)||action(this.key,this.value)||this.right.inorderTraversal(action)};LLRBNode.prototype.reverseTraversal=function(action){return this.right.reverseTraversal(action)||action(this.key,this.value)||this.left.reverseTraversal(action)};LLRBNode.prototype.min_=function(){if(this.left.isEmpty()){return this}else{return this.left.min_()}};LLRBNode.prototype.minKey=function(){return this.min_().key};LLRBNode.prototype.maxKey=function(){if(this.right.isEmpty()){return this.key}else{return this.right.maxKey()}};LLRBNode.prototype.insert=function(key,value,comparator){var cmp,n;n=this;cmp=comparator(key,n.key);if(cmp<0){n=n.copy(null,null,null,n.left.insert(key,value,comparator),null)}else if(cmp===0){n=n.copy(null,value,null,null,null)}else{n=n.copy(null,null,null,null,n.right.insert(key,value,comparator))}return n.fixUp_()};LLRBNode.prototype.removeMin_=function(){if(this.left.isEmpty()){return SortedMap.EMPTY_NODE}var n=this;if(!n.left.isRed_()&&!n.left.left.isRed_())n=n.moveRedLeft_();n=n.copy(null,null,null,n.left.removeMin_(),null);return n.fixUp_()};LLRBNode.prototype.remove=function(key,comparator){var n,smallest;n=this;if(comparator(key,n.key)<0){if(!n.left.isEmpty()&&!n.left.isRed_()&&!n.left.left.isRed_()){n=n.moveRedLeft_()}n=n.copy(null,null,null,n.left.remove(key,comparator),null)}else{if(n.left.isRed_())n=n.rotateRight_();if(!n.right.isEmpty()&&!n.right.isRed_()&&!n.right.left.isRed_()){n=n.moveRedRight_()}if(comparator(key,n.key)===0){if(n.right.isEmpty()){return SortedMap.EMPTY_NODE}else{smallest=n.right.min_();n=n.copy(smallest.key,smallest.value,null,null,n.right.removeMin_())}}n=n.copy(null,null,null,null,n.right.remove(key,comparator))}return n.fixUp_()};LLRBNode.prototype.isRed_=function(){return this.color};LLRBNode.prototype.fixUp_=function(){var n=this;if(n.right.isRed_()&&!n.left.isRed_())n=n.rotateLeft_();if(n.left.isRed_()&&n.left.left.isRed_())n=n.rotateRight_();if(n.left.isRed_()&&n.right.isRed_())n=n.colorFlip_();return n};LLRBNode.prototype.moveRedLeft_=function(){var n=this.colorFlip_();if(n.right.left.isRed_()){n=n.copy(null,null,null,null,n.right.rotateRight_());n=n.rotateLeft_();n=n.colorFlip_()}return n};LLRBNode.prototype.moveRedRight_=function(){var n=this.colorFlip_();if(n.left.left.isRed_()){n=n.rotateRight_();n=n.colorFlip_()}return n};LLRBNode.prototype.rotateLeft_=function(){
var nl=this.copy(null,null,LLRBNode.RED,null,this.right.left);return this.right.copy(null,null,this.color,nl,null)};LLRBNode.prototype.rotateRight_=function(){var nr=this.copy(null,null,LLRBNode.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,nr)};LLRBNode.prototype.colorFlip_=function(){var left=this.left.copy(null,null,!this.left.color,null,null);var right=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,left,right)};LLRBNode.prototype.checkMaxDepth_=function(){var blackDepth=this.check_();return Math.pow(2,blackDepth)<=this.count()+1};LLRBNode.prototype.check_=function(){var blackDepth;if(this.isRed_()&&this.left.isRed_()){throw new Error("Red node has red child("+this.key+","+this.value+")")}if(this.right.isRed_()){throw new Error("Right child of ("+this.key+","+this.value+") is red")}blackDepth=this.left.check_();if(blackDepth!==this.right.check_()){throw new Error("Black depths differ")}else{return blackDepth+(this.isRed_()?0:1)}};LLRBNode.RED=true;LLRBNode.BLACK=false;return LLRBNode}();exports.LLRBNode=LLRBNode;var LLRBEmptyNode=function(){function LLRBEmptyNode(){}LLRBEmptyNode.prototype.copy=function(key,value,color,left,right){return this};LLRBEmptyNode.prototype.insert=function(key,value,comparator){return new LLRBNode(key,value,null)};LLRBEmptyNode.prototype.remove=function(key,comparator){return this};LLRBEmptyNode.prototype.count=function(){return 0};LLRBEmptyNode.prototype.isEmpty=function(){return true};LLRBEmptyNode.prototype.inorderTraversal=function(action){return false};LLRBEmptyNode.prototype.reverseTraversal=function(action){return false};LLRBEmptyNode.prototype.minKey=function(){return null};LLRBEmptyNode.prototype.maxKey=function(){return null};LLRBEmptyNode.prototype.check_=function(){return 0};LLRBEmptyNode.prototype.isRed_=function(){return false};return LLRBEmptyNode}();exports.LLRBEmptyNode=LLRBEmptyNode;var SortedMap=function(){function SortedMap(comparator_,root_){if(root_===void 0){root_=SortedMap.EMPTY_NODE}this.comparator_=comparator_;this.root_=root_}SortedMap.prototype.insert=function(key,value){return new SortedMap(this.comparator_,this.root_.insert(key,value,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))};SortedMap.prototype.remove=function(key){return new SortedMap(this.comparator_,this.root_.remove(key,this.comparator_).copy(null,null,LLRBNode.BLACK,null,null))};SortedMap.prototype.get=function(key){var cmp;var node=this.root_;while(!node.isEmpty()){cmp=this.comparator_(key,node.key);if(cmp===0){return node.value}else if(cmp<0){node=node.left}else if(cmp>0){node=node.right}}return null};SortedMap.prototype.getPredecessorKey=function(key){var cmp,node=this.root_,rightParent=null;while(!node.isEmpty()){cmp=this.comparator_(key,node.key);if(cmp===0){if(!node.left.isEmpty()){node=node.left;while(!node.right.isEmpty())node=node.right;return node.key}else if(rightParent){return rightParent.key}else{return null}}else if(cmp<0){node=node.left}else if(cmp>0){rightParent=node;node=node.right}}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")};SortedMap.prototype.isEmpty=function(){return this.root_.isEmpty()};SortedMap.prototype.count=function(){return this.root_.count()};SortedMap.prototype.minKey=function(){return this.root_.minKey()};SortedMap.prototype.maxKey=function(){return this.root_.maxKey()};SortedMap.prototype.inorderTraversal=function(action){return this.root_.inorderTraversal(action)};SortedMap.prototype.reverseTraversal=function(action){return this.root_.reverseTraversal(action)};SortedMap.prototype.getIterator=function(resultGenerator){return new SortedMapIterator(this.root_,null,this.comparator_,false,resultGenerator)};SortedMap.prototype.getIteratorFrom=function(key,resultGenerator){return new SortedMapIterator(this.root_,key,this.comparator_,false,resultGenerator)};SortedMap.prototype.getReverseIteratorFrom=function(key,resultGenerator){return new SortedMapIterator(this.root_,key,this.comparator_,true,resultGenerator)};SortedMap.prototype.getReverseIterator=function(resultGenerator){return new SortedMapIterator(this.root_,null,this.comparator_,true,resultGenerator)};SortedMap.EMPTY_NODE=new LLRBEmptyNode;return SortedMap}();exports.SortedMap=SortedMap},{}],65:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Path_1=require("./Path");var util_2=require("@firebase/util");var TreeNode=function(){function TreeNode(){this.children={};this.childCount=0;this.value=null}return TreeNode}();exports.TreeNode=TreeNode;var Tree=function(){function Tree(name_,parent_,node_){if(name_===void 0){name_=""}if(parent_===void 0){parent_=null}if(node_===void 0){node_=new TreeNode}this.name_=name_;this.parent_=parent_;this.node_=node_}Tree.prototype.subTree=function(pathObj){var path=pathObj instanceof Path_1.Path?pathObj:new Path_1.Path(pathObj);var child=this,next;while((next=path.getFront())!==null){var childNode=util_2.safeGet(child.node_.children,next)||new TreeNode;child=new Tree(next,child,childNode);path=path.popFront()}return child};Tree.prototype.getValue=function(){return this.node_.value};Tree.prototype.setValue=function(value){util_1.assert(typeof value!=="undefined","Cannot set value to undefined");this.node_.value=value;this.updateParents_()};Tree.prototype.clear=function(){this.node_.value=null;this.node_.children={};this.node_.childCount=0;this.updateParents_()};Tree.prototype.hasChildren=function(){return this.node_.childCount>0};Tree.prototype.isEmpty=function(){return this.getValue()===null&&!this.hasChildren()};Tree.prototype.forEachChild=function(action){var _this=this;util_2.forEach(this.node_.children,function(child,childTree){action(new Tree(child,_this,childTree))})};Tree.prototype.forEachDescendant=function(action,includeSelf,childrenFirst){if(includeSelf&&!childrenFirst)action(this);this.forEachChild(function(child){child.forEachDescendant(action,true,childrenFirst)});if(includeSelf&&childrenFirst)action(this)};Tree.prototype.forEachAncestor=function(action,includeSelf){var node=includeSelf?this:this.parent();while(node!==null){if(action(node)){return true}node=node.parent()}return false};Tree.prototype.forEachImmediateDescendantWithValue=function(action){this.forEachChild(function(child){if(child.getValue()!==null)action(child);else child.forEachImmediateDescendantWithValue(action)})};Tree.prototype.path=function(){return new Path_1.Path(this.parent_===null?this.name_:this.parent_.path()+"/"+this.name_)};Tree.prototype.name=function(){return this.name_};Tree.prototype.parent=function(){return this.parent_};Tree.prototype.updateParents_=function(){if(this.parent_!==null)this.parent_.updateChild_(this.name_,this)};Tree.prototype.updateChild_=function(childName,child){var childEmpty=child.isEmpty();var childExists=util_2.contains(this.node_.children,childName);if(childEmpty&&childExists){delete this.node_.children[childName];this.node_.childCount--;this.updateParents_()}else if(!childEmpty&&!childExists){this.node_.children[childName]=child.node_;this.node_.childCount++;this.updateParents_()}};return Tree}();exports.Tree=Tree},{"./Path":62,"@firebase/util":139}],66:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var EventEmitter_1=require("./EventEmitter");var util_1=require("@firebase/util");var VisibilityMonitor=function(_super){__extends(VisibilityMonitor,_super);function VisibilityMonitor(){var _this=_super.call(this,["visible"])||this;var hidden;var visibilityChange;if(typeof document!=="undefined"&&typeof document.addEventListener!=="undefined"){if(typeof document["hidden"]!=="undefined"){visibilityChange="visibilitychange";hidden="hidden"}else if(typeof document["mozHidden"]!=="undefined"){visibilityChange="mozvisibilitychange";hidden="mozHidden"}else if(typeof document["msHidden"]!=="undefined"){visibilityChange="msvisibilitychange";hidden="msHidden"}else if(typeof document["webkitHidden"]!=="undefined"){visibilityChange="webkitvisibilitychange";hidden="webkitHidden"}}_this.visible_=true;if(visibilityChange){document.addEventListener(visibilityChange,function(){var visible=!document[hidden];if(visible!==_this.visible_){_this.visible_=visible;_this.trigger("visible",visible)}},false)}return _this}VisibilityMonitor.getInstance=function(){return new VisibilityMonitor};VisibilityMonitor.prototype.getInitialEvent=function(eventType){util_1.assert(eventType==="visible","Unknown event type: "+eventType);return[this.visible_]};return VisibilityMonitor}(EventEmitter_1.EventEmitter);exports.VisibilityMonitor=VisibilityMonitor},{"./EventEmitter":58,"@firebase/util":139}],67:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Path_1=require("../Path");var RepoInfo_1=require("../../RepoInfo");var util_1=require("../util");function decodePath(pathString){var pathStringDecoded="";var pieces=pathString.split("/");for(var i=0;i<pieces.length;i++){if(pieces[i].length>0){var piece=pieces[i];try{piece=decodeURIComponent(piece.replace(/\+/g," "))}catch(e){}pathStringDecoded+="/"+piece}}return pathStringDecoded}exports.parseRepoInfo=function(dataURL){var parsedUrl=exports.parseURL(dataURL),namespace=parsedUrl.subdomain;if(parsedUrl.domain==="firebase"){util_1.fatal(parsedUrl.host+" is no longer supported. "+"Please use <YOUR FIREBASE>.firebaseio.com instead")}if(!namespace||namespace=="undefined"){util_1.fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com")}if(!parsedUrl.secure){util_1.warnIfPageIsSecure()}var webSocketOnly=parsedUrl.scheme==="ws"||parsedUrl.scheme==="wss";return{repoInfo:new RepoInfo_1.RepoInfo(parsedUrl.host,parsedUrl.secure,namespace,webSocketOnly),path:new Path_1.Path(parsedUrl.pathString)}};exports.parseURL=function(dataURL){var host="",domain="",subdomain="",pathString="";var secure=true,scheme="https",port=443;if(typeof dataURL==="string"){var colonInd=dataURL.indexOf("//");if(colonInd>=0){scheme=dataURL.substring(0,colonInd-1);dataURL=dataURL.substring(colonInd+2)}var slashInd=dataURL.indexOf("/");if(slashInd===-1){slashInd=dataURL.length}host=dataURL.substring(0,slashInd);pathString=decodePath(dataURL.substring(slashInd));var parts=host.split(".");if(parts.length===3){domain=parts[1];subdomain=parts[0].toLowerCase()}else if(parts.length===2){domain=parts[0]}colonInd=host.indexOf(":");if(colonInd>=0){secure=scheme==="https"||scheme==="wss";port=parseInt(host.substring(colonInd+1),10)}}return{host:host,port:port,domain:domain,subdomain:subdomain,secure:secure,scheme:scheme,pathString:pathString}}},{"../../RepoInfo":23,"../Path":62,"../util":68}],68:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("@firebase/util");var util_3=require("@firebase/util");var util_4=require("@firebase/util");var util_5=require("@firebase/util");var util_6=require("@firebase/util");var storage_1=require("../storage/storage");var util_7=require("@firebase/util");exports.LUIDGenerator=function(){var id=1;return function(){return id++}}();exports.sha1=function(str){var utf8Bytes=util_5.stringToByteArray(str);var sha1=new util_4.Sha1;sha1.update(utf8Bytes);var sha1Bytes=sha1.digest();return util_3.base64.encodeByteArray(sha1Bytes)};var buildLogMessage_=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}var message="";for(var i=0;i<var_args.length;i++){if(Array.isArray(var_args[i])||var_args[i]&&typeof var_args[i]==="object"&&typeof var_args[i].length==="number"){message+=buildLogMessage_.apply(null,var_args[i])}else if(typeof var_args[i]==="object"){message+=util_6.stringify(var_args[i])}else{message+=var_args[i]}message+=" "}return message};exports.logger=null;var firstLog_=true;exports.enableLogging=function(logger_,persistent){util_1.assert(!persistent||(logger_===true||logger_===false),"Can't turn on custom loggers persistently.");if(logger_===true){if(typeof console!=="undefined"){if(typeof console.log==="function"){exports.logger=console.log.bind(console)}else if(typeof console.log==="object"){exports.logger=function(message){console.log(message)}}}if(persistent)storage_1.SessionStorage.set("logging_enabled",true)}else if(typeof logger_==="function"){exports.logger=logger_}else{exports.logger=null;storage_1.SessionStorage.remove("logging_enabled")}};exports.log=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}if(firstLog_===true){firstLog_=false;if(exports.logger===null&&storage_1.SessionStorage.get("logging_enabled")===true)exports.enableLogging(true)}if(exports.logger){var message=buildLogMessage_.apply(null,var_args);exports.logger(message)}};exports.logWrapper=function(prefix){return function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}exports.log.apply(void 0,[prefix].concat(var_args))}};exports.error=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}if(typeof console!=="undefined"){var message="FIREBASE INTERNAL ERROR: "+buildLogMessage_.apply(void 0,var_args);if(typeof console.error!=="undefined"){console.error(message)}else{console.log(message)}}};exports.fatal=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}var message=buildLogMessage_.apply(void 0,var_args);throw new Error("FIREBASE FATAL ERROR: "+message)};exports.warn=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}if(typeof console!=="undefined"){var message="FIREBASE WARNING: "+buildLogMessage_.apply(void 0,var_args);if(typeof console.warn!=="undefined"){console.warn(message)}else{console.log(message)}}};exports.warnIfPageIsSecure=function(){if(typeof window!=="undefined"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1){exports.warn("Insecure Firebase access from a secure page. "+"Please use https in calls to new Firebase().")}};exports.warnAboutUnsupportedMethod=function(methodName){exports.warn(methodName+" is unsupported and will likely change soon.  "+"Please do not use.")};exports.isInvalidJSONNumber=function(data){return typeof data==="number"&&(data!=data||data==Number.POSITIVE_INFINITY||data==Number.NEGATIVE_INFINITY)};exports.executeWhenDOMReady=function(fn){if(util_7.isNodeSdk()||document.readyState==="complete"){fn()}else{var called_1=false;var wrappedFn_1=function(){if(!document.body){setTimeout(wrappedFn_1,Math.floor(10));return}if(!called_1){called_1=true;fn()}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",wrappedFn_1,false);window.addEventListener("load",wrappedFn_1,false)}else if(document.attachEvent){document.attachEvent("onreadystatechange",function(){if(document.readyState==="complete")wrappedFn_1()});window.attachEvent("onload",wrappedFn_1)}}};exports.MIN_NAME="[MIN_NAME]";exports.MAX_NAME="[MAX_NAME]";exports.nameCompare=function(a,b){if(a===b){return 0}else if(a===exports.MIN_NAME||b===exports.MAX_NAME){return-1}else if(b===exports.MIN_NAME||a===exports.MAX_NAME){return 1}else{var aAsInt=exports.tryParseInt(a),bAsInt=exports.tryParseInt(b);if(aAsInt!==null){if(bAsInt!==null){return aAsInt-bAsInt==0?a.length-b.length:aAsInt-bAsInt}else{return-1}}else if(bAsInt!==null){return 1}else{return a<b?-1:1}}};exports.stringCompare=function(a,b){if(a===b){return 0}else if(a<b){return-1}else{return 1}};exports.requireKey=function(key,obj){if(obj&&key in obj){return obj[key]}else{throw new Error("Missing required key ("+key+") in object: "+util_6.stringify(obj))}};exports.ObjectToUniqueKey=function(obj){if(typeof obj!=="object"||obj===null)return util_6.stringify(obj);var keys=[];for(var k in obj){keys.push(k)}keys.sort();var key="{";for(var i=0;i<keys.length;i++){if(i!==0)key+=",";key+=util_6.stringify(keys[i]);key+=":";key+=exports.ObjectToUniqueKey(obj[keys[i]])}key+="}";return key};exports.splitStringBySize=function(str,segsize){var len=str.length;if(len<=segsize){return[str]}var dataSegs=[];for(var c=0;c<len;c+=segsize){if(c+segsize>len){dataSegs.push(str.substring(c,len))}else{dataSegs.push(str.substring(c,c+segsize))}}return dataSegs};exports.each=function(obj,fn){if(Array.isArray(obj)){for(var i=0;i<obj.length;++i){fn(i,obj[i])}}else{util_2.forEach(obj,function(key,val){return fn(val,key)})}};exports.bindCallback=function(callback,context){return context?callback.bind(context):callback};exports.doubleToIEEE754String=function(v){util_1.assert(!exports.isInvalidJSONNumber(v),"Invalid JSON number");var ebits=11,fbits=52;var bias=(1<<ebits-1)-1,s,e,f,ln,i,bits,str;if(v===0){e=0;f=0;s=1/v===-Infinity?1:0}else{s=v<0;v=Math.abs(v);if(v>=Math.pow(2,1-bias)){ln=Math.min(Math.floor(Math.log(v)/Math.LN2),bias);e=ln+bias;f=Math.round(v*Math.pow(2,fbits-ln)-Math.pow(2,fbits))}else{e=0;f=Math.round(v/Math.pow(2,1-bias-fbits))}}bits=[];for(i=fbits;i;i-=1){bits.push(f%2?1:0);f=Math.floor(f/2)}for(i=ebits;i;i-=1){bits.push(e%2?1:0);e=Math.floor(e/2)}bits.push(s?1:0);bits.reverse();str=bits.join("");var hexByteString="";for(i=0;i<64;i+=8){var hexByte=parseInt(str.substr(i,8),2).toString(16);if(hexByte.length===1)hexByte="0"+hexByte;hexByteString=hexByteString+hexByte}return hexByteString.toLowerCase()};exports.isChromeExtensionContentScript=function(){return!!(typeof window==="object"&&window["chrome"]&&window["chrome"]["extension"]&&!/^chrome/.test(window.location.href))};exports.isWindowsStoreApp=function(){return typeof Windows==="object"&&typeof Windows.UI==="object"};exports.errorForServerCode=function(code,query){var reason="Unknown Error";if(code==="too_big"){reason="The data requested exceeds the maximum size "+"that can be accessed with a single request."}else if(code=="permission_denied"){reason="Client doesn't have permission to access the desired data."}else if(code=="unavailable"){reason="The service is unavailable"}var error=new Error(code+" at "+query.path.toString()+": "+reason);error.code=code.toUpperCase();return error};exports.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$");exports.tryParseInt=function(str){if(exports.INTEGER_REGEXP_.test(str)){var intVal=Number(str);if(intVal>=-2147483648&&intVal<=2147483647){return intVal}}return null};exports.exceptionGuard=function(fn){try{fn()}catch(e){setTimeout(function(){var stack=e.stack||"";exports.warn("Exception was thrown by user callback.",stack);throw e},Math.floor(0))}};exports.callUserCallback=function(callback){var var_args=[];for(var _i=1;_i<arguments.length;_i++){var_args[_i-1]=arguments[_i]}if(typeof callback==="function"){exports.exceptionGuard(function(){callback.apply(void 0,var_args)})}};exports.beingCrawled=function(){var userAgent=typeof window==="object"&&window["navigator"]&&window["navigator"]["userAgent"]||"";return userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0};exports.exportPropGetter=function(object,name,fnGet){Object.defineProperty(object,name,{get:fnGet})};exports.setTimeoutNonBlocking=function(fn,time){var timeout=setTimeout(fn,time);if(typeof timeout==="object"&&timeout["unref"]){timeout["unref"]()}return timeout}},{"../storage/storage":56,"@firebase/util":139}],69:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Path_1=require("./Path");var util_1=require("@firebase/util");var util_2=require("./util");var util_3=require("@firebase/util");var util_4=require("@firebase/util");exports.INVALID_KEY_REGEX_=/[\[\].#$\/\u0000-\u001F\u007F]/;exports.INVALID_PATH_REGEX_=/[\[\].#$\u0000-\u001F\u007F]/;exports.MAX_LEAF_SIZE_=10*1024*1024;exports.isValidKey=function(key){return typeof key==="string"&&key.length!==0&&!exports.INVALID_KEY_REGEX_.test(key)};exports.isValidPathString=function(pathString){return typeof pathString==="string"&&pathString.length!==0&&!exports.INVALID_PATH_REGEX_.test(pathString)};exports.isValidRootPathString=function(pathString){if(pathString){pathString=pathString.replace(/^\/*\.info(\/|$)/,"/")}return exports.isValidPathString(pathString)};exports.isValidPriority=function(priority){return priority===null||typeof priority==="string"||typeof priority==="number"&&!util_2.isInvalidJSONNumber(priority)||priority&&typeof priority==="object"&&util_1.contains(priority,".sv")};exports.validateFirebaseDataArg=function(fnName,argumentNumber,data,path,optional){if(optional&&data===undefined)return;exports.validateFirebaseData(util_3.errorPrefix(fnName,argumentNumber,optional),data,path)};exports.validateFirebaseData=function(errorPrefix,data,path_){var path=path_ instanceof Path_1.Path?new Path_1.ValidationPath(path_,errorPrefix):path_;if(data===undefined){throw new Error(errorPrefix+"contains undefined "+path.toErrorString())}if(typeof data==="function"){throw new Error(errorPrefix+"contains a function "+path.toErrorString()+" with contents = "+data.toString())}if(util_2.isInvalidJSONNumber(data)){throw new Error(errorPrefix+"contains "+data.toString()+" "+path.toErrorString())}if(typeof data==="string"&&data.length>exports.MAX_LEAF_SIZE_/3&&util_4.stringLength(data)>exports.MAX_LEAF_SIZE_){throw new Error(errorPrefix+"contains a string greater than "+exports.MAX_LEAF_SIZE_+" utf8 bytes "+path.toErrorString()+" ('"+data.substring(0,50)+"...')")}if(data&&typeof data==="object"){var hasDotValue_1=false,hasActualChild_1=false;util_1.forEach(data,function(key,value){if(key===".value"){hasDotValue_1=true}else if(key!==".priority"&&key!==".sv"){hasActualChild_1=true;if(!exports.isValidKey(key)){throw new Error(errorPrefix+" contains an invalid key ("+key+") "+path.toErrorString()+".  Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}path.push(key);exports.validateFirebaseData(errorPrefix,value,path);path.pop()});if(hasDotValue_1&&hasActualChild_1){throw new Error(errorPrefix+' contains ".value" child '+path.toErrorString()+" in addition to actual children.")}}};exports.validateFirebaseMergePaths=function(errorPrefix,mergePaths){var i,curPath;for(i=0;i<mergePaths.length;i++){curPath=mergePaths[i];var keys=curPath.slice();for(var j=0;j<keys.length;j++){if(keys[j]===".priority"&&j===keys.length-1){}else if(!exports.isValidKey(keys[j])){throw new Error(errorPrefix+"contains an invalid key ("+keys[j]+") in path "+curPath.toString()+". Keys must be non-empty strings "+'and can\'t contain ".", "#", "$", "/", "[", or "]"')}}}mergePaths.sort(Path_1.Path.comparePaths);var prevPath=null;for(i=0;i<mergePaths.length;i++){curPath=mergePaths[i];if(prevPath!==null&&prevPath.contains(curPath)){throw new Error(errorPrefix+"contains a path "+prevPath.toString()+" that is ancestor of another path "+curPath.toString())}prevPath=curPath}};exports.validateFirebaseMergeDataArg=function(fnName,argumentNumber,data,path,optional){if(optional&&data===undefined)return;var errorPrefix=util_3.errorPrefix(fnName,argumentNumber,optional);if(!(data&&typeof data==="object")||Array.isArray(data)){throw new Error(errorPrefix+" must be an object containing the children to replace.")}var mergePaths=[];util_1.forEach(data,function(key,value){var curPath=new Path_1.Path(key);exports.validateFirebaseData(errorPrefix,value,path.child(curPath));if(curPath.getBack()===".priority"){if(!exports.isValidPriority(value)){throw new Error(errorPrefix+"contains an invalid value for '"+curPath.toString()+"', which must be a valid "+"Firebase priority (a string, finite number, server value, or null).")}}mergePaths.push(curPath)});exports.validateFirebaseMergePaths(errorPrefix,mergePaths)};exports.validatePriority=function(fnName,argumentNumber,priority,optional){if(optional&&priority===undefined)return;if(util_2.isInvalidJSONNumber(priority))throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"is "+priority.toString()+", but must be a valid Firebase priority (a string, finite number, "+"server value, or null).");if(!exports.isValidPriority(priority))throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"must be a valid Firebase priority "+"(a string, finite number, server value, or null).")};exports.validateEventType=function(fnName,argumentNumber,eventType,optional){if(optional&&eventType===undefined)return;switch(eventType){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'must be a valid event type = "value", "child_added", "child_removed", '+'"child_changed", or "child_moved".')}};exports.validateKey=function(fnName,argumentNumber,key,optional){if(optional&&key===undefined)return;if(!exports.isValidKey(key))throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'was an invalid key = "'+key+'".  Firebase keys must be non-empty strings and '+'can\'t contain ".", "#", "$", "/", "[", or "]").')};exports.validatePathString=function(fnName,argumentNumber,pathString,optional){if(optional&&pathString===undefined)return;if(!exports.isValidPathString(pathString))throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'was an invalid path = "'+pathString+'". Paths must be non-empty strings and '+'can\'t contain ".", "#", "$", "[", or "]"')};exports.validateRootPathString=function(fnName,argumentNumber,pathString,optional){if(pathString){pathString=pathString.replace(/^\/*\.info(\/|$)/,"/")}exports.validatePathString(fnName,argumentNumber,pathString,optional)};exports.validateWritablePath=function(fnName,path){if(path.getFront()===".info"){throw new Error(fnName+" failed = Can't modify data under /.info/")}};exports.validateUrl=function(fnName,argumentNumber,parsedUrl){var pathString=parsedUrl.path.toString();if(!(typeof parsedUrl.repoInfo.host==="string")||parsedUrl.repoInfo.host.length===0||!exports.isValidKey(parsedUrl.repoInfo.namespace)||pathString.length!==0&&!exports.isValidRootPathString(pathString)){throw new Error(util_3.errorPrefix(fnName,argumentNumber,false)+"must be a valid firebase URL and "+'the path can\'t contain ".", "#", "$", "[", or "]".')}};exports.validateCredential=function(fnName,argumentNumber,cred,optional){if(optional&&cred===undefined)return;if(!(typeof cred==="string"))throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"must be a valid credential (a string).")};exports.validateBoolean=function(fnName,argumentNumber,bool,optional){if(optional&&bool===undefined)return;if(typeof bool!=="boolean")throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"must be a boolean.")};exports.validateString=function(fnName,argumentNumber,string,optional){if(optional&&string===undefined)return;if(!(typeof string==="string")){throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"must be a valid string.")}};exports.validateObject=function(fnName,argumentNumber,obj,optional){if(optional&&obj===undefined)return;if(!(obj&&typeof obj==="object")||obj===null){throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+"must be a valid object.")}};exports.validateObjectContainsKey=function(fnName,argumentNumber,obj,key,optional,opt_type){var objectContainsKey=obj&&typeof obj==="object"&&util_1.contains(obj,key);if(!objectContainsKey){if(optional){return}else{throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'must contain the key "'+key+'"')}}if(opt_type){var val=util_1.safeGet(obj,key);if(opt_type==="number"&&!(typeof val==="number")||opt_type==="string"&&!(typeof val==="string")||opt_type==="boolean"&&!(typeof val==="boolean")||opt_type==="function"&&!(typeof val==="function")||opt_type==="object"&&!(typeof val==="object")&&val){if(optional){throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'contains invalid value for key "'+key+'" (must be of type "'+opt_type+'")')}else{throw new Error(util_3.errorPrefix(fnName,argumentNumber,optional)+'must contain the key "'+key+'" with type "'+opt_type+'"')}}}}},{"./Path":62,"./util":68,"@firebase/util":139}],70:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CacheNode=function(){function CacheNode(node_,fullyInitialized_,filtered_){this.node_=node_;this.fullyInitialized_=fullyInitialized_;this.filtered_=filtered_}CacheNode.prototype.isFullyInitialized=function(){return this.fullyInitialized_};CacheNode.prototype.isFiltered=function(){return this.filtered_};CacheNode.prototype.isCompleteForPath=function(path){if(path.isEmpty()){return this.isFullyInitialized()&&!this.filtered_}var childKey=path.getFront();return this.isCompleteForChild(childKey)};CacheNode.prototype.isCompleteForChild=function(key){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(key)};CacheNode.prototype.getNode=function(){return this.node_};return CacheNode}();exports.CacheNode=CacheNode},{}],71:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Change=function(){function Change(type,snapshotNode,childName,oldSnap,prevName){this.type=type;this.snapshotNode=snapshotNode;this.childName=childName;this.oldSnap=oldSnap;this.prevName=prevName}Change.valueChange=function(snapshot){return new Change(Change.VALUE,snapshot)};Change.childAddedChange=function(childKey,snapshot){return new Change(Change.CHILD_ADDED,snapshot,childKey)};Change.childRemovedChange=function(childKey,snapshot){return new Change(Change.CHILD_REMOVED,snapshot,childKey)};Change.childChangedChange=function(childKey,newSnapshot,oldSnapshot){return new Change(Change.CHILD_CHANGED,newSnapshot,childKey,oldSnapshot)};Change.childMovedChange=function(childKey,snapshot){return new Change(Change.CHILD_MOVED,snapshot,childKey)};Change.CHILD_ADDED="child_added";Change.CHILD_REMOVED="child_removed";Change.CHILD_CHANGED="child_changed";Change.CHILD_MOVED="child_moved";Change.VALUE="value";return Change}();exports.Change=Change},{}],72:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Change_1=require("./Change");var util_2=require("@firebase/util");var ChildChangeAccumulator=function(){function ChildChangeAccumulator(){this.changeMap_={}}ChildChangeAccumulator.prototype.trackChildChange=function(change){var type=change.type;var childKey=change.childName;util_2.assert(type==Change_1.Change.CHILD_ADDED||type==Change_1.Change.CHILD_CHANGED||type==Change_1.Change.CHILD_REMOVED,"Only child changes supported for tracking");util_2.assert(childKey!==".priority","Only non-priority child changes can be tracked.");var oldChange=util_1.safeGet(this.changeMap_,childKey);if(oldChange){var oldType=oldChange.type;if(type==Change_1.Change.CHILD_ADDED&&oldType==Change_1.Change.CHILD_REMOVED){this.changeMap_[childKey]=Change_1.Change.childChangedChange(childKey,change.snapshotNode,oldChange.snapshotNode)}else if(type==Change_1.Change.CHILD_REMOVED&&oldType==Change_1.Change.CHILD_ADDED){delete this.changeMap_[childKey]}else if(type==Change_1.Change.CHILD_REMOVED&&oldType==Change_1.Change.CHILD_CHANGED){this.changeMap_[childKey]=Change_1.Change.childRemovedChange(childKey,oldChange.oldSnap)}else if(type==Change_1.Change.CHILD_CHANGED&&oldType==Change_1.Change.CHILD_ADDED){this.changeMap_[childKey]=Change_1.Change.childAddedChange(childKey,change.snapshotNode)}else if(type==Change_1.Change.CHILD_CHANGED&&oldType==Change_1.Change.CHILD_CHANGED){this.changeMap_[childKey]=Change_1.Change.childChangedChange(childKey,change.snapshotNode,oldChange.oldSnap);
}else{throw util_2.assertionError("Illegal combination of changes: "+change+" occurred after "+oldChange)}}else{this.changeMap_[childKey]=change}};ChildChangeAccumulator.prototype.getChanges=function(){return util_1.getValues(this.changeMap_)};return ChildChangeAccumulator}();exports.ChildChangeAccumulator=ChildChangeAccumulator},{"./Change":71,"@firebase/util":139}],73:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CacheNode_1=require("./CacheNode");var NoCompleteChildSource_=function(){function NoCompleteChildSource_(){}NoCompleteChildSource_.prototype.getCompleteChild=function(childKey){return null};NoCompleteChildSource_.prototype.getChildAfterChild=function(index,child,reverse){return null};return NoCompleteChildSource_}();exports.NoCompleteChildSource_=NoCompleteChildSource_;exports.NO_COMPLETE_CHILD_SOURCE=new NoCompleteChildSource_;var WriteTreeCompleteChildSource=function(){function WriteTreeCompleteChildSource(writes_,viewCache_,optCompleteServerCache_){if(optCompleteServerCache_===void 0){optCompleteServerCache_=null}this.writes_=writes_;this.viewCache_=viewCache_;this.optCompleteServerCache_=optCompleteServerCache_}WriteTreeCompleteChildSource.prototype.getCompleteChild=function(childKey){var node=this.viewCache_.getEventCache();if(node.isCompleteForChild(childKey)){return node.getNode().getImmediateChild(childKey)}else{var serverNode=this.optCompleteServerCache_!=null?new CacheNode_1.CacheNode(this.optCompleteServerCache_,true,false):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(childKey,serverNode)}};WriteTreeCompleteChildSource.prototype.getChildAfterChild=function(index,child,reverse){var completeServerData=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap();var nodes=this.writes_.calcIndexedSlice(completeServerData,child,1,reverse,index);if(nodes.length===0){return null}else{return nodes[0]}};return WriteTreeCompleteChildSource}();exports.WriteTreeCompleteChildSource=WriteTreeCompleteChildSource},{"./CacheNode":70}],74:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var DataEvent=function(){function DataEvent(eventType,eventRegistration,snapshot,prevName){this.eventType=eventType;this.eventRegistration=eventRegistration;this.snapshot=snapshot;this.prevName=prevName}DataEvent.prototype.getPath=function(){var ref=this.snapshot.getRef();if(this.eventType==="value"){return ref.path}else{return ref.getParent().path}};DataEvent.prototype.getEventType=function(){return this.eventType};DataEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};DataEvent.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+util_1.stringify(this.snapshot.exportVal())};return DataEvent}();exports.DataEvent=DataEvent;var CancelEvent=function(){function CancelEvent(eventRegistration,error,path){this.eventRegistration=eventRegistration;this.error=error;this.path=path}CancelEvent.prototype.getPath=function(){return this.path};CancelEvent.prototype.getEventType=function(){return"cancel"};CancelEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)};CancelEvent.prototype.toString=function(){return this.path.toString()+":cancel"};return CancelEvent}();exports.CancelEvent=CancelEvent},{"@firebase/util":139}],75:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Node_1=require("../snap/Node");var Change_1=require("./Change");var util_1=require("@firebase/util");var EventGenerator=function(){function EventGenerator(query_){this.query_=query_;this.index_=this.query_.getQueryParams().getIndex()}EventGenerator.prototype.generateEventsForChanges=function(changes,eventCache,eventRegistrations){var _this=this;var events=[];var moves=[];changes.forEach(function(change){if(change.type===Change_1.Change.CHILD_CHANGED&&_this.index_.indexedValueChanged(change.oldSnap,change.snapshotNode)){moves.push(Change_1.Change.childMovedChange(change.childName,change.snapshotNode))}});this.generateEventsForType_(events,Change_1.Change.CHILD_REMOVED,changes,eventRegistrations,eventCache);this.generateEventsForType_(events,Change_1.Change.CHILD_ADDED,changes,eventRegistrations,eventCache);this.generateEventsForType_(events,Change_1.Change.CHILD_MOVED,moves,eventRegistrations,eventCache);this.generateEventsForType_(events,Change_1.Change.CHILD_CHANGED,changes,eventRegistrations,eventCache);this.generateEventsForType_(events,Change_1.Change.VALUE,changes,eventRegistrations,eventCache);return events};EventGenerator.prototype.generateEventsForType_=function(events,eventType,changes,registrations,eventCache){var _this=this;var filteredChanges=changes.filter(function(change){return change.type===eventType});filteredChanges.sort(this.compareChanges_.bind(this));filteredChanges.forEach(function(change){var materializedChange=_this.materializeSingleChange_(change,eventCache);registrations.forEach(function(registration){if(registration.respondsTo(change.type)){events.push(registration.createEvent(materializedChange,_this.query_))}})})};EventGenerator.prototype.materializeSingleChange_=function(change,eventCache){if(change.type==="value"||change.type==="child_removed"){return change}else{change.prevName=eventCache.getPredecessorChildName(change.childName,change.snapshotNode,this.index_);return change}};EventGenerator.prototype.compareChanges_=function(a,b){if(a.childName==null||b.childName==null){throw util_1.assertionError("Should only compare child_ events.")}var aWrapped=new Node_1.NamedNode(a.childName,a.snapshotNode);var bWrapped=new Node_1.NamedNode(b.childName,b.snapshotNode);return this.index_.compare(aWrapped,bWrapped)};return EventGenerator}();exports.EventGenerator=EventGenerator},{"../snap/Node":40,"./Change":71,"@firebase/util":139}],76:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../util/util");var EventQueue=function(){function EventQueue(){this.eventLists_=[];this.recursionDepth_=0}EventQueue.prototype.queueEvents=function(eventDataList){var currList=null;for(var i=0;i<eventDataList.length;i++){var eventData=eventDataList[i];var eventPath=eventData.getPath();if(currList!==null&&!eventPath.equals(currList.getPath())){this.eventLists_.push(currList);currList=null}if(currList===null){currList=new EventList(eventPath)}currList.add(eventData)}if(currList){this.eventLists_.push(currList)}};EventQueue.prototype.raiseEventsAtPath=function(path,eventDataList){this.queueEvents(eventDataList);this.raiseQueuedEventsMatchingPredicate_(function(eventPath){return eventPath.equals(path)})};EventQueue.prototype.raiseEventsForChangedPath=function(changedPath,eventDataList){this.queueEvents(eventDataList);this.raiseQueuedEventsMatchingPredicate_(function(eventPath){return eventPath.contains(changedPath)||changedPath.contains(eventPath)})};EventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(predicate){this.recursionDepth_++;var sentAll=true;for(var i=0;i<this.eventLists_.length;i++){var eventList=this.eventLists_[i];if(eventList){var eventPath=eventList.getPath();if(predicate(eventPath)){this.eventLists_[i].raise();this.eventLists_[i]=null}else{sentAll=false}}}if(sentAll){this.eventLists_=[]}this.recursionDepth_--};return EventQueue}();exports.EventQueue=EventQueue;var EventList=function(){function EventList(path_){this.path_=path_;this.events_=[]}EventList.prototype.add=function(eventData){this.events_.push(eventData)};EventList.prototype.raise=function(){for(var i=0;i<this.events_.length;i++){var eventData=this.events_[i];if(eventData!==null){this.events_[i]=null;var eventFn=eventData.getEventRunner();if(util_1.logger){util_1.log("event: "+eventData.toString())}util_1.exceptionGuard(eventFn)}}};EventList.prototype.getPath=function(){return this.path_};return EventList}();exports.EventList=EventList},{"../util/util":68}],77:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var DataSnapshot_1=require("../../api/DataSnapshot");var Event_1=require("./Event");var util_1=require("@firebase/util");var util_2=require("@firebase/util");var ValueEventRegistration=function(){function ValueEventRegistration(callback_,cancelCallback_,context_){this.callback_=callback_;this.cancelCallback_=cancelCallback_;this.context_=context_}ValueEventRegistration.prototype.respondsTo=function(eventType){return eventType==="value"};ValueEventRegistration.prototype.createEvent=function(change,query){var index=query.getQueryParams().getIndex();return new Event_1.DataEvent("value",this,new DataSnapshot_1.DataSnapshot(change.snapshotNode,query.getRef(),index))};ValueEventRegistration.prototype.getEventRunner=function(eventData){var ctx=this.context_;if(eventData.getEventType()==="cancel"){util_2.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var cancelCB_1=this.cancelCallback_;return function(){cancelCB_1.call(ctx,eventData.error)}}else{var cb_1=this.callback_;return function(){cb_1.call(ctx,eventData.snapshot)}}};ValueEventRegistration.prototype.createCancelEvent=function(error,path){if(this.cancelCallback_){return new Event_1.CancelEvent(this,error,path)}else{return null}};ValueEventRegistration.prototype.matches=function(other){if(!(other instanceof ValueEventRegistration)){return false}else if(!other.callback_||!this.callback_){return true}else{return other.callback_===this.callback_&&other.context_===this.context_}};ValueEventRegistration.prototype.hasAnyCallback=function(){return this.callback_!==null};return ValueEventRegistration}();exports.ValueEventRegistration=ValueEventRegistration;var ChildEventRegistration=function(){function ChildEventRegistration(callbacks_,cancelCallback_,context_){this.callbacks_=callbacks_;this.cancelCallback_=cancelCallback_;this.context_=context_}ChildEventRegistration.prototype.respondsTo=function(eventType){var eventToCheck=eventType==="children_added"?"child_added":eventType;eventToCheck=eventToCheck==="children_removed"?"child_removed":eventToCheck;return util_1.contains(this.callbacks_,eventToCheck)};ChildEventRegistration.prototype.createCancelEvent=function(error,path){if(this.cancelCallback_){return new Event_1.CancelEvent(this,error,path)}else{return null}};ChildEventRegistration.prototype.createEvent=function(change,query){util_2.assert(change.childName!=null,"Child events should have a childName.");var ref=query.getRef().child(change.childName);var index=query.getQueryParams().getIndex();return new Event_1.DataEvent(change.type,this,new DataSnapshot_1.DataSnapshot(change.snapshotNode,ref,index),change.prevName)};ChildEventRegistration.prototype.getEventRunner=function(eventData){var ctx=this.context_;if(eventData.getEventType()==="cancel"){util_2.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var cancelCB_2=this.cancelCallback_;return function(){cancelCB_2.call(ctx,eventData.error)}}else{var cb_2=this.callbacks_[eventData.eventType];return function(){cb_2.call(ctx,eventData.snapshot,eventData.prevName)}}};ChildEventRegistration.prototype.matches=function(other){if(other instanceof ChildEventRegistration){if(!this.callbacks_||!other.callbacks_){return true}else if(this.context_===other.context_){var otherCount=util_1.getCount(other.callbacks_);var thisCount=util_1.getCount(this.callbacks_);if(otherCount===thisCount){if(otherCount===1){var otherKey=util_1.getAnyKey(other.callbacks_);var thisKey=util_1.getAnyKey(this.callbacks_);return thisKey===otherKey&&(!other.callbacks_[otherKey]||!this.callbacks_[thisKey]||other.callbacks_[otherKey]===this.callbacks_[thisKey])}else{return util_1.every(this.callbacks_,function(eventType,cb){return other.callbacks_[eventType]===cb})}}}}return false};ChildEventRegistration.prototype.hasAnyCallback=function(){return this.callbacks_!==null};return ChildEventRegistration}();exports.ChildEventRegistration=ChildEventRegistration},{"../../api/DataSnapshot":10,"./Event":74,"@firebase/util":139}],78:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var util_2=require("../util/util");var KeyIndex_1=require("../snap/indexes/KeyIndex");var PriorityIndex_1=require("../snap/indexes/PriorityIndex");var ValueIndex_1=require("../snap/indexes/ValueIndex");var PathIndex_1=require("../snap/indexes/PathIndex");var IndexedFilter_1=require("./filter/IndexedFilter");var LimitedFilter_1=require("./filter/LimitedFilter");var RangedFilter_1=require("./filter/RangedFilter");var util_3=require("@firebase/util");var QueryParams=function(){function QueryParams(){this.limitSet_=false;this.startSet_=false;this.startNameSet_=false;this.endSet_=false;this.endNameSet_=false;this.limit_=0;this.viewFrom_="";this.indexStartValue_=null;this.indexStartName_="";this.indexEndValue_=null;this.indexEndName_="";this.index_=PriorityIndex_1.PRIORITY_INDEX}QueryParams.prototype.hasStart=function(){return this.startSet_};QueryParams.prototype.isViewFromLeft=function(){if(this.viewFrom_===""){return this.startSet_}else{return this.viewFrom_===QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT}};QueryParams.prototype.getIndexStartValue=function(){util_1.assert(this.startSet_,"Only valid if start has been set");return this.indexStartValue_};QueryParams.prototype.getIndexStartName=function(){util_1.assert(this.startSet_,"Only valid if start has been set");if(this.startNameSet_){return this.indexStartName_}else{return util_2.MIN_NAME}};QueryParams.prototype.hasEnd=function(){return this.endSet_};QueryParams.prototype.getIndexEndValue=function(){util_1.assert(this.endSet_,"Only valid if end has been set");return this.indexEndValue_};QueryParams.prototype.getIndexEndName=function(){util_1.assert(this.endSet_,"Only valid if end has been set");if(this.endNameSet_){return this.indexEndName_}else{return util_2.MAX_NAME}};QueryParams.prototype.hasLimit=function(){return this.limitSet_};QueryParams.prototype.hasAnchoredLimit=function(){return this.limitSet_&&this.viewFrom_!==""};QueryParams.prototype.getLimit=function(){util_1.assert(this.limitSet_,"Only valid if limit has been set");return this.limit_};QueryParams.prototype.getIndex=function(){return this.index_};QueryParams.prototype.copy_=function(){var copy=new QueryParams;copy.limitSet_=this.limitSet_;copy.limit_=this.limit_;copy.startSet_=this.startSet_;copy.indexStartValue_=this.indexStartValue_;copy.startNameSet_=this.startNameSet_;copy.indexStartName_=this.indexStartName_;copy.endSet_=this.endSet_;copy.indexEndValue_=this.indexEndValue_;copy.endNameSet_=this.endNameSet_;copy.indexEndName_=this.indexEndName_;copy.index_=this.index_;copy.viewFrom_=this.viewFrom_;return copy};QueryParams.prototype.limit=function(newLimit){var newParams=this.copy_();newParams.limitSet_=true;newParams.limit_=newLimit;newParams.viewFrom_="";return newParams};QueryParams.prototype.limitToFirst=function(newLimit){var newParams=this.copy_();newParams.limitSet_=true;newParams.limit_=newLimit;newParams.viewFrom_=QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT;return newParams};QueryParams.prototype.limitToLast=function(newLimit){var newParams=this.copy_();newParams.limitSet_=true;newParams.limit_=newLimit;newParams.viewFrom_=QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT;return newParams};QueryParams.prototype.startAt=function(indexValue,key){var newParams=this.copy_();newParams.startSet_=true;if(!(indexValue!==undefined)){indexValue=null}newParams.indexStartValue_=indexValue;if(key!=null){newParams.startNameSet_=true;newParams.indexStartName_=key}else{newParams.startNameSet_=false;newParams.indexStartName_=""}return newParams};QueryParams.prototype.endAt=function(indexValue,key){var newParams=this.copy_();newParams.endSet_=true;if(!(indexValue!==undefined)){indexValue=null}newParams.indexEndValue_=indexValue;if(key!==undefined){newParams.endNameSet_=true;newParams.indexEndName_=key}else{newParams.endNameSet_=false;newParams.indexEndName_=""}return newParams};QueryParams.prototype.orderBy=function(index){var newParams=this.copy_();newParams.index_=index;return newParams};QueryParams.prototype.getQueryObject=function(){var WIRE_PROTOCOL_CONSTANTS=QueryParams.WIRE_PROTOCOL_CONSTANTS_;var obj={};if(this.startSet_){obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE]=this.indexStartValue_;if(this.startNameSet_){obj[WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME]=this.indexStartName_}}if(this.endSet_){obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE]=this.indexEndValue_;if(this.endNameSet_){obj[WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME]=this.indexEndName_}}if(this.limitSet_){obj[WIRE_PROTOCOL_CONSTANTS.LIMIT]=this.limit_;var viewFrom=this.viewFrom_;if(viewFrom===""){if(this.isViewFromLeft()){viewFrom=WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_LEFT}else{viewFrom=WIRE_PROTOCOL_CONSTANTS.VIEW_FROM_RIGHT}}obj[WIRE_PROTOCOL_CONSTANTS.VIEW_FROM]=viewFrom}if(this.index_!==PriorityIndex_1.PRIORITY_INDEX){obj[WIRE_PROTOCOL_CONSTANTS.INDEX]=this.index_.toString()}return obj};QueryParams.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)};QueryParams.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==PriorityIndex_1.PRIORITY_INDEX};QueryParams.prototype.getNodeFilter=function(){if(this.loadsAllData()){return new IndexedFilter_1.IndexedFilter(this.getIndex())}else if(this.hasLimit()){return new LimitedFilter_1.LimitedFilter(this)}else{return new RangedFilter_1.RangedFilter(this)}};QueryParams.prototype.toRestQueryStringParameters=function(){var REST_CONSTANTS=QueryParams.REST_QUERY_CONSTANTS_;var qs={};if(this.isDefault()){return qs}var orderBy;if(this.index_===PriorityIndex_1.PRIORITY_INDEX){orderBy=REST_CONSTANTS.PRIORITY_INDEX}else if(this.index_===ValueIndex_1.VALUE_INDEX){orderBy=REST_CONSTANTS.VALUE_INDEX}else if(this.index_===KeyIndex_1.KEY_INDEX){orderBy=REST_CONSTANTS.KEY_INDEX}else{util_1.assert(this.index_ instanceof PathIndex_1.PathIndex,"Unrecognized index type!");orderBy=this.index_.toString()}qs[REST_CONSTANTS.ORDER_BY]=util_3.stringify(orderBy);if(this.startSet_){qs[REST_CONSTANTS.START_AT]=util_3.stringify(this.indexStartValue_);if(this.startNameSet_){qs[REST_CONSTANTS.START_AT]+=","+util_3.stringify(this.indexStartName_)}}if(this.endSet_){qs[REST_CONSTANTS.END_AT]=util_3.stringify(this.indexEndValue_);if(this.endNameSet_){qs[REST_CONSTANTS.END_AT]+=","+util_3.stringify(this.indexEndName_)}}if(this.limitSet_){if(this.isViewFromLeft()){qs[REST_CONSTANTS.LIMIT_TO_FIRST]=this.limit_}else{qs[REST_CONSTANTS.LIMIT_TO_LAST]=this.limit_}}return qs};QueryParams.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"};QueryParams.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"};QueryParams.DEFAULT=new QueryParams;return QueryParams}();exports.QueryParams=QueryParams},{"../snap/indexes/KeyIndex":44,"../snap/indexes/PathIndex":45,"../snap/indexes/PriorityIndex":46,"../snap/indexes/ValueIndex":47,"../util/util":68,"./filter/IndexedFilter":82,"./filter/LimitedFilter":83,"./filter/RangedFilter":84,"@firebase/util":139}],79:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var IndexedFilter_1=require("./filter/IndexedFilter");var ViewProcessor_1=require("./ViewProcessor");var ChildrenNode_1=require("../snap/ChildrenNode");var CacheNode_1=require("./CacheNode");var ViewCache_1=require("./ViewCache");var EventGenerator_1=require("./EventGenerator");var util_1=require("@firebase/util");var Operation_1=require("../operation/Operation");var Change_1=require("./Change");var PriorityIndex_1=require("../snap/indexes/PriorityIndex");var View=function(){function View(query_,initialViewCache){this.query_=query_;this.eventRegistrations_=[];var params=this.query_.getQueryParams();var indexFilter=new IndexedFilter_1.IndexedFilter(params.getIndex());var filter=params.getNodeFilter();this.processor_=new ViewProcessor_1.ViewProcessor(filter);var initialServerCache=initialViewCache.getServerCache();var initialEventCache=initialViewCache.getEventCache();var serverSnap=indexFilter.updateFullNode(ChildrenNode_1.ChildrenNode.EMPTY_NODE,initialServerCache.getNode(),null);var eventSnap=filter.updateFullNode(ChildrenNode_1.ChildrenNode.EMPTY_NODE,initialEventCache.getNode(),null);var newServerCache=new CacheNode_1.CacheNode(serverSnap,initialServerCache.isFullyInitialized(),indexFilter.filtersNodes());var newEventCache=new CacheNode_1.CacheNode(eventSnap,initialEventCache.isFullyInitialized(),filter.filtersNodes());this.viewCache_=new ViewCache_1.ViewCache(newEventCache,newServerCache);this.eventGenerator_=new EventGenerator_1.EventGenerator(this.query_)}View.prototype.getQuery=function(){return this.query_};View.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()};View.prototype.getCompleteServerCache=function(path){var cache=this.viewCache_.getCompleteServerSnap();if(cache){if(this.query_.getQueryParams().loadsAllData()||!path.isEmpty()&&!cache.getImmediateChild(path.getFront()).isEmpty()){return cache.getChild(path)}}return null};View.prototype.isEmpty=function(){return this.eventRegistrations_.length===0};View.prototype.addEventRegistration=function(eventRegistration){this.eventRegistrations_.push(eventRegistration)};View.prototype.removeEventRegistration=function(eventRegistration,cancelError){var cancelEvents=[];if(cancelError){util_1.assert(eventRegistration==null,"A cancel should cancel all event registrations.");var path_1=this.query_.path;this.eventRegistrations_.forEach(function(registration){cancelError=cancelError;var maybeEvent=registration.createCancelEvent(cancelError,path_1);if(maybeEvent){cancelEvents.push(maybeEvent)}})}if(eventRegistration){var remaining=[];for(var i=0;i<this.eventRegistrations_.length;++i){var existing=this.eventRegistrations_[i];if(!existing.matches(eventRegistration)){remaining.push(existing)}else if(eventRegistration.hasAnyCallback()){remaining=remaining.concat(this.eventRegistrations_.slice(i+1));break}}this.eventRegistrations_=remaining}else{this.eventRegistrations_=[]}return cancelEvents};View.prototype.applyOperation=function(operation,writesCache,completeServerCache){if(operation.type===Operation_1.OperationType.MERGE&&operation.source.queryId!==null){util_1.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges");util_1.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache")}var oldViewCache=this.viewCache_;var result=this.processor_.applyOperation(oldViewCache,operation,writesCache,completeServerCache);this.processor_.assertIndexed(result.viewCache);util_1.assert(result.viewCache.getServerCache().isFullyInitialized()||!oldViewCache.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back");this.viewCache_=result.viewCache;return this.generateEventsForChanges_(result.changes,result.viewCache.getEventCache().getNode(),null)};View.prototype.getInitialEvents=function(registration){var eventSnap=this.viewCache_.getEventCache();var initialChanges=[];if(!eventSnap.getNode().isLeafNode()){var eventNode=eventSnap.getNode();eventNode.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){initialChanges.push(Change_1.Change.childAddedChange(key,childNode))})}if(eventSnap.isFullyInitialized()){initialChanges.push(Change_1.Change.valueChange(eventSnap.getNode()))}return this.generateEventsForChanges_(initialChanges,eventSnap.getNode(),registration)};View.prototype.generateEventsForChanges_=function(changes,eventCache,eventRegistration){var registrations=eventRegistration?[eventRegistration]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(changes,eventCache,registrations)};return View}();exports.View=View},{"../operation/Operation":35,"../snap/ChildrenNode":37,"../snap/indexes/PriorityIndex":46,"./CacheNode":70,"./Change":71,"./EventGenerator":75,"./ViewCache":80,"./ViewProcessor":81,"./filter/IndexedFilter":82,"@firebase/util":139}],80:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ChildrenNode_1=require("../snap/ChildrenNode");var CacheNode_1=require("./CacheNode");var ViewCache=function(){function ViewCache(eventCache_,serverCache_){this.eventCache_=eventCache_;this.serverCache_=serverCache_}ViewCache.prototype.updateEventSnap=function(eventSnap,complete,filtered){return new ViewCache(new CacheNode_1.CacheNode(eventSnap,complete,filtered),this.serverCache_)};ViewCache.prototype.updateServerSnap=function(serverSnap,complete,filtered){return new ViewCache(this.eventCache_,new CacheNode_1.CacheNode(serverSnap,complete,filtered))};ViewCache.prototype.getEventCache=function(){return this.eventCache_};ViewCache.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null};ViewCache.prototype.getServerCache=function(){return this.serverCache_};ViewCache.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null};ViewCache.Empty=new ViewCache(new CacheNode_1.CacheNode(ChildrenNode_1.ChildrenNode.EMPTY_NODE,false,false),new CacheNode_1.CacheNode(ChildrenNode_1.ChildrenNode.EMPTY_NODE,false,false));return ViewCache}();exports.ViewCache=ViewCache},{"../snap/ChildrenNode":37,"./CacheNode":70}],81:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Operation_1=require("../operation/Operation");var util_1=require("@firebase/util");var ChildChangeAccumulator_1=require("./ChildChangeAccumulator");var Change_1=require("./Change");var ChildrenNode_1=require("../snap/ChildrenNode");var KeyIndex_1=require("../snap/indexes/KeyIndex");var ImmutableTree_1=require("../util/ImmutableTree");var Path_1=require("../util/Path");var CompleteChildSource_1=require("./CompleteChildSource");var ProcessorResult=function(){function ProcessorResult(viewCache,changes){this.viewCache=viewCache;this.changes=changes}return ProcessorResult}();exports.ProcessorResult=ProcessorResult;var ViewProcessor=function(){function ViewProcessor(filter_){this.filter_=filter_}ViewProcessor.prototype.assertIndexed=function(viewCache){util_1.assert(viewCache.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed");util_1.assert(viewCache.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")};ViewProcessor.prototype.applyOperation=function(oldViewCache,operation,writesCache,completeCache){var accumulator=new ChildChangeAccumulator_1.ChildChangeAccumulator;var newViewCache,filterServerNode;if(operation.type===Operation_1.OperationType.OVERWRITE){var overwrite=operation;if(overwrite.source.fromUser){newViewCache=this.applyUserOverwrite_(oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,accumulator)}else{util_1.assert(overwrite.source.fromServer,"Unknown source.");filterServerNode=overwrite.source.tagged||oldViewCache.getServerCache().isFiltered()&&!overwrite.path.isEmpty();newViewCache=this.applyServerOverwrite_(oldViewCache,overwrite.path,overwrite.snap,writesCache,completeCache,filterServerNode,accumulator)}}else if(operation.type===Operation_1.OperationType.MERGE){var merge=operation;if(merge.source.fromUser){newViewCache=this.applyUserMerge_(oldViewCache,merge.path,merge.children,writesCache,completeCache,accumulator)}else{util_1.assert(merge.source.fromServer,"Unknown source.");filterServerNode=merge.source.tagged||oldViewCache.getServerCache().isFiltered();newViewCache=this.applyServerMerge_(oldViewCache,merge.path,merge.children,writesCache,completeCache,filterServerNode,accumulator)}}else if(operation.type===Operation_1.OperationType.ACK_USER_WRITE){var ackUserWrite=operation;if(!ackUserWrite.revert){newViewCache=this.ackUserWrite_(oldViewCache,ackUserWrite.path,ackUserWrite.affectedTree,writesCache,completeCache,accumulator)}else{newViewCache=this.revertUserWrite_(oldViewCache,ackUserWrite.path,writesCache,completeCache,accumulator)}}else if(operation.type===Operation_1.OperationType.LISTEN_COMPLETE){newViewCache=this.listenComplete_(oldViewCache,operation.path,writesCache,accumulator)}else{throw util_1.assertionError("Unknown operation type: "+operation.type)}var changes=accumulator.getChanges();ViewProcessor.maybeAddValueEvent_(oldViewCache,newViewCache,changes);return new ProcessorResult(newViewCache,changes)};ViewProcessor.maybeAddValueEvent_=function(oldViewCache,newViewCache,accumulator){var eventSnap=newViewCache.getEventCache();if(eventSnap.isFullyInitialized()){var isLeafOrEmpty=eventSnap.getNode().isLeafNode()||eventSnap.getNode().isEmpty();var oldCompleteSnap=oldViewCache.getCompleteEventSnap();if(accumulator.length>0||!oldViewCache.getEventCache().isFullyInitialized()||isLeafOrEmpty&&!eventSnap.getNode().equals(oldCompleteSnap)||!eventSnap.getNode().getPriority().equals(oldCompleteSnap.getPriority())){accumulator.push(Change_1.Change.valueChange(newViewCache.getCompleteEventSnap()))}}};ViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(viewCache,changePath,writesCache,source,accumulator){var oldEventSnap=viewCache.getEventCache();if(writesCache.shadowingWrite(changePath)!=null){return viewCache}else{var newEventCache=void 0,serverNode=void 0;if(changePath.isEmpty()){util_1.assert(viewCache.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data");if(viewCache.getServerCache().isFiltered()){var serverCache=viewCache.getCompleteServerSnap();var completeChildren=serverCache instanceof ChildrenNode_1.ChildrenNode?serverCache:ChildrenNode_1.ChildrenNode.EMPTY_NODE;var completeEventChildren=writesCache.calcCompleteEventChildren(completeChildren);newEventCache=this.filter_.updateFullNode(viewCache.getEventCache().getNode(),completeEventChildren,accumulator)}else{var completeNode=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());newEventCache=this.filter_.updateFullNode(viewCache.getEventCache().getNode(),completeNode,accumulator)}}else{var childKey=changePath.getFront();if(childKey==".priority"){util_1.assert(changePath.getLength()==1,"Can't have a priority with additional path components");var oldEventNode=oldEventSnap.getNode();serverNode=viewCache.getServerCache().getNode();var updatedPriority=writesCache.calcEventCacheAfterServerOverwrite(changePath,oldEventNode,serverNode);if(updatedPriority!=null){newEventCache=this.filter_.updatePriority(oldEventNode,updatedPriority)}else{newEventCache=oldEventSnap.getNode()}}else{var childChangePath=changePath.popFront();var newEventChild=void 0;if(oldEventSnap.isCompleteForChild(childKey)){serverNode=viewCache.getServerCache().getNode();var eventChildUpdate=writesCache.calcEventCacheAfterServerOverwrite(changePath,oldEventSnap.getNode(),serverNode);if(eventChildUpdate!=null){newEventChild=oldEventSnap.getNode().getImmediateChild(childKey).updateChild(childChangePath,eventChildUpdate)}else{newEventChild=oldEventSnap.getNode().getImmediateChild(childKey)}}else{newEventChild=writesCache.calcCompleteChild(childKey,viewCache.getServerCache())}if(newEventChild!=null){newEventCache=this.filter_.updateChild(oldEventSnap.getNode(),childKey,newEventChild,childChangePath,source,accumulator)}else{newEventCache=oldEventSnap.getNode()}}}return viewCache.updateEventSnap(newEventCache,oldEventSnap.isFullyInitialized()||changePath.isEmpty(),this.filter_.filtersNodes());
}};ViewProcessor.prototype.applyServerOverwrite_=function(oldViewCache,changePath,changedSnap,writesCache,completeCache,filterServerNode,accumulator){var oldServerSnap=oldViewCache.getServerCache();var newServerCache;var serverFilter=filterServerNode?this.filter_:this.filter_.getIndexedFilter();if(changePath.isEmpty()){newServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),changedSnap,null)}else if(serverFilter.filtersNodes()&&!oldServerSnap.isFiltered()){var newServerNode=oldServerSnap.getNode().updateChild(changePath,changedSnap);newServerCache=serverFilter.updateFullNode(oldServerSnap.getNode(),newServerNode,null)}else{var childKey=changePath.getFront();if(!oldServerSnap.isCompleteForPath(changePath)&&changePath.getLength()>1){return oldViewCache}var childChangePath=changePath.popFront();var childNode=oldServerSnap.getNode().getImmediateChild(childKey);var newChildNode=childNode.updateChild(childChangePath,changedSnap);if(childKey==".priority"){newServerCache=serverFilter.updatePriority(oldServerSnap.getNode(),newChildNode)}else{newServerCache=serverFilter.updateChild(oldServerSnap.getNode(),childKey,newChildNode,childChangePath,CompleteChildSource_1.NO_COMPLETE_CHILD_SOURCE,null)}}var newViewCache=oldViewCache.updateServerSnap(newServerCache,oldServerSnap.isFullyInitialized()||changePath.isEmpty(),serverFilter.filtersNodes());var source=new CompleteChildSource_1.WriteTreeCompleteChildSource(writesCache,newViewCache,completeCache);return this.generateEventCacheAfterServerEvent_(newViewCache,changePath,writesCache,source,accumulator)};ViewProcessor.prototype.applyUserOverwrite_=function(oldViewCache,changePath,changedSnap,writesCache,completeCache,accumulator){var oldEventSnap=oldViewCache.getEventCache();var newViewCache,newEventCache;var source=new CompleteChildSource_1.WriteTreeCompleteChildSource(writesCache,oldViewCache,completeCache);if(changePath.isEmpty()){newEventCache=this.filter_.updateFullNode(oldViewCache.getEventCache().getNode(),changedSnap,accumulator);newViewCache=oldViewCache.updateEventSnap(newEventCache,true,this.filter_.filtersNodes())}else{var childKey=changePath.getFront();if(childKey===".priority"){newEventCache=this.filter_.updatePriority(oldViewCache.getEventCache().getNode(),changedSnap);newViewCache=oldViewCache.updateEventSnap(newEventCache,oldEventSnap.isFullyInitialized(),oldEventSnap.isFiltered())}else{var childChangePath=changePath.popFront();var oldChild=oldEventSnap.getNode().getImmediateChild(childKey);var newChild=void 0;if(childChangePath.isEmpty()){newChild=changedSnap}else{var childNode=source.getCompleteChild(childKey);if(childNode!=null){if(childChangePath.getBack()===".priority"&&childNode.getChild(childChangePath.parent()).isEmpty()){newChild=childNode}else{newChild=childNode.updateChild(childChangePath,changedSnap)}}else{newChild=ChildrenNode_1.ChildrenNode.EMPTY_NODE}}if(!oldChild.equals(newChild)){var newEventSnap=this.filter_.updateChild(oldEventSnap.getNode(),childKey,newChild,childChangePath,source,accumulator);newViewCache=oldViewCache.updateEventSnap(newEventSnap,oldEventSnap.isFullyInitialized(),this.filter_.filtersNodes())}else{newViewCache=oldViewCache}}}return newViewCache};ViewProcessor.cacheHasChild_=function(viewCache,childKey){return viewCache.getEventCache().isCompleteForChild(childKey)};ViewProcessor.prototype.applyUserMerge_=function(viewCache,path,changedChildren,writesCache,serverCache,accumulator){var _this=this;var curViewCache=viewCache;changedChildren.foreach(function(relativePath,childNode){var writePath=path.child(relativePath);if(ViewProcessor.cacheHasChild_(viewCache,writePath.getFront())){curViewCache=_this.applyUserOverwrite_(curViewCache,writePath,childNode,writesCache,serverCache,accumulator)}});changedChildren.foreach(function(relativePath,childNode){var writePath=path.child(relativePath);if(!ViewProcessor.cacheHasChild_(viewCache,writePath.getFront())){curViewCache=_this.applyUserOverwrite_(curViewCache,writePath,childNode,writesCache,serverCache,accumulator)}});return curViewCache};ViewProcessor.prototype.applyMerge_=function(node,merge){merge.foreach(function(relativePath,childNode){node=node.updateChild(relativePath,childNode)});return node};ViewProcessor.prototype.applyServerMerge_=function(viewCache,path,changedChildren,writesCache,serverCache,filterServerNode,accumulator){var _this=this;if(viewCache.getServerCache().getNode().isEmpty()&&!viewCache.getServerCache().isFullyInitialized()){return viewCache}var curViewCache=viewCache;var viewMergeTree;if(path.isEmpty()){viewMergeTree=changedChildren}else{viewMergeTree=ImmutableTree_1.ImmutableTree.Empty.setTree(path,changedChildren)}var serverNode=viewCache.getServerCache().getNode();viewMergeTree.children.inorderTraversal(function(childKey,childTree){if(serverNode.hasChild(childKey)){var serverChild=viewCache.getServerCache().getNode().getImmediateChild(childKey);var newChild=_this.applyMerge_(serverChild,childTree);curViewCache=_this.applyServerOverwrite_(curViewCache,new Path_1.Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator)}});viewMergeTree.children.inorderTraversal(function(childKey,childMergeTree){var isUnknownDeepMerge=!viewCache.getServerCache().isCompleteForChild(childKey)&&childMergeTree.value==null;if(!serverNode.hasChild(childKey)&&!isUnknownDeepMerge){var serverChild=viewCache.getServerCache().getNode().getImmediateChild(childKey);var newChild=_this.applyMerge_(serverChild,childMergeTree);curViewCache=_this.applyServerOverwrite_(curViewCache,new Path_1.Path(childKey),newChild,writesCache,serverCache,filterServerNode,accumulator)}});return curViewCache};ViewProcessor.prototype.ackUserWrite_=function(viewCache,ackPath,affectedTree,writesCache,completeCache,accumulator){if(writesCache.shadowingWrite(ackPath)!=null){return viewCache}var filterServerNode=viewCache.getServerCache().isFiltered();var serverCache=viewCache.getServerCache();if(affectedTree.value!=null){if(ackPath.isEmpty()&&serverCache.isFullyInitialized()||serverCache.isCompleteForPath(ackPath)){return this.applyServerOverwrite_(viewCache,ackPath,serverCache.getNode().getChild(ackPath),writesCache,completeCache,filterServerNode,accumulator)}else if(ackPath.isEmpty()){var changedChildren_1=ImmutableTree_1.ImmutableTree.Empty;serverCache.getNode().forEachChild(KeyIndex_1.KEY_INDEX,function(name,node){changedChildren_1=changedChildren_1.set(new Path_1.Path(name),node)});return this.applyServerMerge_(viewCache,ackPath,changedChildren_1,writesCache,completeCache,filterServerNode,accumulator)}else{return viewCache}}else{var changedChildren_2=ImmutableTree_1.ImmutableTree.Empty;affectedTree.foreach(function(mergePath,value){var serverCachePath=ackPath.child(mergePath);if(serverCache.isCompleteForPath(serverCachePath)){changedChildren_2=changedChildren_2.set(mergePath,serverCache.getNode().getChild(serverCachePath))}});return this.applyServerMerge_(viewCache,ackPath,changedChildren_2,writesCache,completeCache,filterServerNode,accumulator)}};ViewProcessor.prototype.listenComplete_=function(viewCache,path,writesCache,accumulator){var oldServerNode=viewCache.getServerCache();var newViewCache=viewCache.updateServerSnap(oldServerNode.getNode(),oldServerNode.isFullyInitialized()||path.isEmpty(),oldServerNode.isFiltered());return this.generateEventCacheAfterServerEvent_(newViewCache,path,writesCache,CompleteChildSource_1.NO_COMPLETE_CHILD_SOURCE,accumulator)};ViewProcessor.prototype.revertUserWrite_=function(viewCache,path,writesCache,completeServerCache,accumulator){var complete;if(writesCache.shadowingWrite(path)!=null){return viewCache}else{var source=new CompleteChildSource_1.WriteTreeCompleteChildSource(writesCache,viewCache,completeServerCache);var oldEventCache=viewCache.getEventCache().getNode();var newEventCache=void 0;if(path.isEmpty()||path.getFront()===".priority"){var newNode=void 0;if(viewCache.getServerCache().isFullyInitialized()){newNode=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap())}else{var serverChildren=viewCache.getServerCache().getNode();util_1.assert(serverChildren instanceof ChildrenNode_1.ChildrenNode,"serverChildren would be complete if leaf node");newNode=writesCache.calcCompleteEventChildren(serverChildren)}newNode=newNode;newEventCache=this.filter_.updateFullNode(oldEventCache,newNode,accumulator)}else{var childKey=path.getFront();var newChild=writesCache.calcCompleteChild(childKey,viewCache.getServerCache());if(newChild==null&&viewCache.getServerCache().isCompleteForChild(childKey)){newChild=oldEventCache.getImmediateChild(childKey)}if(newChild!=null){newEventCache=this.filter_.updateChild(oldEventCache,childKey,newChild,path.popFront(),source,accumulator)}else if(viewCache.getEventCache().getNode().hasChild(childKey)){newEventCache=this.filter_.updateChild(oldEventCache,childKey,ChildrenNode_1.ChildrenNode.EMPTY_NODE,path.popFront(),source,accumulator)}else{newEventCache=oldEventCache}if(newEventCache.isEmpty()&&viewCache.getServerCache().isFullyInitialized()){complete=writesCache.calcCompleteEventCache(viewCache.getCompleteServerSnap());if(complete.isLeafNode()){newEventCache=this.filter_.updateFullNode(newEventCache,complete,accumulator)}}}complete=viewCache.getServerCache().isFullyInitialized()||writesCache.shadowingWrite(Path_1.Path.Empty)!=null;return viewCache.updateEventSnap(newEventCache,complete,this.filter_.filtersNodes())}};return ViewProcessor}();exports.ViewProcessor=ViewProcessor},{"../operation/Operation":35,"../snap/ChildrenNode":37,"../snap/indexes/KeyIndex":44,"../util/ImmutableTree":59,"../util/Path":62,"./Change":71,"./ChildChangeAccumulator":72,"./CompleteChildSource":73,"@firebase/util":139}],82:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var Change_1=require("../Change");var ChildrenNode_1=require("../../snap/ChildrenNode");var PriorityIndex_1=require("../../snap/indexes/PriorityIndex");var IndexedFilter=function(){function IndexedFilter(index_){this.index_=index_}IndexedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){util_1.assert(snap.isIndexed(this.index_),"A node must be indexed if only a child is updated");var oldChild=snap.getImmediateChild(key);if(oldChild.getChild(affectedPath).equals(newChild.getChild(affectedPath))){if(oldChild.isEmpty()==newChild.isEmpty()){return snap}}if(optChangeAccumulator!=null){if(newChild.isEmpty()){if(snap.hasChild(key)){optChangeAccumulator.trackChildChange(Change_1.Change.childRemovedChange(key,oldChild))}else{util_1.assert(snap.isLeafNode(),"A child remove without an old child only makes sense on a leaf node")}}else if(oldChild.isEmpty()){optChangeAccumulator.trackChildChange(Change_1.Change.childAddedChange(key,newChild))}else{optChangeAccumulator.trackChildChange(Change_1.Change.childChangedChange(key,newChild,oldChild))}}if(snap.isLeafNode()&&newChild.isEmpty()){return snap}else{return snap.updateImmediateChild(key,newChild).withIndex(this.index_)}};IndexedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){if(optChangeAccumulator!=null){if(!oldSnap.isLeafNode()){oldSnap.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){if(!newSnap.hasChild(key)){optChangeAccumulator.trackChildChange(Change_1.Change.childRemovedChange(key,childNode))}})}if(!newSnap.isLeafNode()){newSnap.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){if(oldSnap.hasChild(key)){var oldChild=oldSnap.getImmediateChild(key);if(!oldChild.equals(childNode)){optChangeAccumulator.trackChildChange(Change_1.Change.childChangedChange(key,childNode,oldChild))}}else{optChangeAccumulator.trackChildChange(Change_1.Change.childAddedChange(key,childNode))}})}}return newSnap.withIndex(this.index_)};IndexedFilter.prototype.updatePriority=function(oldSnap,newPriority){if(oldSnap.isEmpty()){return ChildrenNode_1.ChildrenNode.EMPTY_NODE}else{return oldSnap.updatePriority(newPriority)}};IndexedFilter.prototype.filtersNodes=function(){return false};IndexedFilter.prototype.getIndexedFilter=function(){return this};IndexedFilter.prototype.getIndex=function(){return this.index_};return IndexedFilter}();exports.IndexedFilter=IndexedFilter},{"../../snap/ChildrenNode":37,"../../snap/indexes/PriorityIndex":46,"../Change":71,"@firebase/util":139}],83:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RangedFilter_1=require("./RangedFilter");var ChildrenNode_1=require("../../snap/ChildrenNode");var Node_1=require("../../snap/Node");var util_1=require("@firebase/util");var Change_1=require("../Change");var LimitedFilter=function(){function LimitedFilter(params){this.rangedFilter_=new RangedFilter_1.RangedFilter(params);this.index_=params.getIndex();this.limit_=params.getLimit();this.reverse_=!params.isViewFromLeft()}LimitedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){if(!this.rangedFilter_.matches(new Node_1.NamedNode(key,newChild))){newChild=ChildrenNode_1.ChildrenNode.EMPTY_NODE}if(snap.getImmediateChild(key).equals(newChild)){return snap}else if(snap.numChildren()<this.limit_){return this.rangedFilter_.getIndexedFilter().updateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator)}else{return this.fullLimitUpdateChild_(snap,key,newChild,source,optChangeAccumulator)}};LimitedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){var filtered;if(newSnap.isLeafNode()||newSnap.isEmpty()){filtered=ChildrenNode_1.ChildrenNode.EMPTY_NODE.withIndex(this.index_)}else{if(this.limit_*2<newSnap.numChildren()&&newSnap.isIndexed(this.index_)){filtered=ChildrenNode_1.ChildrenNode.EMPTY_NODE.withIndex(this.index_);var iterator=void 0;if(this.reverse_){iterator=newSnap.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_)}else{iterator=newSnap.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_)}var count=0;while(iterator.hasNext()&&count<this.limit_){var next=iterator.getNext();var inRange=void 0;if(this.reverse_){inRange=this.index_.compare(this.rangedFilter_.getStartPost(),next)<=0}else{inRange=this.index_.compare(next,this.rangedFilter_.getEndPost())<=0}if(inRange){filtered=filtered.updateImmediateChild(next.name,next.node);count++}else{break}}}else{filtered=newSnap.withIndex(this.index_);filtered=filtered.updatePriority(ChildrenNode_1.ChildrenNode.EMPTY_NODE);var startPost=void 0;var endPost=void 0;var cmp=void 0;var iterator=void 0;if(this.reverse_){iterator=filtered.getReverseIterator(this.index_);startPost=this.rangedFilter_.getEndPost();endPost=this.rangedFilter_.getStartPost();var indexCompare_1=this.index_.getCompare();cmp=function(a,b){return indexCompare_1(b,a)}}else{iterator=filtered.getIterator(this.index_);startPost=this.rangedFilter_.getStartPost();endPost=this.rangedFilter_.getEndPost();cmp=this.index_.getCompare()}var count=0;var foundStartPost=false;while(iterator.hasNext()){var next=iterator.getNext();if(!foundStartPost&&cmp(startPost,next)<=0){foundStartPost=true}var inRange=foundStartPost&&count<this.limit_&&cmp(next,endPost)<=0;if(inRange){count++}else{filtered=filtered.updateImmediateChild(next.name,ChildrenNode_1.ChildrenNode.EMPTY_NODE)}}}}return this.rangedFilter_.getIndexedFilter().updateFullNode(oldSnap,filtered,optChangeAccumulator)};LimitedFilter.prototype.updatePriority=function(oldSnap,newPriority){return oldSnap};LimitedFilter.prototype.filtersNodes=function(){return true};LimitedFilter.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()};LimitedFilter.prototype.getIndex=function(){return this.index_};LimitedFilter.prototype.fullLimitUpdateChild_=function(snap,childKey,childSnap,source,changeAccumulator){var cmp;if(this.reverse_){var indexCmp_1=this.index_.getCompare();cmp=function(a,b){return indexCmp_1(b,a)}}else{cmp=this.index_.getCompare()}var oldEventCache=snap;util_1.assert(oldEventCache.numChildren()==this.limit_,"");var newChildNamedNode=new Node_1.NamedNode(childKey,childSnap);var windowBoundary=this.reverse_?oldEventCache.getFirstChild(this.index_):oldEventCache.getLastChild(this.index_);var inRange=this.rangedFilter_.matches(newChildNamedNode);if(oldEventCache.hasChild(childKey)){var oldChildSnap=oldEventCache.getImmediateChild(childKey);var nextChild=source.getChildAfterChild(this.index_,windowBoundary,this.reverse_);while(nextChild!=null&&(nextChild.name==childKey||oldEventCache.hasChild(nextChild.name))){nextChild=source.getChildAfterChild(this.index_,nextChild,this.reverse_)}var compareNext=nextChild==null?1:cmp(nextChild,newChildNamedNode);var remainsInWindow=inRange&&!childSnap.isEmpty()&&compareNext>=0;if(remainsInWindow){if(changeAccumulator!=null){changeAccumulator.trackChildChange(Change_1.Change.childChangedChange(childKey,childSnap,oldChildSnap))}return oldEventCache.updateImmediateChild(childKey,childSnap)}else{if(changeAccumulator!=null){changeAccumulator.trackChildChange(Change_1.Change.childRemovedChange(childKey,oldChildSnap))}var newEventCache=oldEventCache.updateImmediateChild(childKey,ChildrenNode_1.ChildrenNode.EMPTY_NODE);var nextChildInRange=nextChild!=null&&this.rangedFilter_.matches(nextChild);if(nextChildInRange){if(changeAccumulator!=null){changeAccumulator.trackChildChange(Change_1.Change.childAddedChange(nextChild.name,nextChild.node))}return newEventCache.updateImmediateChild(nextChild.name,nextChild.node)}else{return newEventCache}}}else if(childSnap.isEmpty()){return snap}else if(inRange){if(cmp(windowBoundary,newChildNamedNode)>=0){if(changeAccumulator!=null){changeAccumulator.trackChildChange(Change_1.Change.childRemovedChange(windowBoundary.name,windowBoundary.node));changeAccumulator.trackChildChange(Change_1.Change.childAddedChange(childKey,childSnap))}return oldEventCache.updateImmediateChild(childKey,childSnap).updateImmediateChild(windowBoundary.name,ChildrenNode_1.ChildrenNode.EMPTY_NODE)}else{return snap}}else{return snap}};return LimitedFilter}();exports.LimitedFilter=LimitedFilter},{"../../snap/ChildrenNode":37,"../../snap/Node":40,"../Change":71,"./RangedFilter":84,"@firebase/util":139}],84:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var IndexedFilter_1=require("./IndexedFilter");var PriorityIndex_1=require("../../snap/indexes/PriorityIndex");var Node_1=require("../../../core/snap/Node");var ChildrenNode_1=require("../../snap/ChildrenNode");var RangedFilter=function(){function RangedFilter(params){this.indexedFilter_=new IndexedFilter_1.IndexedFilter(params.getIndex());this.index_=params.getIndex();this.startPost_=RangedFilter.getStartPost_(params);this.endPost_=RangedFilter.getEndPost_(params)}RangedFilter.prototype.getStartPost=function(){return this.startPost_};RangedFilter.prototype.getEndPost=function(){return this.endPost_};RangedFilter.prototype.matches=function(node){return this.index_.compare(this.getStartPost(),node)<=0&&this.index_.compare(node,this.getEndPost())<=0};RangedFilter.prototype.updateChild=function(snap,key,newChild,affectedPath,source,optChangeAccumulator){if(!this.matches(new Node_1.NamedNode(key,newChild))){newChild=ChildrenNode_1.ChildrenNode.EMPTY_NODE}return this.indexedFilter_.updateChild(snap,key,newChild,affectedPath,source,optChangeAccumulator)};RangedFilter.prototype.updateFullNode=function(oldSnap,newSnap,optChangeAccumulator){if(newSnap.isLeafNode()){newSnap=ChildrenNode_1.ChildrenNode.EMPTY_NODE}var filtered=newSnap.withIndex(this.index_);filtered=filtered.updatePriority(ChildrenNode_1.ChildrenNode.EMPTY_NODE);var self=this;newSnap.forEachChild(PriorityIndex_1.PRIORITY_INDEX,function(key,childNode){if(!self.matches(new Node_1.NamedNode(key,childNode))){filtered=filtered.updateImmediateChild(key,ChildrenNode_1.ChildrenNode.EMPTY_NODE)}});return this.indexedFilter_.updateFullNode(oldSnap,filtered,optChangeAccumulator)};RangedFilter.prototype.updatePriority=function(oldSnap,newPriority){return oldSnap};RangedFilter.prototype.filtersNodes=function(){return true};RangedFilter.prototype.getIndexedFilter=function(){return this.indexedFilter_};RangedFilter.prototype.getIndex=function(){return this.index_};RangedFilter.getStartPost_=function(params){if(params.hasStart()){var startName=params.getIndexStartName();return params.getIndex().makePost(params.getIndexStartValue(),startName)}else{return params.getIndex().minPost()}};RangedFilter.getEndPost_=function(params){if(params.hasEnd()){var endName=params.getIndexEndName();return params.getIndex().makePost(params.getIndexEndValue(),endName)}else{return params.getIndex().maxPost()}};return RangedFilter}();exports.RangedFilter=RangedFilter},{"../../../core/snap/Node":40,"../../snap/ChildrenNode":37,"../../snap/indexes/PriorityIndex":46,"./IndexedFilter":82}],85:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../core/util/util");var CountedSet_1=require("../core/util/CountedSet");var StatsManager_1=require("../core/stats/StatsManager");var PacketReceiver_1=require("./polling/PacketReceiver");var Constants_1=require("./Constants");var util_2=require("@firebase/util");var util_3=require("@firebase/util");exports.FIREBASE_LONGPOLL_START_PARAM="start";exports.FIREBASE_LONGPOLL_CLOSE_COMMAND="close";exports.FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand";exports.FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB";exports.FIREBASE_LONGPOLL_ID_PARAM="id";exports.FIREBASE_LONGPOLL_PW_PARAM="pw";exports.FIREBASE_LONGPOLL_SERIAL_PARAM="ser";exports.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb";exports.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg";exports.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts";exports.FIREBASE_LONGPOLL_DATA_PARAM="d";exports.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM="disconn";exports.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe";var MAX_URL_DATA_SIZE=1870;var SEG_HEADER_SIZE=30;var MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE;var KEEPALIVE_REQUEST_INTERVAL=25e3;var LP_CONNECT_TIMEOUT=3e4;var BrowserPollConnection=function(){function BrowserPollConnection(connId,repoInfo,transportSessionId,lastSessionId){this.connId=connId;this.repoInfo=repoInfo;this.transportSessionId=transportSessionId;this.lastSessionId=lastSessionId;this.bytesSent=0;this.bytesReceived=0;this.everConnected_=false;this.log_=util_1.logWrapper(connId);this.stats_=StatsManager_1.StatsManager.getCollection(repoInfo);this.urlFn=function(params){return repoInfo.connectionURL(Constants_1.LONG_POLLING,params)}}BrowserPollConnection.prototype.open=function(onMessage,onDisconnect){var _this=this;this.curSegmentNum=0;this.onDisconnect_=onDisconnect;this.myPacketOrderer=new PacketReceiver_1.PacketReceiver(onMessage);this.isClosed_=false;this.connectTimeoutTimer_=setTimeout(function(){_this.log_("Timed out trying to connect.");_this.onClosed_();_this.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT));util_1.executeWhenDOMReady(function(){if(_this.isClosed_)return;_this.scriptTagHolder=new FirebaseIFrameScriptHolder(function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var command=args[0],arg1=args[1],arg2=args[2],arg3=args[3],arg4=args[4];_this.incrementIncomingBytes_(args);if(!_this.scriptTagHolder)return;if(_this.connectTimeoutTimer_){clearTimeout(_this.connectTimeoutTimer_);_this.connectTimeoutTimer_=null}_this.everConnected_=true;if(command==exports.FIREBASE_LONGPOLL_START_PARAM){_this.id=arg1;_this.password=arg2}else if(command===exports.FIREBASE_LONGPOLL_CLOSE_COMMAND){if(arg1){_this.scriptTagHolder.sendNewPolls=false;_this.myPacketOrderer.closeAfter(arg1,function(){_this.onClosed_()})}else{_this.onClosed_()}}else{throw new Error("Unrecognized command received: "+command)}},function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}var pN=args[0],data=args[1];_this.incrementIncomingBytes_(args);_this.myPacketOrderer.handleResponse(pN,data)},function(){_this.onClosed_()},_this.urlFn);var urlParams={};urlParams[exports.FIREBASE_LONGPOLL_START_PARAM]="t";urlParams[exports.FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(Math.random()*1e8);if(_this.scriptTagHolder.uniqueCallbackIdentifier)urlParams[exports.FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=_this.scriptTagHolder.uniqueCallbackIdentifier;urlParams[Constants_1.VERSION_PARAM]=Constants_1.PROTOCOL_VERSION;if(_this.transportSessionId){urlParams[Constants_1.TRANSPORT_SESSION_PARAM]=_this.transportSessionId}if(_this.lastSessionId){urlParams[Constants_1.LAST_SESSION_PARAM]=_this.lastSessionId}if(!util_3.isNodeSdk()&&typeof location!=="undefined"&&location.href&&location.href.indexOf(Constants_1.FORGE_DOMAIN)!==-1){urlParams[Constants_1.REFERER_PARAM]=Constants_1.FORGE_REF}var connectURL=_this.urlFn(urlParams);_this.log_("Connecting via long-poll to "+connectURL);_this.scriptTagHolder.addTag(connectURL,function(){})})};BrowserPollConnection.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password);this.addDisconnectPingFrame(this.id,this.password)};BrowserPollConnection.forceAllow=function(){BrowserPollConnection.forceAllow_=true};BrowserPollConnection.forceDisallow=function(){BrowserPollConnection.forceDisallow_=true};BrowserPollConnection.isAvailable=function(){return BrowserPollConnection.forceAllow_||!BrowserPollConnection.forceDisallow_&&typeof document!=="undefined"&&document.createElement!=null&&!util_1.isChromeExtensionContentScript()&&!util_1.isWindowsStoreApp()&&!util_3.isNodeSdk()};BrowserPollConnection.prototype.markConnectionHealthy=function(){};BrowserPollConnection.prototype.shutdown_=function(){this.isClosed_=true;if(this.scriptTagHolder){this.scriptTagHolder.close();this.scriptTagHolder=null}if(this.myDisconnFrame){document.body.removeChild(this.myDisconnFrame);this.myDisconnFrame=null}if(this.connectTimeoutTimer_){clearTimeout(this.connectTimeoutTimer_);this.connectTimeoutTimer_=null}};BrowserPollConnection.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("Longpoll is closing itself");this.shutdown_();if(this.onDisconnect_){this.onDisconnect_(this.everConnected_);this.onDisconnect_=null}}};BrowserPollConnection.prototype.close=function(){if(!this.isClosed_){this.log_("Longpoll is being closed.");this.shutdown_()}};BrowserPollConnection.prototype.send=function(data){var dataStr=util_2.stringify(data);this.bytesSent+=dataStr.length;this.stats_.incrementCounter("bytes_sent",dataStr.length);var base64data=util_2.base64Encode(dataStr);var dataSegs=util_1.splitStringBySize(base64data,MAX_PAYLOAD_SIZE);for(var i=0;i<dataSegs.length;i++){this.scriptTagHolder.enqueueSegment(this.curSegmentNum,dataSegs.length,dataSegs[i]);this.curSegmentNum++}};BrowserPollConnection.prototype.addDisconnectPingFrame=function(id,pw){if(util_3.isNodeSdk())return;this.myDisconnFrame=document.createElement("iframe");var urlParams={};urlParams[exports.FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t";urlParams[exports.FIREBASE_LONGPOLL_ID_PARAM]=id;urlParams[exports.FIREBASE_LONGPOLL_PW_PARAM]=pw;this.myDisconnFrame.src=this.urlFn(urlParams);this.myDisconnFrame.style.display="none";document.body.appendChild(this.myDisconnFrame)};BrowserPollConnection.prototype.incrementIncomingBytes_=function(args){var bytesReceived=util_2.stringify(args).length;this.bytesReceived+=bytesReceived;this.stats_.incrementCounter("bytes_received",bytesReceived)};return BrowserPollConnection}();exports.BrowserPollConnection=BrowserPollConnection;var FirebaseIFrameScriptHolder=function(){function FirebaseIFrameScriptHolder(commandCB,onMessageCB,onDisconnect,urlFn){this.onDisconnect=onDisconnect;this.urlFn=urlFn;this.outstandingRequests=new CountedSet_1.CountedSet;this.pendingSegs=[];this.currentSerial=Math.floor(Math.random()*1e8);this.sendNewPolls=true;if(!util_3.isNodeSdk()){this.uniqueCallbackIdentifier=util_1.LUIDGenerator();window[exports.FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=commandCB;window[exports.FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=onMessageCB;this.myIFrame=FirebaseIFrameScriptHolder.createIFrame_();var script="";if(this.myIFrame.src&&this.myIFrame.src.substr(0,"javascript:".length)==="javascript:"){var currentDomain=document.domain;script='<script>document.domain="'+currentDomain+'";</script>'}var iframeContents="<html><body>"+script+"</body></html>";try{this.myIFrame.doc.open();this.myIFrame.doc.write(iframeContents);this.myIFrame.doc.close()}catch(e){util_1.log("frame writing exception");if(e.stack){util_1.log(e.stack)}util_1.log(e)}}else{this.commandCB=commandCB;this.onMessageCB=onMessageCB}}FirebaseIFrameScriptHolder.createIFrame_=function(){var iframe=document.createElement("iframe");iframe.style.display="none";if(document.body){document.body.appendChild(iframe);try{var a=iframe.contentWindow.document;if(!a){util_1.log("No IE domain setting required")}}catch(e){var domain=document.domain;iframe.src="javascript:void((function(){document.open();document.domain='"+domain+"';document.close();})())"}}else{throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready."}if(iframe.contentDocument){iframe.doc=iframe.contentDocument}else if(iframe.contentWindow){iframe.doc=iframe.contentWindow.document}else if(iframe.document){iframe.doc=iframe.document}return iframe};FirebaseIFrameScriptHolder.prototype.close=function(){var _this=this;this.alive=false;if(this.myIFrame){this.myIFrame.doc.body.innerHTML="";setTimeout(function(){if(_this.myIFrame!==null){document.body.removeChild(_this.myIFrame);_this.myIFrame=null}},Math.floor(0))}if(util_3.isNodeSdk()&&this.myID){var urlParams={};urlParams[exports.FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]="t";urlParams[exports.FIREBASE_LONGPOLL_ID_PARAM]=this.myID;urlParams[exports.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;var theURL=this.urlFn(urlParams);FirebaseIFrameScriptHolder.nodeRestRequest(theURL)}var onDisconnect=this.onDisconnect;if(onDisconnect){this.onDisconnect=null;onDisconnect()}};FirebaseIFrameScriptHolder.prototype.startLongPoll=function(id,pw){this.myID=id;this.myPW=pw;this.alive=true;while(this.newRequest_()){}};FirebaseIFrameScriptHolder.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var urlParams={};urlParams[exports.FIREBASE_LONGPOLL_ID_PARAM]=this.myID;urlParams[exports.FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;urlParams[exports.FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;var theURL=this.urlFn(urlParams);var curDataString="";var i=0;while(this.pendingSegs.length>0){var nextSeg=this.pendingSegs[0];if(nextSeg.d.length+SEG_HEADER_SIZE+curDataString.length<=MAX_URL_DATA_SIZE){var theSeg=this.pendingSegs.shift();curDataString=curDataString+"&"+exports.FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+i+"="+theSeg.seg+"&"+exports.FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+i+"="+theSeg.ts+"&"+exports.FIREBASE_LONGPOLL_DATA_PARAM+i+"="+theSeg.d;i++}else{break}}theURL=theURL+curDataString;this.addLongPollTag_(theURL,this.currentSerial);return true}else{return false}};FirebaseIFrameScriptHolder.prototype.enqueueSegment=function(segnum,totalsegs,data){this.pendingSegs.push({seg:segnum,ts:totalsegs,d:data});if(this.alive){this.newRequest_()}};FirebaseIFrameScriptHolder.prototype.addLongPollTag_=function(url,serial){var _this=this;this.outstandingRequests.add(serial,1);var doNewRequest=function(){_this.outstandingRequests.remove(serial);_this.newRequest_()};var keepaliveTimeout=setTimeout(doNewRequest,Math.floor(KEEPALIVE_REQUEST_INTERVAL));var readyStateCB=function(){clearTimeout(keepaliveTimeout);doNewRequest()};this.addTag(url,readyStateCB)};FirebaseIFrameScriptHolder.prototype.addTag=function(url,loadCB){var _this=this;if(util_3.isNodeSdk()){this.doNodeLongPoll(url,loadCB)}else{setTimeout(function(){try{if(!_this.sendNewPolls)return;var newScript_1=_this.myIFrame.doc.createElement("script");newScript_1.type="text/javascript";newScript_1.async=true;
newScript_1.src=url;newScript_1.onload=newScript_1.onreadystatechange=function(){var rstate=newScript_1.readyState;if(!rstate||rstate==="loaded"||rstate==="complete"){newScript_1.onload=newScript_1.onreadystatechange=null;if(newScript_1.parentNode){newScript_1.parentNode.removeChild(newScript_1)}loadCB()}};newScript_1.onerror=function(){util_1.log("Long-poll script failed to load: "+url);_this.sendNewPolls=false;_this.close()};_this.myIFrame.doc.body.appendChild(newScript_1)}catch(e){}},Math.floor(1))}};return FirebaseIFrameScriptHolder}();exports.FirebaseIFrameScriptHolder=FirebaseIFrameScriptHolder},{"../core/stats/StatsManager":52,"../core/util/CountedSet":57,"../core/util/util":68,"./Constants":87,"./polling/PacketReceiver":90,"@firebase/util":139}],86:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../core/util/util");var storage_1=require("../core/storage/storage");var Constants_1=require("./Constants");var TransportManager_1=require("./TransportManager");var UPGRADE_TIMEOUT=6e4;var DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3;var BYTES_SENT_HEALTHY_OVERRIDE=10*1024;var BYTES_RECEIVED_HEALTHY_OVERRIDE=100*1024;var MESSAGE_TYPE="t";var MESSAGE_DATA="d";var CONTROL_SHUTDOWN="s";var CONTROL_RESET="r";var CONTROL_ERROR="e";var CONTROL_PONG="o";var SWITCH_ACK="a";var END_TRANSMISSION="n";var PING="p";var SERVER_HELLO="h";var Connection=function(){function Connection(id,repoInfo_,onMessage_,onReady_,onDisconnect_,onKill_,lastSessionId){this.id=id;this.repoInfo_=repoInfo_;this.onMessage_=onMessage_;this.onReady_=onReady_;this.onDisconnect_=onDisconnect_;this.onKill_=onKill_;this.lastSessionId=lastSessionId;this.connectionCount=0;this.pendingDataMessages=[];this.state_=0;this.log_=util_1.logWrapper("c:"+this.id+":");this.transportManager_=new TransportManager_1.TransportManager(repoInfo_);this.log_("Connection created");this.start_()}Connection.prototype.start_=function(){var _this=this;var conn=this.transportManager_.initialTransport();this.conn_=new conn(this.nextTransportId_(),this.repoInfo_,undefined,this.lastSessionId);this.primaryResponsesRequired_=conn["responsesRequiredToBeHealthy"]||0;var onMessageReceived=this.connReceiver_(this.conn_);var onConnectionLost=this.disconnReceiver_(this.conn_);this.tx_=this.conn_;this.rx_=this.conn_;this.secondaryConn_=null;this.isHealthy_=false;setTimeout(function(){_this.conn_&&_this.conn_.open(onMessageReceived,onConnectionLost)},Math.floor(0));var healthyTimeout_ms=conn["healthyTimeout"]||0;if(healthyTimeout_ms>0){this.healthyTimeout_=util_1.setTimeoutNonBlocking(function(){_this.healthyTimeout_=null;if(!_this.isHealthy_){if(_this.conn_&&_this.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE){_this.log_("Connection exceeded healthy timeout but has received "+_this.conn_.bytesReceived+" bytes.  Marking connection healthy.");_this.isHealthy_=true;_this.conn_.markConnectionHealthy()}else if(_this.conn_&&_this.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE){_this.log_("Connection exceeded healthy timeout but has sent "+_this.conn_.bytesSent+" bytes.  Leaving connection alive.")}else{_this.log_("Closing unhealthy connection after timeout.");_this.close()}}},Math.floor(healthyTimeout_ms))}};Connection.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++};Connection.prototype.disconnReceiver_=function(conn){var _this=this;return function(everConnected){if(conn===_this.conn_){_this.onConnectionLost_(everConnected)}else if(conn===_this.secondaryConn_){_this.log_("Secondary connection lost.");_this.onSecondaryConnectionLost_()}else{_this.log_("closing an old connection")}}};Connection.prototype.connReceiver_=function(conn){var _this=this;return function(message){if(_this.state_!=2){if(conn===_this.rx_){_this.onPrimaryMessageReceived_(message)}else if(conn===_this.secondaryConn_){_this.onSecondaryMessageReceived_(message)}else{_this.log_("message on old connection")}}}};Connection.prototype.sendRequest=function(dataMsg){var msg={t:"d",d:dataMsg};this.sendData_(msg)};Connection.prototype.tryCleanupConnection=function(){if(this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_){this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId);this.conn_=this.secondaryConn_;this.secondaryConn_=null}};Connection.prototype.onSecondaryControl_=function(controlData){if(MESSAGE_TYPE in controlData){var cmd=controlData[MESSAGE_TYPE];if(cmd===SWITCH_ACK){this.upgradeIfSecondaryHealthy_()}else if(cmd===CONTROL_RESET){this.log_("Got a reset on secondary, closing it");this.secondaryConn_.close();if(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_){this.close()}}else if(cmd===CONTROL_PONG){this.log_("got pong on secondary.");this.secondaryResponsesRequired_--;this.upgradeIfSecondaryHealthy_()}}};Connection.prototype.onSecondaryMessageReceived_=function(parsedData){var layer=util_1.requireKey("t",parsedData);var data=util_1.requireKey("d",parsedData);if(layer=="c"){this.onSecondaryControl_(data)}else if(layer=="d"){this.pendingDataMessages.push(data)}else{throw new Error("Unknown protocol layer: "+layer)}};Connection.prototype.upgradeIfSecondaryHealthy_=function(){if(this.secondaryResponsesRequired_<=0){this.log_("Secondary connection is healthy.");this.isHealthy_=true;this.secondaryConn_.markConnectionHealthy();this.proceedWithUpgrade_()}else{this.log_("sending ping on secondary.");this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}})}};Connection.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start();this.log_("sending client ack on secondary");this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}});this.log_("Ending transmission on primary");this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}});this.tx_=this.secondaryConn_;this.tryCleanupConnection()};Connection.prototype.onPrimaryMessageReceived_=function(parsedData){var layer=util_1.requireKey("t",parsedData);var data=util_1.requireKey("d",parsedData);if(layer=="c"){this.onControl_(data)}else if(layer=="d"){this.onDataMessage_(data)}};Connection.prototype.onDataMessage_=function(message){this.onPrimaryResponse_();this.onMessage_(message)};Connection.prototype.onPrimaryResponse_=function(){if(!this.isHealthy_){this.primaryResponsesRequired_--;if(this.primaryResponsesRequired_<=0){this.log_("Primary connection is healthy.");this.isHealthy_=true;this.conn_.markConnectionHealthy()}}};Connection.prototype.onControl_=function(controlData){var cmd=util_1.requireKey(MESSAGE_TYPE,controlData);if(MESSAGE_DATA in controlData){var payload=controlData[MESSAGE_DATA];if(cmd===SERVER_HELLO){this.onHandshake_(payload)}else if(cmd===END_TRANSMISSION){this.log_("recvd end transmission on primary");this.rx_=this.secondaryConn_;for(var i=0;i<this.pendingDataMessages.length;++i){this.onDataMessage_(this.pendingDataMessages[i])}this.pendingDataMessages=[];this.tryCleanupConnection()}else if(cmd===CONTROL_SHUTDOWN){this.onConnectionShutdown_(payload)}else if(cmd===CONTROL_RESET){this.onReset_(payload)}else if(cmd===CONTROL_ERROR){util_1.error("Server Error: "+payload)}else if(cmd===CONTROL_PONG){this.log_("got pong on primary.");this.onPrimaryResponse_();this.sendPingOnPrimaryIfNecessary_()}else{util_1.error("Unknown control packet command: "+cmd)}}};Connection.prototype.onHandshake_=function(handshake){var timestamp=handshake.ts;var version=handshake.v;var host=handshake.h;this.sessionId=handshake.s;this.repoInfo_.updateHost(host);if(this.state_==0){this.conn_.start();this.onConnectionEstablished_(this.conn_,timestamp);if(Constants_1.PROTOCOL_VERSION!==version){util_1.warn("Protocol version mismatch detected")}this.tryStartUpgrade_()}};Connection.prototype.tryStartUpgrade_=function(){var conn=this.transportManager_.upgradeTransport();if(conn){this.startUpgrade_(conn)}};Connection.prototype.startUpgrade_=function(conn){var _this=this;this.secondaryConn_=new conn(this.nextTransportId_(),this.repoInfo_,this.sessionId);this.secondaryResponsesRequired_=conn["responsesRequiredToBeHealthy"]||0;var onMessage=this.connReceiver_(this.secondaryConn_);var onDisconnect=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(onMessage,onDisconnect);util_1.setTimeoutNonBlocking(function(){if(_this.secondaryConn_){_this.log_("Timed out trying to upgrade.");_this.secondaryConn_.close()}},Math.floor(UPGRADE_TIMEOUT))};Connection.prototype.onReset_=function(host){this.log_("Reset packet received.  New host: "+host);this.repoInfo_.updateHost(host);if(this.state_===1){this.close()}else{this.closeConnections_();this.start_()}};Connection.prototype.onConnectionEstablished_=function(conn,timestamp){var _this=this;this.log_("Realtime connection established.");this.conn_=conn;this.state_=1;if(this.onReady_){this.onReady_(timestamp,this.sessionId);this.onReady_=null}if(this.primaryResponsesRequired_===0){this.log_("Primary connection is healthy.");this.isHealthy_=true}else{util_1.setTimeoutNonBlocking(function(){_this.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))}};Connection.prototype.sendPingOnPrimaryIfNecessary_=function(){if(!this.isHealthy_&&this.state_===1){this.log_("sending ping on primary.");this.sendData_({t:"c",d:{t:PING,d:{}}})}};Connection.prototype.onSecondaryConnectionLost_=function(){var conn=this.secondaryConn_;this.secondaryConn_=null;if(this.tx_===conn||this.rx_===conn){this.close()}};Connection.prototype.onConnectionLost_=function(everConnected){this.conn_=null;if(!everConnected&&this.state_===0){this.log_("Realtime connection failed.");if(this.repoInfo_.isCacheableHost()){storage_1.PersistentStorage.remove("host:"+this.repoInfo_.host);this.repoInfo_.internalHost=this.repoInfo_.host}}else if(this.state_===1){this.log_("Realtime connection lost.")}this.close()};Connection.prototype.onConnectionShutdown_=function(reason){this.log_("Connection shutdown command received. Shutting down...");if(this.onKill_){this.onKill_(reason);this.onKill_=null}this.onDisconnect_=null;this.close()};Connection.prototype.sendData_=function(data){if(this.state_!==1){throw"Connection is not connected"}else{this.tx_.send(data)}};Connection.prototype.close=function(){if(this.state_!==2){this.log_("Closing realtime connection.");this.state_=2;this.closeConnections_();if(this.onDisconnect_){this.onDisconnect_();this.onDisconnect_=null}}};Connection.prototype.closeConnections_=function(){this.log_("Shutting down all connections");if(this.conn_){this.conn_.close();this.conn_=null}if(this.secondaryConn_){this.secondaryConn_.close();this.secondaryConn_=null}if(this.healthyTimeout_){clearTimeout(this.healthyTimeout_);this.healthyTimeout_=null}};return Connection}();exports.Connection=Connection},{"../core/storage/storage":56,"../core/util/util":68,"./Constants":87,"./TransportManager":88}],87:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PROTOCOL_VERSION="5";exports.VERSION_PARAM="v";exports.TRANSPORT_SESSION_PARAM="s";exports.REFERER_PARAM="r";exports.FORGE_REF="f";exports.FORGE_DOMAIN="firebaseio.com";exports.LAST_SESSION_PARAM="ls";exports.WEBSOCKET="websocket";exports.LONG_POLLING="long_polling"},{}],88:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var BrowserPollConnection_1=require("./BrowserPollConnection");var WebSocketConnection_1=require("./WebSocketConnection");var util_1=require("../core/util/util");var TransportManager=function(){function TransportManager(repoInfo){this.initTransports_(repoInfo)}Object.defineProperty(TransportManager,"ALL_TRANSPORTS",{get:function(){return[BrowserPollConnection_1.BrowserPollConnection,WebSocketConnection_1.WebSocketConnection]},enumerable:true,configurable:true});TransportManager.prototype.initTransports_=function(repoInfo){var isWebSocketsAvailable=WebSocketConnection_1.WebSocketConnection&&WebSocketConnection_1.WebSocketConnection["isAvailable"]();var isSkipPollConnection=isWebSocketsAvailable&&!WebSocketConnection_1.WebSocketConnection.previouslyFailed();if(repoInfo.webSocketOnly){if(!isWebSocketsAvailable)util_1.warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway.");isSkipPollConnection=true}if(isSkipPollConnection){this.transports_=[WebSocketConnection_1.WebSocketConnection]}else{var transports_1=this.transports_=[];util_1.each(TransportManager.ALL_TRANSPORTS,function(i,transport){if(transport&&transport["isAvailable"]()){transports_1.push(transport)}})}};TransportManager.prototype.initialTransport=function(){if(this.transports_.length>0){return this.transports_[0]}else{throw new Error("No transports available")}};TransportManager.prototype.upgradeTransport=function(){if(this.transports_.length>1){return this.transports_[1]}else{return null}};return TransportManager}();exports.TransportManager=TransportManager},{"../core/util/util":68,"./BrowserPollConnection":85,"./WebSocketConnection":89}],89:[function(require,module,exports){(function(process){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var app_1=require("@firebase/app");var util_1=require("@firebase/util");var util_2=require("../core/util/util");var StatsManager_1=require("../core/stats/StatsManager");var Constants_1=require("./Constants");var util_3=require("@firebase/util");var storage_1=require("../core/storage/storage");var util_4=require("@firebase/util");var util_5=require("@firebase/util");var WEBSOCKET_MAX_FRAME_SIZE=16384;var WEBSOCKET_KEEPALIVE_INTERVAL=45e3;var WebSocketImpl=null;if(typeof MozWebSocket!=="undefined"){WebSocketImpl=MozWebSocket}else if(typeof WebSocket!=="undefined"){WebSocketImpl=WebSocket}function setWebSocketImpl(impl){WebSocketImpl=impl}exports.setWebSocketImpl=setWebSocketImpl;var WebSocketConnection=function(){function WebSocketConnection(connId,repoInfo,transportSessionId,lastSessionId){this.connId=connId;this.keepaliveTimer=null;this.frames=null;this.totalFrames=0;this.bytesSent=0;this.bytesReceived=0;this.log_=util_2.logWrapper(this.connId);this.stats_=StatsManager_1.StatsManager.getCollection(repoInfo);this.connURL=WebSocketConnection.connectionURL_(repoInfo,transportSessionId,lastSessionId)}WebSocketConnection.connectionURL_=function(repoInfo,transportSessionId,lastSessionId){var urlParams={};urlParams[Constants_1.VERSION_PARAM]=Constants_1.PROTOCOL_VERSION;if(!util_5.isNodeSdk()&&typeof location!=="undefined"&&location.href&&location.href.indexOf(Constants_1.FORGE_DOMAIN)!==-1){urlParams[Constants_1.REFERER_PARAM]=Constants_1.FORGE_REF}if(transportSessionId){urlParams[Constants_1.TRANSPORT_SESSION_PARAM]=transportSessionId}if(lastSessionId){urlParams[Constants_1.LAST_SESSION_PARAM]=lastSessionId}return repoInfo.connectionURL(Constants_1.WEBSOCKET,urlParams)};WebSocketConnection.prototype.open=function(onMessage,onDisconnect){var _this=this;this.onDisconnect=onDisconnect;this.onMessage=onMessage;this.log_("Websocket connecting to "+this.connURL);this.everConnected_=false;storage_1.PersistentStorage.set("previous_websocket_failure",true);try{if(util_5.isNodeSdk()){var device=util_3.CONSTANTS.NODE_ADMIN?"AdminNode":"Node";var options={headers:{"User-Agent":"Firebase/"+Constants_1.PROTOCOL_VERSION+"/"+app_1.default.SDK_VERSION+"/"+process.platform+"/"+device}};var env=process["env"];var proxy=this.connURL.indexOf("wss://")==0?env["HTTPS_PROXY"]||env["https_proxy"]:env["HTTP_PROXY"]||env["http_proxy"];if(proxy){options["proxy"]={origin:proxy}}this.mySock=new WebSocketImpl(this.connURL,[],options)}else{this.mySock=new WebSocketImpl(this.connURL)}}catch(e){this.log_("Error instantiating WebSocket.");var error=e.message||e.data;if(error){this.log_(error)}this.onClosed_();return}this.mySock.onopen=function(){_this.log_("Websocket connected.");_this.everConnected_=true};this.mySock.onclose=function(){_this.log_("Websocket connection was disconnected.");_this.mySock=null;_this.onClosed_()};this.mySock.onmessage=function(m){_this.handleIncomingFrame(m)};this.mySock.onerror=function(e){_this.log_("WebSocket error.  Closing connection.");var error=e.message||e.data;if(error){_this.log_(error)}_this.onClosed_()}};WebSocketConnection.prototype.start=function(){};WebSocketConnection.forceDisallow=function(){WebSocketConnection.forceDisallow_=true};WebSocketConnection.isAvailable=function(){var isOldAndroid=false;if(typeof navigator!=="undefined"&&navigator.userAgent){var oldAndroidRegex=/Android ([0-9]{0,}\.[0-9]{0,})/;var oldAndroidMatch=navigator.userAgent.match(oldAndroidRegex);if(oldAndroidMatch&&oldAndroidMatch.length>1){if(parseFloat(oldAndroidMatch[1])<4.4){isOldAndroid=true}}}return!isOldAndroid&&WebSocketImpl!==null&&!WebSocketConnection.forceDisallow_};WebSocketConnection.previouslyFailed=function(){return storage_1.PersistentStorage.isInMemoryStorage||storage_1.PersistentStorage.get("previous_websocket_failure")===true};WebSocketConnection.prototype.markConnectionHealthy=function(){storage_1.PersistentStorage.remove("previous_websocket_failure")};WebSocketConnection.prototype.appendFrame_=function(data){this.frames.push(data);if(this.frames.length==this.totalFrames){var fullMess=this.frames.join("");this.frames=null;var jsonMess=util_4.jsonEval(fullMess);this.onMessage(jsonMess)}};WebSocketConnection.prototype.handleNewFrameCount_=function(frameCount){this.totalFrames=frameCount;this.frames=[]};WebSocketConnection.prototype.extractFrameCount_=function(data){util_1.assert(this.frames===null,"We already have a frame buffer");if(data.length<=6){var frameCount=Number(data);if(!isNaN(frameCount)){this.handleNewFrameCount_(frameCount);return null}}this.handleNewFrameCount_(1);return data};WebSocketConnection.prototype.handleIncomingFrame=function(mess){if(this.mySock===null)return;var data=mess["data"];this.bytesReceived+=data.length;this.stats_.incrementCounter("bytes_received",data.length);this.resetKeepAlive();if(this.frames!==null){this.appendFrame_(data)}else{var remainingData=this.extractFrameCount_(data);if(remainingData!==null){this.appendFrame_(remainingData)}}};WebSocketConnection.prototype.send=function(data){this.resetKeepAlive();var dataStr=util_4.stringify(data);this.bytesSent+=dataStr.length;this.stats_.incrementCounter("bytes_sent",dataStr.length);var dataSegs=util_2.splitStringBySize(dataStr,WEBSOCKET_MAX_FRAME_SIZE);if(dataSegs.length>1){this.sendString_(String(dataSegs.length))}for(var i=0;i<dataSegs.length;i++){this.sendString_(dataSegs[i])}};WebSocketConnection.prototype.shutdown_=function(){this.isClosed_=true;if(this.keepaliveTimer){clearInterval(this.keepaliveTimer);this.keepaliveTimer=null}if(this.mySock){this.mySock.close();this.mySock=null}};WebSocketConnection.prototype.onClosed_=function(){if(!this.isClosed_){this.log_("WebSocket is closing itself");this.shutdown_();if(this.onDisconnect){this.onDisconnect(this.everConnected_);this.onDisconnect=null}}};WebSocketConnection.prototype.close=function(){if(!this.isClosed_){this.log_("WebSocket is being closed");this.shutdown_()}};WebSocketConnection.prototype.resetKeepAlive=function(){var _this=this;clearInterval(this.keepaliveTimer);this.keepaliveTimer=setInterval(function(){if(_this.mySock){_this.sendString_("0")}_this.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))};WebSocketConnection.prototype.sendString_=function(str){try{this.mySock.send(str)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection.");setTimeout(this.onClosed_.bind(this),0)}};WebSocketConnection.responsesRequiredToBeHealthy=2;WebSocketConnection.healthyTimeout=3e4;return WebSocketConnection}();exports.WebSocketConnection=WebSocketConnection}).call(this,require("_process"))},{"../core/stats/StatsManager":52,"../core/storage/storage":56,"../core/util/util":68,"./Constants":87,"@firebase/app":6,"@firebase/util":139,_process:187}],90:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("../../core/util/util");var PacketReceiver=function(){function PacketReceiver(onMessage_){this.onMessage_=onMessage_;this.pendingResponses=[];this.currentResponseNum=0;this.closeAfterResponse=-1;this.onClose=null}PacketReceiver.prototype.closeAfter=function(responseNum,callback){this.closeAfterResponse=responseNum;this.onClose=callback;if(this.closeAfterResponse<this.currentResponseNum){this.onClose();this.onClose=null}};PacketReceiver.prototype.handleResponse=function(requestNum,data){var _this=this;this.pendingResponses[requestNum]=data;var _loop_1=function(){var toProcess=this_1.pendingResponses[this_1.currentResponseNum];delete this_1.pendingResponses[this_1.currentResponseNum];var _loop_2=function(i){if(toProcess[i]){util_1.exceptionGuard(function(){_this.onMessage_(toProcess[i])})}};for(var i=0;i<toProcess.length;++i){_loop_2(i)}if(this_1.currentResponseNum===this_1.closeAfterResponse){if(this_1.onClose){this_1.onClose();this_1.onClose=null}return"break"}this_1.currentResponseNum++};var this_1=this;while(this.pendingResponses[this.currentResponseNum]){var state_1=_loop_1();if(state_1==="break")break}};return PacketReceiver}();exports.PacketReceiver=PacketReceiver},{"../../core/util/util":68}],91:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var window_controller_1=require("./src/controllers/window-controller");var sw_controller_1=require("./src/controllers/sw-controller");var app_1=require("@firebase/app");function registerMessaging(instance){var messagingName="messaging";var factoryMethod=function(app){if(self&&"ServiceWorkerGlobalScope"in self){return new sw_controller_1.default(app)}return new window_controller_1.default(app)};var namespaceExports={Messaging:window_controller_1.default};instance.INTERNAL.registerService(messagingName,factoryMethod,namespaceExports)}exports.registerMessaging=registerMessaging;registerMessaging(app_1.default)},{"./src/controllers/sw-controller":93,"./src/controllers/window-controller":94,"@firebase/app":6}],92:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var errors_1=require("../models/errors");var token_manager_1=require("../models/token-manager");var notification_permission_1=require("../models/notification-permission");var SENDER_ID_OPTION_NAME="messagingSenderId";var ControllerInterface=function(){function ControllerInterface(app){var _this=this;this.errorFactory_=new util_1.ErrorFactory("messaging","Messaging",errors_1.default.map);if(!app.options[SENDER_ID_OPTION_NAME]||typeof app.options[SENDER_ID_OPTION_NAME]!=="string"){throw this.errorFactory_.create(errors_1.default.codes.BAD_SENDER_ID)}this.messagingSenderId_=app.options[SENDER_ID_OPTION_NAME];this.tokenManager_=new token_manager_1.default;this.app=app;this.INTERNAL={};this.INTERNAL.delete=function(){return _this.delete}}ControllerInterface.prototype.getToken=function(){var _this=this;var currentPermission=this.getNotificationPermission_();if(currentPermission!==notification_permission_1.default.granted){if(currentPermission===notification_permission_1.default.denied){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.NOTIFICATIONS_BLOCKED))}return Promise.resolve(null)}return this.getSWRegistration_().then(function(registration){return _this.tokenManager_.getSavedToken(_this.messagingSenderId_,registration).then(function(token){if(token){return token}return _this.tokenManager_.createToken(_this.messagingSenderId_,registration)})})};ControllerInterface.prototype.deleteToken=function(token){var _this=this;return this.tokenManager_.deleteToken(token).then(function(){return _this.getSWRegistration_().then(function(registration){if(registration){return registration.pushManager.getSubscription()}}).then(function(subscription){if(subscription){return subscription.unsubscribe()}})})};ControllerInterface.prototype.getSWRegistration_=function(){throw this.errorFactory_.create(errors_1.default.codes.SHOULD_BE_INHERITED)};ControllerInterface.prototype.requestPermission=function(){throw this.errorFactory_.create(errors_1.default.codes.AVAILABLE_IN_WINDOW)};ControllerInterface.prototype.useServiceWorker=function(registration){throw this.errorFactory_.create(errors_1.default.codes.AVAILABLE_IN_WINDOW)};ControllerInterface.prototype.onMessage=function(nextOrObserver,optError,optCompleted){throw this.errorFactory_.create(errors_1.default.codes.AVAILABLE_IN_WINDOW)};ControllerInterface.prototype.onTokenRefresh=function(nextOrObserver,optError,optCompleted){throw this.errorFactory_.create(errors_1.default.codes.AVAILABLE_IN_WINDOW)};ControllerInterface.prototype.setBackgroundMessageHandler=function(callback){throw this.errorFactory_.create(errors_1.default.codes.AVAILABLE_IN_SW)};ControllerInterface.prototype.delete=function(){return this.tokenManager_.closeDatabase()};ControllerInterface.prototype.getNotificationPermission_=function(){return Notification.permission};ControllerInterface.prototype.getTokenManager=function(){return this.tokenManager_};return ControllerInterface}();exports.default=ControllerInterface},{"../models/errors":97,"../models/notification-permission":99,"../models/token-manager":100,"@firebase/util":139}],93:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var controller_interface_1=require("./controller-interface");var errors_1=require("../models/errors");var worker_page_message_1=require("../models/worker-page-message");var fcm_details_1=require("../models/fcm-details");var FCM_MSG="FCM_MSG";var SWController=function(_super){__extends(SWController,_super);function SWController(app){var _this=_super.call(this,app)||this;self.addEventListener("push",function(e){return _this.onPush_(e)},false);self.addEventListener("pushsubscriptionchange",function(e){return _this.onSubChange_(e)},false);self.addEventListener("notificationclick",function(e){return _this.onNotificationClick_(e)},false);_this.bgMessageHandler_=null;return _this}SWController.prototype.onPush_=function(event){var _this=this;var msgPayload;try{msgPayload=event.data.json()}catch(err){return}var handleMsgPromise=this.hasVisibleClients_().then(function(hasVisibleClients){if(hasVisibleClients){if(msgPayload.notification||_this.bgMessageHandler_){return _this.sendMessageToWindowClients_(msgPayload)}return}var notificationDetails=_this.getNotificationData_(msgPayload);if(notificationDetails){var notificationTitle=notificationDetails.title||"";return self.registration.showNotification(notificationTitle,notificationDetails)}else if(_this.bgMessageHandler_){return _this.bgMessageHandler_(msgPayload)}});event.waitUntil(handleMsgPromise)};SWController.prototype.onSubChange_=function(event){var _this=this;var promiseChain=this.getToken().then(function(token){if(!token){throw _this.errorFactory_.create(errors_1.default.codes.NO_FCM_TOKEN_FOR_RESUBSCRIBE)}var tokenDetails=null;var tokenManager=_this.getTokenManager();return tokenManager.getTokenDetailsFromToken(token).then(function(details){tokenDetails=details;if(!tokenDetails){throw _this.errorFactory_.create(errors_1.default.codes.INVALID_SAVED_TOKEN)}return self.registration.pushManager.subscribe(fcm_details_1.default.SUBSCRIPTION_OPTIONS)}).then(function(newSubscription){return tokenManager.subscribeToFCM(tokenDetails.fcmSenderId,newSubscription,tokenDetails.fcmPushSet)}).catch(function(err){return tokenManager.deleteToken(tokenDetails.fcmToken).then(function(){throw _this.errorFactory_.create(errors_1.default.codes.UNABLE_TO_RESUBSCRIBE,{message:err})})})});event.waitUntil(promiseChain)};SWController.prototype.onNotificationClick_=function(event){var _this=this;if(!(event.notification&&event.notification.data&&event.notification.data[FCM_MSG])){return}event.stopImmediatePropagation();event.notification.close();var msgPayload=event.notification.data[FCM_MSG];var clickAction=msgPayload["notification"]["click_action"];if(!clickAction){return}var promiseChain=this.getWindowClient_(clickAction).then(function(windowClient){if(!windowClient){return self.clients.openWindow(clickAction)}return windowClient}).then(function(windowClient){if(!windowClient){return}var notificationData=msgPayload["notification"];delete msgPayload["notification"];var internalMsg=worker_page_message_1.default.createNewMsg(worker_page_message_1.default.TYPES_OF_MSG.NOTIFICATION_CLICKED,msgPayload);return _this.attemptToMessageClient_(windowClient,internalMsg)});event.waitUntil(promiseChain)};SWController.prototype.getNotificationData_=function(msgPayload){if(!msgPayload){return}if(typeof msgPayload.notification!=="object"){return}var notificationInformation=Object.assign({},msgPayload.notification);notificationInformation["data"]=(_a={},_a[FCM_MSG]=msgPayload,_a);return notificationInformation;var _a};SWController.prototype.setBackgroundMessageHandler=function(callback){if(callback&&typeof callback!=="function"){throw this.errorFactory_.create(errors_1.default.codes.BG_HANDLER_FUNCTION_EXPECTED)}this.bgMessageHandler_=callback};SWController.prototype.getWindowClient_=function(url){var parsedURL=new URL(url).href;return self.clients.matchAll({type:"window",includeUncontrolled:true}).then(function(clientList){var suitableClient=null;for(var i=0;i<clientList.length;i++){var parsedClientUrl=new URL(clientList[i].url).href;if(parsedClientUrl===parsedURL){suitableClient=clientList[i];break}}if(suitableClient){suitableClient.focus();return suitableClient}})};SWController.prototype.attemptToMessageClient_=function(client,message){var _this=this;return new Promise(function(resolve,reject){if(!client){return reject(_this.errorFactory_.create(errors_1.default.codes.NO_WINDOW_CLIENT_TO_MSG))}client.postMessage(message);resolve()})};SWController.prototype.hasVisibleClients_=function(){return self.clients.matchAll({type:"window",includeUncontrolled:true}).then(function(clientList){return clientList.some(function(client){return client.visibilityState==="visible"})})};SWController.prototype.sendMessageToWindowClients_=function(msgPayload){var _this=this;return self.clients.matchAll({type:"window",includeUncontrolled:true}).then(function(clientList){var internalMsg=worker_page_message_1.default.createNewMsg(worker_page_message_1.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED,msgPayload);return Promise.all(clientList.map(function(client){return _this.attemptToMessageClient_(client,internalMsg)}))})};SWController.prototype.getSWRegistration_=function(){return Promise.resolve(self.registration)};return SWController}(controller_interface_1.default);exports.default=SWController},{"../models/errors":97,"../models/fcm-details":98,"../models/worker-page-message":101,"./controller-interface":92}],94:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var controller_interface_1=require("./controller-interface");var errors_1=require("../models/errors");var worker_page_message_1=require("../models/worker-page-message");var default_sw_1=require("../models/default-sw");var notification_permission_1=require("../models/notification-permission");var util_1=require("@firebase/util");var WindowController=function(_super){__extends(WindowController,_super);function WindowController(app){var _this=_super.call(this,app)||this;
_this.registrationToUse_;_this.manifestCheckPromise_;_this.messageObserver_=null;_this.onMessage_=util_1.createSubscribe(function(observer){_this.messageObserver_=observer});_this.tokenRefreshObserver_=null;_this.onTokenRefresh_=util_1.createSubscribe(function(observer){_this.tokenRefreshObserver_=observer});_this.setupSWMessageListener_();return _this}WindowController.prototype.getToken=function(){var _this=this;if(!this.isSupported_()){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.UNSUPPORTED_BROWSER))}return this.manifestCheck_().then(function(){return _super.prototype.getToken.call(_this)})};WindowController.prototype.manifestCheck_=function(){var _this=this;if(this.manifestCheckPromise_){return this.manifestCheckPromise_}var manifestTag=document.querySelector('link[rel="manifest"]');if(!manifestTag){this.manifestCheckPromise_=Promise.resolve()}else{this.manifestCheckPromise_=fetch(manifestTag.href).then(function(response){return response.json()}).catch(function(){return Promise.resolve()}).then(function(manifestContent){if(!manifestContent){return}if(!manifestContent["gcm_sender_id"]){return}if(manifestContent["gcm_sender_id"]!=="103953800507"){throw _this.errorFactory_.create(errors_1.default.codes.INCORRECT_GCM_SENDER_ID)}})}return this.manifestCheckPromise_};WindowController.prototype.requestPermission=function(){var _this=this;if(Notification.permission===notification_permission_1.default.granted){return Promise.resolve()}return new Promise(function(resolve,reject){var managePermissionResult=function(result){if(result===notification_permission_1.default.granted){return resolve()}else if(result===notification_permission_1.default.denied){return reject(_this.errorFactory_.create(errors_1.default.codes.PERMISSION_BLOCKED))}else{return reject(_this.errorFactory_.create(errors_1.default.codes.PERMISSION_DEFAULT))}};var permissionPromise=Notification.requestPermission(function(result){if(permissionPromise){return}managePermissionResult(result)});if(permissionPromise){permissionPromise.then(managePermissionResult)}})};WindowController.prototype.useServiceWorker=function(registration){if(!(registration instanceof ServiceWorkerRegistration)){throw this.errorFactory_.create(errors_1.default.codes.SW_REGISTRATION_EXPECTED)}if(typeof this.registrationToUse_!=="undefined"){throw this.errorFactory_.create(errors_1.default.codes.USE_SW_BEFORE_GET_TOKEN)}this.registrationToUse_=registration};WindowController.prototype.onMessage=function(nextOrObserver,optError,optCompleted){return this.onMessage_(nextOrObserver,optError,optCompleted)};WindowController.prototype.onTokenRefresh=function(nextOrObserver,optError,optCompleted){return this.onTokenRefresh_(nextOrObserver,optError,optCompleted)};WindowController.prototype.waitForRegistrationToActivate_=function(registration){var _this=this;var serviceWorker=registration.installing||registration.waiting||registration.active;return new Promise(function(resolve,reject){if(!serviceWorker){reject(_this.errorFactory_.create(errors_1.default.codes.NO_SW_IN_REG));return}if(serviceWorker.state==="activated"){resolve(registration);return}if(serviceWorker.state==="redundant"){reject(_this.errorFactory_.create(errors_1.default.codes.SW_REG_REDUNDANT));return}var stateChangeListener=function(){if(serviceWorker.state==="activated"){resolve(registration)}else if(serviceWorker.state==="redundant"){reject(_this.errorFactory_.create(errors_1.default.codes.SW_REG_REDUNDANT))}else{return}serviceWorker.removeEventListener("statechange",stateChangeListener)};serviceWorker.addEventListener("statechange",stateChangeListener)})};WindowController.prototype.getSWRegistration_=function(){var _this=this;if(this.registrationToUse_){return this.waitForRegistrationToActivate_(this.registrationToUse_)}this.registrationToUse_=null;return navigator.serviceWorker.register(default_sw_1.default.path,{scope:default_sw_1.default.scope}).catch(function(err){throw _this.errorFactory_.create(errors_1.default.codes.FAILED_DEFAULT_REGISTRATION,{browserErrorMessage:err.message})}).then(function(registration){return _this.waitForRegistrationToActivate_(registration).then(function(){_this.registrationToUse_=registration;registration.update();return registration})})};WindowController.prototype.setupSWMessageListener_=function(){var _this=this;if(!("serviceWorker"in navigator)){return}navigator.serviceWorker.addEventListener("message",function(event){if(!event.data||!event.data[worker_page_message_1.default.PARAMS.TYPE_OF_MSG]){return}var workerPageMessage=event.data;switch(workerPageMessage[worker_page_message_1.default.PARAMS.TYPE_OF_MSG]){case worker_page_message_1.default.TYPES_OF_MSG.PUSH_MSG_RECEIVED:case worker_page_message_1.default.TYPES_OF_MSG.NOTIFICATION_CLICKED:var pushMessage=workerPageMessage[worker_page_message_1.default.PARAMS.DATA];_this.messageObserver_.next(pushMessage);break;default:break}},false)};WindowController.prototype.isSupported_=function(){return"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")};return WindowController}(controller_interface_1.default);exports.default=WindowController},{"../models/default-sw":96,"../models/errors":97,"../models/notification-permission":99,"../models/worker-page-message":101,"./controller-interface":92,"@firebase/util":139}],95:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function toBase64(arrayBuffer){var uint8Version=new Uint8Array(arrayBuffer);return window.btoa(String.fromCharCode.apply(null,uint8Version))}exports.default=function(arrayBuffer){var base64String=toBase64(arrayBuffer);return base64String.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}},{}],96:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={path:"/firebase-messaging-sw.js",scope:"/firebase-cloud-messaging-push-scope"}},{}],97:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var CODES={AVAILABLE_IN_WINDOW:"only-available-in-window",AVAILABLE_IN_SW:"only-available-in-sw",SHOULD_BE_INHERITED:"should-be-overriden",BAD_SENDER_ID:"bad-sender-id",INCORRECT_GCM_SENDER_ID:"incorrect-gcm-sender-id",PERMISSION_DEFAULT:"permission-default",PERMISSION_BLOCKED:"permission-blocked",UNSUPPORTED_BROWSER:"unsupported-browser",NOTIFICATIONS_BLOCKED:"notifications-blocked",FAILED_DEFAULT_REGISTRATION:"failed-serviceworker-registration",SW_REGISTRATION_EXPECTED:"sw-registration-expected",GET_SUBSCRIPTION_FAILED:"get-subscription-failed",INVALID_SAVED_TOKEN:"invalid-saved-token",SW_REG_REDUNDANT:"sw-reg-redundant",TOKEN_SUBSCRIBE_FAILED:"token-subscribe-failed",TOKEN_SUBSCRIBE_NO_TOKEN:"token-subscribe-no-token",TOKEN_SUBSCRIBE_NO_PUSH_SET:"token-subscribe-no-push-set",USE_SW_BEFORE_GET_TOKEN:"use-sw-before-get-token",INVALID_DELETE_TOKEN:"invalid-delete-token",DELETE_TOKEN_NOT_FOUND:"delete-token-not-found",DELETE_SCOPE_NOT_FOUND:"delete-scope-not-found",BG_HANDLER_FUNCTION_EXPECTED:"bg-handler-function-expected",NO_WINDOW_CLIENT_TO_MSG:"no-window-client-to-msg",UNABLE_TO_RESUBSCRIBE:"unable-to-resubscribe",NO_FCM_TOKEN_FOR_RESUBSCRIBE:"no-fcm-token-for-resubscribe",FAILED_TO_DELETE_TOKEN:"failed-to-delete-token",NO_SW_IN_REG:"no-sw-in-reg",BAD_SCOPE:"bad-scope",BAD_VAPID_KEY:"bad-vapid-key",BAD_SUBSCRIPTION:"bad-subscription",BAD_TOKEN:"bad-token",BAD_PUSH_SET:"bad-push-set",FAILED_DELETE_VAPID_KEY:"failed-delete-vapid-key"};var ERROR_MAP=(_a={},_a[CODES.AVAILABLE_IN_WINDOW]="This method is available in a Window context.",_a[CODES.AVAILABLE_IN_SW]="This method is available in a service worker "+"context.",_a[CODES.SHOULD_BE_INHERITED]="This method should be overriden by "+"extended classes.",_a[CODES.BAD_SENDER_ID]="Please ensure that 'messagingSenderId' is set "+"correctly in the options passed into firebase.initializeApp().",_a[CODES.PERMISSION_DEFAULT]="The required permissions were not granted and "+"dismissed instead.",_a[CODES.PERMISSION_BLOCKED]="The required permissions were not granted and "+"blocked instead.",_a[CODES.UNSUPPORTED_BROWSER]="This browser doesn't support the API's "+"required to use the firebase SDK.",_a[CODES.NOTIFICATIONS_BLOCKED]="Notifications have been blocked.",_a[CODES.FAILED_DEFAULT_REGISTRATION]="We are unable to register the "+"default service worker. {$browserErrorMessage}",_a[CODES.SW_REGISTRATION_EXPECTED]="A service worker registration was the "+"expected input.",_a[CODES.GET_SUBSCRIPTION_FAILED]="There was an error when trying to get "+"any existing Push Subscriptions.",_a[CODES.INVALID_SAVED_TOKEN]="Unable to access details of the saved token.",_a[CODES.SW_REG_REDUNDANT]="The service worker being used for push was made "+"redundant.",_a[CODES.TOKEN_SUBSCRIBE_FAILED]="A problem occured while subscribing the "+"user to FCM: {$message}",_a[CODES.TOKEN_SUBSCRIBE_NO_TOKEN]="FCM returned no token when subscribing "+"the user to push.",_a[CODES.TOKEN_SUBSCRIBE_NO_PUSH_SET]="FCM returned an invalid response "+"when getting an FCM token.",_a[CODES.USE_SW_BEFORE_GET_TOKEN]="You must call useServiceWorker() before "+"calling getToken() to ensure your service worker is used.",_a[CODES.INVALID_DELETE_TOKEN]="You must pass a valid token into "+"deleteToken(), i.e. the token from getToken().",_a[CODES.DELETE_TOKEN_NOT_FOUND]="The deletion attempt for token could not "+"be performed as the token was not found.",_a[CODES.DELETE_SCOPE_NOT_FOUND]="The deletion attempt for service worker "+"scope could not be performed as the scope was not found.",_a[CODES.BG_HANDLER_FUNCTION_EXPECTED]="The input to "+"setBackgroundMessageHandler() must be a function.",_a[CODES.NO_WINDOW_CLIENT_TO_MSG]="An attempt was made to message a "+"non-existant window client.",_a[CODES.UNABLE_TO_RESUBSCRIBE]="There was an error while re-subscribing "+"the FCM token for push messaging. Will have to resubscribe the "+"user on next visit. {$message}",_a[CODES.NO_FCM_TOKEN_FOR_RESUBSCRIBE]="Could not find an FCM token "+"and as a result, unable to resubscribe. Will have to resubscribe the "+"user on next visit.",_a[CODES.FAILED_TO_DELETE_TOKEN]="Unable to delete the currently saved token.",_a[CODES.NO_SW_IN_REG]="Even though the service worker registration was "+"successful, there was a problem accessing the service worker itself.",_a[CODES.INCORRECT_GCM_SENDER_ID]="Please change your web app manifest's "+"'gcm_sender_id' value to '103953800507' to use Firebase messaging.",_a[CODES.BAD_SCOPE]="The service worker scope must be a string with at "+"least one character.",_a[CODES.BAD_VAPID_KEY]="The public VAPID key must be a string with at "+"least one character.",_a[CODES.BAD_SUBSCRIPTION]="The subscription must be a valid "+"PushSubscription.",_a[CODES.BAD_TOKEN]="The FCM Token used for storage / lookup was not "+"a valid token string.",_a[CODES.BAD_PUSH_SET]="The FCM push set used for storage / lookup was not "+"not a valid push set string.",_a[CODES.FAILED_DELETE_VAPID_KEY]="The VAPID key could not be deleted.",_a);exports.default={codes:CODES,map:ERROR_MAP};var _a},{}],98:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var FCM_APPLICATION_SERVER_KEY=[4,51,148,247,223,161,235,177,220,3,162,94,21,113,219,72,211,46,237,237,178,52,219,183,71,58,12,143,196,204,225,111,60,140,132,223,171,182,102,62,242,12,212,139,254,227,249,118,47,20,28,99,8,106,111,45,177,26,149,176,206,55,192,156,110];var SUBSCRIPTION_DETAILS={userVisibleOnly:true,applicationServerKey:new Uint8Array(FCM_APPLICATION_SERVER_KEY)};exports.default={ENDPOINT:"https://fcm.googleapis.com",APPLICATION_SERVER_KEY:FCM_APPLICATION_SERVER_KEY,SUBSCRIPTION_OPTIONS:SUBSCRIPTION_DETAILS}},{}],99:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={granted:"granted","default":"default",denied:"denied"}},{}],100:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var util_1=require("@firebase/util");var errors_1=require("./errors");var array_buffer_to_base64_1=require("../helpers/array-buffer-to-base64");var fcm_details_1=require("./fcm-details");var FCM_TOKEN_OBJ_STORE="fcm_token_object_Store";var FCM_TOKEN_DETAILS_DB_VERSION=1;var TokenManager=function(){function TokenManager(){this.errorFactory_=new util_1.ErrorFactory("messaging","Messaging",errors_1.default.map);this.openDbPromise_=null}TokenManager.prototype.openDatabase_=function(){if(this.openDbPromise_){return this.openDbPromise_}this.openDbPromise_=new Promise(function(resolve,reject){var request=indexedDB.open(TokenManager.DB_NAME,FCM_TOKEN_DETAILS_DB_VERSION);request.onerror=function(event){reject(event.target.error)};request.onsuccess=function(event){resolve(event.target.result)};request.onupgradeneeded=function(event){var db=event.target.result;var objectStore=db.createObjectStore(FCM_TOKEN_OBJ_STORE,{keyPath:"swScope"});objectStore.createIndex("fcmSenderId","fcmSenderId",{unique:false});objectStore.createIndex("fcmToken","fcmToken",{unique:true})}});return this.openDbPromise_};TokenManager.prototype.closeDatabase=function(){var _this=this;if(this.openDbPromise_){return this.openDbPromise_.then(function(db){db.close();_this.openDbPromise_=null})}return Promise.resolve()};TokenManager.prototype.getTokenDetailsFromToken=function(fcmToken){return this.openDatabase_().then(function(db){return new Promise(function(resolve,reject){var transaction=db.transaction([FCM_TOKEN_OBJ_STORE]);var objectStore=transaction.objectStore(FCM_TOKEN_OBJ_STORE);var index=objectStore.index("fcmToken");var request=index.get(fcmToken);request.onerror=function(event){reject(event.target.error)};request.onsuccess=function(event){resolve(event.target.result)}})})};TokenManager.prototype.getTokenDetailsFromSWScope_=function(swScope){return this.openDatabase_().then(function(db){return new Promise(function(resolve,reject){var transaction=db.transaction([FCM_TOKEN_OBJ_STORE]);var objectStore=transaction.objectStore(FCM_TOKEN_OBJ_STORE);var scopeRequest=objectStore.get(swScope);scopeRequest.onerror=function(event){reject(event.target.error)};scopeRequest.onsuccess=function(event){resolve(event.target.result)}})})};TokenManager.prototype.getAllTokenDetailsForSenderId_=function(senderId){return this.openDatabase_().then(function(db){return new Promise(function(resolve,reject){var transaction=db.transaction([FCM_TOKEN_OBJ_STORE]);var objectStore=transaction.objectStore(FCM_TOKEN_OBJ_STORE);var senderIdTokens=[];var cursorRequest=objectStore.openCursor();cursorRequest.onerror=function(event){reject(event.target.error)};cursorRequest.onsuccess=function(event){var cursor=event.target.result;if(cursor){if(cursor.value["fcmSenderId"]===senderId){senderIdTokens.push(cursor.value)}cursor.continue()}else{resolve(senderIdTokens)}}})})};TokenManager.prototype.subscribeToFCM=function(senderId,subscription,pushSet){var _this=this;var p256dh=array_buffer_to_base64_1.default(subscription["getKey"]("p256dh"));var auth=array_buffer_to_base64_1.default(subscription["getKey"]("auth"));var fcmSubscribeBody="authorized_entity="+senderId+"&"+("endpoint="+subscription.endpoint+"&")+("encryption_key="+p256dh+"&")+("encryption_auth="+auth);if(pushSet){fcmSubscribeBody+="&pushSet="+pushSet}var headers=new Headers;headers.append("Content-Type","application/x-www-form-urlencoded");var subscribeOptions={method:"POST",headers:headers,body:fcmSubscribeBody};return fetch(fcm_details_1.default.ENDPOINT+"/fcm/connect/subscribe",subscribeOptions).then(function(response){return response.json()}).then(function(response){var fcmTokenResponse=response;if(fcmTokenResponse["error"]){var message=fcmTokenResponse["error"]["message"];throw _this.errorFactory_.create(errors_1.default.codes.TOKEN_SUBSCRIBE_FAILED,{message:message})}if(!fcmTokenResponse["token"]){throw _this.errorFactory_.create(errors_1.default.codes.TOKEN_SUBSCRIBE_NO_TOKEN)}if(!fcmTokenResponse["pushSet"]){throw _this.errorFactory_.create(errors_1.default.codes.TOKEN_SUBSCRIBE_NO_PUSH_SET)}return{token:fcmTokenResponse["token"],pushSet:fcmTokenResponse["pushSet"]}})};TokenManager.prototype.isSameSubscription_=function(subscription,masterTokenDetails){return subscription.endpoint===masterTokenDetails["endpoint"]&&array_buffer_to_base64_1.default(subscription["getKey"]("auth"))===masterTokenDetails["auth"]&&array_buffer_to_base64_1.default(subscription["getKey"]("p256dh"))===masterTokenDetails["p256dh"]};TokenManager.prototype.saveTokenDetails_=function(senderId,swRegistration,subscription,fcmToken,fcmPushSet){var details={swScope:swRegistration.scope,endpoint:subscription.endpoint,auth:array_buffer_to_base64_1.default(subscription["getKey"]("auth")),p256dh:array_buffer_to_base64_1.default(subscription["getKey"]("p256dh")),fcmToken:fcmToken,fcmPushSet:fcmPushSet,fcmSenderId:senderId};return this.openDatabase_().then(function(db){return new Promise(function(resolve,reject){var transaction=db.transaction([FCM_TOKEN_OBJ_STORE],"readwrite");var objectStore=transaction.objectStore(FCM_TOKEN_OBJ_STORE);var request=objectStore.put(details);request.onerror=function(event){reject(event.target.error)};request.onsuccess=function(event){resolve()}})})};TokenManager.prototype.getSavedToken=function(senderId,swRegistration){var _this=this;if(!(swRegistration instanceof ServiceWorkerRegistration)){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.SW_REGISTRATION_EXPECTED))}if(typeof senderId!=="string"||senderId.length===0){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.BAD_SENDER_ID))}return this.getAllTokenDetailsForSenderId_(senderId).then(function(allTokenDetails){if(allTokenDetails.length===0){return}var index=allTokenDetails.findIndex(function(tokenDetails){return swRegistration.scope===tokenDetails["swScope"]&&senderId===tokenDetails["fcmSenderId"]});if(index===-1){return}return allTokenDetails[index]}).then(function(tokenDetails){if(!tokenDetails){return}return swRegistration.pushManager.getSubscription().catch(function(err){throw _this.errorFactory_.create(errors_1.default.codes.GET_SUBSCRIPTION_FAILED)}).then(function(subscription){if(subscription&&_this.isSameSubscription_(subscription,tokenDetails)){return tokenDetails["fcmToken"]}})})};TokenManager.prototype.createToken=function(senderId,swRegistration){var _this=this;if(typeof senderId!=="string"||senderId.length===0){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.BAD_SENDER_ID))}if(!(swRegistration instanceof ServiceWorkerRegistration)){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.SW_REGISTRATION_EXPECTED))}var subscription;var fcmTokenDetails;return swRegistration.pushManager.getSubscription().then(function(subscription){if(subscription){return subscription}return swRegistration.pushManager.subscribe(fcm_details_1.default.SUBSCRIPTION_OPTIONS)}).then(function(sub){subscription=sub;return _this.subscribeToFCM(senderId,subscription)}).then(function(tokenDetails){fcmTokenDetails=tokenDetails;return _this.saveTokenDetails_(senderId,swRegistration,subscription,fcmTokenDetails["token"],fcmTokenDetails["pushSet"])}).then(function(){return fcmTokenDetails["token"]})};TokenManager.prototype.deleteToken=function(token){var _this=this;if(typeof token!=="string"||token.length===0){return Promise.reject(this.errorFactory_.create(errors_1.default.codes.INVALID_DELETE_TOKEN))}return this.getTokenDetailsFromToken(token).then(function(details){if(!details){throw _this.errorFactory_.create(errors_1.default.codes.DELETE_TOKEN_NOT_FOUND)}return _this.openDatabase_().then(function(db){return new Promise(function(resolve,reject){var transaction=db.transaction([FCM_TOKEN_OBJ_STORE],"readwrite");var objectStore=transaction.objectStore(FCM_TOKEN_OBJ_STORE);var request=objectStore.delete(details["swScope"]);request.onerror=function(event){reject(event.target.error)};request.onsuccess=function(event){if(event.target.result===0){reject(_this.errorFactory_.create(errors_1.default.codes.FAILED_TO_DELETE_TOKEN));return}resolve(details)}})})})};return TokenManager}();exports.default=TokenManager},{"../helpers/array-buffer-to-base64":95,"./errors":97,"./fcm-details":98,"@firebase/util":139}],101:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var PARAMS={TYPE_OF_MSG:"firebase-messaging-msg-type",DATA:"firebase-messaging-msg-data"};var msgType={PUSH_MSG_RECEIVED:"push-msg-received",NOTIFICATION_CLICKED:"notification-clicked"};var createNewMsg=function(msgType,msgData){var message=(_a={},_a[PARAMS.TYPE_OF_MSG]=msgType,_a[PARAMS.DATA]=msgData,_a);return message;var _a};exports.default={PARAMS:PARAMS,TYPES_OF_MSG:msgType,createNewMsg:createNewMsg}},{}],102:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});require("./src/polyfills/promise");require("./src/shims/find");require("./src/shims/findIndex")},{"./src/polyfills/promise":103,"./src/shims/find":104,"./src/shims/findIndex":105}],103:[function(require,module,exports){(function(global){var __global=function(){if(typeof global!=="undefined"){return global}if(typeof window!=="undefined"){return window}if(typeof self!=="undefined"){return self}throw new Error("unable to locate global object")}();if(typeof Promise==="undefined"){__global["Promise"]=Promise=require("promise-polyfill")}}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"promise-polyfill":188}],104:[function(require,module,exports){if(!Array.prototype.find){Object.defineProperty(Array.prototype,"find",{value:function(predicate){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var thisArg=arguments[1];var k=0;while(k<len){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return kValue}k++}return undefined}})}},{}],105:[function(require,module,exports){if(!Array.prototype.findIndex){Object.defineProperty(Array.prototype,"findIndex",{value:function(predicate){if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var thisArg=arguments[1];var k=0;while(k<len){var kValue=o[k];if(predicate.call(thisArg,kValue,k,o)){return k}k++}return-1}})}},{}],106:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var app_1=require("@firebase/app");var string_1=require("./src/implementation/string");var taskenums_1=require("./src/implementation/taskenums");var taskenums_2=require("./src/implementation/taskenums");var xhriopool_1=require("./src/implementation/xhriopool");var reference_1=require("./src/reference");var service_1=require("./src/service");var STORAGE_TYPE="storage";function factory(app,unused,opt_url){return new service_1.Service(app,new xhriopool_1.XhrIoPool,opt_url)}function registerStorage(instance){var namespaceExports={TaskState:taskenums_2.TaskState,TaskEvent:taskenums_1.TaskEvent,StringFormat:string_1.StringFormat,Storage:service_1.Service,Reference:reference_1.Reference};instance.INTERNAL.registerService(STORAGE_TYPE,factory,namespaceExports,undefined,true)}exports.registerStorage=registerStorage;registerStorage(app_1.default)},{"./src/implementation/string":128,"./src/implementation/taskenums":129,"./src/implementation/xhriopool":134,"./src/reference":135,"./src/service":136,"@firebase/app":6}],107:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errorsExports=require("./error");var MetadataUtils=require("./metadata");var type=require("./type");function validate(name,specs,passed){var minArgs=specs.length;var maxArgs=specs.length;for(var i=0;i<specs.length;i++){if(specs[i].optional){minArgs=i;break}}var validLength=minArgs<=passed.length&&passed.length<=maxArgs;if(!validLength){throw errorsExports.invalidArgumentCount(minArgs,maxArgs,name,passed.length)}for(var i=0;i<passed.length;i++){try{specs[i].validator(passed[i])}catch(e){if(e instanceof Error){throw errorsExports.invalidArgument(i,name,e.message)}else{throw errorsExports.invalidArgument(i,name,e)}}}}exports.validate=validate;var ArgSpec=function(){function ArgSpec(validator,opt_optional){var self=this;this.validator=function(p){if(self.optional&&!type.isJustDef(p)){return}validator(p)};this.optional=!!opt_optional}return ArgSpec}();exports.ArgSpec=ArgSpec;function and_(v1,v2){return function(p){v1(p);v2(p)}}exports.and_=and_;function stringSpec(opt_validator,opt_optional){function stringValidator(p){if(!type.isString(p)){throw"Expected string."}}var validator;if(opt_validator){validator=and_(stringValidator,opt_validator)}else{validator=stringValidator}return new ArgSpec(validator,opt_optional)}exports.stringSpec=stringSpec;function uploadDataSpec(){function validator(p){var valid=p instanceof Uint8Array||p instanceof ArrayBuffer||type.isNativeBlobDefined()&&p instanceof Blob;if(!valid){throw"Expected Blob or File."}}return new ArgSpec(validator)}exports.uploadDataSpec=uploadDataSpec;function metadataSpec(opt_optional){return new ArgSpec(MetadataUtils.metadataValidator,opt_optional)}exports.metadataSpec=metadataSpec;function nonNegativeNumberSpec(){function validator(p){var valid=type.isNumber(p)&&p>=0;if(!valid){throw"Expected a number 0 or greater."}}return new ArgSpec(validator)}exports.nonNegativeNumberSpec=nonNegativeNumberSpec;function looseObjectSpec(opt_validator,opt_optional){function validator(p){var isLooseObject=p===null||type.isDef(p)&&p instanceof Object;if(!isLooseObject){throw"Expected an Object."}if(opt_validator!==undefined&&opt_validator!==null){opt_validator(p)}}return new ArgSpec(validator,opt_optional)}exports.looseObjectSpec=looseObjectSpec;function nullFunctionSpec(opt_optional){function validator(p){var valid=p===null||type.isFunction(p);if(!valid){throw"Expected a Function."}}return new ArgSpec(validator,opt_optional)}exports.nullFunctionSpec=nullFunctionSpec},{"./error":114,"./metadata":119,"./type":130}],108:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function contains(array,elem){return array.indexOf(elem)!==-1}exports.contains=contains;function clone(arraylike){return Array.prototype.slice.call(arraylike)}exports.clone=clone;function remove(array,elem){var i=array.indexOf(elem);if(i!==-1){array.splice(i,1)}}exports.remove=remove},{}],109:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var promiseimpl=require("./promise_external");function async(f){return function(){var argsToForward=[];for(var _i=0;_i<arguments.length;_i++){argsToForward[_i]=arguments[_i]}promiseimpl.resolve(true).then(function(){f.apply(null,argsToForward)})}}exports.async=async},{"./promise_external":123}],110:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants=require("./constants");var errorsExports=require("./error");var failrequest_1=require("./failrequest");var location_1=require("./location");var promiseimpl=require("./promise_external");var requestmap_1=require("./requestmap");var type=require("./type");var AuthWrapper=function(){function AuthWrapper(app,maker,requestMaker,service,pool){this.bucket_=null;this.deleted_=false;this.app_=app;if(this.app_!==null){var options=this.app_.options;if(type.isDef(options)){this.bucket_=AuthWrapper.extractBucket_(options)}}this.storageRefMaker_=maker;this.requestMaker_=requestMaker;this.pool_=pool;this.service_=service;this.maxOperationRetryTime_=constants.defaultMaxOperationRetryTime;this.maxUploadRetryTime_=constants.defaultMaxUploadRetryTime;this.requestMap_=new requestmap_1.RequestMap}AuthWrapper.extractBucket_=function(config){var bucketString=config[constants.configOption]||null;if(bucketString==null){return null}var loc=location_1.Location.makeFromBucketSpec(bucketString);return loc.bucket};AuthWrapper.prototype.getAuthToken=function(){if(this.app_!==null&&type.isDef(this.app_.INTERNAL)&&type.isDef(this.app_.INTERNAL.getToken)){return this.app_.INTERNAL.getToken().then(function(response){if(response!==null){return response.accessToken}else{return null}},function(_error){return null})}else{return promiseimpl.resolve(null)}};AuthWrapper.prototype.bucket=function(){if(this.deleted_){throw errorsExports.appDeleted()}else{return this.bucket_}};AuthWrapper.prototype.service=function(){return this.service_};AuthWrapper.prototype.makeStorageReference=function(loc){return this.storageRefMaker_(this,loc)};AuthWrapper.prototype.makeRequest=function(requestInfo,authToken){if(!this.deleted_){var request=this.requestMaker_(requestInfo,authToken,this.pool_);this.requestMap_.addRequest(request);return request}else{return new failrequest_1.FailRequest(errorsExports.appDeleted())}};AuthWrapper.prototype.deleteApp=function(){this.deleted_=true;this.app_=null;this.requestMap_.clear()};AuthWrapper.prototype.maxUploadRetryTime=function(){return this.maxUploadRetryTime_};AuthWrapper.prototype.setMaxUploadRetryTime=function(time){this.maxUploadRetryTime_=time};AuthWrapper.prototype.maxOperationRetryTime=function(){return this.maxOperationRetryTime_};AuthWrapper.prototype.setMaxOperationRetryTime=function(time){this.maxOperationRetryTime_=time};return AuthWrapper}();exports.AuthWrapper=AuthWrapper},{"./constants":113,"./error":114,"./failrequest":115,"./location":118,"./promise_external":123,"./requestmap":126,"./type":130}],111:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function start(f,callback,timeout){var waitSeconds=1;var timeoutId=null;var hitTimeout=false;var cancelState=0;function canceled(){return cancelState===2}var triggeredCallback=false;function triggerCallback(){if(!triggeredCallback){triggeredCallback=true;callback.apply(null,arguments)}}function callWithDelay(millis){timeoutId=setTimeout(function(){timeoutId=null;f(handler,canceled())},millis)}function handler(success){var var_args=[];for(var _i=1;_i<arguments.length;_i++){var_args[_i-1]=arguments[_i]}if(triggeredCallback){return}if(success){triggerCallback.apply(null,arguments);return}var mustStop=canceled()||hitTimeout;if(mustStop){triggerCallback.apply(null,arguments);return}if(waitSeconds<64){waitSeconds*=2}var waitMillis;if(cancelState===1){cancelState=2;waitMillis=0}else{waitMillis=(waitSeconds+Math.random())*1e3}callWithDelay(waitMillis)}var stopped=false;function stop(wasTimeout){if(stopped){return}stopped=true;if(triggeredCallback){return}if(timeoutId!==null){if(!wasTimeout){cancelState=2}clearTimeout(timeoutId);callWithDelay(0)}else{if(!wasTimeout){cancelState=1}}}callWithDelay(0);setTimeout(function(){hitTimeout=true;stop(true)},timeout);return stop}exports.start=start;function stop(id){id(false)}exports.stop=stop},{}],112:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var fs=require("./fs");var string=require("./string");var string_1=require("./string");var type=require("./type");var FbsBlob=function(){function FbsBlob(data,opt_elideCopy){var size=0;var blobType="";if(type.isNativeBlob(data)){this.data_=data;size=data.size;blobType=data.type}else if(data instanceof ArrayBuffer){if(opt_elideCopy){this.data_=new Uint8Array(data)}else{this.data_=new Uint8Array(data.byteLength);this.data_.set(new Uint8Array(data))}size=this.data_.length}else if(data instanceof Uint8Array){if(opt_elideCopy){this.data_=data}else{this.data_=new Uint8Array(data.length);this.data_.set(data)}size=data.length}this.size_=size;this.type_=blobType;
}FbsBlob.prototype.size=function(){return this.size_};FbsBlob.prototype.type=function(){return this.type_};FbsBlob.prototype.slice=function(startByte,endByte){if(type.isNativeBlob(this.data_)){var realBlob=this.data_;var sliced=fs.sliceBlob(realBlob,startByte,endByte);if(sliced===null){return null}return new FbsBlob(sliced)}else{var slice=new Uint8Array(this.data_.buffer,startByte,endByte-startByte);return new FbsBlob(slice,true)}};FbsBlob.getBlob=function(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}if(type.isNativeBlobDefined()){var blobby=var_args.map(function(val){if(val instanceof FbsBlob){return val.data_}else{return val}});return new FbsBlob(fs.getBlob.apply(null,blobby))}else{var uint8Arrays=var_args.map(function(val){if(type.isString(val)){return string.dataFromString(string_1.StringFormat.RAW,val).data}else{return val.data_}});var finalLength_1=0;uint8Arrays.forEach(function(array){finalLength_1+=array.byteLength});var merged_1=new Uint8Array(finalLength_1);var index_1=0;uint8Arrays.forEach(function(array){for(var i=0;i<array.length;i++){merged_1[index_1++]=array[i]}});return new FbsBlob(merged_1,true)}};FbsBlob.prototype.uploadData=function(){return this.data_};return FbsBlob}();exports.FbsBlob=FbsBlob},{"./fs":116,"./string":128,"./type":130}],113:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.domainBase="https://firebasestorage.googleapis.com";exports.downloadBase="https://firebasestorage.googleapis.com";exports.apiBaseUrl="/v0";exports.apiUploadBaseUrl="/v0";function setDomainBase(domainBase){domainBase=domainBase}exports.setDomainBase=setDomainBase;exports.configOption="storageBucket";exports.shortMaxOperationRetryTime=1*60*1e3;exports.defaultMaxOperationRetryTime=2*60*1e3;exports.defaultMaxUploadRetryTime=10*60*100;exports.minSafeInteger=-9007199254740991},{}],114:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require("./constants");var FirebaseStorageError=function(){function FirebaseStorageError(code,message){this.code_=prependCode(code);this.message_="Firebase Storage: "+message;this.serverResponse_=null;this.name_="FirebaseError"}FirebaseStorageError.prototype.codeProp=function(){return this.code};FirebaseStorageError.prototype.codeEquals=function(code){return prependCode(code)===this.codeProp()};FirebaseStorageError.prototype.serverResponseProp=function(){return this.serverResponse_};FirebaseStorageError.prototype.setServerResponseProp=function(serverResponse){this.serverResponse_=serverResponse};Object.defineProperty(FirebaseStorageError.prototype,"name",{get:function(){return this.name_},enumerable:true,configurable:true});Object.defineProperty(FirebaseStorageError.prototype,"code",{get:function(){return this.code_},enumerable:true,configurable:true});Object.defineProperty(FirebaseStorageError.prototype,"message",{get:function(){return this.message_},enumerable:true,configurable:true});Object.defineProperty(FirebaseStorageError.prototype,"serverResponse",{get:function(){return this.serverResponse_},enumerable:true,configurable:true});return FirebaseStorageError}();exports.FirebaseStorageError=FirebaseStorageError;exports.errors={};exports.Code={UNKNOWN:"unknown",OBJECT_NOT_FOUND:"object-not-found",BUCKET_NOT_FOUND:"bucket-not-found",PROJECT_NOT_FOUND:"project-not-found",QUOTA_EXCEEDED:"quota-exceeded",UNAUTHENTICATED:"unauthenticated",UNAUTHORIZED:"unauthorized",RETRY_LIMIT_EXCEEDED:"retry-limit-exceeded",INVALID_CHECKSUM:"invalid-checksum",CANCELED:"canceled",INVALID_EVENT_NAME:"invalid-event-name",INVALID_URL:"invalid-url",INVALID_DEFAULT_BUCKET:"invalid-default-bucket",NO_DEFAULT_BUCKET:"no-default-bucket",CANNOT_SLICE_BLOB:"cannot-slice-blob",SERVER_FILE_WRONG_SIZE:"server-file-wrong-size",NO_DOWNLOAD_URL:"no-download-url",INVALID_ARGUMENT:"invalid-argument",INVALID_ARGUMENT_COUNT:"invalid-argument-count",APP_DELETED:"app-deleted",INVALID_ROOT_OPERATION:"invalid-root-operation",INVALID_FORMAT:"invalid-format",INTERNAL_ERROR:"internal-error"};function prependCode(code){return"storage/"+code}exports.prependCode=prependCode;function unknown(){var message="An unknown error occurred, please check the error payload for "+"server response.";return new FirebaseStorageError(exports.Code.UNKNOWN,message)}exports.unknown=unknown;function objectNotFound(path){return new FirebaseStorageError(exports.Code.OBJECT_NOT_FOUND,"Object '"+path+"' does not exist.")}exports.objectNotFound=objectNotFound;function bucketNotFound(bucket){return new FirebaseStorageError(exports.Code.BUCKET_NOT_FOUND,"Bucket '"+bucket+"' does not exist.")}exports.bucketNotFound=bucketNotFound;function projectNotFound(project){return new FirebaseStorageError(exports.Code.PROJECT_NOT_FOUND,"Project '"+project+"' does not exist.")}exports.projectNotFound=projectNotFound;function quotaExceeded(bucket){return new FirebaseStorageError(exports.Code.QUOTA_EXCEEDED,"Quota for bucket '"+bucket+"' exceeded, please view quota on "+"https://firebase.google.com/pricing/.")}exports.quotaExceeded=quotaExceeded;function unauthenticated(){var message="User is not authenticated, please authenticate using Firebase "+"Authentication and try again.";return new FirebaseStorageError(exports.Code.UNAUTHENTICATED,message)}exports.unauthenticated=unauthenticated;function unauthorized(path){return new FirebaseStorageError(exports.Code.UNAUTHORIZED,"User does not have permission to access '"+path+"'.")}exports.unauthorized=unauthorized;function retryLimitExceeded(){return new FirebaseStorageError(exports.Code.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}exports.retryLimitExceeded=retryLimitExceeded;function invalidChecksum(path,checksum,calculated){return new FirebaseStorageError(exports.Code.INVALID_CHECKSUM,"Uploaded/downloaded object '"+path+"' has checksum '"+checksum+"' which does not match '"+calculated+"'. Please retry the upload/download.")}exports.invalidChecksum=invalidChecksum;function canceled(){return new FirebaseStorageError(exports.Code.CANCELED,"User canceled the upload/download.")}exports.canceled=canceled;function invalidEventName(name){return new FirebaseStorageError(exports.Code.INVALID_EVENT_NAME,"Invalid event name '"+name+"'.")}exports.invalidEventName=invalidEventName;function invalidUrl(url){return new FirebaseStorageError(exports.Code.INVALID_URL,"Invalid URL '"+url+"'.")}exports.invalidUrl=invalidUrl;function invalidDefaultBucket(bucket){return new FirebaseStorageError(exports.Code.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+bucket+"'.")}exports.invalidDefaultBucket=invalidDefaultBucket;function noDefaultBucket(){return new FirebaseStorageError(exports.Code.NO_DEFAULT_BUCKET,"No default bucket "+"found. Did you set the '"+constants_1.configOption+"' property when initializing the app?")}exports.noDefaultBucket=noDefaultBucket;function cannotSliceBlob(){return new FirebaseStorageError(exports.Code.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}exports.cannotSliceBlob=cannotSliceBlob;function serverFileWrongSize(){return new FirebaseStorageError(exports.Code.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}exports.serverFileWrongSize=serverFileWrongSize;function noDownloadURL(){return new FirebaseStorageError(exports.Code.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}exports.noDownloadURL=noDownloadURL;function invalidArgument(index,fnName,message){return new FirebaseStorageError(exports.Code.INVALID_ARGUMENT,"Invalid argument in `"+fnName+"` at index "+index+": "+message)}exports.invalidArgument=invalidArgument;function invalidArgumentCount(argMin,argMax,fnName,real){var countPart;var plural;if(argMin===argMax){countPart=argMin;plural=argMin===1?"argument":"arguments"}else{countPart="between "+argMin+" and "+argMax;plural="arguments"}return new FirebaseStorageError(exports.Code.INVALID_ARGUMENT_COUNT,"Invalid argument count in `"+fnName+"`: Expected "+countPart+" "+plural+", received "+real+".")}exports.invalidArgumentCount=invalidArgumentCount;function appDeleted(){return new FirebaseStorageError(exports.Code.APP_DELETED,"The Firebase app was deleted.")}exports.appDeleted=appDeleted;function invalidRootOperation(name){return new FirebaseStorageError(exports.Code.INVALID_ROOT_OPERATION,"The operation '"+name+"' cannot be performed on a root reference, create a non-root "+"reference using child, such as .child('file.png').")}exports.invalidRootOperation=invalidRootOperation;function invalidFormat(format,message){return new FirebaseStorageError(exports.Code.INVALID_FORMAT,"String does not match format '"+format+"': "+message)}exports.invalidFormat=invalidFormat;function internalError(message){throw new FirebaseStorageError(exports.Code.INTERNAL_ERROR,"Internal error: "+message)}exports.internalError=internalError},{"./constants":113}],115:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var promiseimpl=require("./promise_external");var FailRequest=function(){function FailRequest(error){this.promise_=promiseimpl.reject(error)}FailRequest.prototype.getPromise=function(){return this.promise_};FailRequest.prototype.cancel=function(appDelete){if(appDelete===void 0){appDelete=false}};return FailRequest}();exports.FailRequest=FailRequest},{"./promise_external":123}],116:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var type=require("./type");function getBlobBuilder(){if(typeof BlobBuilder!=="undefined"){return BlobBuilder}else if(typeof WebKitBlobBuilder!=="undefined"){return WebKitBlobBuilder}else{return undefined}}function getBlob(){var var_args=[];for(var _i=0;_i<arguments.length;_i++){var_args[_i]=arguments[_i]}var BlobBuilder=getBlobBuilder();if(BlobBuilder!==undefined){var bb=new BlobBuilder;for(var i=0;i<var_args.length;i++){bb.append(var_args[i])}return bb.getBlob()}else{if(type.isNativeBlobDefined()){return new Blob(var_args)}else{throw Error("This browser doesn't seem to support creating Blobs")}}}exports.getBlob=getBlob;function sliceBlob(blob,start,end){if(blob.webkitSlice){return blob.webkitSlice(start,end)}else if(blob.mozSlice){return blob.mozSlice(start,end)}else if(blob.slice){return blob.slice(start,end)}return null}exports.sliceBlob=sliceBlob},{"./type":130}],117:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var type=require("./type");function jsonObjectOrNull(s){var obj;try{obj=JSON.parse(s)}catch(e){return null}if(type.isNonArrayObject(obj)){return obj}else{return null}}exports.jsonObjectOrNull=jsonObjectOrNull},{"./type":130}],118:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errorsExports=require("./error");var Location=function(){function Location(bucket,path){this.bucket=bucket;this.path_=path}Object.defineProperty(Location.prototype,"path",{get:function(){return this.path_},enumerable:true,configurable:true});Location.prototype.fullServerUrl=function(){var encode=encodeURIComponent;return"/b/"+encode(this.bucket)+"/o/"+encode(this.path)};Location.prototype.bucketOnlyServerUrl=function(){var encode=encodeURIComponent;return"/b/"+encode(this.bucket)+"/o"};Location.makeFromBucketSpec=function(bucketString){var bucketLocation;try{bucketLocation=Location.makeFromUrl(bucketString)}catch(e){return new Location(bucketString,"")}if(bucketLocation.path===""){return bucketLocation}else{throw errorsExports.invalidDefaultBucket(bucketString)}};Location.makeFromUrl=function(url){var location=null;var bucketDomain="([A-Za-z0-9.\\-]+)";function gsModify(loc){if(loc.path.charAt(loc.path.length-1)==="/"){loc.path_=loc.path_.slice(0,-1)}}var gsPath="(/(.*))?$";var path="(/([^?#]*).*)?$";var gsRegex=new RegExp("^gs://"+bucketDomain+gsPath,"i");var gsIndices={bucket:1,path:3};function httpModify(loc){loc.path_=decodeURIComponent(loc.path)}var version="v[A-Za-z0-9_]+";var httpRegex=new RegExp("^https?://firebasestorage\\.googleapis\\.com/"+version+"/b/"+bucketDomain+"/o"+path,"i");var httpIndices={bucket:1,path:3};var groups=[{regex:gsRegex,indices:gsIndices,postModify:gsModify},{regex:httpRegex,indices:httpIndices,postModify:httpModify}];for(var i=0;i<groups.length;i++){var group=groups[i];var captures=group.regex.exec(url);if(captures){var bucketValue=captures[group.indices.bucket];var pathValue=captures[group.indices.path];if(!pathValue){pathValue=""}location=new Location(bucketValue,pathValue);group.postModify(location);break}}if(location==null){throw errorsExports.invalidUrl(url)}return location};return Location}();exports.Location=Location},{"./error":114}],119:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var json=require("./json");var location_1=require("./location");var path=require("./path");var type=require("./type");var UrlUtils=require("./url");function noXform_(metadata,value){return value}exports.noXform_=noXform_;var Mapping=function(){function Mapping(server,opt_local,opt_writable,opt_xform){this.server=server;this.local=opt_local||server;this.writable=!!opt_writable;this.xform=opt_xform||noXform_}return Mapping}();exports.Mapping=Mapping;var mappings_=null;function xformPath(fullPath){var valid=type.isString(fullPath);if(!valid||fullPath.length<2){return fullPath}else{fullPath=fullPath;return path.lastComponent(fullPath)}}exports.xformPath=xformPath;function getMappings(){if(mappings_){return mappings_}var mappings=[];mappings.push(new Mapping("bucket"));mappings.push(new Mapping("generation"));mappings.push(new Mapping("metageneration"));mappings.push(new Mapping("name","fullPath",true));function mappingsXformPath(metadata,fullPath){return xformPath(fullPath)}var nameMapping=new Mapping("name");nameMapping.xform=mappingsXformPath;mappings.push(nameMapping);function xformSize(metadata,size){if(type.isDef(size)){return+size}else{return size}}var sizeMapping=new Mapping("size");sizeMapping.xform=xformSize;mappings.push(sizeMapping);mappings.push(new Mapping("timeCreated"));mappings.push(new Mapping("updated"));mappings.push(new Mapping("md5Hash",null,true));mappings.push(new Mapping("cacheControl",null,true));mappings.push(new Mapping("contentDisposition",null,true));mappings.push(new Mapping("contentEncoding",null,true));mappings.push(new Mapping("contentLanguage",null,true));mappings.push(new Mapping("contentType",null,true));mappings.push(new Mapping("metadata","customMetadata",true));function xformTokens(metadata,tokens){var valid=type.isString(tokens)&&tokens.length>0;if(!valid){return[]}var encode=encodeURIComponent;var tokensList=tokens.split(",");var urls=tokensList.map(function(token){var bucket=metadata["bucket"];var path=metadata["fullPath"];var urlPart="/b/"+encode(bucket)+"/o/"+encode(path);var base=UrlUtils.makeDownloadUrl(urlPart);var queryString=UrlUtils.makeQueryString({alt:"media",token:token});return base+queryString});return urls}mappings.push(new Mapping("downloadTokens","downloadURLs",false,xformTokens));mappings_=mappings;return mappings_}exports.getMappings=getMappings;function addRef(metadata,authWrapper){function generateRef(){var bucket=metadata["bucket"];var path=metadata["fullPath"];var loc=new location_1.Location(bucket,path);return authWrapper.makeStorageReference(loc)}Object.defineProperty(metadata,"ref",{get:generateRef})}exports.addRef=addRef;function fromResource(authWrapper,resource,mappings){var metadata={};metadata["type"]="file";var len=mappings.length;for(var i=0;i<len;i++){var mapping=mappings[i];metadata[mapping.local]=mapping.xform(metadata,resource[mapping.server])}addRef(metadata,authWrapper);return metadata}exports.fromResource=fromResource;function fromResourceString(authWrapper,resourceString,mappings){var obj=json.jsonObjectOrNull(resourceString);if(obj===null){return null}var resource=obj;return fromResource(authWrapper,resource,mappings)}exports.fromResourceString=fromResourceString;function toResourceString(metadata,mappings){var resource={};var len=mappings.length;for(var i=0;i<len;i++){var mapping=mappings[i];if(mapping.writable){resource[mapping.server]=metadata[mapping.local]}}return JSON.stringify(resource)}exports.toResourceString=toResourceString;function metadataValidator(p){var validType=p&&type.isObject(p);if(!validType){throw"Expected Metadata object."}for(var key in p){var val=p[key];if(key==="customMetadata"){if(!type.isObject(val)){throw"Expected object for 'customMetadata' mapping."}}else{if(type.isNonNullObject(val)){throw"Mapping for '"+key+"' cannot be an object."}}}}exports.metadataValidator=metadataValidator},{"./json":117,"./location":118,"./path":122,"./type":130,"./url":131}],120:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function contains(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}exports.contains=contains;function forEach(obj,f){for(var key in obj){if(contains(obj,key)){f(key,obj[key])}}}exports.forEach=forEach;function clone(obj){if(obj==null){return{}}var c={};forEach(obj,function(key,val){c[key]=val});return c}exports.clone=clone},{}],121:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var type=require("./type");var Observer=function(){function Observer(nextOrObserver,opt_error,opt_complete){var asFunctions=type.isFunction(nextOrObserver)||type.isDef(opt_error)||type.isDef(opt_complete);if(asFunctions){this.next=nextOrObserver;this.error=opt_error||null;this.complete=opt_complete||null}else{var observer=nextOrObserver;this.next=observer.next||null;this.error=observer.error||null;this.complete=observer.complete||null}}return Observer}();exports.Observer=Observer},{"./type":130}],122:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function parent(path){if(path.length==0){return null}var index=path.lastIndexOf("/");if(index===-1){return""}var newPath=path.slice(0,index);return newPath}exports.parent=parent;function child(path,childPath){var canonicalChildPath=childPath.split("/").filter(function(component){return component.length>0}).join("/");if(path.length===0){return canonicalChildPath}else{return path+"/"+canonicalChildPath}}exports.child=child;function lastComponent(path){var index=path.lastIndexOf("/",path.length-2);if(index===-1){return path}else{return path.slice(index+1)}}exports.lastComponent=lastComponent},{}],123:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function make(resolver){return new Promise(resolver)}exports.make=make;function resolve(value){return Promise.resolve(value)}exports.resolve=resolve;function reject(error){return Promise.reject(error)}exports.reject=reject},{}],124:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var app_1=require("@firebase/app");var array=require("./array");var backoff=require("./backoff");var errorsExports=require("./error");var object=require("./object");var promiseimpl=require("./promise_external");var type=require("./type");var UrlUtils=require("./url");var XhrIoExports=require("./xhrio");var NetworkRequest=function(){function NetworkRequest(url,method,headers,body,successCodes,additionalRetryCodes,callback,errorCallback,timeout,progressCallback,pool){this.pendingXhr_=null;this.backoffId_=null;this.resolve_=null;this.reject_=null;this.canceled_=false;this.appDelete_=false;this.url_=url;this.method_=method;this.headers_=headers;this.body_=body;this.successCodes_=successCodes.slice();this.additionalRetryCodes_=additionalRetryCodes.slice();this.callback_=callback;this.errorCallback_=errorCallback;this.progressCallback_=progressCallback;this.timeout_=timeout;this.pool_=pool;var self=this;this.promise_=promiseimpl.make(function(resolve,reject){self.resolve_=resolve;self.reject_=reject;self.start_()})}NetworkRequest.prototype.start_=function(){var self=this;function doTheRequest(backoffCallback,canceled){if(canceled){backoffCallback(false,new RequestEndStatus(false,null,true));return}var xhr=self.pool_.createXhrIo();self.pendingXhr_=xhr;function progressListener(progressEvent){var loaded=progressEvent.loaded;var total=progressEvent.lengthComputable?progressEvent.total:-1;if(self.progressCallback_!==null){self.progressCallback_(loaded,total)}}if(self.progressCallback_!==null){xhr.addUploadProgressListener(progressListener)}xhr.send(self.url_,self.method_,self.body_,self.headers_).then(function(xhr){if(self.progressCallback_!==null){xhr.removeUploadProgressListener(progressListener)}self.pendingXhr_=null;xhr=xhr;var hitServer=xhr.getErrorCode()===XhrIoExports.ErrorCode.NO_ERROR;var status=xhr.getStatus();if(!hitServer||self.isRetryStatusCode_(status)){var wasCanceled=xhr.getErrorCode()===XhrIoExports.ErrorCode.ABORT;backoffCallback(false,new RequestEndStatus(false,null,wasCanceled));return}var successCode=array.contains(self.successCodes_,status);backoffCallback(true,new RequestEndStatus(successCode,xhr))})}function backoffDone(requestWentThrough,status){var resolve=self.resolve_;var reject=self.reject_;var xhr=status.xhr;if(status.wasSuccessCode){try{var result=self.callback_(xhr,xhr.getResponseText());if(type.isJustDef(result)){resolve(result)}else{resolve()}}catch(e){reject(e)}}else{if(xhr!==null){var err=errorsExports.unknown();err.setServerResponseProp(xhr.getResponseText());if(self.errorCallback_){reject(self.errorCallback_(xhr,err))}else{reject(err)}}else{if(status.canceled){var err=self.appDelete_?errorsExports.appDeleted():errorsExports.canceled();reject(err)}else{var err=errorsExports.retryLimitExceeded();reject(err)}}}}if(this.canceled_){backoffDone(false,new RequestEndStatus(false,null,true))}else{this.backoffId_=backoff.start(doTheRequest,backoffDone,this.timeout_)}};NetworkRequest.prototype.getPromise=function(){return this.promise_};NetworkRequest.prototype.cancel=function(appDelete){this.canceled_=true;this.appDelete_=appDelete||false;if(this.backoffId_!==null){backoff.stop(this.backoffId_)}if(this.pendingXhr_!==null){this.pendingXhr_.abort()}};NetworkRequest.prototype.isRetryStatusCode_=function(status){var isFiveHundredCode=status>=500&&status<600;var extraRetryCodes=[408,429];var isExtraRetryCode=array.contains(extraRetryCodes,status);var isRequestSpecificRetryCode=array.contains(this.additionalRetryCodes_,status);return isFiveHundredCode||isExtraRetryCode||isRequestSpecificRetryCode};return NetworkRequest}();var RequestEndStatus=function(){function RequestEndStatus(wasSuccessCode,xhr,opt_canceled){this.wasSuccessCode=wasSuccessCode;this.xhr=xhr;this.canceled=!!opt_canceled}return RequestEndStatus}();exports.RequestEndStatus=RequestEndStatus;function addAuthHeader_(headers,authToken){if(authToken!==null&&authToken.length>0){headers["Authorization"]="Firebase "+authToken}}exports.addAuthHeader_=addAuthHeader_;function addVersionHeader_(headers){var number=typeof app_1.default!=="undefined"?app_1.default.SDK_VERSION:"AppManager";headers["X-Firebase-Storage-Version"]="webjs/"+number}exports.addVersionHeader_=addVersionHeader_;function makeRequest(requestInfo,authToken,pool){var queryPart=UrlUtils.makeQueryString(requestInfo.urlParams);var url=requestInfo.url+queryPart;var headers=object.clone(requestInfo.headers);addAuthHeader_(headers,authToken);addVersionHeader_(headers);return new NetworkRequest(url,requestInfo.method,headers,requestInfo.body,requestInfo.successCodes,requestInfo.additionalRetryCodes,requestInfo.handler,requestInfo.errorHandler,requestInfo.timeout,requestInfo.progressCallback,pool)}exports.makeRequest=makeRequest},{"./array":108,"./backoff":111,"./error":114,"./object":120,"./promise_external":123,"./type":130,"./url":131,"./xhrio":132,"@firebase/app":6}],125:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var RequestInfo=function(){function RequestInfo(url,method,handler,timeout){this.url=url;this.method=method;this.handler=handler;this.timeout=timeout;this.urlParams={};this.headers={};this.body=null;this.errorHandler=null;this.progressCallback=null;this.successCodes=[200];this.additionalRetryCodes=[]}return RequestInfo}();exports.RequestInfo=RequestInfo},{}],126:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var object=require("./object");var constants=require("./constants");var RequestMap=function(){function RequestMap(){this.map_={};this.id_=constants.minSafeInteger}RequestMap.prototype.addRequest=function(r){var id=this.id_;this.id_++;this.map_[id]=r;var self=this;function unmap(){delete self.map_[id]}r.getPromise().then(unmap,unmap)};RequestMap.prototype.clear=function(){object.forEach(this.map_,function(key,val){if(val){val.cancel(true)}});this.map_={}};return RequestMap}();exports.RequestMap=RequestMap},{"./constants":113,"./object":120}],127:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var array=require("./array");var blob_1=require("./blob");var errorsExports=require("./error");var MetadataUtils=require("./metadata");var object=require("./object");var requestinfo_1=require("./requestinfo");var type=require("./type");var UrlUtils=require("./url");function handlerCheck(cndn){if(!cndn){throw errorsExports.unknown()}}exports.handlerCheck=handlerCheck;function metadataHandler(authWrapper,mappings){function handler(xhr,text){var metadata=MetadataUtils.fromResourceString(authWrapper,text,mappings);handlerCheck(metadata!==null);return metadata}return handler}exports.metadataHandler=metadataHandler;function sharedErrorHandler(location){function errorHandler(xhr,err){var newErr;if(xhr.getStatus()===401){newErr=errorsExports.unauthenticated()}else{if(xhr.getStatus()===402){newErr=errorsExports.quotaExceeded(location.bucket)}else{if(xhr.getStatus()===403){newErr=errorsExports.unauthorized(location.path)}else{newErr=err}}}newErr.setServerResponseProp(err.serverResponseProp());return newErr}return errorHandler}exports.sharedErrorHandler=sharedErrorHandler;function objectErrorHandler(location){var shared=sharedErrorHandler(location);function errorHandler(xhr,err){var newErr=shared(xhr,err);if(xhr.getStatus()===404){newErr=errorsExports.objectNotFound(location.path)}newErr.setServerResponseProp(err.serverResponseProp());return newErr}return errorHandler}exports.objectErrorHandler=objectErrorHandler;function getMetadata(authWrapper,location,mappings){var urlPart=location.fullServerUrl();var url=UrlUtils.makeNormalUrl(urlPart);var method="GET";var timeout=authWrapper.maxOperationRetryTime();var requestInfo=new requestinfo_1.RequestInfo(url,method,metadataHandler(authWrapper,mappings),timeout);requestInfo.errorHandler=objectErrorHandler(location);return requestInfo}exports.getMetadata=getMetadata;function updateMetadata(authWrapper,location,metadata,mappings){var urlPart=location.fullServerUrl();var url=UrlUtils.makeNormalUrl(urlPart);var method="PATCH";var body=MetadataUtils.toResourceString(metadata,mappings);var headers={"Content-Type":"application/json; charset=utf-8"};var timeout=authWrapper.maxOperationRetryTime();var requestInfo=new requestinfo_1.RequestInfo(url,method,metadataHandler(authWrapper,mappings),timeout);requestInfo.headers=headers;requestInfo.body=body;requestInfo.errorHandler=objectErrorHandler(location);return requestInfo}exports.updateMetadata=updateMetadata;function deleteObject(authWrapper,location){var urlPart=location.fullServerUrl();var url=UrlUtils.makeNormalUrl(urlPart);var method="DELETE";var timeout=authWrapper.maxOperationRetryTime();function handler(xhr,text){}var requestInfo=new requestinfo_1.RequestInfo(url,method,handler,timeout);requestInfo.successCodes=[200,204];requestInfo.errorHandler=objectErrorHandler(location);return requestInfo}exports.deleteObject=deleteObject;function determineContentType_(metadata,blob){return metadata&&metadata["contentType"]||blob&&blob.type()||"application/octet-stream"}exports.determineContentType_=determineContentType_;function metadataForUpload_(location,blob,opt_metadata){var metadata=object.clone(opt_metadata);metadata["fullPath"]=location.path;metadata["size"]=blob.size();if(!metadata["contentType"]){metadata["contentType"]=determineContentType_(null,blob)}return metadata}exports.metadataForUpload_=metadataForUpload_;function multipartUpload(authWrapper,location,mappings,blob,opt_metadata){var urlPart=location.bucketOnlyServerUrl();var headers={"X-Goog-Upload-Protocol":"multipart"};function genBoundary(){var str="";for(var i=0;i<2;i++){str=str+Math.random().toString().slice(2)}return str}var boundary=genBoundary();headers["Content-Type"]="multipart/related; boundary="+boundary;var metadata=metadataForUpload_(location,blob,opt_metadata);var metadataString=MetadataUtils.toResourceString(metadata,mappings);var preBlobPart="--"+boundary+"\r\n"+"Content-Type: application/json; charset=utf-8\r\n\r\n"+metadataString+"\r\n--"+boundary+"\r\n"+"Content-Type: "+metadata["contentType"]+"\r\n\r\n";var postBlobPart="\r\n--"+boundary+"--";var body=blob_1.FbsBlob.getBlob(preBlobPart,blob,postBlobPart);if(body===null){throw errorsExports.cannotSliceBlob()}var urlParams={name:metadata["fullPath"]};var url=UrlUtils.makeUploadUrl(urlPart);var method="POST";var timeout=authWrapper.maxUploadRetryTime();var requestInfo=new requestinfo_1.RequestInfo(url,method,metadataHandler(authWrapper,mappings),timeout);requestInfo.urlParams=urlParams;requestInfo.headers=headers;requestInfo.body=body.uploadData();requestInfo.errorHandler=sharedErrorHandler(location);return requestInfo}exports.multipartUpload=multipartUpload;var ResumableUploadStatus=function(){function ResumableUploadStatus(current,total,finalized,metadata){this.current=current;this.total=total;this.finalized=!!finalized;this.metadata=metadata||null}return ResumableUploadStatus}();exports.ResumableUploadStatus=ResumableUploadStatus;function checkResumeHeader_(xhr,opt_allowed){var status;try{status=xhr.getResponseHeader("X-Goog-Upload-Status")}catch(e){handlerCheck(false)}var allowed=opt_allowed||["active"];handlerCheck(array.contains(allowed,status));return status}exports.checkResumeHeader_=checkResumeHeader_;function createResumableUpload(authWrapper,location,mappings,blob,opt_metadata){var urlPart=location.bucketOnlyServerUrl();var metadata=metadataForUpload_(location,blob,opt_metadata);var urlParams={name:metadata["fullPath"]};var url=UrlUtils.makeUploadUrl(urlPart);var method="POST";var headers={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":blob.size(),"X-Goog-Upload-Header-Content-Type":metadata["contentType"],"Content-Type":"application/json; charset=utf-8"};var body=MetadataUtils.toResourceString(metadata,mappings);var timeout=authWrapper.maxUploadRetryTime();function handler(xhr,text){checkResumeHeader_(xhr);var url;try{url=xhr.getResponseHeader("X-Goog-Upload-URL")}catch(e){handlerCheck(false)}handlerCheck(type.isString(url));return url}var requestInfo=new requestinfo_1.RequestInfo(url,method,handler,timeout);requestInfo.urlParams=urlParams;requestInfo.headers=headers;requestInfo.body=body;requestInfo.errorHandler=sharedErrorHandler(location);return requestInfo}exports.createResumableUpload=createResumableUpload;function getResumableUploadStatus(authWrapper,location,url,blob){var headers={"X-Goog-Upload-Command":"query"};function handler(xhr,text){var status=checkResumeHeader_(xhr,["active","final"]);var sizeString;try{sizeString=xhr.getResponseHeader("X-Goog-Upload-Size-Received")}catch(e){handlerCheck(false)}var size=parseInt(sizeString,10);handlerCheck(!isNaN(size));return new ResumableUploadStatus(size,blob.size(),status==="final")}var method="POST";var timeout=authWrapper.maxUploadRetryTime();var requestInfo=new requestinfo_1.RequestInfo(url,method,handler,timeout);
requestInfo.headers=headers;requestInfo.errorHandler=sharedErrorHandler(location);return requestInfo}exports.getResumableUploadStatus=getResumableUploadStatus;exports.resumableUploadChunkSize=256*1024;function continueResumableUpload(location,authWrapper,url,blob,chunkSize,mappings,opt_status,opt_progressCallback){var status=new ResumableUploadStatus(0,0);if(opt_status){status.current=opt_status.current;status.total=opt_status.total}else{status.current=0;status.total=blob.size()}if(blob.size()!==status.total){throw errorsExports.serverFileWrongSize()}var bytesLeft=status.total-status.current;var bytesToUpload=bytesLeft;if(chunkSize>0){bytesToUpload=Math.min(bytesToUpload,chunkSize)}var startByte=status.current;var endByte=startByte+bytesToUpload;var uploadCommand=bytesToUpload===bytesLeft?"upload, finalize":"upload";var headers={"X-Goog-Upload-Command":uploadCommand,"X-Goog-Upload-Offset":status.current};var body=blob.slice(startByte,endByte);if(body===null){throw errorsExports.cannotSliceBlob()}function handler(xhr,text){var uploadStatus=checkResumeHeader_(xhr,["active","final"]);var newCurrent=status.current+bytesToUpload;var size=blob.size();var metadata;if(uploadStatus==="final"){metadata=metadataHandler(authWrapper,mappings)(xhr,text)}else{metadata=null}return new ResumableUploadStatus(newCurrent,size,uploadStatus==="final",metadata)}var method="POST";var timeout=authWrapper.maxUploadRetryTime();var requestInfo=new requestinfo_1.RequestInfo(url,method,handler,timeout);requestInfo.headers=headers;requestInfo.body=body.uploadData();requestInfo.progressCallback=opt_progressCallback||null;requestInfo.errorHandler=sharedErrorHandler(location);return requestInfo}exports.continueResumableUpload=continueResumableUpload},{"./array":108,"./blob":112,"./error":114,"./metadata":119,"./object":120,"./requestinfo":125,"./type":130,"./url":131}],128:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errorsExports=require("./error");exports.StringFormat={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};function formatValidator(stringFormat){switch(stringFormat){case exports.StringFormat.RAW:case exports.StringFormat.BASE64:case exports.StringFormat.BASE64URL:case exports.StringFormat.DATA_URL:return;default:throw"Expected one of the event types: ["+exports.StringFormat.RAW+", "+exports.StringFormat.BASE64+", "+exports.StringFormat.BASE64URL+", "+exports.StringFormat.DATA_URL+"]."}}exports.formatValidator=formatValidator;var StringData=function(){function StringData(data,opt_contentType){this.data=data;this.contentType=opt_contentType||null}return StringData}();exports.StringData=StringData;function dataFromString(format,string){switch(format){case exports.StringFormat.RAW:return new StringData(utf8Bytes_(string));case exports.StringFormat.BASE64:case exports.StringFormat.BASE64URL:return new StringData(base64Bytes_(format,string));case exports.StringFormat.DATA_URL:return new StringData(dataURLBytes_(string),dataURLContentType_(string))}throw errorsExports.unknown()}exports.dataFromString=dataFromString;function utf8Bytes_(string){var b=[];for(var i=0;i<string.length;i++){var c=string.charCodeAt(i);if(c<=127){b.push(c)}else{if(c<=2047){b.push(192|c>>6,128|c&63)}else{if((c&64512)==55296){var valid=i<string.length-1&&(string.charCodeAt(i+1)&64512)==56320;if(!valid){b.push(239,191,189)}else{var hi=c;var lo=string.charCodeAt(++i);c=65536|(hi&1023)<<10|lo&1023;b.push(240|c>>18,128|c>>12&63,128|c>>6&63,128|c&63)}}else{if((c&64512)==56320){b.push(239,191,189)}else{b.push(224|c>>12,128|c>>6&63,128|c&63)}}}}}return new Uint8Array(b)}exports.utf8Bytes_=utf8Bytes_;function percentEncodedBytes_(string){var decoded;try{decoded=decodeURIComponent(string)}catch(e){throw errorsExports.invalidFormat(exports.StringFormat.DATA_URL,"Malformed data URL.")}return utf8Bytes_(decoded)}exports.percentEncodedBytes_=percentEncodedBytes_;function base64Bytes_(format,string){switch(format){case exports.StringFormat.BASE64:{var hasMinus=string.indexOf("-")!==-1;var hasUnder=string.indexOf("_")!==-1;if(hasMinus||hasUnder){var invalidChar=hasMinus?"-":"_";throw errorsExports.invalidFormat(format,"Invalid character '"+invalidChar+"' found: is it base64url encoded?")}break}case exports.StringFormat.BASE64URL:{var hasPlus=string.indexOf("+")!==-1;var hasSlash=string.indexOf("/")!==-1;if(hasPlus||hasSlash){var invalidChar=hasPlus?"+":"/";throw errorsExports.invalidFormat(format,"Invalid character '"+invalidChar+"' found: is it base64 encoded?")}string=string.replace(/-/g,"+").replace(/_/g,"/");break}}var bytes;try{bytes=atob(string)}catch(e){throw errorsExports.invalidFormat(format,"Invalid character found")}var array=new Uint8Array(bytes.length);for(var i=0;i<bytes.length;i++){array[i]=bytes.charCodeAt(i)}return array}exports.base64Bytes_=base64Bytes_;var DataURLParts=function(){function DataURLParts(dataURL){this.base64=false;this.contentType=null;var matches=dataURL.match(/^data:([^,]+)?,/);if(matches===null){throw errorsExports.invalidFormat(exports.StringFormat.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>")}var middle=matches[1]||null;if(middle!=null){this.base64=endsWith(middle,";base64");this.contentType=this.base64?middle.substring(0,middle.length-";base64".length):middle}this.rest=dataURL.substring(dataURL.indexOf(",")+1)}return DataURLParts}();function dataURLBytes_(string){var parts=new DataURLParts(string);if(parts.base64){return base64Bytes_(exports.StringFormat.BASE64,parts.rest)}else{return percentEncodedBytes_(parts.rest)}}exports.dataURLBytes_=dataURLBytes_;function dataURLContentType_(string){var parts=new DataURLParts(string);return parts.contentType}exports.dataURLContentType_=dataURLContentType_;function endsWith(s,end){var longEnough=s.length>=end.length;if(!longEnough){return false}return s.substring(s.length-end.length)===end}},{"./error":114}],129:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TaskEvent={STATE_CHANGED:"state_changed"};exports.InternalTaskState={RUNNING:"running",PAUSING:"pausing",PAUSED:"paused",SUCCESS:"success",CANCELING:"canceling",CANCELED:"canceled",ERROR:"error"};exports.TaskState={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function taskStateFromInternalTaskState(state){switch(state){case exports.InternalTaskState.RUNNING:case exports.InternalTaskState.PAUSING:case exports.InternalTaskState.CANCELING:return exports.TaskState.RUNNING;case exports.InternalTaskState.PAUSED:return exports.TaskState.PAUSED;case exports.InternalTaskState.SUCCESS:return exports.TaskState.SUCCESS;case exports.InternalTaskState.CANCELED:return exports.TaskState.CANCELED;case exports.InternalTaskState.ERROR:return exports.TaskState.ERROR;default:return exports.TaskState.ERROR}}exports.taskStateFromInternalTaskState=taskStateFromInternalTaskState},{}],130:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function isDef(p){return p!=null}exports.isDef=isDef;function isJustDef(p){return p!==void 0}exports.isJustDef=isJustDef;function isFunction(p){return typeof p==="function"}exports.isFunction=isFunction;function isObject(p){return typeof p==="object"}exports.isObject=isObject;function isNonNullObject(p){return isObject(p)&&p!==null}exports.isNonNullObject=isNonNullObject;function isNonArrayObject(p){return isObject(p)&&!Array.isArray(p)}exports.isNonArrayObject=isNonArrayObject;function isString(p){return typeof p==="string"||p instanceof String}exports.isString=isString;function isNumber(p){return typeof p==="number"||p instanceof Number}exports.isNumber=isNumber;function isNativeBlob(p){return isNativeBlobDefined()&&p instanceof Blob}exports.isNativeBlob=isNativeBlob;function isNativeBlobDefined(){return typeof Blob!=="undefined"}exports.isNativeBlobDefined=isNativeBlobDefined},{}],131:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants=require("./constants");var object=require("./object");function makeNormalUrl(urlPart){return constants.domainBase+constants.apiBaseUrl+urlPart}exports.makeNormalUrl=makeNormalUrl;function makeDownloadUrl(urlPart){return constants.downloadBase+constants.apiBaseUrl+urlPart}exports.makeDownloadUrl=makeDownloadUrl;function makeUploadUrl(urlPart){return constants.domainBase+constants.apiUploadBaseUrl+urlPart}exports.makeUploadUrl=makeUploadUrl;function makeQueryString(params){var encode=encodeURIComponent;var queryPart="?";object.forEach(params,function(key,val){var nextPart=encode(key)+"="+encode(val);queryPart=queryPart+nextPart+"&"});queryPart=queryPart.slice(0,-1);return queryPart}exports.makeQueryString=makeQueryString},{"./constants":113,"./object":120}],132:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ErrorCode;(function(ErrorCode){ErrorCode[ErrorCode["NO_ERROR"]=0]="NO_ERROR";ErrorCode[ErrorCode["NETWORK_ERROR"]=1]="NETWORK_ERROR";ErrorCode[ErrorCode["ABORT"]=2]="ABORT"})(ErrorCode=exports.ErrorCode||(exports.ErrorCode={}))},{}],133:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var errorsExports=require("./error");var object=require("./object");var promiseimpl=require("./promise_external");var type=require("./type");var XhrIoExports=require("./xhrio");var NetworkXhrIo=function(){function NetworkXhrIo(){var _this=this;this.sent_=false;this.xhr_=new XMLHttpRequest;this.errorCode_=XhrIoExports.ErrorCode.NO_ERROR;this.sendPromise_=promiseimpl.make(function(resolve,reject){_this.xhr_.addEventListener("abort",function(event){_this.errorCode_=XhrIoExports.ErrorCode.ABORT;resolve(_this)});_this.xhr_.addEventListener("error",function(event){_this.errorCode_=XhrIoExports.ErrorCode.NETWORK_ERROR;resolve(_this)});_this.xhr_.addEventListener("load",function(event){resolve(_this)})})}NetworkXhrIo.prototype.send=function(url,method,opt_body,opt_headers){var _this=this;if(this.sent_){throw errorsExports.internalError("cannot .send() more than once")}this.sent_=true;this.xhr_.open(method,url,true);if(type.isDef(opt_headers)){var headers=opt_headers;object.forEach(headers,function(key,val){_this.xhr_.setRequestHeader(key,val.toString())})}if(type.isDef(opt_body)){this.xhr_.send(opt_body)}else{this.xhr_.send()}return this.sendPromise_};NetworkXhrIo.prototype.getErrorCode=function(){if(!this.sent_){throw errorsExports.internalError("cannot .getErrorCode() before sending")}return this.errorCode_};NetworkXhrIo.prototype.getStatus=function(){if(!this.sent_){throw errorsExports.internalError("cannot .getStatus() before sending")}try{return this.xhr_.status}catch(e){return-1}};NetworkXhrIo.prototype.getResponseText=function(){if(!this.sent_){throw errorsExports.internalError("cannot .getResponseText() before sending")}return this.xhr_.responseText};NetworkXhrIo.prototype.abort=function(){this.xhr_.abort()};NetworkXhrIo.prototype.getResponseHeader=function(header){return this.xhr_.getResponseHeader(header)};NetworkXhrIo.prototype.addUploadProgressListener=function(listener){if(type.isDef(this.xhr_.upload)){this.xhr_.upload.addEventListener("progress",listener)}};NetworkXhrIo.prototype.removeUploadProgressListener=function(listener){if(type.isDef(this.xhr_.upload)){this.xhr_.upload.removeEventListener("progress",listener)}};return NetworkXhrIo}();exports.NetworkXhrIo=NetworkXhrIo},{"./error":114,"./object":120,"./promise_external":123,"./type":130,"./xhrio":132}],134:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var xhrio_network_1=require("./xhrio_network");var XhrIoPool=function(){function XhrIoPool(){}XhrIoPool.prototype.createXhrIo=function(){return new xhrio_network_1.NetworkXhrIo};return XhrIoPool}();exports.XhrIoPool=XhrIoPool},{"./xhrio_network":133}],135:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var args=require("./implementation/args");var blob_1=require("./implementation/blob");var errorsExports=require("./implementation/error");var location_1=require("./implementation/location");var metadata=require("./implementation/metadata");var object=require("./implementation/object");var path=require("./implementation/path");var requests=require("./implementation/requests");var fbsString=require("./implementation/string");var string_1=require("./implementation/string");var type=require("./implementation/type");var task_1=require("./task");var Reference=function(){function Reference(authWrapper,location){this.authWrapper=authWrapper;if(location instanceof location_1.Location){this.location=location}else{this.location=location_1.Location.makeFromUrl(location)}}Reference.prototype.toString=function(){args.validate("toString",[],arguments);return"gs://"+this.location.bucket+"/"+this.location.path};Reference.prototype.newRef=function(authWrapper,location){return new Reference(authWrapper,location)};Reference.prototype.mappings=function(){return metadata.getMappings()};Reference.prototype.child=function(childPath){args.validate("child",[args.stringSpec()],arguments);var newPath=path.child(this.location.path,childPath);var location=new location_1.Location(this.location.bucket,newPath);return this.newRef(this.authWrapper,location)};Object.defineProperty(Reference.prototype,"parent",{get:function(){var newPath=path.parent(this.location.path);if(newPath===null){return null}var location=new location_1.Location(this.location.bucket,newPath);return this.newRef(this.authWrapper,location)},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"root",{get:function(){var location=new location_1.Location(this.location.bucket,"");return this.newRef(this.authWrapper,location)},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"bucket",{get:function(){return this.location.bucket},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"fullPath",{get:function(){return this.location.path},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"name",{get:function(){return path.lastComponent(this.location.path)},enumerable:true,configurable:true});Object.defineProperty(Reference.prototype,"storage",{get:function(){return this.authWrapper.service()},enumerable:true,configurable:true});Reference.prototype.put=function(data,metadata){if(metadata===void 0){metadata=null}args.validate("put",[args.uploadDataSpec(),args.metadataSpec(true)],arguments);this.throwIfRoot_("put");return new task_1.UploadTask(this,this.authWrapper,this.location,this.mappings(),new blob_1.FbsBlob(data),metadata)};Reference.prototype.putString=function(string,format,opt_metadata){if(format===void 0){format=string_1.StringFormat.RAW}args.validate("putString",[args.stringSpec(),args.stringSpec(fbsString.formatValidator,true),args.metadataSpec(true)],arguments);this.throwIfRoot_("putString");var data=fbsString.dataFromString(format,string);var metadata=object.clone(opt_metadata);if(!type.isDef(metadata["contentType"])&&type.isDef(data.contentType)){metadata["contentType"]=data.contentType}return new task_1.UploadTask(this,this.authWrapper,this.location,this.mappings(),new blob_1.FbsBlob(data.data,true),metadata)};Reference.prototype.delete=function(){args.validate("delete",[],arguments);this.throwIfRoot_("delete");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=requests.deleteObject(self.authWrapper,self.location);return self.authWrapper.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.getMetadata=function(){args.validate("getMetadata",[],arguments);this.throwIfRoot_("getMetadata");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=requests.getMetadata(self.authWrapper,self.location,self.mappings());return self.authWrapper.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.updateMetadata=function(metadata){args.validate("updateMetadata",[args.metadataSpec()],arguments);this.throwIfRoot_("updateMetadata");var self=this;return this.authWrapper.getAuthToken().then(function(authToken){var requestInfo=requests.updateMetadata(self.authWrapper,self.location,metadata,self.mappings());return self.authWrapper.makeRequest(requestInfo,authToken).getPromise()})};Reference.prototype.getDownloadURL=function(){args.validate("getDownloadURL",[],arguments);this.throwIfRoot_("getDownloadURL");return this.getMetadata().then(function(metadata){var url=metadata["downloadURLs"][0];if(type.isDef(url)){return url}else{throw errorsExports.noDownloadURL()}})};Reference.prototype.throwIfRoot_=function(name){if(this.location.path===""){throw errorsExports.invalidRootOperation(name)}};return Reference}();exports.Reference=Reference},{"./implementation/args":107,"./implementation/blob":112,"./implementation/error":114,"./implementation/location":118,"./implementation/metadata":119,"./implementation/object":120,"./implementation/path":122,"./implementation/requests":127,"./implementation/string":128,"./implementation/type":130,"./task":137}],136:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var args=require("./implementation/args");var authwrapper_1=require("./implementation/authwrapper");var location_1=require("./implementation/location");var fbsPromiseImpl=require("./implementation/promise_external");var RequestExports=require("./implementation/request");var reference_1=require("./reference");var Service=function(){function Service(app,pool,url){this.bucket_=null;function maker(authWrapper,loc){return new reference_1.Reference(authWrapper,loc)}this.authWrapper_=new authwrapper_1.AuthWrapper(app,maker,RequestExports.makeRequest,this,pool);this.app_=app;if(url!=null){this.bucket_=location_1.Location.makeFromBucketSpec(url)}else{var authWrapperBucket=this.authWrapper_.bucket();if(authWrapperBucket!=null){this.bucket_=new location_1.Location(authWrapperBucket,"")}}this.internals_=new ServiceInternals(this)}Service.prototype.ref=function(path){function validator(path){if(/^[A-Za-z]+:\/\//.test(path)){throw"Expected child path but got a URL, use refFromURL instead."}}args.validate("ref",[args.stringSpec(validator,true)],arguments);if(this.bucket_==null){throw new Error("No Storage Bucket defined in Firebase Options.")}var ref=new reference_1.Reference(this.authWrapper_,this.bucket_);if(path!=null){return ref.child(path)}else{return ref}};Service.prototype.refFromURL=function(url){function validator(p){if(!/^[A-Za-z]+:\/\//.test(p)){throw"Expected full URL but got a child path, use ref instead."}try{location_1.Location.makeFromUrl(p)}catch(e){throw"Expected valid full URL but got an invalid one."}}args.validate("refFromURL",[args.stringSpec(validator,false)],arguments);return new reference_1.Reference(this.authWrapper_,url)};Object.defineProperty(Service.prototype,"maxUploadRetryTime",{get:function(){return this.authWrapper_.maxUploadRetryTime()},enumerable:true,configurable:true});Service.prototype.setMaxUploadRetryTime=function(time){args.validate("setMaxUploadRetryTime",[args.nonNegativeNumberSpec()],arguments);this.authWrapper_.setMaxUploadRetryTime(time)};Object.defineProperty(Service.prototype,"maxOperationRetryTime",{get:function(){return this.authWrapper_.maxOperationRetryTime()},enumerable:true,configurable:true});Service.prototype.setMaxOperationRetryTime=function(time){args.validate("setMaxOperationRetryTime",[args.nonNegativeNumberSpec()],arguments);this.authWrapper_.setMaxOperationRetryTime(time)};Object.defineProperty(Service.prototype,"app",{get:function(){return this.app_},enumerable:true,configurable:true});Object.defineProperty(Service.prototype,"INTERNAL",{get:function(){return this.internals_},enumerable:true,configurable:true});return Service}();exports.Service=Service;var ServiceInternals=function(){function ServiceInternals(service){this.service_=service}ServiceInternals.prototype.delete=function(){this.service_.authWrapper_.deleteApp();return fbsPromiseImpl.resolve(undefined)};return ServiceInternals}();exports.ServiceInternals=ServiceInternals},{"./implementation/args":107,"./implementation/authwrapper":110,"./implementation/location":118,"./implementation/promise_external":123,"./implementation/request":124,"./reference":135}],137:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var taskenums_1=require("./implementation/taskenums");var observer_1=require("./implementation/observer");var taskenums_2=require("./implementation/taskenums");var tasksnapshot_1=require("./tasksnapshot");var fbsArgs=require("./implementation/args");var fbsArray=require("./implementation/array");var async_1=require("./implementation/async");var errors=require("./implementation/error");var fbsPromiseimpl=require("./implementation/promise_external");var fbsRequests=require("./implementation/requests");var fbsTaskEnums=require("./implementation/taskenums");var typeUtils=require("./implementation/type");var UploadTask=function(){function UploadTask(ref,authWrapper,location,mappings,blob,metadata){if(metadata===void 0){metadata=null}var _this=this;this.transferred_=0;this.needToFetchStatus_=false;this.needToFetchMetadata_=false;this.observers_=[];this.error_=null;this.uploadUrl_=null;this.request_=null;this.chunkMultiplier_=1;this.resolve_=null;this.reject_=null;this.ref_=ref;this.authWrapper_=authWrapper;this.location_=location;this.blob_=blob;this.metadata_=metadata;this.mappings_=mappings;this.resumable_=this.shouldDoResumable_(this.blob_);this.state_=taskenums_1.InternalTaskState.RUNNING;this.errorHandler_=function(error){_this.request_=null;_this.chunkMultiplier_=1;if(error.codeEquals(errors.Code.CANCELED)){_this.needToFetchStatus_=true;_this.completeTransitions_()}else{_this.error_=error;_this.transition_(taskenums_1.InternalTaskState.ERROR)}};this.metadataErrorHandler_=function(error){_this.request_=null;if(error.codeEquals(errors.Code.CANCELED)){_this.completeTransitions_()}else{_this.error_=error;_this.transition_(taskenums_1.InternalTaskState.ERROR)}};this.promise_=fbsPromiseimpl.make(function(resolve,reject){_this.resolve_=resolve;_this.reject_=reject;_this.start_()});this.promise_.then(null,function(){})}UploadTask.prototype.makeProgressCallback_=function(){var _this=this;var sizeBefore=this.transferred_;return function(loaded,total){_this.updateProgress_(sizeBefore+loaded)}};UploadTask.prototype.shouldDoResumable_=function(blob){return blob.size()>256*1024};UploadTask.prototype.start_=function(){if(this.state_!==taskenums_1.InternalTaskState.RUNNING){return}if(this.request_!==null){return}if(this.resumable_){if(this.uploadUrl_===null){this.createResumable_()}else{if(this.needToFetchStatus_){this.fetchStatus_()}else{if(this.needToFetchMetadata_){this.fetchMetadata_()}else{this.continueUpload_()}}}}else{this.oneShotUpload_()}};UploadTask.prototype.resolveToken_=function(callback){var _this=this;this.authWrapper_.getAuthToken().then(function(authToken){switch(_this.state_){case taskenums_1.InternalTaskState.RUNNING:callback(authToken);break;case taskenums_1.InternalTaskState.CANCELING:_this.transition_(taskenums_1.InternalTaskState.CANCELED);break;case taskenums_1.InternalTaskState.PAUSING:_this.transition_(taskenums_1.InternalTaskState.PAUSED);break;default:}})};UploadTask.prototype.createResumable_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=fbsRequests.createResumableUpload(_this.authWrapper_,_this.location_,_this.mappings_,_this.blob_,_this.metadata_);var createRequest=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=createRequest;createRequest.getPromise().then(function(url){_this.request_=null;_this.uploadUrl_=url;_this.needToFetchStatus_=false;_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.fetchStatus_=function(){var _this=this;var url=this.uploadUrl_;this.resolveToken_(function(authToken){var requestInfo=fbsRequests.getResumableUploadStatus(_this.authWrapper_,_this.location_,url,_this.blob_);var statusRequest=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=statusRequest;statusRequest.getPromise().then(function(status){status=status;_this.request_=null;_this.updateProgress_(status.current);_this.needToFetchStatus_=false;if(status.finalized){_this.needToFetchMetadata_=true}_this.completeTransitions_()},_this.errorHandler_)})};UploadTask.prototype.continueUpload_=function(){var _this=this;var chunkSize=fbsRequests.resumableUploadChunkSize*this.chunkMultiplier_;var status=new fbsRequests.ResumableUploadStatus(this.transferred_,this.blob_.size());var url=this.uploadUrl_;this.resolveToken_(function(authToken){var requestInfo;try{requestInfo=fbsRequests.continueResumableUpload(_this.location_,_this.authWrapper_,url,_this.blob_,chunkSize,_this.mappings_,status,_this.makeProgressCallback_())}catch(e){_this.error_=e;_this.transition_(taskenums_1.InternalTaskState.ERROR);return}var uploadRequest=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=uploadRequest;uploadRequest.getPromise().then(function(newStatus){_this.increaseMultiplier_();_this.request_=null;_this.updateProgress_(newStatus.current);if(newStatus.finalized){_this.metadata_=newStatus.metadata;_this.transition_(taskenums_1.InternalTaskState.SUCCESS)}else{_this.completeTransitions_()}},_this.errorHandler_)})};UploadTask.prototype.increaseMultiplier_=function(){var currentSize=fbsRequests.resumableUploadChunkSize*this.chunkMultiplier_;if(currentSize<32*1024*1024){this.chunkMultiplier_*=2}};UploadTask.prototype.fetchMetadata_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=fbsRequests.getMetadata(_this.authWrapper_,_this.location_,_this.mappings_);var metadataRequest=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=metadataRequest;metadataRequest.getPromise().then(function(metadata){_this.request_=null;_this.metadata_=metadata;_this.transition_(taskenums_1.InternalTaskState.SUCCESS)},_this.metadataErrorHandler_)})};UploadTask.prototype.oneShotUpload_=function(){var _this=this;this.resolveToken_(function(authToken){var requestInfo=fbsRequests.multipartUpload(_this.authWrapper_,_this.location_,_this.mappings_,_this.blob_,_this.metadata_);var multipartRequest=_this.authWrapper_.makeRequest(requestInfo,authToken);_this.request_=multipartRequest;multipartRequest.getPromise().then(function(metadata){_this.request_=null;_this.metadata_=metadata;_this.updateProgress_(_this.blob_.size());_this.transition_(taskenums_1.InternalTaskState.SUCCESS)},_this.errorHandler_)})};UploadTask.prototype.updateProgress_=function(transferred){var old=this.transferred_;this.transferred_=transferred;if(this.transferred_!==old){this.notifyObservers_()}};UploadTask.prototype.transition_=function(state){if(this.state_===state){return}switch(state){case taskenums_1.InternalTaskState.CANCELING:this.state_=state;if(this.request_!==null){this.request_.cancel()}break;case taskenums_1.InternalTaskState.PAUSING:this.state_=state;if(this.request_!==null){this.request_.cancel()}break;case taskenums_1.InternalTaskState.RUNNING:var wasPaused=this.state_===taskenums_1.InternalTaskState.PAUSED;this.state_=state;if(wasPaused){this.notifyObservers_();this.start_()}break;case taskenums_1.InternalTaskState.PAUSED:this.state_=state;this.notifyObservers_();break;case taskenums_1.InternalTaskState.CANCELED:this.error_=errors.canceled();this.state_=state;this.notifyObservers_();break;case taskenums_1.InternalTaskState.ERROR:this.state_=state;this.notifyObservers_();break;case taskenums_1.InternalTaskState.SUCCESS:this.state_=state;this.notifyObservers_();break}};UploadTask.prototype.completeTransitions_=function(){switch(this.state_){case taskenums_1.InternalTaskState.PAUSING:this.transition_(taskenums_1.InternalTaskState.PAUSED);break;case taskenums_1.InternalTaskState.CANCELING:this.transition_(taskenums_1.InternalTaskState.CANCELED);break;case taskenums_1.InternalTaskState.RUNNING:this.start_();break;default:break}};Object.defineProperty(UploadTask.prototype,"snapshot",{get:function(){var externalState=fbsTaskEnums.taskStateFromInternalTaskState(this.state_);return new tasksnapshot_1.UploadTaskSnapshot(this.transferred_,this.blob_.size(),externalState,this.metadata_,this,this.ref_)},enumerable:true,configurable:true});UploadTask.prototype.on=function(type,nextOrObserver,error,completed){if(nextOrObserver===void 0){nextOrObserver=undefined}if(error===void 0){error=undefined}if(completed===void 0){completed=undefined}function typeValidator(_p){if(type!==taskenums_2.TaskEvent.STATE_CHANGED){throw"Expected one of the event types: ["+taskenums_2.TaskEvent.STATE_CHANGED+"]."}}var nextOrObserverMessage="Expected a function or an Object with one of "+"`next`, `error`, `complete` properties.";var nextValidator=fbsArgs.nullFunctionSpec(true).validator;var observerValidator=fbsArgs.looseObjectSpec(null,true).validator;function nextOrObserverValidator(p){try{nextValidator(p);return}catch(e){}try{observerValidator(p);var anyDefined=typeUtils.isJustDef(p["next"])||typeUtils.isJustDef(p["error"])||typeUtils.isJustDef(p["complete"]);if(!anyDefined){throw""}return}catch(e){throw nextOrObserverMessage}}var specs=[fbsArgs.stringSpec(typeValidator),fbsArgs.looseObjectSpec(nextOrObserverValidator,true),fbsArgs.nullFunctionSpec(true),fbsArgs.nullFunctionSpec(true)];fbsArgs.validate("on",specs,arguments);var self=this;function makeBinder(specs){function binder(nextOrObserver,error,opt_complete){if(specs!==null){fbsArgs.validate("on",specs,arguments)}var observer=new observer_1.Observer(nextOrObserver,error,completed);self.addObserver_(observer);return function(){self.removeObserver_(observer)}}return binder}function binderNextOrObserverValidator(p){if(p===null){throw nextOrObserverMessage}nextOrObserverValidator(p)}var binderSpecs=[fbsArgs.looseObjectSpec(binderNextOrObserverValidator),fbsArgs.nullFunctionSpec(true),fbsArgs.nullFunctionSpec(true)];var typeOnly=!(typeUtils.isJustDef(nextOrObserver)||typeUtils.isJustDef(error)||typeUtils.isJustDef(completed));if(typeOnly){return makeBinder(binderSpecs)}else{return makeBinder(null)(nextOrObserver,error,completed)}};UploadTask.prototype.then=function(onFulfilled,onRejected){return this.promise_.then(onFulfilled,onRejected)};UploadTask.prototype.catch=function(onRejected){return this.then(null,onRejected)};UploadTask.prototype.addObserver_=function(observer){this.observers_.push(observer);this.notifyObserver_(observer)};UploadTask.prototype.removeObserver_=function(observer){fbsArray.remove(this.observers_,observer)};UploadTask.prototype.notifyObservers_=function(){var _this=this;this.finishPromise_();var observers=fbsArray.clone(this.observers_);observers.forEach(function(observer){_this.notifyObserver_(observer)})};UploadTask.prototype.finishPromise_=function(){if(this.resolve_!==null){var triggered=true;switch(fbsTaskEnums.taskStateFromInternalTaskState(this.state_)){case taskenums_2.TaskState.SUCCESS:async_1.async(this.resolve_.bind(null,this.snapshot))();break;case taskenums_2.TaskState.CANCELED:case taskenums_2.TaskState.ERROR:var toCall=this.reject_;async_1.async(toCall.bind(null,this.error_))();break;default:triggered=false;break}if(triggered){this.resolve_=null;this.reject_=null}}};UploadTask.prototype.notifyObserver_=function(observer){var externalState=fbsTaskEnums.taskStateFromInternalTaskState(this.state_);switch(externalState){case taskenums_2.TaskState.RUNNING:case taskenums_2.TaskState.PAUSED:if(observer.next!==null){async_1.async(observer.next.bind(observer,this.snapshot))()}break;case taskenums_2.TaskState.SUCCESS:if(observer.complete!==null){async_1.async(observer.complete.bind(observer))()}break;case taskenums_2.TaskState.CANCELED:case taskenums_2.TaskState.ERROR:if(observer.error!==null){
async_1.async(observer.error.bind(observer,this.error_))()}break;default:if(observer.error!==null){async_1.async(observer.error.bind(observer,this.error_))()}}};UploadTask.prototype.resume=function(){fbsArgs.validate("resume",[],arguments);var valid=this.state_===taskenums_1.InternalTaskState.PAUSED||this.state_===taskenums_1.InternalTaskState.PAUSING;if(valid){this.transition_(taskenums_1.InternalTaskState.RUNNING)}return valid};UploadTask.prototype.pause=function(){fbsArgs.validate("pause",[],arguments);var valid=this.state_===taskenums_1.InternalTaskState.RUNNING;if(valid){this.transition_(taskenums_1.InternalTaskState.PAUSING)}return valid};UploadTask.prototype.cancel=function(){fbsArgs.validate("cancel",[],arguments);var valid=this.state_===taskenums_1.InternalTaskState.RUNNING||this.state_===taskenums_1.InternalTaskState.PAUSING;if(valid){this.transition_(taskenums_1.InternalTaskState.CANCELING)}return valid};return UploadTask}();exports.UploadTask=UploadTask},{"./implementation/args":107,"./implementation/array":108,"./implementation/async":109,"./implementation/error":114,"./implementation/observer":121,"./implementation/promise_external":123,"./implementation/requests":127,"./implementation/taskenums":129,"./implementation/type":130,"./tasksnapshot":138}],138:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var UploadTaskSnapshot=function(){function UploadTaskSnapshot(bytesTransferred,totalBytes,state,metadata,task,ref){this.bytesTransferred=bytesTransferred;this.totalBytes=totalBytes;this.state=state;this.metadata=metadata;this.task=task;this.ref=ref}Object.defineProperty(UploadTaskSnapshot.prototype,"downloadURL",{get:function(){if(this.metadata!==null){var urls=this.metadata["downloadURLs"];if(urls!=null&&urls[0]!=null){return urls[0]}else{return null}}else{return null}},enumerable:true,configurable:true});return UploadTaskSnapshot}();exports.UploadTaskSnapshot=UploadTaskSnapshot},{}],139:[function(require,module,exports){"use strict";function __export(m){for(var p in m)if(!exports.hasOwnProperty(p))exports[p]=m[p]}Object.defineProperty(exports,"__esModule",{value:true});__export(require("./src/assert"));__export(require("./src/crypt"));__export(require("./src/constants"));__export(require("./src/deepCopy"));__export(require("./src/deferred"));__export(require("./src/environment"));__export(require("./src/errors"));__export(require("./src/json"));__export(require("./src/jwt"));__export(require("./src/obj"));__export(require("./src/query"));__export(require("./src/sha1"));__export(require("./src/subscribe"));__export(require("./src/validation"));__export(require("./src/utf8"))},{"./src/assert":140,"./src/constants":141,"./src/crypt":142,"./src/deepCopy":143,"./src/deferred":144,"./src/environment":145,"./src/errors":146,"./src/json":148,"./src/jwt":149,"./src/obj":150,"./src/query":151,"./src/sha1":152,"./src/subscribe":153,"./src/utf8":154,"./src/validation":155}],140:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require("./constants");exports.assert=function(assertion,message){if(!assertion){throw exports.assertionError(message)}};exports.assertionError=function(message){return new Error("Firebase Database ("+constants_1.CONSTANTS.SDK_VERSION+") INTERNAL ASSERT FAILED: "+message)}},{"./constants":141}],141:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CONSTANTS={NODE_CLIENT:false,NODE_ADMIN:false,SDK_VERSION:"${JSCORE_VERSION}"}},{}],142:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var stringToByteArray=function(str){var output=[],p=0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);while(c>255){output[p++]=c&255;c>>=8}output[p++]=c}return output};var byteArrayToString=function(bytes){var CHUNK_SIZE=8192;if(bytes.length<CHUNK_SIZE){return String.fromCharCode.apply(null,bytes)}var str="";for(var i=0;i<bytes.length;i+=CHUNK_SIZE){var chunk=bytes.slice(i,i+CHUNK_SIZE);str+=String.fromCharCode.apply(null,chunk)}return str};exports.base64={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz"+"0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob==="function",encodeByteArray:function(input,opt_webSafe){if(!Array.isArray(input)){throw Error("encodeByteArray takes an array as a parameter")}this.init_();var byteToCharMap=opt_webSafe?this.byteToCharMapWebSafe_:this.byteToCharMap_;var output=[];for(var i=0;i<input.length;i+=3){var byte1=input[i];var haveByte2=i+1<input.length;var byte2=haveByte2?input[i+1]:0;var haveByte3=i+2<input.length;var byte3=haveByte3?input[i+2]:0;var outByte1=byte1>>2;var outByte2=(byte1&3)<<4|byte2>>4;var outByte3=(byte2&15)<<2|byte3>>6;var outByte4=byte3&63;if(!haveByte3){outByte4=64;if(!haveByte2){outByte3=64}}output.push(byteToCharMap[outByte1],byteToCharMap[outByte2],byteToCharMap[outByte3],byteToCharMap[outByte4])}return output.join("")},encodeString:function(input,opt_webSafe){if(this.HAS_NATIVE_SUPPORT&&!opt_webSafe){return btoa(input)}return this.encodeByteArray(stringToByteArray(input),opt_webSafe)},decodeString:function(input,opt_webSafe){if(this.HAS_NATIVE_SUPPORT&&!opt_webSafe){return atob(input)}return byteArrayToString(this.decodeStringToByteArray(input,opt_webSafe))},decodeStringToByteArray:function(input,opt_webSafe){this.init_();var charToByteMap=opt_webSafe?this.charToByteMapWebSafe_:this.charToByteMap_;var output=[];for(var i=0;i<input.length;){var byte1=charToByteMap[input.charAt(i++)];var haveByte2=i<input.length;var byte2=haveByte2?charToByteMap[input.charAt(i)]:0;++i;var haveByte3=i<input.length;var byte3=haveByte3?charToByteMap[input.charAt(i)]:64;++i;var haveByte4=i<input.length;var byte4=haveByte4?charToByteMap[input.charAt(i)]:64;++i;if(byte1==null||byte2==null||byte3==null||byte4==null){throw Error()}var outByte1=byte1<<2|byte2>>4;output.push(outByte1);if(byte3!=64){var outByte2=byte2<<4&240|byte3>>2;output.push(outByte2);if(byte4!=64){var outByte3=byte3<<6&192|byte4;output.push(outByte3)}}}return output},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={};this.charToByteMap_={};this.byteToCharMapWebSafe_={};this.charToByteMapWebSafe_={};for(var i=0;i<this.ENCODED_VALS.length;i++){this.byteToCharMap_[i]=this.ENCODED_VALS.charAt(i);this.charToByteMap_[this.byteToCharMap_[i]]=i;this.byteToCharMapWebSafe_[i]=this.ENCODED_VALS_WEBSAFE.charAt(i);this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]]=i;if(i>=this.ENCODED_VALS_BASE.length){this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)]=i;this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)]=i}}}}};exports.base64Encode=function(str){var utf8Bytes=stringToByteArray(str);return exports.base64.encodeByteArray(utf8Bytes,true)};exports.base64Decode=function(str){try{return exports.base64.decodeString(str,true)}catch(e){console.error("base64Decode failed: ",e)}return null}},{}],143:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function deepCopy(value){return deepExtend(undefined,value)}exports.deepCopy=deepCopy;function deepExtend(target,source){if(!(source instanceof Object)){return source}switch(source.constructor){case Date:var dateValue=source;return new Date(dateValue.getTime());case Object:if(target===undefined){target={}}break;case Array:target=[];break;default:return source}for(var prop in source){if(!source.hasOwnProperty(prop)){continue}target[prop]=deepExtend(target[prop],source[prop])}return target}exports.deepExtend=deepExtend;function patchProperty(obj,prop,value){obj[prop]=value}exports.patchProperty=patchProperty},{}],144:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Deferred=function(){function Deferred(){var _this=this;this.promise=new Promise(function(resolve,reject){_this.resolve=resolve;_this.reject=reject})}Deferred.prototype.wrapCallback=function(callback){var _this=this;return function(error,value){if(error){_this.reject(error)}else{_this.resolve(value)}if(typeof callback==="function"){_this.promise.catch(function(){});if(callback.length===1){callback(error)}else{callback(error,value)}}}};return Deferred}();exports.Deferred=Deferred},{}],145:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require("./constants");exports.getUA=function(){if(typeof navigator!=="undefined"&&typeof navigator["userAgent"]==="string"){return navigator["userAgent"]}else{return""}};exports.isMobileCordova=function(){return typeof window!=="undefined"&&!!(window["cordova"]||window["phonegap"]||window["PhoneGap"])&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(exports.getUA())};exports.isReactNative=function(){return typeof navigator==="object"&&navigator["product"]==="ReactNative"};exports.isNodeSdk=function(){return constants_1.CONSTANTS.NODE_CLIENT===true||constants_1.CONSTANTS.NODE_ADMIN===true}},{"./constants":141}],146:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var ERROR_NAME="FirebaseError";var captureStackTrace=Error.captureStackTrace;function patchCapture(captureFake){var result=captureStackTrace;captureStackTrace=captureFake;return result}exports.patchCapture=patchCapture;var FirebaseError=function(){function FirebaseError(code,message){this.code=code;this.message=message;var stack;if(captureStackTrace){captureStackTrace(this,ErrorFactory.prototype.create)}else{var err_1=Error.apply(this,arguments);this.name=ERROR_NAME;Object.defineProperty(this,"stack",{get:function(){return err_1.stack}})}}return FirebaseError}();exports.FirebaseError=FirebaseError;FirebaseError.prototype=Object.create(Error.prototype);FirebaseError.prototype.constructor=FirebaseError;FirebaseError.prototype.name=ERROR_NAME;var ErrorFactory=function(){function ErrorFactory(service,serviceName,errors){this.service=service;this.serviceName=serviceName;this.errors=errors;this.pattern=/\{\$([^}]+)}/g}ErrorFactory.prototype.create=function(code,data){if(data===undefined){data={}}var template=this.errors[code];var fullCode=this.service+"/"+code;var message;if(template===undefined){message="Error"}else{message=template.replace(this.pattern,function(match,key){var value=data[key];return value!==undefined?value.toString():"<"+key+"?>"})}message=this.serviceName+": "+message+" ("+fullCode+").";var err=new FirebaseError(fullCode,message);for(var prop in data){if(!data.hasOwnProperty(prop)||prop.slice(-1)==="_"){continue}err[prop]=data[prop]}return err};return ErrorFactory}();exports.ErrorFactory=ErrorFactory},{}],147:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var Hash=function(){function Hash(){this.blockSize=-1}return Hash}();exports.Hash=Hash},{}],148:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function jsonEval(str){return JSON.parse(str)}exports.jsonEval=jsonEval;function stringify(data){return JSON.stringify(data)}exports.stringify=stringify},{}],149:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var crypt_1=require("./crypt");var json_1=require("./json");exports.decode=function(token){var header={},claims={},data={},signature="";try{var parts=token.split(".");header=json_1.jsonEval(crypt_1.base64Decode(parts[0])||"");claims=json_1.jsonEval(crypt_1.base64Decode(parts[1])||"");signature=parts[2];data=claims["d"]||{};delete claims["d"]}catch(e){}return{header:header,claims:claims,data:data,signature:signature}};exports.isValidTimestamp=function(token){var claims=exports.decode(token).claims,now=Math.floor((new Date).getTime()/1e3),validSince,validUntil;if(typeof claims==="object"){if(claims.hasOwnProperty("nbf")){validSince=claims["nbf"]}else if(claims.hasOwnProperty("iat")){validSince=claims["iat"]}if(claims.hasOwnProperty("exp")){validUntil=claims["exp"]}else{validUntil=validSince+86400}}return now&&validSince&&validUntil&&now>=validSince&&now<=validUntil};exports.issuedAtTime=function(token){var claims=exports.decode(token).claims;if(typeof claims==="object"&&claims.hasOwnProperty("iat")){return claims["iat"]}return null};exports.isValidFormat=function(token){var decoded=exports.decode(token),claims=decoded.claims;return!!decoded.signature&&!!claims&&typeof claims==="object"&&claims.hasOwnProperty("iat")};exports.isAdmin=function(token){var claims=exports.decode(token).claims;return typeof claims==="object"&&claims["admin"]===true}},{"./crypt":142,"./json":148}],150:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.contains=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)};exports.safeGet=function(obj,key){if(Object.prototype.hasOwnProperty.call(obj,key))return obj[key]};exports.forEach=function(obj,fn){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){fn(key,obj[key])}}};exports.extend=function(objTo,objFrom){exports.forEach(objFrom,function(key,value){objTo[key]=value});return objTo};exports.clone=function(obj){return exports.extend({},obj)};exports.isNonNullObject=function(obj){return typeof obj==="object"&&obj!==null};exports.isEmpty=function(obj){for(var key in obj){return false}return true};exports.getCount=function(obj){var rv=0;for(var key in obj){rv++}return rv};exports.map=function(obj,f,opt_obj){var res={};for(var key in obj){res[key]=f.call(opt_obj,obj[key],key,obj)}return res};exports.findKey=function(obj,fn,opt_this){for(var key in obj){if(fn.call(opt_this,obj[key],key,obj)){return key}}return undefined};exports.findValue=function(obj,fn,opt_this){var key=exports.findKey(obj,fn,opt_this);return key&&obj[key]};exports.getAnyKey=function(obj){for(var key in obj){return key}};exports.getValues=function(obj){var res=[];var i=0;for(var key in obj){res[i++]=obj[key]}return res};exports.every=function(obj,fn){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){if(!fn(key,obj[key])){return false}}}return true}},{}],151:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var obj_1=require("./obj");exports.querystring=function(querystringParams){var params=[];obj_1.forEach(querystringParams,function(key,value){if(Array.isArray(value)){value.forEach(function(arrayVal){params.push(encodeURIComponent(key)+"="+encodeURIComponent(arrayVal))})}else{params.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}});return params.length?"&"+params.join("&"):""};exports.querystringDecode=function(querystring){var obj={};var tokens=querystring.replace(/^\?/,"").split("&");tokens.forEach(function(token){if(token){var key=token.split("=");obj[key[0]]=key[1]}});return obj}},{"./obj":150}],152:[function(require,module,exports){"use strict";var __extends=this&&this.__extends||function(){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p]};return function(d,b){extendStatics(d,b);function __(){this.constructor=d}d.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:true});var hash_1=require("./hash");var Sha1=function(_super){__extends(Sha1,_super);function Sha1(){var _this=_super.call(this)||this;_this.chain_=[];_this.buf_=[];_this.W_=[];_this.pad_=[];_this.inbuf_=0;_this.total_=0;_this.blockSize=512/8;_this.pad_[0]=128;for(var i=1;i<_this.blockSize;++i){_this.pad_[i]=0}_this.reset();return _this}Sha1.prototype.reset=function(){this.chain_[0]=1732584193;this.chain_[1]=4023233417;this.chain_[2]=2562383102;this.chain_[3]=271733878;this.chain_[4]=3285377520;this.inbuf_=0;this.total_=0};Sha1.prototype.compress_=function(buf,opt_offset){if(!opt_offset){opt_offset=0}var W=this.W_;if(typeof buf==="string"){for(var i=0;i<16;i++){W[i]=buf.charCodeAt(opt_offset)<<24|buf.charCodeAt(opt_offset+1)<<16|buf.charCodeAt(opt_offset+2)<<8|buf.charCodeAt(opt_offset+3);opt_offset+=4}}else{for(var i=0;i<16;i++){W[i]=buf[opt_offset]<<24|buf[opt_offset+1]<<16|buf[opt_offset+2]<<8|buf[opt_offset+3];opt_offset+=4}}for(var i=16;i<80;i++){var t=W[i-3]^W[i-8]^W[i-14]^W[i-16];W[i]=(t<<1|t>>>31)&4294967295}var a=this.chain_[0];var b=this.chain_[1];var c=this.chain_[2];var d=this.chain_[3];var e=this.chain_[4];var f,k;for(var i=0;i<80;i++){if(i<40){if(i<20){f=d^b&(c^d);k=1518500249}else{f=b^c^d;k=1859775393}}else{if(i<60){f=b&c|d&(b|c);k=2400959708}else{f=b^c^d;k=3395469782}}var t=(a<<5|a>>>27)+f+e+k+W[i]&4294967295;e=d;d=c;c=(b<<30|b>>>2)&4294967295;b=a;a=t}this.chain_[0]=this.chain_[0]+a&4294967295;this.chain_[1]=this.chain_[1]+b&4294967295;this.chain_[2]=this.chain_[2]+c&4294967295;this.chain_[3]=this.chain_[3]+d&4294967295;this.chain_[4]=this.chain_[4]+e&4294967295};Sha1.prototype.update=function(bytes,opt_length){if(bytes==null){return}if(opt_length===undefined){opt_length=bytes.length}var lengthMinusBlock=opt_length-this.blockSize;var n=0;var buf=this.buf_;var inbuf=this.inbuf_;while(n<opt_length){if(inbuf==0){while(n<=lengthMinusBlock){this.compress_(bytes,n);n+=this.blockSize}}if(typeof bytes==="string"){while(n<opt_length){buf[inbuf]=bytes.charCodeAt(n);++inbuf;++n;if(inbuf==this.blockSize){this.compress_(buf);inbuf=0;break}}}else{while(n<opt_length){buf[inbuf]=bytes[n];++inbuf;++n;if(inbuf==this.blockSize){this.compress_(buf);inbuf=0;break}}}}this.inbuf_=inbuf;this.total_+=opt_length};Sha1.prototype.digest=function(){var digest=[];var totalBits=this.total_*8;if(this.inbuf_<56){this.update(this.pad_,56-this.inbuf_)}else{this.update(this.pad_,this.blockSize-(this.inbuf_-56))}for(var i=this.blockSize-1;i>=56;i--){this.buf_[i]=totalBits&255;totalBits/=256}this.compress_(this.buf_);var n=0;for(var i=0;i<5;i++){for(var j=24;j>=0;j-=8){digest[n]=this.chain_[i]>>j&255;++n}}return digest};return Sha1}(hash_1.Hash);exports.Sha1=Sha1},{"./hash":147}],153:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});function createSubscribe(executor,onNoObservers){var proxy=new ObserverProxy(executor,onNoObservers);return proxy.subscribe.bind(proxy)}exports.createSubscribe=createSubscribe;var ObserverProxy=function(){function ObserverProxy(executor,onNoObservers){var _this=this;this.observers=[];this.unsubscribes=[];this.observerCount=0;this.task=Promise.resolve();this.finalized=false;this.onNoObservers=onNoObservers;this.task.then(function(){executor(_this)}).catch(function(e){_this.error(e)})}ObserverProxy.prototype.next=function(value){this.forEachObserver(function(observer){observer.next(value)})};ObserverProxy.prototype.error=function(error){this.forEachObserver(function(observer){observer.error(error)});this.close(error)};ObserverProxy.prototype.complete=function(){this.forEachObserver(function(observer){observer.complete()});this.close()};ObserverProxy.prototype.subscribe=function(nextOrObserver,error,complete){var _this=this;var observer;if(nextOrObserver===undefined&&error===undefined&&complete===undefined){throw new Error("Missing Observer.")}if(implementsAnyMethods(nextOrObserver,["next","error","complete"])){observer=nextOrObserver}else{observer={next:nextOrObserver,error:error,complete:complete}}if(observer.next===undefined){observer.next=noop}if(observer.error===undefined){observer.error=noop}if(observer.complete===undefined){observer.complete=noop}var unsub=this.unsubscribeOne.bind(this,this.observers.length);if(this.finalized){this.task.then(function(){try{if(_this.finalError){observer.error(_this.finalError)}else{observer.complete()}}catch(e){}return})}this.observers.push(observer);return unsub};ObserverProxy.prototype.unsubscribeOne=function(i){if(this.observers===undefined||this.observers[i]===undefined){return}delete this.observers[i];this.observerCount-=1;if(this.observerCount===0&&this.onNoObservers!==undefined){this.onNoObservers(this)}};ObserverProxy.prototype.forEachObserver=function(fn){if(this.finalized){return}for(var i=0;i<this.observers.length;i++){this.sendOne(i,fn)}};ObserverProxy.prototype.sendOne=function(i,fn){var _this=this;this.task.then(function(){if(_this.observers!==undefined&&_this.observers[i]!==undefined){try{fn(_this.observers[i])}catch(e){if(typeof console!=="undefined"&&console.error){console.error(e)}}}})};ObserverProxy.prototype.close=function(err){var _this=this;if(this.finalized){return}this.finalized=true;if(err!==undefined){this.finalError=err}this.task.then(function(){_this.observers=undefined;_this.onNoObservers=undefined})};return ObserverProxy}();function async(fn,onError){return function(){var args=[];for(var _i=0;_i<arguments.length;_i++){args[_i]=arguments[_i]}Promise.resolve(true).then(function(){fn.apply(void 0,args)}).catch(function(error){if(onError){onError(error)}})}}exports.async=async;function implementsAnyMethods(obj,methods){if(typeof obj!=="object"||obj===null){return false}for(var _i=0,methods_1=methods;_i<methods_1.length;_i++){var method=methods_1[_i];if(method in obj&&typeof obj[method]==="function"){return true}}return false}function noop(){}},{}],154:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var assert_1=require("./assert");exports.stringToByteArray=function(str){var out=[],p=0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c>=55296&&c<=56319){var high=c-55296;i++;assert_1.assert(i<str.length,"Surrogate pair missing trail surrogate.");var low=str.charCodeAt(i)-56320;c=65536+(high<<10)+low}if(c<128){out[p++]=c}else if(c<2048){out[p++]=c>>6|192;out[p++]=c&63|128}else if(c<65536){out[p++]=c>>12|224;out[p++]=c>>6&63|128;out[p++]=c&63|128}else{out[p++]=c>>18|240;out[p++]=c>>12&63|128;out[p++]=c>>6&63|128;out[p++]=c&63|128}}return out};exports.stringLength=function(str){var p=0;for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c<128){p++}else if(c<2048){p+=2}else if(c>=55296&&c<=56319){p+=4;i++}else{p+=3}}return p}},{"./assert":140}],155:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateArgCount=function(fnName,minCount,maxCount,argCount){var argError;if(argCount<minCount){argError="at least "+minCount}else if(argCount>maxCount){argError=maxCount===0?"none":"no more than "+maxCount}if(argError){var error=fnName+" failed: Was called with "+argCount+(argCount===1?" argument.":" arguments.")+" Expects "+argError+".";throw new Error(error)}};function errorPrefix(fnName,argumentNumber,optional){var argName="";switch(argumentNumber){case 1:argName=optional?"first":"First";break;case 2:argName=optional?"second":"Second";break;case 3:argName=optional?"third":"Third";break;case 4:argName=optional?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var error=fnName+" failed: ";error+=argName+" argument ";return error}exports.errorPrefix=errorPrefix;function validateNamespace(fnName,argumentNumber,namespace,optional){if(optional&&!namespace)return;if(typeof namespace!=="string"){throw new Error(errorPrefix(fnName,argumentNumber,optional)+"must be a valid firebase namespace.")}}exports.validateNamespace=validateNamespace;function validateCallback(fnName,argumentNumber,callback,optional){if(optional&&!callback)return;if(typeof callback!=="function")throw new Error(errorPrefix(fnName,argumentNumber,optional)+"must be a valid function.")}exports.validateCallback=validateCallback;function validateContextObject(fnName,argumentNumber,context,optional){if(optional&&!context)return;if(typeof context!=="object"||context===null)throw new Error(errorPrefix(fnName,argumentNumber,optional)+"must be a valid context object.")}exports.validateContextObject=validateContextObject},{}],156:[function(require,module,exports){module.exports=require("./lib/axios")},{"./lib/axios":158}],157:[function(require,module,exports){(function(process){"use strict";var utils=require("./../utils");var settle=require("./../core/settle");var buildURL=require("./../helpers/buildURL");var parseHeaders=require("./../helpers/parseHeaders");var isURLSameOrigin=require("./../helpers/isURLSameOrigin");var createError=require("../core/createError");var btoa=typeof window!=="undefined"&&window.btoa&&window.btoa.bind(window)||require("./../helpers/btoa");module.exports=function xhrAdapter(config){return new Promise(function dispatchXhrRequest(resolve,reject){var requestData=config.data;var requestHeaders=config.headers;if(utils.isFormData(requestData)){delete requestHeaders["Content-Type"]}var request=new XMLHttpRequest;var loadEvent="onreadystatechange";var xDomain=false;if(process.env.NODE_ENV!=="test"&&typeof window!=="undefined"&&window.XDomainRequest&&!("withCredentials"in request)&&!isURLSameOrigin(config.url)){request=new window.XDomainRequest;loadEvent="onload";xDomain=true;request.onprogress=function handleProgress(){};request.ontimeout=function handleTimeout(){}}if(config.auth){var username=config.auth.username||"";var password=config.auth.password||"";requestHeaders.Authorization="Basic "+btoa(username+":"+password)}request.open(config.method.toUpperCase(),buildURL(config.url,config.params,config.paramsSerializer),true);request.timeout=config.timeout;request[loadEvent]=function handleLoad(){if(!request||request.readyState!==4&&!xDomain){return}if(request.status===0&&!(request.responseURL&&request.responseURL.indexOf("file:")===0)){return}var responseHeaders="getAllResponseHeaders"in request?parseHeaders(request.getAllResponseHeaders()):null;var responseData=!config.responseType||config.responseType==="text"?request.responseText:request.response;var response={data:responseData,status:request.status===1223?204:request.status,statusText:request.status===1223?"No Content":request.statusText,headers:responseHeaders,config:config,request:request};settle(resolve,reject,response);request=null};request.onerror=function handleError(){reject(createError("Network Error",config));request=null};request.ontimeout=function handleTimeout(){reject(createError("timeout of "+config.timeout+"ms exceeded",config,"ECONNABORTED"));request=null};if(utils.isStandardBrowserEnv()){var cookies=require("./../helpers/cookies");var xsrfValue=(config.withCredentials||isURLSameOrigin(config.url))&&config.xsrfCookieName?cookies.read(config.xsrfCookieName):undefined;if(xsrfValue){requestHeaders[config.xsrfHeaderName]=xsrfValue}}if("setRequestHeader"in request){utils.forEach(requestHeaders,function setRequestHeader(val,key){if(typeof requestData==="undefined"&&key.toLowerCase()==="content-type"){delete requestHeaders[key]}else{request.setRequestHeader(key,val)}})}if(config.withCredentials){request.withCredentials=true}if(config.responseType){try{request.responseType=config.responseType}catch(e){if(request.responseType!=="json"){throw e}}}if(typeof config.onDownloadProgress==="function"){request.addEventListener("progress",config.onDownloadProgress)}if(typeof config.onUploadProgress==="function"&&request.upload){request.upload.addEventListener("progress",config.onUploadProgress)}if(config.cancelToken){config.cancelToken.promise.then(function onCanceled(cancel){if(!request){return}request.abort();reject(cancel);request=null})}if(requestData===undefined){requestData=null}request.send(requestData)})}}).call(this,require("_process"))},{"../core/createError":164,"./../core/settle":167,"./../helpers/btoa":171,"./../helpers/buildURL":172,"./../helpers/cookies":174,"./../helpers/isURLSameOrigin":176,"./../helpers/parseHeaders":178,"./../utils":180,_process:187}],158:[function(require,module,exports){"use strict";var utils=require("./utils");var bind=require("./helpers/bind");var Axios=require("./core/Axios");var defaults=require("./defaults");function createInstance(defaultConfig){var context=new Axios(defaultConfig);var instance=bind(Axios.prototype.request,context);utils.extend(instance,Axios.prototype,context);utils.extend(instance,context);return instance}var axios=createInstance(defaults);axios.Axios=Axios;axios.create=function create(instanceConfig){return createInstance(utils.merge(defaults,instanceConfig))};axios.Cancel=require("./cancel/Cancel");axios.CancelToken=require("./cancel/CancelToken");axios.isCancel=require("./cancel/isCancel");axios.all=function all(promises){return Promise.all(promises)};axios.spread=require("./helpers/spread");module.exports=axios;module.exports.default=axios},{"./cancel/Cancel":159,"./cancel/CancelToken":160,"./cancel/isCancel":161,"./core/Axios":162,"./defaults":169,"./helpers/bind":170,"./helpers/spread":179,"./utils":180}],159:[function(require,module,exports){"use strict";function Cancel(message){this.message=message}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")};Cancel.prototype.__CANCEL__=true;module.exports=Cancel},{}],160:[function(require,module,exports){"use strict";var Cancel=require("./Cancel");function CancelToken(executor){if(typeof executor!=="function"){throw new TypeError("executor must be a function.")}var resolvePromise;this.promise=new Promise(function promiseExecutor(resolve){resolvePromise=resolve});var token=this;executor(function cancel(message){if(token.reason){return}token.reason=new Cancel(message);resolvePromise(token.reason)})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason){throw this.reason}};CancelToken.source=function source(){var cancel;var token=new CancelToken(function executor(c){cancel=c});return{token:token,cancel:cancel}};module.exports=CancelToken},{"./Cancel":159}],161:[function(require,module,exports){"use strict";module.exports=function isCancel(value){return!!(value&&value.__CANCEL__)}},{}],162:[function(require,module,exports){"use strict";var defaults=require("./../defaults");var utils=require("./../utils");var InterceptorManager=require("./InterceptorManager");var dispatchRequest=require("./dispatchRequest");var isAbsoluteURL=require("./../helpers/isAbsoluteURL");var combineURLs=require("./../helpers/combineURLs");function Axios(instanceConfig){this.defaults=instanceConfig;this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}Axios.prototype.request=function request(config){if(typeof config==="string"){config=utils.merge({url:arguments[0]},arguments[1])}config=utils.merge(defaults,this.defaults,{method:"get"},config);if(config.baseURL&&!isAbsoluteURL(config.url)){config.url=combineURLs(config.baseURL,config.url)}var chain=[dispatchRequest,undefined];var promise=Promise.resolve(config);this.interceptors.request.forEach(function unshiftRequestInterceptors(interceptor){chain.unshift(interceptor.fulfilled,interceptor.rejected)});this.interceptors.response.forEach(function pushResponseInterceptors(interceptor){chain.push(interceptor.fulfilled,interceptor.rejected)});while(chain.length){promise=promise.then(chain.shift(),chain.shift())}return promise};utils.forEach(["delete","get","head"],function forEachMethodNoData(method){Axios.prototype[method]=function(url,config){return this.request(utils.merge(config||{},{method:method,url:url}))}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){Axios.prototype[method]=function(url,data,config){return this.request(utils.merge(config||{},{method:method,url:url,data:data}))}});module.exports=Axios},{"./../defaults":169,"./../helpers/combineURLs":173,"./../helpers/isAbsoluteURL":175,"./../utils":180,"./InterceptorManager":163,"./dispatchRequest":165}],163:[function(require,module,exports){"use strict";var utils=require("./../utils");function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(fulfilled,rejected){
this.handlers.push({fulfilled:fulfilled,rejected:rejected});return this.handlers.length-1};InterceptorManager.prototype.eject=function eject(id){if(this.handlers[id]){this.handlers[id]=null}};InterceptorManager.prototype.forEach=function forEach(fn){utils.forEach(this.handlers,function forEachHandler(h){if(h!==null){fn(h)}})};module.exports=InterceptorManager},{"./../utils":180}],164:[function(require,module,exports){"use strict";var enhanceError=require("./enhanceError");module.exports=function createError(message,config,code,response){var error=new Error(message);return enhanceError(error,config,code,response)}},{"./enhanceError":166}],165:[function(require,module,exports){"use strict";var utils=require("./../utils");var transformData=require("./transformData");var isCancel=require("../cancel/isCancel");var defaults=require("../defaults");function throwIfCancellationRequested(config){if(config.cancelToken){config.cancelToken.throwIfRequested()}}module.exports=function dispatchRequest(config){throwIfCancellationRequested(config);config.headers=config.headers||{};config.data=transformData(config.data,config.headers,config.transformRequest);config.headers=utils.merge(config.headers.common||{},config.headers[config.method]||{},config.headers||{});utils.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(method){delete config.headers[method]});var adapter=config.adapter||defaults.adapter;return adapter(config).then(function onAdapterResolution(response){throwIfCancellationRequested(config);response.data=transformData(response.data,response.headers,config.transformResponse);return response},function onAdapterRejection(reason){if(!isCancel(reason)){throwIfCancellationRequested(config);if(reason&&reason.response){reason.response.data=transformData(reason.response.data,reason.response.headers,config.transformResponse)}}return Promise.reject(reason)})}},{"../cancel/isCancel":161,"../defaults":169,"./../utils":180,"./transformData":168}],166:[function(require,module,exports){"use strict";module.exports=function enhanceError(error,config,code,response){error.config=config;if(code){error.code=code}error.response=response;return error}},{}],167:[function(require,module,exports){"use strict";var createError=require("./createError");module.exports=function settle(resolve,reject,response){var validateStatus=response.config.validateStatus;if(!response.status||!validateStatus||validateStatus(response.status)){resolve(response)}else{reject(createError("Request failed with status code "+response.status,response.config,null,response))}}},{"./createError":164}],168:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=function transformData(data,headers,fns){utils.forEach(fns,function transform(fn){data=fn(data,headers)});return data}},{"./../utils":180}],169:[function(require,module,exports){(function(process){"use strict";var utils=require("./utils");var normalizeHeaderName=require("./helpers/normalizeHeaderName");var PROTECTION_PREFIX=/^\)\]\}',?\n/;var DEFAULT_CONTENT_TYPE={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(headers,value){if(!utils.isUndefined(headers)&&utils.isUndefined(headers["Content-Type"])){headers["Content-Type"]=value}}function getDefaultAdapter(){var adapter;if(typeof XMLHttpRequest!=="undefined"){adapter=require("./adapters/xhr")}else if(typeof process!=="undefined"){adapter=require("./adapters/http")}return adapter}var defaults={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(data,headers){normalizeHeaderName(headers,"Content-Type");if(utils.isFormData(data)||utils.isArrayBuffer(data)||utils.isStream(data)||utils.isFile(data)||utils.isBlob(data)){return data}if(utils.isArrayBufferView(data)){return data.buffer}if(utils.isURLSearchParams(data)){setContentTypeIfUnset(headers,"application/x-www-form-urlencoded;charset=utf-8");return data.toString()}if(utils.isObject(data)){setContentTypeIfUnset(headers,"application/json;charset=utf-8");return JSON.stringify(data)}return data}],transformResponse:[function transformResponse(data){if(typeof data==="string"){data=data.replace(PROTECTION_PREFIX,"");try{data=JSON.parse(data)}catch(e){}}return data}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(status){return status>=200&&status<300}};defaults.headers={common:{Accept:"application/json, text/plain, */*"}};utils.forEach(["delete","get","head"],function forEachMehtodNoData(method){defaults.headers[method]={}});utils.forEach(["post","put","patch"],function forEachMethodWithData(method){defaults.headers[method]=utils.merge(DEFAULT_CONTENT_TYPE)});module.exports=defaults}).call(this,require("_process"))},{"./adapters/http":157,"./adapters/xhr":157,"./helpers/normalizeHeaderName":177,"./utils":180,_process:187}],170:[function(require,module,exports){"use strict";module.exports=function bind(fn,thisArg){return function wrap(){var args=new Array(arguments.length);for(var i=0;i<args.length;i++){args[i]=arguments[i]}return fn.apply(thisArg,args)}}},{}],171:[function(require,module,exports){"use strict";var chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function E(){this.message="String contains an invalid character"}E.prototype=new Error;E.prototype.code=5;E.prototype.name="InvalidCharacterError";function btoa(input){var str=String(input);var output="";for(var block,charCode,idx=0,map=chars;str.charAt(idx|0)||(map="=",idx%1);output+=map.charAt(63&block>>8-idx%1*8)){charCode=str.charCodeAt(idx+=3/4);if(charCode>255){throw new E}block=block<<8|charCode}return output}module.exports=btoa},{}],172:[function(require,module,exports){"use strict";var utils=require("./../utils");function encode(val){return encodeURIComponent(val).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}module.exports=function buildURL(url,params,paramsSerializer){if(!params){return url}var serializedParams;if(paramsSerializer){serializedParams=paramsSerializer(params)}else if(utils.isURLSearchParams(params)){serializedParams=params.toString()}else{var parts=[];utils.forEach(params,function serialize(val,key){if(val===null||typeof val==="undefined"){return}if(utils.isArray(val)){key=key+"[]"}if(!utils.isArray(val)){val=[val]}utils.forEach(val,function parseValue(v){if(utils.isDate(v)){v=v.toISOString()}else if(utils.isObject(v)){v=JSON.stringify(v)}parts.push(encode(key)+"="+encode(v))})});serializedParams=parts.join("&")}if(serializedParams){url+=(url.indexOf("?")===-1?"?":"&")+serializedParams}return url}},{"./../utils":180}],173:[function(require,module,exports){"use strict";module.exports=function combineURLs(baseURL,relativeURL){return baseURL.replace(/\/+$/,"")+"/"+relativeURL.replace(/^\/+/,"")}},{}],174:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(name,value,expires,path,domain,secure){var cookie=[];cookie.push(name+"="+encodeURIComponent(value));if(utils.isNumber(expires)){cookie.push("expires="+new Date(expires).toGMTString())}if(utils.isString(path)){cookie.push("path="+path)}if(utils.isString(domain)){cookie.push("domain="+domain)}if(secure===true){cookie.push("secure")}document.cookie=cookie.join("; ")},read:function read(name){var match=document.cookie.match(new RegExp("(^|;\\s*)("+name+")=([^;]*)"));return match?decodeURIComponent(match[3]):null},remove:function remove(name){this.write(name,"",Date.now()-864e5)}}}():function nonStandardBrowserEnv(){return{write:function write(){},read:function read(){return null},remove:function remove(){}}}()},{"./../utils":180}],175:[function(require,module,exports){"use strict";module.exports=function isAbsoluteURL(url){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(url)}},{}],176:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=utils.isStandardBrowserEnv()?function standardBrowserEnv(){var msie=/(msie|trident)/i.test(navigator.userAgent);var urlParsingNode=document.createElement("a");var originURL;function resolveURL(url){var href=url;if(msie){urlParsingNode.setAttribute("href",href);href=urlParsingNode.href}urlParsingNode.setAttribute("href",href);return{href:urlParsingNode.href,protocol:urlParsingNode.protocol?urlParsingNode.protocol.replace(/:$/,""):"",host:urlParsingNode.host,search:urlParsingNode.search?urlParsingNode.search.replace(/^\?/,""):"",hash:urlParsingNode.hash?urlParsingNode.hash.replace(/^#/,""):"",hostname:urlParsingNode.hostname,port:urlParsingNode.port,pathname:urlParsingNode.pathname.charAt(0)==="/"?urlParsingNode.pathname:"/"+urlParsingNode.pathname}}originURL=resolveURL(window.location.href);return function isURLSameOrigin(requestURL){var parsed=utils.isString(requestURL)?resolveURL(requestURL):requestURL;return parsed.protocol===originURL.protocol&&parsed.host===originURL.host}}():function nonStandardBrowserEnv(){return function isURLSameOrigin(){return true}}()},{"./../utils":180}],177:[function(require,module,exports){"use strict";var utils=require("../utils");module.exports=function normalizeHeaderName(headers,normalizedName){utils.forEach(headers,function processHeader(value,name){if(name!==normalizedName&&name.toUpperCase()===normalizedName.toUpperCase()){headers[normalizedName]=value;delete headers[name]}})}},{"../utils":180}],178:[function(require,module,exports){"use strict";var utils=require("./../utils");module.exports=function parseHeaders(headers){var parsed={};var key;var val;var i;if(!headers){return parsed}utils.forEach(headers.split("\n"),function parser(line){i=line.indexOf(":");key=utils.trim(line.substr(0,i)).toLowerCase();val=utils.trim(line.substr(i+1));if(key){parsed[key]=parsed[key]?parsed[key]+", "+val:val}});return parsed}},{"./../utils":180}],179:[function(require,module,exports){"use strict";module.exports=function spread(callback){return function wrap(arr){return callback.apply(null,arr)}}},{}],180:[function(require,module,exports){"use strict";var bind=require("./helpers/bind");var toString=Object.prototype.toString;function isArray(val){return toString.call(val)==="[object Array]"}function isArrayBuffer(val){return toString.call(val)==="[object ArrayBuffer]"}function isFormData(val){return typeof FormData!=="undefined"&&val instanceof FormData}function isArrayBufferView(val){var result;if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView){result=ArrayBuffer.isView(val)}else{result=val&&val.buffer&&val.buffer instanceof ArrayBuffer}return result}function isString(val){return typeof val==="string"}function isNumber(val){return typeof val==="number"}function isUndefined(val){return typeof val==="undefined"}function isObject(val){return val!==null&&typeof val==="object"}function isDate(val){return toString.call(val)==="[object Date]"}function isFile(val){return toString.call(val)==="[object File]"}function isBlob(val){return toString.call(val)==="[object Blob]"}function isFunction(val){return toString.call(val)==="[object Function]"}function isStream(val){return isObject(val)&&isFunction(val.pipe)}function isURLSearchParams(val){return typeof URLSearchParams!=="undefined"&&val instanceof URLSearchParams}function trim(str){return str.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){return typeof window!=="undefined"&&typeof document!=="undefined"&&typeof document.createElement==="function"}function forEach(obj,fn){if(obj===null||typeof obj==="undefined"){return}if(typeof obj!=="object"&&!isArray(obj)){obj=[obj]}if(isArray(obj)){for(var i=0,l=obj.length;i<l;i++){fn.call(null,obj[i],i,obj)}}else{for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){fn.call(null,obj[key],key,obj)}}}}function merge(){var result={};function assignValue(val,key){if(typeof result[key]==="object"&&typeof val==="object"){result[key]=merge(result[key],val)}else{result[key]=val}}for(var i=0,l=arguments.length;i<l;i++){forEach(arguments[i],assignValue)}return result}function extend(a,b,thisArg){forEach(b,function assignValue(val,key){if(thisArg&&typeof val==="function"){a[key]=bind(val,thisArg)}else{a[key]=val}});return a}module.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,extend:extend,trim:trim}},{"./helpers/bind":170}],181:[function(require,module,exports){require("@firebase/polyfill");module.exports=require("@firebase/app").default},{"@firebase/app":6,"@firebase/polyfill":102}],182:[function(require,module,exports){require("@firebase/auth")},{"@firebase/auth":8}],183:[function(require,module,exports){module.exports=require("@firebase/database")},{"@firebase/database":9}],184:[function(require,module,exports){var firebase=require("./app");require("./auth");require("./database");require("./messaging");require("./storage");module.exports=firebase},{"./app":181,"./auth":182,"./database":183,"./messaging":185,"./storage":186}],185:[function(require,module,exports){require("@firebase/messaging")},{"@firebase/messaging":91}],186:[function(require,module,exports){require("@firebase/storage")},{"@firebase/storage":106}],187:[function(require,module,exports){var process=module.exports={};var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if(typeof setTimeout==="function"){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if(typeof clearTimeout==="function"){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;runClearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],188:[function(require,module,exports){(function(root){var setTimeoutFunc=setTimeout;function noop(){}function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}function Promise(fn){if(typeof this!=="object")throw new TypeError("Promises must be constructed via new");if(typeof fn!=="function")throw new TypeError("not a function");this._state=0;this._handled=false;this._value=undefined;this._deferreds=[];doResolve(fn,this)}function handle(self,deferred){while(self._state===3){self=self._value}if(self._state===0){self._deferreds.push(deferred);return}self._handled=true;Promise._immediateFn(function(){var cb=self._state===1?deferred.onFulfilled:deferred.onRejected;if(cb===null){(self._state===1?resolve:reject)(deferred.promise,self._value);return}var ret;try{ret=cb(self._value)}catch(e){reject(deferred.promise,e);return}resolve(deferred.promise,ret)})}function resolve(self,newValue){try{if(newValue===self)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&(typeof newValue==="object"||typeof newValue==="function")){var then=newValue.then;if(newValue instanceof Promise){self._state=3;self._value=newValue;finale(self);return}else if(typeof then==="function"){doResolve(bind(then,newValue),self);return}}self._state=1;self._value=newValue;finale(self)}catch(e){reject(self,e)}}function reject(self,newValue){self._state=2;self._value=newValue;finale(self)}function finale(self){if(self._state===2&&self._deferreds.length===0){Promise._immediateFn(function(){if(!self._handled){Promise._unhandledRejectionFn(self._value)}})}for(var i=0,len=self._deferreds.length;i<len;i++){handle(self,self._deferreds[i])}self._deferreds=null}function Handler(onFulfilled,onRejected,promise){this.onFulfilled=typeof onFulfilled==="function"?onFulfilled:null;this.onRejected=typeof onRejected==="function"?onRejected:null;this.promise=promise}function doResolve(fn,self){var done=false;try{fn(function(value){if(done)return;done=true;resolve(self,value)},function(reason){if(done)return;done=true;reject(self,reason)})}catch(ex){if(done)return;done=true;reject(self,ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var prom=new this.constructor(noop);handle(this,new Handler(onFulfilled,onRejected,prom));return prom};Promise.all=function(arr){var args=Array.prototype.slice.call(arr);return new Promise(function(resolve,reject){if(args.length===0)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&(typeof val==="object"||typeof val==="function")){var then=val.then;if(typeof then==="function"){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(--remaining===0){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&typeof value==="object"&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};Promise._immediateFn=typeof setImmediate==="function"&&function(fn){setImmediate(fn)}||function(fn){setTimeoutFunc(fn,0)};Promise._unhandledRejectionFn=function _unhandledRejectionFn(err){if(typeof console!=="undefined"&&console){console.warn("Possible Unhandled Promise Rejection:",err)}};Promise._setImmediateFn=function _setImmediateFn(fn){Promise._immediateFn=fn};Promise._setUnhandledRejectionFn=function _setUnhandledRejectionFn(fn){Promise._unhandledRejectionFn=fn};if(typeof module!=="undefined"&&module.exports){module.exports=Promise}else if(!root.Promise){root.Promise=Promise}})(this)},{}]},{},[1]);
